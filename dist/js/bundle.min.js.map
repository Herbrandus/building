{"version":3,"sources":["node_modules/browser-pack/_prelude.js","bundle.min.js","src/ts/builder.component.ts","src/ts/config.component.ts","src/ts/main.ts","src/ts/mapGenerationFunctions.component.ts","src/ts/mapper.component.ts","src/ts/modifiers.component.ts","src/ts/primitives.component.ts","src/ts/renderelements.component.ts","src/ts/tile.component.ts"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Object","defineProperty","value","mapGenerationFunctions_component_1","tile_component_1","config_component_1","renderelements_component_1","Renderer","[object Object]","this","config","Config","calculations","MapGenerationFunctions","render","RenderElements","map","html","mapWidth","mapLength","tileWidth","tileLength","htmlMap","getMapWidth","y","halfWay","Math","round","x","getColumn","isDefined","getTopTile","tileTopColor","getColor","rgb","tileColor","emptyBlocksPresent","h","height","tileStack","type","TileType","None","edge","top","right","bottom","left","blockGroup","mapToBuild","mapTotalWidth","mapTotalLength","tileHeight","windowLights","lightInWindows","console","log","testTile","createTile","yDeviation","coords","tileHalfWidthLeft","tileHalfWidthRight","tileHalfLengthTop","mapLengthTop","mapLengthBottom","mapWidthPx","mapLengthPx","topMargin","shadowColor","groundColor","changeColorLighting","lastTile","startTileX","thisPosY","thisPosX","newTile","newData","Shadow","color","createPlane","Grass","options","currentTile","roof","pillar","slope","windowed","tower","stairs","halfArch","wholeArch","Body","createSlopeBlock","getTile","createBlock","random","createWindow","createDoor","HalfBlock","createPillarBlock","createHalfArch","createHalfBlock","xPos","yPos","tile","corner","./config.component","./mapGenerationFunctions.component","./renderelements.component","./tile.component","2","_allowDebug","_tileWidth","_tileLength","_tileHeight","_tileSmallAngle","_tileLargeAngle","_groundColor","Color","_buildingBaseColor","floor","_tileEdgeBleed","_maxAllowedHeight","_topMargin","_allowSurroundingDecorations","_lightInWindows","allowDebug","tileSmallAngle","tileLargeAngle","buildingBaseColor","tileEdgeBleed","maxAllowedHeight","allowSurroundingDecorations","mapArrayWidth","mapArrayLength","3","mapper_component_1","builder_component_1","RandomBuilding","_builder","_map","Map","document","querySelector","style","background","hex","build2DMap","addToBuilding","buildMap","col","getFirstDefinedColumn","remove","svg","XMLSerializer","serializeToString","base64","window","btoa","newImg","createElement","setAttribute","beforeElement","insertBefore","classList","add","innerHTML","building","colorMap","setColors","getBaseColor","shade0","changeColorLightingString","shade1","colorDivs","getColorStringByHue","debug","drawTileMap","addEventListener","querySelectorAll","forEach","item","parentElement","toggle","./builder.component","./mapper.component","4","smallAngle","largeAngle","maximumBlockIterations","blockWidth","blockHeight","smallOuterAngle","largeOuterAngle","horizontalWidthFromBottom","getHorizontalBottomShortestWidth","verticalHeightFromBottom","getVerticalBottomShortestHeight","horizontalWidthFromTop","getHorizontalTopLongestWidth","verticalHeightFromTop","getVerticalTopLongestHeight","totalWidth","totalHeight","diagonalWidth","sin","toRadians","diagonalHeight","cos","id","colorLeft","colorRight","gradient","angle","PI","TileColor","BuildingHeightVariations","params","error","validateHex","hexColor","charAt","setHex","hexToRgb","convertToHSL","validateRgb","setRgb","rgbToHex","toString","g","b","_colorRgb","s","l","_colorHsl","hexadecimal","hexVal1","hexVal2","hexVal3","_colorHex","match","hexValues","substr","split","hexPair1","parseInt","hexPair2","hexPair3","hexR","Number","hexG","hexB","amount","newR","newG","newB","hue","newHue","convertHSLtoRGB","convertRGBtoHex","cmin","min","cmax","max","delta","abs","toFixed","m","5","primitives_component_1","modifiers_component_1","mapMaxHeight","mapEdgeWidth","averageBuildingSize","pyramid","mapGen","primitives","Primitives","mods","Modifiers","_blockHeightVariationLabels","TallCenter","TallSurrounds","Random","_blockHeightVariation","_world","_mapWidth","_mapLength","_mapMaxHeight","_mapEdgeWidth","_averageBuildingSize","_blockHeight","_maximumBlockIterations","_additionalBlockIterations","calculateAdditionalBlockIterations","_blockGroups","_blockEdges","_blockHeightsArray","_mapHalfLength","_blockIdIterator","_blockAmountIterator","_blockHeightIterator","_decorationLineH","newLineHue","lineColor","_defaultColor","_lineColor","_firstLevelColor","_HorizontalRemainingEmptyBlocksMin","_HorizontalRemainingEmptyBlocksMax","_surroundingsGrassColor","_surroundingsWaterColor","_surroundingsSandColor","_surroundingsDefaultColor","_showWindows","firstBlockHeight","mapLengthHalf","startblockLength","startblockWidth","startblockXfromCenter","startblockLengthHalf","startingPositionX","buildGardens","useWaterGarden","slopeY","ceil","hollowBuildingBlock","openGroundLevel","thisBlockGroup","column","Column","xConditions","thisPillar","tileType","thisWindowed","isRoof","push","Tile","indexOf","setEdges","hasEdge","getEdges","addBuildingComponent","edgePointY","edgePointX","grass","getLeastOpenSpaceOnX","landsLength","landsEdge","defaultHeight","gardenBlock","clearMapEdges","mirrorMap","mapHalfLength","blockGroups","maxBlockIterations","blockAmountIterator","blockEdges","blockHeightsArray","heightsArray","blockIdIterator","blockHeightVariation","lineHeight","defaultColor","firstLevelColor","decorativeColors","showWindows","considerLowerEdges","pos","xMinValues","xMaxValues","xMin","xMax","defined","colX","colY","colHeight","_edge","_tileStack","_defined","_x","_y","_height","groupNum","_blockGroup","_corner","tiles","pop","./modifiers.component","./primitives.component","6","_lastBlockHollow","world","oldBlockGroups","activeCol","isTower","halfArches","nextHeight","openFloor","randomNum","randomEdgePoint","creationPoint","nextBlockWidth","nextBlockLength","yStartOffset","chanceForHigherSpace","changeForHighCorridor","yLowEdge","yHighEdge","xLowEdge","xHighEdge","yEdgeLowActive","yEdgeHighActive","createTower","towerLocation","defaultTileColor","xEdgeLowActive","xEdgeHighActive","createCol","buildTowerHere","thisHeight","thisHalfArch","thisWholeArch","maxWallPoint","undefined","warn","7","width","widthHalf","heightHalf","quarter","quarterRev","reverse","8","tileW","tileL","tileH","bleed","dimensions","calculateStraightLinesFromIsometricSquare","shadow","pointTop","pointLeft","pointBottom","pointRight","regularColor","blockTopLeft","highlight","darkestColor","leftWallLeftTop","leftWallLeftBottom","leftWallRightBottom","leftWallRightTop","rightWallLeftTop","rightWallLeftBottom","rightWallRightBottom","rightWallRightTop","slopeDirection","regularDarkerColor","regularLighterColor","shadowLight","shadowHighlight","almostDarkestColor","almostLightestColor","lightestColor","blockTopBottom","blockTopTop","blockRightBottom","blockLeftLeft","blockLeftBottom","blockLeftTop","blockRightRight","blockBottomLeft","blockBottomRight","blockBottomTop","blockTopRight","leftWallBezier","rightWallBezier","addGradient","columnInfo","xEdge","yEdge","leftWindowLeftTop","leftWindowLeftBottom","leftWindowRightBottom","leftWindowRightTop","leftWindowRightBezier","leftWindowLeftBezier","windowColor","rightWindowLeftTop","rightWindowLeftBottom","rightWindowRightBottom","rightWindowRightTop","rightWindowRightBezier","rightWindowLeftBezier","direction","doorHandleColor","getColorByHue","leftWindowBorderLeftTop","leftWindowBorderRightBottom","orientation","highlightLeft","highlightRight","halfTileWidth","rightWallLeftBottomBezier","rightWallRightTopBezier","rightWallLeftTopBezier","rightWallRightBottomBezier","blockBackRightBottom","9","_id","_h","_tileType","_tileColor","_options"],"mappings":"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","file":"bundle.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()",null,"import { MapGenerationFunctions, Color } from './mapGenerationFunctions.component'\r\nimport { Map } from './mapper.component'\r\nimport { Tile, TileType } from './tile.component'\r\nimport { Config, Coords, TileTemplate, Position } from './config.component'\r\nimport { RenderElements } from './renderelements.component'\r\n\r\nexport class Renderer {\t\r\n\r\n\tprivate config: Config = new Config()\r\n\tprivate calculations: MapGenerationFunctions = new MapGenerationFunctions()\r\n\tprivate render: RenderElements = new RenderElements()\r\n\r\n\tconstructor() {\t}\r\n\r\n\tshowData(map: Map): string {\r\n\r\n\t\tlet html = '<div class=\"showData\">'\r\n\t\thtml += `map width: ${map.mapWidth} tiles<br>map length: ${map.mapLength} tiles<br>`\r\n\t\thtml += `tile width: ${this.config.tileWidth}<br>tile length: ${this.config.tileLength}<br>`\r\n\t\thtml += '</div>'\r\n\r\n\t\treturn html\r\n\t}\r\n\r\n\tbuild2DMap(map: Map): string {\r\n\r\n\t\tlet htmlMap = `<div class=\"map\" style=\"width:${this.config.getMapWidth(map.mapWidth+1)}px;\">`\r\n\r\n\t\thtmlMap += `<div class=\"tile axis\" style=\"width:${this.config.tileWidth}px;height:${this.config.tileLength}px;\"></div>`\r\n\r\n\t\tfor (let i = 0; i < map.mapWidth; i++) {\r\n\t\t\thtmlMap += `<div class=\"tile axis\" style=\"width:${this.config.tileWidth}px;height:${this.config.tileLength}px;\">${i}</div>`\r\n\t\t}\r\n\r\n\t\tfor (let y = 0; y < map.mapLength; y++) {\r\n\r\n\t\t\tlet halfWay = ''\r\n\r\n\t\t\tif (y === Math.round(map.mapLength / 2)) {\r\n\t\t\t\thalfWay = ' half'\r\n\t\t\t}\r\n\r\n\t\t\thtmlMap += `<div class=\"tile axis${halfWay}\" style=\"width:${this.config.tileWidth}px;height:${this.config.tileLength}px;\">${y}</div>`\r\n\r\n\t\t\tfor (let x = 0; x < map.mapWidth; x++) {\r\n\r\n\t\t\t\thtmlMap += `<div class=\"tile${halfWay}\" style=\"width:${this.config.tileWidth}px;height:${this.config.tileLength}px;`\r\n\r\n\t\t\t\tif (map.getColumn(x, y).isDefined && map.getTopTile(x, y)) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet tile = map.getTopTile(x, y)\r\n\t\t\t\t\tlet tileTopColor = tile.getColor().rgb()\r\n\t\t\t\t\tlet tileColor = `rgb(${tileTopColor['r']}, ${tileTopColor['g']}, ${tileTopColor['b']})`\r\n\t\t\t\t\tlet emptyBlocksPresent = false\r\n\t\t\t\t\tfor (let h = 0; h < map.map[y][x].height; h++) {\r\n\t\t\t\t\t\tif (map.map[y][x].tileStack[h].type === TileType.None) {\r\n\t\t\t\t\t\t\temptyBlocksPresent = true\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet edge = (map.map[y][x].edge.top || map.map[y][x].edge.right || map.map[y][x].edge.bottom || map.map[y][x].edge.left) ? true : false\r\n\t\t\t\t\tlet blockGroup = map.map[y][x].blockGroup\r\n\r\n\t\t\t\t\tlet indicateEmptyBlocks = emptyBlocksPresent ? 'x' : ''\r\n\r\n\t\t\t\t\thtmlMap += `background-color:${tileColor}\">${indicateEmptyBlocks}<div class=\"tileInfo\">x: ${x} y: ${y}<br>height: ${map.map[y][x].height}<br>edge: ${edge}<br>group: ${blockGroup}</div></div>`\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\thtmlMap += `\"></div>`\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\thtmlMap += `</div>`\r\n\r\n\t\treturn htmlMap\r\n\t}\r\n\r\n\tbuildMap(mapToBuild: Map): string {\r\n\r\n\t\tlet mapTotalWidth = mapToBuild.mapWidth\r\n\t\tlet mapTotalLength = mapToBuild.mapLength\r\n\t\tconst tileHeight = this.config.tileHeight\r\n\t\tconst windowLights = this.config.lightInWindows\r\n\r\n\t\tconsole.log('windowLights', windowLights)\r\n\r\n\t\tlet testTile = this.render.createTile(0, 0, '')\r\n\r\n\t\tlet xDeviation = testTile.coords.bottom.x - testTile.coords.top.x\r\n\t\tlet yDeviation = testTile.coords.right.y - testTile.coords.left.y\r\n\t\tlet tileHalfWidthLeft = testTile.coords.top.x - testTile.coords.left.x\r\n\t\tlet tileHalfWidthRight = testTile.coords.right.x - testTile.coords.top.x\r\n\t\tlet mapWidthLeft = tileHalfWidthLeft * mapTotalLength\r\n\t\tlet mapWidthRight = tileHalfWidthRight * mapTotalWidth\r\n\t\tlet tileHalfLengthTop = testTile.coords.right.y\r\n\t\tlet tileHalfLengthBottom = testTile.coords.bottom.y - testTile.coords.right.y\r\n\t\tlet mapLengthTop = tileHalfLengthTop * mapTotalWidth\r\n\t\tlet mapLengthBottom = tileHalfLengthBottom * mapTotalLength\r\n\t\tlet mapWidthPx = Math.round((tileHalfWidthLeft + tileHalfWidthRight) * (mapTotalWidth ))\r\n\t\tlet mapLengthPx = Math.round(mapLengthTop + mapLengthBottom) + this.config.topMargin\r\n\r\n\t\tconst shadowColor = this.config.groundColor.changeColorLighting(-20)\r\n\r\n\t\tconst map = mapToBuild.map\r\n\r\n\t\tlet detailsHtml = ''\r\n\t\tlet html = '<svg width=\"'+mapWidthPx+'\" height=\"'+mapLengthPx+'\">'\r\n\r\n\t\tlet lastTile = null\r\n\t\tlet startTileX = tileHalfWidthLeft * (mapTotalWidth - 1)\r\n\r\n\t\tfor (let y = 0; y < mapTotalLength; y++) {\r\n\r\n\t\t\tfor (let x = 0; x < mapTotalWidth; x++) {\r\n\r\n\t\t\t\tlet thisPosY = 0\r\n\t\t\t\tlet thisPosX = 0\r\n\r\n\t\t\t\tif (x === 0 && y === 0) {\r\n\t\t\t\t\tthisPosX = startTileX\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (lastTile != null) {\r\n\t\t\t\t\tthisPosY = lastTile.coords.right.y\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (y > 0 && x === 0) {\r\n\t\t\t\t\tthisPosX = startTileX - (tileHalfWidthLeft * y)\r\n\t\t\t\t\tthisPosY = (tileHalfLengthTop * y) - (yDeviation * y)\r\n\t\t\t\t}\t\r\n\t\t\t\t\r\n\t\t\t\tif (x > 0) {\r\n\t\t\t\t\tthisPosX = (lastTile.coords.right.x - (lastTile.coords.right.x - lastTile.coords.bottom.x))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet newTile = this.render.createTile(thisPosX, thisPosY, 'shade')\r\n\t\t\t\tlet newData = ''\r\n\t\t\t\t\r\n\t\t\t\tif (map[y][x].isDefined) {\r\n\r\n\t\t\t\t\tif (map[y][x].tileStack[0].type === TileType.Shadow) {\r\n\t\t\t\t\t\tlet color = shadowColor\r\n\t\t\t\t\t\tnewData += this.render.createPlane(thisPosX, thisPosY, map[y][x].tileStack[0], color).html\r\n\t\t\t\t\t} else if (map[y][x].tileStack[0].type === TileType.Grass) {\r\n\t\t\t\t\t\tlet color = map[y][x].tileStack[0].tileColor\r\n\t\t\t\t\t\tnewData += this.render.createPlane(thisPosX, thisPosY, map[y][x].tileStack[0], color).html\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (map[y][x].height > 0) {\r\n\r\n\t\t\t\t\t\tnewData += this.render.createPlane(thisPosX, thisPosY, map[y][x].tileStack[0], shadowColor).html\r\n\r\n\t\t\t\t\t\tfor (let h = 0; h < map[y][x].height; h++) {\r\n\r\n\t\t\t\t\t\t\tlet currentTile = map[y][x].tileStack[h]\r\n\t\t\t\t\t\t\tlet options\r\n\r\n\t\t\t\t\t\t\tif (currentTile.options) {\r\n\t\t\t\t\t\t\t\toptions = currentTile.options\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\toptions = {\r\n\t\t\t\t\t\t\t\t\troof: false,\r\n\t\t\t\t\t\t\t\t\tpillar: false,\r\n\t\t\t\t\t\t\t\t\tslope: false,\r\n\t\t\t\t\t\t\t\t\twindowed: 0,\r\n\t\t\t\t\t\t\t\t\ttower: false,\r\n\t\t\t\t\t\t\t\t\tstairs:\tfalse,\r\n\t\t\t\t\t\t\t\t\thalfArch: false,\r\n\t\t\t\t\t\t\t\t\twholeArch: false\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (currentTile.type === TileType.Body) {\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (currentTile.options.slope) {\r\n\t\t\t\t\t\t\t\t\tlet slope = this.render.createSlopeBlock(thisPosX, thisPosY + (tileHeight * 4), map[y][x].getTile(h), 'e')\r\n\t\t\t\t\t\t\t\t\tnewData += slope.html\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tlet tile = this.render.createBlock(thisPosX, thisPosY - tileHeight, currentTile)\r\n\t\t\t\t\t\t\t\t\tnewData += tile.html\r\n\r\n\t\t\t\t\t\t\t\t\tif (currentTile.options.windowed > 0) {\r\n\t\t\t\t\t\t\t\t\t\tif (map[y][x].edge.right || map[y][x].edge.bottom) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (Math.round(Math.random() * 6) > 4) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tlet window = this.render.createWindow(thisPosX, thisPosY - tileHeight, currentTile, map[y][x], windowLights)\r\n\t\t\t\t\t\t\t\t\t\t\t\tnewData += window.html\r\n\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tif (map[y][x].edge.bottom && (h === map[y+1][x].height || h === 0) && Math.round(Math.random() * 10) > 8) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet door = this.render.createDoor(thisPosX, thisPosY - tileHeight, currentTile, map[y][x], 'bottom')\r\n\t\t\t\t\t\t\t\t\t\t\tnewData += door.html\r\n\t\t\t\t\t\t\t\t\t\t} else if (map[y][x].edge.right && (h === map[y][x+1].height || h === 0) && Math.round(Math.random() * 10) > 8) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet door = this.render.createDoor(thisPosX, thisPosY - tileHeight, currentTile, map[y][x], 'right')\r\n\t\t\t\t\t\t\t\t\t\t\tnewData += door.html\r\n\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t} else if (!options.tower && currentTile.type === TileType.HalfBlock) {\r\n\r\n\t\t\t\t\t\t\t\tlet tile = this.render.createHalfBlock(thisPosX, thisPosY - tileHeight, currentTile)\r\n\t\t\t\t\t\t\t\tnewData += tile.html\r\n\r\n\t\t\t\t\t\t\t} else if (!options.tower && currentTile.type === TileType.None) {\r\n\r\n\t\t\t\t\t\t\t\tif (currentTile.options.pillar && h < map[y][x].height) {\r\n\t\t\t\t\t\t\t\t\tif (y < (mapTotalLength/2)-1 || y > (mapTotalLength/2)) {\r\n\t\t\t\t\t\t\t\t\t\tlet pillar = this.render.createPillarBlock(thisPosX, thisPosY - tileHeight, currentTile)\r\n\t\t\t\t\t\t\t\t\t\tnewData += pillar.html\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (currentTile.options.halfArch) {\r\n\r\n\t\t\t\t\t\t\t\t\tif (map[y+1][x].isDefined && map[y+1][x].height > 0 && map[y+1][x].height > h && map[y+1][x].tileStack[h].type === TileType.None) {\r\n\t\t\t\t\t\t\t\t\t\tlet arch = this.render.createHalfArch(thisPosX, thisPosY - tileHeight, currentTile, 'right-top')\r\n\t\t\t\t\t\t\t\t\t\tnewData += arch.html\r\n\t\t\t\t\t\t\t\t\t} else if (map[y-1][x].isDefined && map[y-1][x].height > 0 && map[y-1][x].height > h && map[y-1][x].tileStack[h].type === TileType.None) {\r\n\t\t\t\t\t\t\t\t\t\tlet arch = this.render.createHalfArch(thisPosX, thisPosY - tileHeight, currentTile, 'right-bottom')\r\n\t\t\t\t\t\t\t\t\t\tnewData += arch.html\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (currentTile.options.tower) {\r\n\t\t\t\t\t\t\t\tlet tile = this.render.createBlock(thisPosX, thisPosY - tileHeight, currentTile)\r\n\t\t\t\t\t\t\t\tnewData += tile.html\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t} \r\n\r\n\t\t\t\thtml += newData\r\n\r\n\t\t\t\tlastTile = newTile\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\thtml += '</svg>'\r\n\r\n\t\t// document.querySelector('#debug').innerHTML = detailsHtml\r\n\r\n\t\treturn '<div id=\"debug\">' + detailsHtml + '</div>' + html\r\n\t}\r\n\r\n\taddSlopedEdges(map: any[], x: number, y: number, h: number, xPos: number, yPos: number) {\r\n\r\n\t\tlet tile = null\r\n\r\n\t\tif (map[y][x].edge.top && !map[y][x].corner && h === map[y][x].height-1) {\r\n\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'n')\r\n\t\t} else if (map[y][x].edge.bottom && !map[y][x].corner && h === map[y][x].height-1) {\r\n\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 's')\r\n\t\t} else if (map[y][x].edge.right && !map[y][x].corner && h === map[y][x].height-1) {\r\n\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'e')\r\n\t\t} else if (map[y][x].edge.left && !map[y][x].corner && h === map[y][x].height-1) {\r\n\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'w')\r\n\t\t} else {\r\n\t\t\ttile = this.render.createBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h))\t\r\n\t\t}\r\n\r\n\t\tif (map[y][x].corner && h === map[y][x].height-1) {\r\n\t\t\tif (map[y][x].edge.top && map[y][x].edge.left) {\r\n\t\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'nw')\r\n\t\t\t} else if (map[y][x].edge.top && map[y][x].edge.right) {\r\n\t\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'ne')\r\n\t\t\t} else if (map[y][x].edge.bottom && map[y][x].edge.left) {\r\n\t\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'sw')\r\n\t\t\t} else if (map[y][x].edge.bottom && map[y][x].edge.right) {\r\n\t\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'se')\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn tile\r\n\t}\r\n}\r\n","import { Color } from './mapGenerationFunctions.component'\r\n\r\nexport class Config {\r\n\r\n\tprivate _allowDebug: boolean = true\r\n\tprivate _tileWidth: number = 20\r\n\tprivate _tileLength: number = 20\r\n\tprivate _tileHeight: number = 15\r\n\tprivate _tileSmallAngle: number = 85\r\n\tprivate _tileLargeAngle: number = 100\r\n\tprivate _groundColor: Color = new Color('#f5f3e5')\r\n\tprivate _buildingBaseColor: Color = new Color(\r\n\t\t115 + Math.floor(Math.random() * 75),\r\n\t\t155 + Math.floor(Math.random() * 40),\r\n\t\t150 + Math.floor(Math.random() * 30)\r\n\t)\r\n\tprivate _tileEdgeBleed: number = 0.3\r\n\tprivate _maxAllowedHeight: number = 12\r\n\tprivate _topMargin: number = 80\r\n\tprivate _allowSurroundingDecorations: boolean = true\r\n\tprivate _lightInWindows: boolean = Math.round(Math.random() * 8) > 6 ? true : false\r\n\r\n\tconstructor() {\t}\t\r\n\r\n\tpublic get allowDebug(): boolean {\r\n\t\treturn this._allowDebug\r\n\t}\r\n\r\n\tpublic get tileWidth(): number {\r\n\t\treturn this._tileWidth\r\n\t}\r\n\r\n\tpublic get tileLength(): number {\r\n\t\treturn this._tileLength\r\n\t}\r\n\r\n\tpublic get tileHeight(): number {\r\n\t\treturn this._tileHeight\r\n\t}\r\n\r\n\tpublic get tileSmallAngle(): number {\r\n\t\treturn this._tileSmallAngle\r\n\t}\r\n\r\n\tpublic get tileLargeAngle(): number {\r\n\t\treturn this._tileLargeAngle\r\n\t}\r\n\r\n\tpublic get groundColor(): Color {\r\n\t\treturn this._groundColor\r\n\t}\r\n\r\n\tpublic get buildingBaseColor(): Color {\r\n\t\treturn this._buildingBaseColor\r\n\t}\r\n\r\n\tpublic get tileEdgeBleed(): number {\r\n\t\treturn this._tileEdgeBleed\r\n\t}\r\n\r\n\tpublic get maxAllowedHeight(): number {\r\n\t\treturn this._maxAllowedHeight\r\n\t}\r\n\r\n\tpublic get topMargin(): number {\r\n\t\treturn this._topMargin\r\n\t}\r\n\r\n\tpublic get lightInWindows(): boolean {\r\n\t\treturn this._lightInWindows\r\n\t}\r\n\r\n\tpublic get allowSurroundingDecorations(): boolean {\r\n\t\treturn this._allowSurroundingDecorations\r\n\t}\r\n\r\n\tpublic getMapWidth(mapArrayWidth: number): number {\r\n\t\treturn mapArrayWidth * this._tileWidth\r\n\t}\r\n\r\n\tpublic getMapLength(mapArrayLength: number): number {\r\n\t\treturn mapArrayLength * this._tileLength\r\n\t}\r\n}\r\n\r\nexport interface Coords {\r\n\ttop?: Position,\r\n\tleft?: Position,\r\n\tbottom?: Position,\r\n\tright?: Position\r\n}\r\n\r\nexport interface TileTemplate {\r\n\thtml?: string,\r\n\tcoords?: Coords\r\n}\r\n\r\nexport interface Position {\r\n\tx?: number,\r\n\ty?: number\r\n}\r\n","import { Map } from './mapper.component'\r\nimport { Renderer } from './builder.component'\r\nimport { Color } from './mapGenerationFunctions.component'\r\nimport { Config } from './config.component'\r\n\r\nclass RandomBuilding {\r\n\r\n\tprivate _map: Map\r\n\tprivate _builder: Renderer = new Renderer\r\n\tprivate config: Config = new Config\r\n\r\n\tconstructor() {\r\n\t\tthis._map = new Map(30, 30, 10, 1, 5, 3, 3, false)\r\n\t\tdocument.querySelector('body').style.background = this.config.groundColor.hex()\r\n\t\tconsole.log(\"this.config.lightInWindows\", this.config.lightInWindows)\r\n\t}\r\n\r\n\tpublic debug(): boolean {\r\n\t\treturn this.config.allowDebug\r\n\t}\r\n\r\n\tget map() {\r\n\t\treturn this._map\r\n\t}\r\n\r\n\tpublic colorMap(): string {\r\n\t\treturn this._builder.build2DMap(this._map)\r\n\t}\r\n\r\n\tpublic addToBuildingAndRedraw(): string {\r\n\t\tthis._map.addToBuilding()\r\n\t\treturn this._builder.build2DMap(this._map)\r\n\t}\r\n\r\n\tpublic drawTileMap(): string {\r\n\t\treturn this._builder.buildMap(this._map)\r\n\t}\r\n\r\n\tpublic getBaseColor(): Color {\r\n\t\tconst col = this.map.getFirstDefinedColumn()\r\n\t\tconst tile = col.tileStack[col.tileStack.length-1]\r\n\t\treturn tile.getColor()\r\n\t}\r\n\r\n\tpublic getImageTag(): void {\r\n\t\tif (document.querySelector('#buildingimg')) {\r\n\t\t\tdocument.querySelector('#buildingimg').remove()\r\n\t\t}\r\n\r\n\t\tlet svg = new XMLSerializer().serializeToString(document.querySelector('svg'))\r\n\t\tlet base64 = window.btoa(svg)\r\n\r\n\t\tlet newImg = document.createElement('img')\r\n\t\tnewImg.setAttribute('id', 'buildingimg')\r\n\t\tif (window['debug']) {\r\n\t\t\tnewImg.setAttribute('class', 'debug-active')\r\n\t\t}\r\n\t\tnewImg.setAttribute('src', 'data:image/svg+xml;base64,'+base64)\r\n\t\t\r\n\t\tlet beforeElement = document.querySelector('#worldtest')\r\n\t\tlet parent = document.querySelector(\"body\")\r\n\t\tparent.insertBefore(newImg, beforeElement)\t\t\r\n\t}\r\n}\r\n\r\nwindow['debug'] = false\r\n\r\nwindow['activateDebug'] = () => { \r\n\twindow['debug'] = true\r\n\tdocument.querySelector('#color').classList.remove('hide')\r\n\tdocument.querySelector('#color-scheme').classList.remove('hide')\r\n\tif (document.querySelector('#buildingimg')) {\r\n\t\tdocument.querySelector('#buildingimg').classList.add('debug-active')\r\n\t}\t\r\n\tdocument.querySelector('#color').innerHTML = building.colorMap()\r\n}\r\n\r\nlet building = new RandomBuilding()\r\n\r\nif (building.debug()) {\r\n\twindow['activateDebug']();\r\n}\r\n\r\ndocument.querySelector(\"#worldtest\").innerHTML = building.drawTileMap()\r\n//building.getImageTag()\r\n\r\nsetColors(building)\r\n\r\ndocument.querySelector('#generate').addEventListener('click', () => {\r\n\tbuilding = new RandomBuilding()\r\n\tif (window['debug']) {\r\n\t\tdocument.querySelector('#color').innerHTML = building.colorMap()\r\n\t}\t\r\n\tdocument.querySelector(\"#worldtest\").innerHTML = building.drawTileMap()\r\n\t//building.getImageTag()\r\n\r\n\tdocument.querySelectorAll('.point').forEach((item) => {\r\n\t\titem.addEventListener('click', () => {\r\n\t\t\tconsole.log('toggled', item)\r\n\t\t\titem.parentElement.classList.toggle('active')\r\n\t\t})\t\t\r\n\t})\r\n\r\n\tsetColors(building)\r\n})\r\n/*\r\ndocument.querySelector('#debugActive').addEventListener('click', () => {\r\n\tdocument.querySelector('#debug').classList.toggle('show')\r\n\tdocument.querySelector('#debugActive').classList.toggle('active')\r\n})\r\n\r\ndocument.querySelectorAll('.blockLabel').forEach((item) => {\r\n\titem.addEventListener('click', () => {\r\n\t\titem.classList.toggle('active')\r\n\t})\r\n}) */\r\n\r\nfunction setColors(building: RandomBuilding) {\r\n\r\n\tconst color = building.getBaseColor()\r\n\tconst shade0 = color.changeColorLightingString(0)\r\n\tconst shade1 = color.changeColorLightingString(20)\r\n\tconst shade2 = color.changeColorLightingString(-20)\r\n\tconst shade3 = color.getColorStringByHue(60)\r\n\tconst shade4 = color.getColorStringByHue(120)\r\n\tconst shade5 = color.getColorStringByHue(180)\r\n\tconst shade6 = color.getColorStringByHue(240)\r\n\tconst shade7 = color.getColorStringByHue(300)\r\n\r\n\tconst colorDivs = `\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade0};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade1};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade3};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade4};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade5};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade6};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade7};\"></div>`\r\n\r\n\tdocument.querySelector('#color-scheme').innerHTML = colorDivs\r\n}\r\n/*\r\ndocument.querySelector('#download').addEventListener('click', () => {\r\n\tlet svg = new XMLSerializer().serializeToString(document.querySelector('svg'))\r\n\tlet base64 = window.btoa(svg)\r\n\r\n\tlet newImg = document.createElement('img')\r\n\tnewImg.setAttribute('src', 'data:image/svg+xml;base64,'+base64)\r\n\tdocument.querySelector('body').appendChild(newImg)\r\n}); */","import { Config } from './config.component'\r\n\r\nexport class MapGenerationFunctions {\r\n\r\n\tprivate config: Config = new Config();\r\n\tsmallAngle = this.config.tileSmallAngle;\r\n\tlargeAngle = this.config.tileLargeAngle;\r\n\r\n\tconstructor() { }\r\n\r\n\tpublic calculateAdditionalBlockIterations(maximumBlockIterations: number) {\r\n\t\treturn 2 + Math.floor(Math.random() * maximumBlockIterations);\r\n\t}\r\n\r\n\t// calculate the dimensions to draw the isometric perspective tile with the parameters as if it were a straight square tile\r\n\tpublic calculateStraightLinesFromIsometricSquare (blockWidth: number, blockHeight: number) {\r\n\t\t// lengths this function returns when it comes to positions of longest and shortest sides as array\r\n\t\t/*           [0]\r\n\t\t *   _________________ \r\n\t\t *   |    [3]  |      |\r\n\t\t *   | [5]            |\r\n\t\t *   |               -|\r\n\t\t *   |-               | [1]\r\n\t\t *   | [4]            |\r\n\t\t *   |    [2]         |\r\n\t\t *   |_______|________|\r\n\t\t */  \r\n\r\n\t\tlet smallOuterAngle = (180 - this.smallAngle) / 2;\r\n\t\tlet largeOuterAngle = (180 - this.largeAngle) / 2;\r\n\r\n\t\tlet horizontalWidthFromBottom = this.getHorizontalBottomShortestWidth(blockWidth, smallOuterAngle);\r\n\t\tlet verticalHeightFromBottom = this.getVerticalBottomShortestHeight(horizontalWidthFromBottom, smallOuterAngle);\r\n\r\n\t\tlet horizontalWidthFromTop = this.getHorizontalTopLongestWidth(blockHeight, largeOuterAngle);\r\n\t\tlet verticalHeightFromTop = this.getVerticalTopLongestHeight(horizontalWidthFromTop, largeOuterAngle);\r\n\r\n\t\tlet totalHeight = verticalHeightFromBottom + verticalHeightFromTop;\r\n\t\tlet totalWidth = horizontalWidthFromBottom + horizontalWidthFromTop;\r\n\r\n\t\treturn {\t'totalWidth': totalWidth, // 0\r\n\t\t\t\t\t'totalHeight': totalHeight,  // 1\r\n\t\t\t\t\t'horizontalWidthFromBottom': horizontalWidthFromBottom,  // 2\r\n\t\t\t\t\t'horizontalWidthFromTop': horizontalWidthFromTop,  // 3\r\n\t\t\t\t\t'verticalHeightFromBottom': verticalHeightFromBottom,  // 4\r\n\t\t\t\t\t'verticalHeightFromTop': verticalHeightFromTop } // 5\r\n\t}\r\n\r\n\t// calculate the amount of pixels from the bottom left side of a straight square to the point at the bottom \r\n\t// .. where the tip of the tile meets the border of the square\r\n\tpublic getHorizontalBottomShortestWidth (diagonalWidth: number, smallAngle: number): number {\r\n\t\treturn diagonalWidth * Math.sin(this.toRadians(smallAngle));\r\n\t}\r\n\r\n\tpublic getVerticalBottomShortestHeight (diagonalHeight: number, smallAngle: number): number {\r\n\t\treturn diagonalHeight * Math.cos(this.toRadians(smallAngle));\r\n\t}\r\n\r\n\tpublic getHorizontalTopLongestWidth (diagonalWidth: number, largeAngle: number): number {\r\n\t\treturn diagonalWidth * Math.sin(this.toRadians(largeAngle));\r\n\t}\r\n\r\n\tpublic getVerticalTopLongestHeight (diagonalHeight: number, largeAngle: number): number {\r\n\t\treturn diagonalHeight * Math.cos(this.toRadians(largeAngle));\r\n\t}\r\n\r\n\tpublic addGradient(id: string, colorLeft: string, colorRight: string) {\r\n\r\n\t\tlet gradient = '<linearGradient id=\"'+id+'\">'\r\n\t\t\tgradient += '<stop offset=\"5%\" stop-color=\"'+colorLeft+'\" />'\r\n\t\t\tgradient += '<stop offset=\"95%\" stop-color=\"'+colorRight+'\" />'\r\n\t\t\tgradient += '</linearGradient>'\r\n\r\n\t\treturn gradient\r\n\t}\r\n\r\n\ttoRadians (angle: number): number {\r\n\t\treturn angle * (Math.PI / 180);\r\n\t}\r\n}\r\n\r\nexport enum TileColor {\r\n\tRed = 125 + Math.floor(Math.random() * 75),\r\n\tGreen = 170 + Math.floor(Math.random() * 40),\r\n\tBlue = 180 + Math.floor(Math.random() * 30)\r\n}\r\n\r\nexport enum BuildingHeightVariations {\r\n\tTallCenter = 'tallCenter',\r\n\tTallSurrounds = 'tallSurrounds',\r\n\tRandom = 'random'\r\n}\r\n\r\nexport class Color {\r\n\tprivate _colorRgb: RGB\r\n\tprivate _colorHex: string\r\n\tprivate _colorHsl: HSL\r\n\r\n\tconstructor(...params: any[]) {\r\n\t\tlet error = null\r\n\t\tif (params.length === 1) {\r\n\t\t\tif (typeof params[0] === 'string') {\r\n\t\t\t\tif (this.validateHex(params[0])) {\r\n\t\t\t\t\tlet hexColor = params[0]\r\n\t\t\t\t\tif (hexColor.charAt(0) !== '#') {\r\n\t\t\t\t\t\thexColor = `#${hexColor}`\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.setHex(hexColor)\r\n\t\t\t\t\tthis.hexToRgb()\r\n\t\t\t\t\tthis.convertToHSL()\r\n\t\t\t\t} else {\r\n\t\t\t\t\terror = \"Hexadecimal color is incorrect\"\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\terror = \"Length of 1 in parameters is not equal to string\"\r\n\t\t\t}\r\n\t\t} else if (params.length === 3) {\r\n\t\t\tif (this.validateRgb(params)) {\r\n\t\t\t\tthis.setRgb(params[0], params[1], params[2])\r\n\t\t\t\tthis.rgbToHex()\r\n\t\t\t\tthis.convertToHSL()\r\n\t\t\t} else {\r\n\t\t\t\terror = \"Values of RGB exceed limits\"\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (error !== null) {\r\n\t\t\tthrow \"Color type is incorrect. \" + error + \": \" + params.toString()\r\n\t\t}\r\n\t}\r\n\r\n\tpublic setRgb(r: number, g: number, b: number) {\r\n\t\tthis._colorRgb = {r: r, g: g, b: b} as RGB\r\n\t}\r\n\r\n\tpublic setHsl(h: number, s: number, l: number) {\r\n\t\tthis._colorHsl = {h: h, s: s, l: l} as HSL\r\n\t}\r\n\r\n\tpublic setHex(hexadecimal: string) {\r\n\t\tif (hexadecimal.length < 7) {\r\n\t\t\tlet hexVal1 = hexadecimal.charAt(1)\r\n\t\t\tlet hexVal2 = hexadecimal.charAt(2)\r\n\t\t\tlet hexVal3 = hexadecimal.charAt(3)\r\n\t\t\thexadecimal = \"#\" + hexVal1 + hexVal1 + hexVal2 + hexVal2 + hexVal3 + hexVal3\r\n\t\t}\r\n\t\tthis._colorHex = hexadecimal\r\n\t}\r\n\r\n\tpublic rgb(): RGB {\r\n\t\treturn this._colorRgb\r\n\t}\r\n\r\n\tpublic hex(): string {\r\n\t\treturn this._colorHex\r\n\t}\r\n\r\n\tpublic hsl(): HSL {\r\n\t\treturn this._colorHsl\r\n\t}\r\n\r\n\tvalidateRgb(rgb: number[]): boolean {\r\n\t\tif (rgb[0] > -1 && rgb[0] < 256 &&\r\n\t\t\trgb[1] > -1 && rgb[1] < 256 &&\r\n\t\t\trgb[2] > -1 && rgb[2] < 256) {\r\n\t\t\treturn true\r\n\t\t} else {\r\n\t\t\treturn false\r\n\t\t}\r\n\t}\r\n\r\n\tvalidateHex(hex: string): boolean {\r\n\t\tlet regex = /^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/\r\n\t\tif (hex.match(regex)) {\r\n\t\t\treturn true\r\n\t\t} else {\r\n\t\t\treturn false\r\n\t\t}\r\n\t}\r\n\r\n\thexToRgb() {\r\n\t\tlet hexValues: string[] = this._colorHex.substr(1).split('')\r\n\t\tlet hexPair1 = parseInt(hexValues[0]+hexValues[1], 16)\r\n\t\tlet hexPair2 = parseInt(hexValues[2]+hexValues[3], 16)\r\n\t\tlet hexPair3 = parseInt(hexValues[4]+hexValues[5], 16)\r\n\t\tthis.setRgb(hexPair1, hexPair2, hexPair3)\r\n\t\tthis.rgbToHex()\r\n\t}\r\n\r\n\trgbToHex() {\r\n\t\tif (typeof this._colorRgb === 'object') {\r\n\t\t\tlet r = this._colorRgb.r\r\n\t\t\tlet b = this._colorRgb.b\r\n\t\t\tlet g = this._colorRgb.g\r\n\t\t\tlet hexR = Number(r).toString(16)\r\n\t\t\tlet hexG = Number(g).toString(16)\r\n\t\t\tlet hexB = Number(b).toString(16)\r\n\t\t\tthis._colorHex = \"#\" + hexR + hexG + hexB\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\tconvertRGBtoHex(color: RGB): string {\r\n\t\tlet r = color.r\r\n\t\tlet b = color.b\r\n\t\tlet g = color.g\r\n\t\tlet hexR = Number(r).toString(16)\r\n\t\tlet hexG = Number(g).toString(16)\r\n\t\tlet hexB = Number(b).toString(16)\r\n\t\treturn \"#\" + hexR + hexG + hexB\r\n\t}\r\n\r\n\tpublic changeColorLightingString(amount: number): string {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r + amount\r\n\t\tlet newG = g + amount\r\n\t\tlet newB = b + (amount - 8)\r\n\t\tif (newR > 255) newR = 255\r\n\t\tif (newG > 255) newG = 255\r\n\t\tif (newR > 255) newR = 255\r\n\r\n\t\tlet hexR = Number(newR).toString(16)\r\n\t\tlet hexG = Number(newG).toString(16)\r\n\t\tlet hexB = Number(newB).toString(16)\r\n\t\tlet result = \"#\" + hexR + hexG + hexB\r\n\r\n\t\treturn result\r\n\t}\r\n\r\n\tpublic changeColorLighting(amount: number): Color {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r + amount\r\n\t\tlet newG = g + amount\r\n\t\tlet newB = b + (amount - 8)\r\n\t\tif (newR > 255) newR = 255\r\n\t\tif (newG > 255) newG = 255\r\n\t\tif (newR > 255) newR = 255\r\n\t\t\r\n\t\tthis.setRgb(newR, newG, newR)\r\n\t\tthis.rgbToHex()\r\n\t\tthis.convertToHSL()\r\n\r\n\t\treturn this\r\n\t}\r\n\r\n\tpublic getLightestRGB(): RGB {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r + 55\r\n\t\tlet newG = g + 55\r\n\t\tlet newB = b + 40\r\n\t\tif (newR > 255) newR = 255\r\n\t\tif (newG > 255) newG = 255\r\n\t\tif (newR > 255) newR = 255\r\n\t\treturn {r: newR, g: newG, b: newB}\r\n\t}\r\n\r\n\tpublic getHighlightsRGB(): RGB {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r + 45\r\n\t\tlet newG = g + 45\r\n\t\tlet newB = b + 30\r\n\t\tif (newR > 255) newR = 255\r\n\t\tif (newG > 255) newG = 255\r\n\t\tif (newR > 255) newR = 255\r\n\t\treturn {r: newR, g: newG, b: newB}\r\n\t}\r\n\r\n\tpublic getDarkerRegularRGB(): RGB {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r + 15\r\n\t\tlet newG = g + 15\r\n\t\tlet newB = b + 5\r\n\t\tif (newR > 255) newR = 255\r\n\t\tif (newG > 255) newG = 255\r\n\t\tif (newR > 255) newR = 255\r\n\t\treturn {r: newR, g: newG, b: newB}\r\n\t}\r\n\r\n\tpublic getHalflightsRGB(): RGB {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r + 25\r\n\t\tlet newG = g + 25\r\n\t\tlet newB = b + 15\r\n\t\tif (newR > 255) newR = 255\r\n\t\tif (newG > 255) newG = 255\r\n\t\tif (newR > 255) newR = 255\r\n\t\treturn {r: newR, g: newG, b: newB}\r\n\t}\r\n\r\n\tpublic getShadowsRGB(): RGB {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r - 55\r\n\t\tlet newG = g - 55\r\n\t\tlet newB = b - 35\r\n\t\tif (newR < 0) newR = 0\r\n\t\tif (newG < 0) newG = 0\r\n\t\tif (newR < 0) newR = 0\r\n\t\treturn {r: newR, g: newG, b: newB}\r\n\t}\r\n\r\n\tpublic getDarkestRGB(): RGB {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r - 70\r\n\t\tlet newG = g - 70\r\n\t\tlet newB = b - 60\r\n\t\tif (newR < 0) newR = 0\r\n\t\tif (newG < 0) newG = 0\r\n\t\tif (newR < 0) newR = 0\r\n\t\treturn {r: newR, g: newG, b: newB}\r\n\t}\r\n\r\n\tpublic getColorStringByHue(hue: number): string {\r\n\r\n\t\tlet h = this._colorHsl.h,\r\n\t\t\ts = this._colorHsl.s,\r\n\t\t\tl = this._colorHsl.l\r\n\r\n\t\tlet newHue = h + hue\r\n\r\n\t\tif (newHue > 360) {\r\n\t\t\tnewHue = newHue % 360\r\n\t\t}\r\n\r\n\t\tlet rgb = this.convertHSLtoRGB({h: newHue, s: s, l: l})\r\n\r\n\t\treturn this.convertRGBtoHex(rgb)\r\n\t}\r\n\r\n\tpublic getColorByHue(hue: number): Color {\r\n\r\n\t\tlet h = this._colorHsl.h,\r\n\t\t\ts = this._colorHsl.s,\r\n\t\t\tl = this._colorHsl.l\r\n\r\n\t\tlet newHue = h + hue\r\n\r\n\t\tif (newHue > 360) {\r\n\t\t\tnewHue = newHue % 360\r\n\t\t}\r\n\r\n\t\tlet rgb = this.convertHSLtoRGB({h: newHue, s: s, l: l})\r\n\r\n\t\tthis.setRgb(rgb.r, rgb.g, rgb.b)\r\n\t\tthis.rgbToHex()\r\n\r\n\t\treturn this\r\n\t}\r\n\r\n\tconvertToHSL(): void {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\r\n\t\tr /= 255\r\n\t\tg /= 255\r\n\t\tb /= 255\r\n\r\n\t\tlet cmin = Math.min(r,g,b),\r\n\t\t\tcmax = Math.max(r,g,b),\r\n\t\t\tdelta = cmax - cmin,\r\n\t\t\th = 0,\r\n\t\t\ts = 0,\r\n\t\t\tl = 0\r\n\r\n\t\t// calculate hue\r\n\t\tif (delta === 0) {\r\n\t\t\th = 0\r\n\t\t} else if (cmax === r) {\r\n\t\t\th = ((g - b) / delta) % 6\r\n\t\t} else if (cmax === g) {\r\n\t\t\th = (b - r) / delta + 2\r\n\t\t} else {\r\n\t\t\th = (r - g) / delta + 4\r\n\t\t}\r\n\r\n\t\th = Math.round(h * 60)\r\n\r\n\t\tif (h < 0) {\r\n\t\t\th += 360\r\n\t\t}\r\n\r\n\t\t// calculate lightness\r\n\t\tl = (cmax + cmin) / 2 \r\n\r\n\t\t// calculate saturation\r\n\t\ts = delta === 0 ? 0 : delta / (1 - Math.abs(2 * l - 1))\r\n\r\n\t\ts = +(s * 100).toFixed(1)\r\n\t\tl = +(l * 100).toFixed(1)\r\n\r\n\t\tthis._colorHsl = { h: h, s: s, l: l }\r\n\t}\r\n\r\n\tconvertHSLtoRGB(color: HSL): RGB {\r\n\r\n\t\tlet h = color.h\r\n\t\tlet s = color.s\r\n\t\tlet l = color.l\r\n\r\n\t\ts /= 100\r\n\t\tl /= 100\r\n\r\n\t\tlet c = (1 - Math.abs(2 * l - 1)) * s,\r\n\t\t\tx = c * (1 - Math.abs((h / 60) % 2 - 1)),\r\n\t\t\tm = l - c / 2,\r\n\t\t\tr = 0,\r\n\t\t\tg = 0,\r\n\t\t\tb = 0\r\n\r\n\t\tif (0 <= h && h < 60) {\r\n\t\t\tr = c; g = x; b = 0;\r\n\t\t} else if (60 <= h && h < 120) {\r\n\t\t\tr = x; g = c; b = 0;\r\n\t\t} else if (120 <= h && h < 180) {\r\n\t\t\tr = 0; g = c; b = x;\r\n\t\t} else if (180 <= h && h < 240) {\r\n\t\t\tr = 0; g = x; b = c;\r\n\t\t} else if (240 <= h && h < 300) {\r\n\t\t\tr = x; g = 0; b = c;\r\n\t\t} else if (300 <= h && h < 360) {\r\n\t\t\tr = c; g = 0; b = x;\r\n\t\t}\r\n\t\t\r\n\t\tr = Math.round((r + m) * 255)\r\n\t\tg = Math.round((g + m) * 255)\r\n\t\tb = Math.round((b + m) * 255)\r\n\r\n\t\treturn {r: r, g: g, b: b}\r\n\t}\r\n}\r\n\r\nexport interface RGB {\r\n\tr: number,\r\n\tg: number,\r\n\tb: number\r\n}\r\n\r\nexport interface HSL {\r\n\th: number,\r\n\ts: number,\r\n\tl: number\r\n}","import { MapGenerationFunctions, BuildingHeightVariations, Color } from './mapGenerationFunctions.component'\r\nimport { Tile, TileType, TileOptions } from './tile.component'\r\nimport { Config, Position } from './config.component'\r\nimport { Primitives } from './primitives.component'\r\nimport { Modifiers } from './modifiers.component'\r\n\r\nexport class Map {\r\n\r\n\tprivate mapGen: MapGenerationFunctions = new MapGenerationFunctions()\r\n\tprivate config: Config = new Config()\r\n\tprivate primitives: Primitives = new Primitives()\r\n\tprivate mods: Modifiers = new Modifiers()\r\n\r\n\tprivate _mapWidth: number\r\n\tprivate _mapLength: number\r\n\tprivate _mapMaxHeight: number\r\n\tprivate _averageBuildingSize: number\r\n\tprivate _blockHeight: number\r\n\tprivate _maximumBlockIterations: number\r\n\tprivate _additionalBlockIterations: number\r\n\tprivate _mapEdgeWidth: number\r\n\tprivate _highestPoint: number\r\n\tprivate _startBlockXfromCenterDeviation: number\r\n\tprivate _mapHalfLength: number\r\n\tprivate _world: any[][]\r\n\tprivate _blockHeightsArray: number[]\r\n\tprivate _blockGroups: number[]\r\n\tprivate _blockEdges: Position[]\t\r\n\tprivate _blockHeightVariationLabels = [BuildingHeightVariations.TallCenter, BuildingHeightVariations.TallSurrounds, BuildingHeightVariations.Random]\r\n\tprivate _blockHeightVariation = this._blockHeightVariationLabels[Math.floor(Math.random() * 3)]\r\n\tprivate _blockIdIterator: number\r\n\tprivate _blockHeightIterator: number\r\n\tprivate _blockAmountIterator: number\r\n\tprivate _HorizontalRemainingEmptyBlocksMin: number\r\n\tprivate _HorizontalRemainingEmptyBlocksMax: number\r\n\tprivate _decorationLineH: number\r\n\tprivate _groundColor: Color\r\n\tprivate _defaultColor: Color\r\n\tprivate _lineColor: Color\r\n\tprivate _firstLevelColor: Color\r\n\tprivate _surroundingsGrassColor: Color\r\n\tprivate _surroundingsWaterColor: Color\r\n\tprivate _surroundingsSandColor: Color\r\n\tprivate _surroundingsDefaultColor: Color\r\n\tprivate _showWindows: number\r\n\r\n\tconstructor(\t\r\n\t\t\tmapWidth: number, \r\n\t\t\tmapLength: number, \r\n\t\t\tmapMaxHeight: number, \r\n\t\t\tmapEdgeWidth: number,\r\n\t\t\taverageBuildingSize: number,\r\n\t\t\tblockHeight: number,\r\n\t\t\tmaximumBlockIterations: number,\r\n\t\t\tpyramid: boolean)\r\n\t{\r\n\t\tthis._world = []\r\n\t\tthis._mapWidth = mapWidth\r\n\t\tthis._mapLength = mapLength\r\n\t\tthis._mapMaxHeight = mapMaxHeight\r\n\t\tthis._mapEdgeWidth = mapEdgeWidth\r\n\t\tthis._averageBuildingSize = averageBuildingSize \r\n\t\tthis._blockHeight = blockHeight\r\n\t\tthis._maximumBlockIterations = maximumBlockIterations\r\n\t\tthis._additionalBlockIterations = this.mapGen.calculateAdditionalBlockIterations(maximumBlockIterations)\r\n\t\tthis._blockGroups = []\r\n\t\tthis._blockEdges = []\r\n\t\tthis._blockHeightsArray = []\r\n\t\tthis._mapHalfLength = Math.floor(mapLength / 2)\r\n\t\tthis._blockIdIterator = 0\r\n\t\tthis._blockAmountIterator = 1\r\n\t\tthis._blockHeightIterator = 1\r\n\t\tthis._decorationLineH = -1\r\n\t\tlet newLineHue = this.config.buildingBaseColor.getColorStringByHue(-120)\r\n\t\tlet lineColor = new Color(newLineHue)\r\n\t\tthis._defaultColor = new Color(this.config.buildingBaseColor.hex())\r\n\t\tthis._lineColor = lineColor.changeColorLighting(-30)\r\n\t\tthis._firstLevelColor = new Color(this.config.buildingBaseColor.getColorStringByHue(10)).changeColorLighting(-20)\r\n\t\tthis._groundColor = this.config.groundColor\r\n\t\tthis._HorizontalRemainingEmptyBlocksMin = 0\r\n\t\tthis._HorizontalRemainingEmptyBlocksMax = 0\r\n\t\tthis._surroundingsGrassColor = new Color('#7bb376')\r\n\t\tthis._surroundingsWaterColor = new Color('#6fb9ca')\r\n\t\tthis._surroundingsSandColor = new Color('#e9e3ba')\r\n\t\tthis._surroundingsDefaultColor = this._surroundingsGrassColor\r\n\t\tthis._showWindows = Math.round(Math.random() * 2)\r\n\r\n\t\tlet mapLengthHalf = Math.floor(mapLength / 2) \r\n\t\tlet mapWidthHalf = Math.floor(mapWidth / 2)\r\n\t\tlet startBlockXfromCenterDeviation = 7\r\n\t\tlet startblockLength = this._averageBuildingSize + Math.floor(Math.random() * 4)\r\n\t\tlet startblockWidth = this._averageBuildingSize + Math.floor(Math.random() * 3)\r\n\t\tlet startblockXfromCenter = 4 + Math.floor(Math.random() * startBlockXfromCenterDeviation)\r\n\t\tlet startblockLengthHalf = Math.floor(startblockLength / 2)\r\n\t\tlet startblockWidthHalf = Math.floor(startblockWidth / 2)\r\n\t\tlet startingPositionX = Math.floor(this._mapWidth / 2) - Math.floor(startblockXfromCenter / 2)\r\n\t\tlet buildGardens = !!(Math.round(Math.random() * 2))\r\n\t\tlet useWaterGarden = false\t\t\r\n\t\tlet tileHeight = 0\r\n\t\tlet firstBlockHeight\r\n\t\tlet slopeY = 0\r\n\r\n\t\tif (this._defaultColor.rgb().g >= 180 && this._defaultColor.rgb().b >= 150 && Math.round(Math.random() * 4) >= 3) {\r\n\t\t\tuseWaterGarden = (Math.round(Math.random() * 10) > 6) ? true : false\r\n\t\t\tthis._surroundingsDefaultColor = this._surroundingsWaterColor\r\n\t\t} else if (Math.round(Math.random() * 10) <= 1) {\r\n\t\t\tuseWaterGarden = (Math.round(Math.random() * 10) > 3) ? true : false\r\n\t\t\tthis._surroundingsDefaultColor = this._surroundingsWaterColor\r\n\t\t}\r\n\r\n\t\tif (this._blockHeightVariation === BuildingHeightVariations.TallCenter) {\r\n\t\t\tfirstBlockHeight = this._blockHeight * 3\r\n\t\t} else if (this._blockHeightVariation === BuildingHeightVariations.TallSurrounds) {\r\n\t\t\tfirstBlockHeight = 3 + Math.round(Math.random())\r\n\t\t\tthis._blockHeight = firstBlockHeight\r\n\t\t} else {\r\n\t\t\tfirstBlockHeight = this._blockHeight + Math.round(Math.random() * 4)\r\n\t\t}\r\n\r\n\t\tif (firstBlockHeight > 6) {\r\n\t\t\tthis._decorationLineH = 4\r\n\t\t} else if (firstBlockHeight > 3) {\r\n\t\t\tthis._decorationLineH = 3\r\n\t\t}\r\n\r\n\t\tif (firstBlockHeight < 4) {\r\n\t\t\tif (Math.round(Math.random() * 5) > 2) {\r\n\t\t\t\tslopeY = startingPositionX + Math.ceil(Math.random() * startblockWidth - 2)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._blockHeight = firstBlockHeight\r\n\r\n\t\tlet hollowBuildingBlock = (Math.round(Math.random()) === 1 ? true : false) \r\n\t\tlet openGroundLevel = (Math.round(Math.random()) === 1 ? true : false) \r\n\r\n\t\tconsole.log('showWindows', this._showWindows)\r\n\r\n\t\tfor (let y = 0; y < this.mapLength; y++) {\r\n\r\n\t\t\tthis._world[y] = []\r\n\r\n\t\t\tfor (let x = 0; x < this.mapWidth; x++) {\r\n\r\n\t\t\t\tlet thisBlockGroup = 0\r\n\r\n\t\t\t\tlet column = new Column(false, x, y, 0)\r\n\r\n\t\t\t\tlet yConditions = (y >= mapLengthHalf && y <= (mapLengthHalf + startblockLengthHalf))\r\n\t\t\t\tlet xConditions = (x > startingPositionX && x <= (startingPositionX + startblockWidth))\r\n\r\n\t\t\t\tif (yConditions) {\r\n\r\n\t\t\t\t\tif (xConditions) {\r\n\r\n\t\t\t\t\t\tthisBlockGroup = 1\r\n\t\t\t\t\t\tlet tileStack = []\r\n\r\n\t\t\t\t\t\tfor (let h = 0; h < firstBlockHeight; h++) {\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlet thisPillar = false\r\n\t\t\t\t\t\t\tlet tileType = TileType.Body\r\n\t\t\t\t\t\t\tif (h < 2 && openGroundLevel) {\r\n\t\t\t\t\t\t\t\tif (y % 2 === 0) {\r\n\t\t\t\t\t\t\t\t\tthisPillar = true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (this._decorationLineH > 3 && h+1 === this._decorationLineH && h+1 < firstBlockHeight) {\r\n\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\tif (y % 2 === 0) {\r\n\t\t\t\t\t\t\t\t\tthisPillar = true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlet thisWindowed = 0\r\n\t\t\t\t\t\t\tif (!thisPillar && this._showWindows > 0 && h % 2 === 1) {\r\n\t\t\t\t\t\t\t\tthisWindowed = this._showWindows\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlet isRoof = (h === firstBlockHeight-1) ? true : false\r\n\t\t\t\t\t\t\tlet tileColor = this._defaultColor\r\n\r\n\t\t\t\t\t\t\tif (h === this._decorationLineH) {\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\ttileColor = this._lineColor\r\n\t\t\t\t\t\t\t} else if (h === 0) { \r\n\t\t\t\t\t\t\t\ttileColor = this._firstLevelColor\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttileColor = this._defaultColor\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlet slope = false\r\n\t\t\t\t\t\t\tif (h < firstBlockHeight && y === slopeY) {\r\n\t\t\t\t\t\t\t\tif (h === 0) {\r\n\t\t\t\t\t\t\t\t\tif (x === startingPositionX + startblockWidth) {\r\n\t\t\t\t\t\t\t\t\t\tslope = true\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else if (h === 1) {\r\n\t\t\t\t\t\t\t\t\tif (x === startingPositionX + startblockWidth - 1) {\r\n\t\t\t\t\t\t\t\t\t\tslope = true\r\n\t\t\t\t\t\t\t\t\t} else if (x === startingPositionX + startblockWidth) {\r\n\t\t\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else if (h === 2) {\r\n\t\t\t\t\t\t\t\t\tif (x === startingPositionX + startblockWidth - 2) {\r\n\t\t\t\t\t\t\t\t\t\tslope = true\r\n\t\t\t\t\t\t\t\t\t} else if (x > startingPositionX + startblockWidth - 2) {\r\n\t\t\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\ttileStack.push(\r\n\t\t\t\t\t\t\t\tnew Tile(\r\n\t\t\t\t\t\t\t\t\tthis._blockIdIterator, \r\n\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\th, \r\n\t\t\t\t\t\t\t\t\ttileType,\r\n\t\t\t\t\t\t\t\t\ttileColor,\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\troof:\t\tisRoof,\r\n\t\t\t\t\t\t\t\t\t\tpillar: \tthisPillar,\r\n\t\t\t\t\t\t\t\t\t\tslope:\t\tslope,\r\n\t\t\t\t\t\t\t\t\t\twindowed: \tthisWindowed,\r\n\t\t\t\t\t\t\t\t\t\ttower: \t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\tstairs:\t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\thalfArch: \tfalse,\r\n\t\t\t\t\t\t\t\t\t\twholeArch:\tfalse\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t)\r\n\r\n\t\t\t\t\t\t\tif (this._blockGroups.indexOf(thisBlockGroup) === -1) {\r\n\t\t\t\t\t\t\t\tthis._blockGroups.push(thisBlockGroup)\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tthis._blockHeightsArray.push(firstBlockHeight)\r\n\r\n\t\t\t\t\t\t\tthis._blockIdIterator++\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tcolumn = new Column(true, x, y, firstBlockHeight)\r\n\r\n\t\t\t\t\t\tcolumn.blockGroup = thisBlockGroup\r\n\t\t\t\t\t\tcolumn.height = firstBlockHeight\r\n\t\t\t\t\t\tcolumn.corner = false\r\n\t\t\t\t\t\tcolumn.tileStack = tileStack\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._world[y][x] = column\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.setEdges(false)\r\n\r\n\t\t/* Make hollow */\r\n\t\tif (hollowBuildingBlock) {\r\n\r\n\t\t\tfor (let y = 0; y < this.mapLength; y++) {\r\n\t\t\t\tfor (let x = 0; x < this.mapWidth; x++) {\r\n\r\n\t\t\t\t\tlet hasEdge = (this._world[y][x].edge.left || this._world[y][x].edge.bottom || this._world[y][x].edge.right) ? true : false\r\n\r\n\t\t\t\t\tif (this._world[y][x].isDefined && !hasEdge) {\r\n\t\t\t\t\t\tthis._world[y][x] = new Column(false, x, y, 0)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfor (let i = 0; i < this._additionalBlockIterations; i++) {\r\n\t\t\tthis.getEdges()\r\n\t\t\tthis._world = this.mods.addBuildingComponent(this)\r\n\t\t}\r\n\r\n\t\t/* \t\r\n\t\t *\tAdd shadows around the building\r\n\t\t */\r\n\r\n\t\tfor (let e = 0; e < this._blockEdges.length; e++) {\r\n\t\t\tlet edgePointY = this._blockEdges[e].y\r\n\t\t\tlet edgePointX = this._blockEdges[e].x\r\n\t\t\tlet grass = new Column(true, edgePointX, edgePointY, 0)\r\n\t\t\t\tgrass.tileStack = [new Tile(\r\n\t\t\t\t\t\t\t\t\tthis._blockIdIterator, \r\n\t\t\t\t\t\t\t\t\tedgePointX, \r\n\t\t\t\t\t\t\t\t\tedgePointY, \r\n\t\t\t\t\t\t\t\t\t0, \r\n\t\t\t\t\t\t\t\t\tTileType.Shadow,\r\n\t\t\t\t\t\t\t\t\tthis._defaultColor)]\r\n\r\n\t\t\tif (this._world[edgePointY][edgePointX].isDefined) {\r\n\t\t\t\t\r\n\t\t\t\tif (!this._world[edgePointY - 1][edgePointX].isDefined) {\r\n\t\t\t\t\tthis._world[edgePointY - 1][edgePointX] = grass\r\n\t\t\t\t}\r\n\t\t\t\tif (!this._world[edgePointY + 1][edgePointX].isDefined) {\r\n\t\t\t\t\tthis._world[edgePointY + 1][edgePointX] = grass\r\n\t\t\t\t}\r\n\t\t\t\tif (!this._world[edgePointY][edgePointX - 1].isDefined) {\r\n\t\t\t\t\tthis._world[edgePointY][edgePointX - 1] = grass\r\n\t\t\t\t}\r\n\t\t\t\tif (!this._world[edgePointY][edgePointX + 1].isDefined) {\r\n\t\t\t\t\tthis._world[edgePointY][edgePointX + 1] = grass\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._blockIdIterator++\r\n\t\t}\r\n\r\n\t\t/* \t\r\n\t\t *\tAdd gardens or other ornamental features around the building\r\n\t\t */\r\n\r\n\t\tif (this.config.allowSurroundingDecorations && buildGardens) {\r\n\r\n\t\t\tthis._HorizontalRemainingEmptyBlocksMin = this.getLeastOpenSpaceOnX()['min']\r\n\t\t\tthis._HorizontalRemainingEmptyBlocksMax = this.getLeastOpenSpaceOnX()['max']\r\n\r\n\t\t\tif (this._HorizontalRemainingEmptyBlocksMin > 7) {\r\n\r\n\t\t\t\tlet landsLength = this._HorizontalRemainingEmptyBlocksMin * 2\r\n\t\t\t\tif (landsLength > 16) landsLength = 16\r\n\t\t\t\tlet landsEdge = this._mapLength - landsLength\r\n\r\n\t\t\t\tfor (let y = Math.floor(landsEdge / 2); y < this.mapLength - Math.floor(landsEdge / 2); y++) {\t\t\t\t\r\n\t\t\t\t\tfor (let x = 0; x < this._HorizontalRemainingEmptyBlocksMin - 3; x++) {\r\n\t\t\t\t\t\tif (!this._world[y][x].isDefined) {\r\n\t\t\t\t\t\t\tlet edgeOfGarden = false\r\n\t\t\t\t\t\t\tlet tileType: TileType = TileType.Grass\r\n\t\t\t\t\t\t\tlet tileColor = this._surroundingsDefaultColor\r\n\t\t\t\t\t\t\tlet defaultHeight = 0\r\n\t\t\t\t\t\t\tif (x === 0 || \r\n\t\t\t\t\t\t\t\tx === this._HorizontalRemainingEmptyBlocksMin - 4) {\r\n\t\t\t\t\t\t\t\tif (useWaterGarden) {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._defaultColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.HalfBlock\r\n\t\t\t\t\t\t\t\t\tdefaultHeight = 1\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._surroundingsSandColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.Grass\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\t\t\t(y === Math.floor(landsEdge / 2) + 1) ||\r\n\t\t\t\t\t\t\t\t\t(y === this.mapLength - Math.floor(landsEdge / 2) - 1) ) {\r\n\t\t\t\t\t\t\t\tif (useWaterGarden) {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._defaultColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.HalfBlock\r\n\t\t\t\t\t\t\t\t\tdefaultHeight = 1\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._surroundingsSandColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.Grass\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlet gardenBlock = new Column(true, x, y, defaultHeight)\r\n\t\t\t\t\t\t\t\tgardenBlock.tileStack = [new Tile(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis._blockIdIterator, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t0, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttileType,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttileColor)]\r\n\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\tthis._world[y][x] = gardenBlock\r\n\t\t\t\t\t\t\tthis._blockIdIterator++\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this._HorizontalRemainingEmptyBlocksMax > 7) {\r\n\r\n\t\t\t\tlet landsLength = this._HorizontalRemainingEmptyBlocksMax * 2\r\n\t\t\t\tlet landsEdge = this._mapLength - landsLength\r\n\r\n\t\t\t\tfor (let y = Math.floor(landsEdge / 2); y < this.mapLength - Math.floor(landsEdge / 2); y++) {\r\n\t\t\t\t\tfor (let x = this._mapWidth - this._HorizontalRemainingEmptyBlocksMax + 2; x < this._mapWidth; x++) {\r\n\t\t\t\t\t\tif (!this._world[y][x].isDefined) {\r\n\t\t\t\t\t\t\tlet edgeOfGarden = false\r\n\t\t\t\t\t\t\tlet tileType: TileType = TileType.Grass\r\n\t\t\t\t\t\t\tlet tileColor = this._surroundingsDefaultColor\r\n\t\t\t\t\t\t\tlet defaultHeight = 0\r\n\t\t\t\t\t\t\tif (x === this._mapWidth - 1 || \r\n\t\t\t\t\t\t\t\tx === this._mapWidth - this._HorizontalRemainingEmptyBlocksMax + 2) {\r\n\t\t\t\t\t\t\t\tif (useWaterGarden) {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._defaultColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.HalfBlock\r\n\t\t\t\t\t\t\t\t\tdefaultHeight = 1\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._surroundingsSandColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.Grass\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\t\t\ty === Math.floor(landsEdge / 2) + 1 ||\r\n\t\t\t\t\t\t\t\t\ty === this.mapLength - Math.floor(landsEdge / 2) - 1) {\r\n\t\t\t\t\t\t\t\tif (useWaterGarden) {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._defaultColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.HalfBlock\r\n\t\t\t\t\t\t\t\t\tdefaultHeight = 1\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._surroundingsSandColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.Grass\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlet gardenBlock = new Column(true, x, y, defaultHeight)\r\n\t\t\t\t\t\t\t\tgardenBlock.tileStack = [new Tile(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis._blockIdIterator, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t0, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttileType,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttileColor)]\r\n\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\tthis._world[y][x] = gardenBlock\r\n\t\t\t\t\t\t\tthis._blockIdIterator++\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/* \t\r\n\t\t *\tClear the edges and mirror the building\r\n\t\t */\r\n\r\n\t\tthis._world = this.mods.clearMapEdges(this)\r\n\t\tthis._world = this.mods.mirrorMap(this)\r\n\t\tthis.setEdges(true)\r\n\r\n\t\tconsole.log(this._world)\r\n\t}\t\r\n\r\n\tget mapWidth(): number {\r\n\t\treturn this._mapWidth\r\n\t}\r\n\r\n\tget mapLength(): number {\r\n\t\treturn this._mapLength\r\n\t}\r\n\r\n\tget mapHalfLength(): number {\r\n\t\treturn this._mapHalfLength\r\n\t}\r\n\r\n\tget mapEdgeWidth(): number {\r\n\t\treturn this._mapEdgeWidth\r\n\t}\r\n\r\n\tget map(): any[] {\r\n\t\treturn this._world\r\n\t}\r\n\r\n\tget blockGroups(): number[] {\r\n\t\treturn this._blockGroups\r\n\t}\r\n\r\n\tset blockGroups(blockGroups: number[]) {\r\n\t\tthis._blockGroups = blockGroups\r\n\t}\r\n\r\n\tget blockHeight(): number {\r\n\t\treturn this._blockHeight\r\n\t}\r\n\r\n\tget mapMaxHeight(): number {\r\n\t\treturn this._mapMaxHeight\r\n\t}\r\n\r\n\tset blockHeight(height: number) {\r\n\t\tthis._blockHeight = height\r\n\t}\r\n\r\n\tget maxBlockIterations(): number {\r\n\t\treturn this._maximumBlockIterations\r\n\t}\r\n\r\n\tget blockAmountIterator(): number {\r\n\t\treturn this._blockAmountIterator\r\n\t}\r\n\r\n\tset blockAmountIterator(i: number) {\r\n\t\tthis._blockAmountIterator = i\r\n\t}\r\n\r\n\tget averageBuildingSize(): number {\r\n\t\treturn this._averageBuildingSize\r\n\t}\r\n\r\n\tget blockEdges(): object[] {\r\n\t\treturn this._blockEdges\r\n\t}\r\n\r\n\tset blockEdges(blockEdges: object[]) {\r\n\t\tthis._blockEdges = blockEdges\r\n\t}\r\n\r\n\tget blockHeightsArray(): number[] {\r\n\t\treturn this._blockHeightsArray\r\n\t}\r\n\r\n\tset blockHeightsArray(heightsArray: number[]) {\r\n\t\tthis._blockHeightsArray = heightsArray\r\n\t}\r\n\r\n\tget blockIdIterator(): number {\r\n\t\treturn this._blockIdIterator\r\n\t}\r\n\r\n\tset blockIdIterator(i: number) {\r\n\t\tthis._blockIdIterator = i\r\n\t}\r\n\r\n\tget blockHeightVariation(): BuildingHeightVariations {\r\n\t\treturn this._blockHeightVariation\r\n\t}\r\n\r\n\tget lineHeight(): number {\r\n\t\treturn this._decorationLineH\r\n\t}\r\n\r\n\tget groundColor(): Color {\r\n\t\treturn this._groundColor\r\n\t}\r\n\r\n\tget defaultColor(): Color {\r\n\t\treturn this._defaultColor\r\n\t}\r\n\r\n\tget firstLevelColor(): Color {\r\n\t\treturn this._firstLevelColor\r\n\t}\r\n\r\n\tget decorativeColors(): object {\r\n\t\treturn { lineColor: this._lineColor }\r\n\t}\r\n\r\n\tget showWindows(): number {\r\n\t\treturn this._showWindows\r\n\t}\r\n\r\n\tpublic getColumn(x, y): Column {\r\n\t\treturn this._world[y][x]\r\n\t}\r\n\r\n\tpublic getTiles(x, y): Tile[] {\r\n\t\treturn this._world[y][x].tileStack\r\n\t}\r\n\r\n\tpublic getTile(x, y, h): Tile {\r\n\t\treturn this._world[y][x].getTile(h)\r\n\t}\r\n\r\n\tpublic getTopTile(x, y): Tile {\r\n\t\tlet height = this._world[y][x].height\r\n\t\treturn this._world[y][x].getTile(height-1)\r\n\t}\r\n\r\n\tpublic getFirstDefinedColumn(): Column {\r\n\t\tlet column\r\n\r\n\t\tfor (let y = 0; y < this.mapLength; y++) {\r\n\t\t\tfor (let x = 0; x < this.mapWidth; x++) {\r\n\t\t\t\tif (this._world[y][x].isDefined) {\r\n\t\t\t\t\tcolumn = this._world[y][x]\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn column\r\n\t}\t\r\n\r\n\tsetEdges(considerLowerEdges: boolean): void {\r\n\r\n\t\tfor (let y = 0; y < this.mapLength; y++) {\r\n\t\t\tfor (let x = 0; x < this.mapWidth; x++) {\r\n\t\t\t\t\r\n\t\t\t\tif (y > 0 && x > 0 && y < this.mapLength - 1 && x < this.mapWidth - 1 && this._world[y][x].isDefined) {\r\n\r\n\t\t\t\t\tif (considerLowerEdges) {\r\n\r\n\t\t\t\t\t\tif (this._world[y-1][x].height < this._world[y][x].height || y === 0) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.top = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (this._world[y+1][x].height < this._world[y][x].height || y === this.mapLength - 1) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.bottom = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (this._world[y][x-1].height < this._world[y][x].height) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.left = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (this._world[y][x+1].height < this._world[y][x].height) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.right = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tif (!this._world[y-1][x].isDefined || y === 0) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.top = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!this._world[y+1][x].isDefined || y === this.mapLength - 1) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.bottom = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!this._world[y][x-1].isDefined) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.left = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!this._world[y][x+1].isDefined) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.right = true\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( (this._world[y][x].edge.top && this._world[y][x].edge.right) ||\r\n\t\t\t\t\t\t (this._world[y][x].edge.top && this._world[y][x].edge.left) ||\r\n\t\t\t\t\t\t (this._world[y][x].edge.bottom && this._world[y][x].edge.right) ||\r\n\t\t\t\t\t\t (this._world[y][x].edge.bottom && this._world[y][x].edge.left) ) {\r\n\t\t\t\t\t\tthis._world[y][x].corner = true\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getEdges(): Position[] {\r\n\r\n\t\tthis._blockEdges = []\r\n\r\n\t\tfor (let y = 0; y < this._mapLength; y++) {\r\n\t\t\t// only check second half of map\r\n\r\n\t\t\tif (y > this._mapHalfLength + (this._blockAmountIterator - 1) && y < this._mapLength - 2) {\r\n\r\n\t\t\t\tfor (let x = 0; x < this._mapWidth; x++) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (x > this._mapEdgeWidth && x < this._mapWidth - 1) {\r\n\r\n\t\t\t\t\t\tif (this._world[y][x].isDefined) {\r\n\r\n\t\t\t\t\t\t\tif (!this._world[y][x+1].isDefined || \r\n\t\t\t\t\t\t\t\t!this._world[y][x-1].isDefined || \r\n\t\t\t\t\t\t\t\t!this._world[y+1][x].isDefined || \r\n\t\t\t\t\t\t\t\t!this._world[y-1][x+1].isDefined || \r\n\t\t\t\t\t\t\t\t!this._world[y-1][x-1].isDefined) {\r\n\r\n\t\t\t\t\t\t\t\tif (y > this._mapLength - 1) {\r\n\t\t\t\t\t\t\t\t\ty = this._mapLength - 1\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tlet pos: Position = {x: x, y: y}\r\n\r\n\t\t\t\t\t\t\t\tthis._blockEdges.push(pos)\r\n\r\n\t\t\t\t\t\t\t} else if ((!this._world[y-1][x].isDefined && !this._world[y+1][x].isDefined) ||\r\n\t\t\t\t\t\t\t\t(!this._world[y][x-1].isDefined && !this._world[y][x+1].isDefined)) {\r\n\r\n\t\t\t\t\t\t\t\tif (y > this._mapLength - 1) {\r\n\t\t\t\t\t\t\t\t\ty = this._mapLength - 1\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tlet pos: Position = {x: x, y: y}\r\n\r\n\t\t\t\t\t\t\t\tthis._blockEdges.push(pos)\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this._blockEdges\r\n\t}\r\n\r\n\tgetLeastOpenSpaceOnX(): object {\r\n\t\tlet xMinValues = []\r\n\t\tlet xMaxValues = []\r\n\r\n\t\tfor (let y = 0; y < this.mapLength; y++) {\r\n\t\t\t\r\n\t\t\tlet xMin = 0\r\n\t\t\tlet xMax = 0\r\n\t\t\t\r\n\t\t\tfor (let x = 0; x < this.mapWidth; x++) {\r\n\t\t\t\tif (x < Math.floor(this.mapWidth / 2)) {\r\n\t\t\t\t\tif (!this._world[y][x].isDefined && this._world[y][x].height === 0) {\r\n\t\t\t\t\t\txMin++\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!this._world[y][x].isDefined && this._world[y][x].height === 0) {\r\n\t\t\t\t\t\txMax++\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\txMinValues.push(xMin)\r\n\t\t\txMaxValues.push(xMax)\r\n\t\t}\r\n\r\n\t\treturn {'min': Math.min(...xMinValues), 'max': Math.min(...xMaxValues) }\t\t\r\n\t}\r\n\r\n\tpublic addToBuilding(): void {\r\n\t\tthis._world = this.mods.addBuildingComponent(this)\r\n\t\tthis._world = this.mods.mirrorMap(this)\r\n\t\tthis._world = this.mods.clearMapEdges(this)\r\n\t\tthis.setEdges(false)\r\n\t\tconsole.log(this._world)\t\r\n\t}\r\n}\r\n\r\nexport class Column {\r\n\r\n\tprivate _defined: boolean\r\n\tprivate _x: number\r\n\tprivate _y: number\r\n\tprivate _height: number\r\n\tprivate _blockGroup: number\r\n\tprivate _corner: boolean\r\n\tprivate _edge: ColumnEdge = { top: false, right: false, bottom: false, left: false }\r\n\tprivate _tileStack: Tile[] = []\r\n\r\n\tconstructor(private defined: boolean, private colX: number, private colY: number, private colHeight: number) {\r\n\t\tthis._defined = defined\r\n\t\tthis._x = colX\r\n\t\tthis._y = colY\r\n\t\tthis._height = colHeight\r\n\t}\r\n\r\n\tset x(x: number) {\r\n\t\tthis._x = x\r\n\t}\r\n\r\n\tset y(y: number) {\r\n\t\tthis._y = y\r\n\t}\r\n\r\n\tset height(h: number) {\r\n\t\tthis._height = h\r\n\t}\r\n\r\n\tset blockGroup(groupNum: number) {\r\n\t\tthis._blockGroup = groupNum\r\n\t}\r\n\r\n\tset corner(corner: boolean) {\r\n\t\tthis._corner = corner\r\n\t}\r\n\r\n\tset edge(edge: ColumnEdge) {\r\n\t\tthis._edge = edge\r\n\t}\r\n\r\n\tset tileStack(tiles: Tile[]) {\r\n\t\tthis._tileStack = tiles\r\n\t}\r\n\r\n\tget isDefined(): boolean {\r\n\t\treturn this._defined\r\n\t}\r\n\r\n\tget x(): number {\r\n\t\treturn this._x\r\n\t}\r\n\r\n\tget y(): number {\r\n\t\treturn this._y\r\n\t}\r\n\r\n\tget height(): number {\r\n\t\treturn this._height\r\n\t}\r\n\r\n\tget blockGroup(): number {\r\n\t\treturn this._blockGroup\r\n\t}\r\n\r\n\tget corner(): boolean {\r\n\t\treturn this._corner\r\n\t}\r\n\r\n\tget edge(): ColumnEdge {\r\n\t\treturn this._edge\r\n\t}\r\n\r\n\tget tileStack(): Tile[] {\r\n\t\treturn this._tileStack\r\n\t}\r\n\r\n\tpublic getTile(height: number): Tile {\r\n\t\treturn this._tileStack[height]\r\n\t}\r\n\r\n\tpublic removeTopTile(): void {\r\n\t\tthis._tileStack.pop()\r\n\t}\r\n}\r\n\r\nexport interface ColumnEdge {\r\n\ttop: boolean,\r\n\tright: boolean,\r\n\tbottom: boolean,\r\n\tleft: boolean\r\n}","import { Map, Column } from './mapper.component'\r\nimport { MapGenerationFunctions, BuildingHeightVariations, Color } from './mapGenerationFunctions.component'\r\nimport { Tile, TileType, TileOptions } from './tile.component'\r\nimport { Config, Position } from './config.component'\r\n\r\nexport class Modifiers {\r\n\r\n\tprivate config: Config = new Config()\r\n\tprivate _lastBlockHollow: boolean = false\r\n\r\n\tmirrorMap(world: Map): any[][] {\r\n\r\n\t\tlet oldBlockGroups = []\r\n\t\tworld.blockGroups.forEach(id => {\r\n\t\t\toldBlockGroups.push(id)\r\n\t\t})\r\n\r\n\t\tfor (let y = 0; y < world.mapHalfLength; y++) {\r\n\t\t\tif (y < world.mapHalfLength) {\r\n\t\t\t\t\t\t\t\r\n\t\t\t\tfor (let x = 0; x < world.mapWidth; x++) {\r\n\r\n\t\t\t\t\tif (world.map[world.mapLength - y - 1][x].isDefined) {\r\n\r\n\t\t\t\t\t\tlet activeCol = world.map[world.mapLength - y - 1][x]\r\n\t\t\t\t\t\tlet height = activeCol.height\r\n\r\n\t\t\t\t\t\tif (height > 0) {\r\n\t\t\t\t\t\t\tlet blockGroup = oldBlockGroups.length + activeCol.blockGroup\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlet tileStack = []\r\n\r\n\t\t\t\t\t\t\tfor (let h = 0; h < height; h++) {\r\n\r\n\t\t\t\t\t\t\t\tlet tileColor = activeCol.tileStack[h].tileColor\r\n\r\n\t\t\t\t\t\t\t\tlet thisPillar\r\n\t\t\t\t\t\t\t\tlet slope\r\n\t\t\t\t\t\t\t\tlet thisWindowed\r\n\t\t\t\t\t\t\t\tlet isTower\r\n\t\t\t\t\t\t\t\tlet stairs\r\n\t\t\t\t\t\t\t\tlet isRoof\r\n\t\t\t\t\t\t\t\tlet halfArches\r\n\t\t\t\t\t\t\t\tlet wholeArch\r\n\r\n\t\t\t\t\t\t\t\tif (activeCol.tileStack[h].options) {\r\n\t\t\t\t\t\t\t\t\tthisPillar = activeCol.tileStack[h].options.pillar\r\n\t\t\t\t\t\t\t\t\tslope = activeCol.tileStack[h].options.slope\r\n\t\t\t\t\t\t\t\t\tthisWindowed = activeCol.tileStack[h].options.windowed\r\n\t\t\t\t\t\t\t\t\tisTower = activeCol.tileStack[h].options.tower\r\n\t\t\t\t\t\t\t\t\tstairs = activeCol.tileStack[h].options.stairs\r\n\t\t\t\t\t\t\t\t\tisRoof = (h === height-1) ? true : false\r\n\t\t\t\t\t\t\t\t\thalfArches = activeCol.tileStack[h].options.halfArch\r\n\t\t\t\t\t\t\t\t\twholeArch = activeCol.tileStack[h].options.wholeArch\r\n\r\n\t\t\t\t\t\t\t\t\ttileStack.push(\r\n\t\t\t\t\t\t\t\t\t\tnew Tile(\r\n\t\t\t\t\t\t\t\t\t\t\tworld.blockIdIterator, \r\n\t\t\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\t\t\th, \r\n\t\t\t\t\t\t\t\t\t\t\tactiveCol.tileStack[h].type,\r\n\t\t\t\t\t\t\t\t\t\t\ttileColor,\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\troof: isRoof,\r\n\t\t\t\t\t\t\t\t\t\t\t\tpillar: thisPillar,\r\n\t\t\t\t\t\t\t\t\t\t\t\tslope: slope,\r\n\t\t\t\t\t\t\t\t\t\t\t\twindowed: thisWindowed,\r\n\t\t\t\t\t\t\t\t\t\t\t\ttower: isTower,\r\n\t\t\t\t\t\t\t\t\t\t\t\tstairs:\tstairs,\r\n\t\t\t\t\t\t\t\t\t\t\t\thalfArch: halfArches,\r\n\t\t\t\t\t\t\t\t\t\t\t\twholeArch: wholeArch\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttileStack.push(\r\n\t\t\t\t\t\t\t\t\t\tnew Tile(\r\n\t\t\t\t\t\t\t\t\t\t\tworld.blockIdIterator, \r\n\t\t\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\t\t\th, \r\n\t\t\t\t\t\t\t\t\t\t\tactiveCol.tileStack[h].type,\r\n\t\t\t\t\t\t\t\t\t\t\ttileColor\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t\tworld.blockIdIterator++\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tworld.blockHeightsArray.push(height)\r\n\r\n\t\t\t\t\t\t\tif (world.blockGroups.indexOf(blockGroup) === -1) {\r\n\t\t\t\t\t\t\t\tworld.blockGroups.push(blockGroup)\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tworld.map[y][x] = null\r\n\r\n\t\t\t\t\t\t\tlet column = new Column(true, x, y, height)\r\n\r\n\t\t\t\t\t\t\tcolumn.blockGroup = blockGroup\r\n\t\t\t\t\t\t\tcolumn.height = height\r\n\t\t\t\t\t\t\tcolumn.corner = false\r\n\t\t\t\t\t\t\tcolumn.tileStack = tileStack\r\n\r\n\t\t\t\t\t\t\tworld.map[y][x] = column\r\n\t\t\t\t\t\t} else if(height === 0 && activeCol.isDefined) {\r\n\t\t\t\t\t\t\tworld.map[y][x] = activeCol\r\n\t\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn world.map\r\n\t}\r\n\t\r\n\tclearMapEdges(world: Map): any[][] {\r\n\r\n\t\tfor (let y = 0; y < world.mapLength; y++) {\r\n\t\t\tfor (let x = 1; x < world.mapWidth; x++) {\r\n\t\t\t\tif (x < world.mapEdgeWidth || x >= world.mapWidth ||\r\n\t\t\t\t\ty < world.mapEdgeWidth || y >= world.mapLength - world.mapEdgeWidth) {\r\n\t\t\t\t\tif (world.map[y][x].isDefined && world.map[y][x].height > 0) {\r\n\t\t\t\t\t\tworld.map[y][x] = null\r\n\t\t\t\t\t\tlet column = new Column(false, x, y, 0)\r\n\t\t\t\t\t\tcolumn.tileStack = []\r\n\t\t\t\t\t\tworld.map[y][x] = column\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn world.map\r\n\t}\r\n\r\n\taddBuildingComponent(world: Map): any[][] {\r\n\r\n\t\tif (world.blockAmountIterator < world.maxBlockIterations) {\r\n\r\n\t\t\tworld.blockEdges = world.getEdges()\r\n\r\n\t\t\tif (world.blockEdges.length > 0) {\t\t\t\r\n\r\n\t\t\t\tlet nextHeight\r\n\t\t\t\tlet openFloor = 0\r\n\t\t\t\tlet showWindows = world.showWindows\r\n\r\n\t\t\t\tif (world.blockHeightVariation === BuildingHeightVariations.TallCenter) {\r\n\t\t\t\t\tnextHeight = world.blockHeight - (world.blockAmountIterator)\r\n\t\t\t\t} else if (world.blockHeightVariation === BuildingHeightVariations.TallSurrounds) {\r\n\t\t\t\t\tnextHeight = world.blockHeight + (world.blockAmountIterator * Math.ceil(Math.random() * 2))\r\n\t\t\t\t} else if (world.blockHeightVariation === BuildingHeightVariations.Random) {\r\n\t\t\t\t\tlet randomNum = Math.ceil(Math.random() * 4)\r\n\t\t\t\t\tlet randomAdd = Math.round(Math.random())\r\n\t\t\t\t\tif (randomAdd === 0 && world.blockHeight > 3) {\r\n\t\t\t\t\t\tnextHeight = world.blockHeight - randomNum\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnextHeight = world.blockHeight + randomNum\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (nextHeight < 2) {\r\n\t\t\t\t\tnextHeight = 1\r\n\t\t\t\t} else if (nextHeight > world.mapMaxHeight) {\r\n\t\t\t\t\tnextHeight = world.mapMaxHeight\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (nextHeight > 5) {\r\n\t\t\t\t\topenFloor = 2 + Math.floor(Math.random() * 3)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet randomEdgePoint = Math.floor(Math.random() * world.blockEdges.length)\r\n\t\t\t\tlet creationPoint: Position = world.blockEdges[randomEdgePoint]\r\n\t\t\t\tlet blockGroup = world.blockGroups.length + 1\r\n\t\t\t\tlet manipulateExistingCols = (Math.round(Math.random()) < 1) ? false : true\r\n\t\t\t\tlet nextBlockWidth = (world.averageBuildingSize ) + Math.floor(Math.random() * 5)\r\n\t\t\t\tlet nextBlockLength = (world.averageBuildingSize ) + Math.floor(Math.random() * 5)\r\n\t\t\t\tlet yStartOffset = 1 + Math.floor(Math.random() * 2)\r\n\t\t\t\tlet hollowBuildingBlock = Math.round(Math.random()) === 1 ? true : false\r\n\r\n\t\t\t\tif (creationPoint.y + nextBlockLength - yStartOffset > world.mapLength - 1) {\r\n\t\t\t\t\tnextBlockLength = world.mapLength - (creationPoint.y + yStartOffset) - 1\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (nextBlockWidth > 4 && nextBlockLength > 4) {\r\n\t\t\t\t\tif (!this._lastBlockHollow) {\r\n\t\t\t\t\t\thollowBuildingBlock = Math.round(Math.random() * 8) > 5 ? true : false\r\n\t\t\t\t\t\tthis._lastBlockHollow = true\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\thollowBuildingBlock = false\r\n\t\t\t\t\t\tthis._lastBlockHollow = false\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\thollowBuildingBlock = false\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet chanceForHigherSpace = Math.round(Math.random() * 8)\r\n\t\t\t\tlet changeForHighCorridor = true // Math.round(Math.random() * 8) > 5 ? true : false\r\n\r\n\t\t\t\tlet yLowEdge = creationPoint.y - yStartOffset + 1\r\n\t\t\t\tlet yHighEdge = creationPoint.y + nextBlockLength - yStartOffset - 1\r\n\t\t\t\tlet xLowEdge = creationPoint.x - (nextBlockWidth / 2) + 1\r\n\t\t\t\tlet xHighEdge = creationPoint.x + (nextBlockWidth / 2) - 1\r\n\t\t\t\tlet yEdgeLowActive = false\r\n\t\t\t\tlet yEdgeHighActive = false\r\n\r\n\t\t\t\tlet createTower = (nextHeight < 7 && Math.round(Math.random() * 8) > 5) ? true : false\r\n\t\t\t\tlet towerLocation = 0\r\n\t\t\t\tif (createTower) {\r\n\t\t\t\t\ttowerLocation = Math.round(Math.random() * 2)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet defaultTileColor = world.getFirstDefinedColumn().tileStack[0].tileColor\r\n\r\n\t\t\t\tlet slopeY\r\n\t\t\t\tif (nextHeight < 4) {\r\n\t\t\t\t\tif (Math.round(Math.random() * 5) > 0) {\r\n\t\t\t\t\t\tslopeY = creationPoint.x + Math.ceil(Math.random() * Math.round(nextBlockWidth / 2) - 2)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (let y = 0; y < world.mapLength; y++) {\t\r\n\r\n\t\t\t\t\tif (yLowEdge === y) {\r\n\t\t\t\t\t\tyEdgeLowActive = true\r\n\t\t\t\t\t} else if (yHighEdge === y) {\r\n\t\t\t\t\t\tyEdgeHighActive = true\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tyEdgeLowActive = false\r\n\t\t\t\t\t\tyEdgeHighActive = false\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet xEdgeLowActive = false\r\n\t\t\t\t\tlet xEdgeHighActive = false\r\n\r\n\t\t\t\t\tfor (let x = 0; x < world.mapWidth; x++) {\r\n\r\n\t\t\t\t\t\tif (x === xLowEdge) {\r\n\t\t\t\t\t\t\txEdgeLowActive = true\r\n\t\t\t\t\t\t} else if (x === xHighEdge) {\r\n\t\t\t\t\t\t\txEdgeHighActive = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (y >= yLowEdge && y <= yHighEdge) {\r\n\r\n\t\t\t\t\t\t\tif (x >= xLowEdge && x <= xHighEdge) {\r\n\r\n\t\t\t\t\t\t\t\tlet createCol = true\r\n\r\n\t\t\t\t\t\t\t\tif (hollowBuildingBlock) {\r\n\t\t\t\t\t\t\t\t\tif (y > yLowEdge && y < yHighEdge && x > xLowEdge+1 && x < xHighEdge-1) {\r\n\t\t\t\t\t\t\t\t\t\tcreateCol = false\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (createCol) {\r\n\r\n\t\t\t\t\t\t\t\t\tlet buildTowerHere = false\r\n\r\n\t\t\t\t\t\t\t\t\tif (createTower) {\r\n\t\t\t\t\t\t\t\t\t\tif (towerLocation === 0) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (y <= yLowEdge + 1 && x <= xLowEdge + 1) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tbuildTowerHere = true\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else if (towerLocation === 1) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (y <= yLowEdge + 1 && x >= xHighEdge - 2) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tbuildTowerHere = true\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else if (towerLocation === 2) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (y >= yHighEdge - 1 && x >= xHighEdge - 2) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif ((world.blockHeightVariation !== BuildingHeightVariations.TallCenter)) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tbuildTowerHere = true\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tlet thisHeight = nextHeight\r\n\t\t\t\t\t\t\t\t\tif (buildTowerHere) {\r\n\t\t\t\t\t\t\t\t\t\tthisHeight = nextHeight + 5\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tlet tileStack = []\r\n\r\n\t\t\t\t\t\t\t\t\tfor (let h = 0; h < thisHeight; h++) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tlet thisPillar = false\r\n\t\t\t\t\t\t\t\t\t\tlet thisWindowed = 0\r\n\t\t\t\t\t\t\t\t\t\tif (showWindows > 0 && h % 2 === 1) {\r\n\t\t\t\t\t\t\t\t\t\t\tthisWindowed = showWindows\r\n\t\t\t\t\t\t\t\t\t\t}\t\r\n\t\t\t\t\t\t\t\t\t\tlet isRoof = (h === thisHeight-1) ? true : false\r\n\t\t\t\t\t\t\t\t\t\tlet slope = false\r\n\t\t\t\t\t\t\t\t\t\tif (h < nextHeight) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (y === slopeY && x === creationPoint.x + Math.round(nextBlockWidth / 2) - h) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tslope = true\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\t\r\n\t\t\t\t\t\t\t\t\t\tlet tileColor = defaultTileColor\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tlet tileType = TileType.Body\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tlet isTower = false\r\n\t\t\t\t\t\t\t\t\t\tif (buildTowerHere) {\r\n\t\t\t\t\t\t\t\t\t\t\tisTower = true\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tlet stairs = false\r\n\t\t\t\t\t\t\t\t\t\tlet thisHalfArch = false\r\n\t\t\t\t\t\t\t\t\t\tlet thisWholeArch = false\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (thisHeight > 4) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (changeForHighCorridor) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (nextBlockLength > 4 && nextBlockLength < 6) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet maxWallPoint = creationPoint.y + 5\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (creationPoint.y + 5 > creationPoint.y + (nextBlockLength / 2)) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaxWallPoint = creationPoint.y + 4\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (y > creationPoint.y + 1 && y < maxWallPoint) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (h < thisHeight - 2) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (creationPoint.y + 5 > 27) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (y % 2 === 0 && x % 2 !== 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthisPillar = true\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (h === thisHeight - 3) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthisHalfArch = true\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} \r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (nextBlockLength === 6) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (y === yLowEdge + 1 || \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ty === yLowEdge + 2 ||\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ty === yHighEdge - 2 ||\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ty === yHighEdge - 3) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (h < thisHeight - 2) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (h === thisHeight - 3) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthisHalfArch = true\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (nextBlockLength === 8) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (y === yLowEdge + 1 || \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ty === yLowEdge + 2 ||\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ty === yLowEdge + 4 ||\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ty === yLowEdge + 5) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (h < thisHeight - 2) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (h === thisHeight - 3) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthisHalfArch = true\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (y === yLowEdge + 3 || y === yLowEdge + 6) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttileType = TileType.Body\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthisHalfArch = false\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (chanceForHigherSpace > 4) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (openFloor > 0 && (h === openFloor || h+1 === openFloor)) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (y % 2 === 0 && x % 2 !== 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthisPillar = true\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (thisHeight > 7 && openFloor > 0 && h > openFloor && h < openFloor + 4) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (y % 2 === 0 && x % 2 !== 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthisPillar = true\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (h === world.lineHeight) {\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\ttileColor = world.decorativeColors['lineColor']\r\n\t\t\t\t\t\t\t\t\t\t} else if (h === 0) {\r\n\t\t\t\t\t\t\t\t\t\t\ttileColor = world.firstLevelColor\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\ttileColor = world.defaultColor\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\ttileStack.push(\r\n\t\t\t\t\t\t\t\t\t\t\tnew Tile(\r\n\t\t\t\t\t\t\t\t\t\t\t\tworld.blockIdIterator, \r\n\t\t\t\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\t\t\t\th, \r\n\t\t\t\t\t\t\t\t\t\t\t\ttileType,\r\n\t\t\t\t\t\t\t\t\t\t\t\ttileColor,\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\troof: isRoof,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpillar: thisPillar,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tslope: slope,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twindowed: thisWindowed,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttower: isTower,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstairs:\tstairs,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\thalfArch: thisHalfArch,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twholeArch: thisWholeArch\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t)\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t\t\t\tworld.blockHeightsArray.push(thisHeight)\r\n\r\n\t\t\t\t\t\t\t\t\t\tworld.blockIdIterator++\r\n\r\n\t\t\t\t\t\t\t\t\t\ttileColor = undefined\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (world.blockGroups.indexOf(blockGroup) === -1) {\r\n\t\t\t\t\t\t\t\t\t\tworld.blockGroups.push(blockGroup)\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tworld.map[y][x] = null\r\n\r\n\t\t\t\t\t\t\t\t\tlet column = new Column(true, x, y, thisHeight)\r\n\r\n\t\t\t\t\t\t\t\t\tcolumn.blockGroup = blockGroup\r\n\t\t\t\t\t\t\t\t\tcolumn.height = thisHeight\r\n\t\t\t\t\t\t\t\t\tcolumn.corner = false\r\n\t\t\t\t\t\t\t\t\tcolumn.tileStack = tileStack\r\n\r\n\t\t\t\t\t\t\t\t\tworld.map[y][x] = column\t\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tworld.blockHeight = nextHeight\r\n\r\n\t\t\t\tworld.blockAmountIterator++\r\n\r\n\t\t\t\tif (1 === 1) {\r\n\r\n\t\t\t\t\tfor (let y = 0; y < world.mapLength; y++) {\r\n\t\t\t\t\t\tfor (let x = 0; x < world.mapWidth; x++) {\r\n\r\n\t\t\t\t\t\t\tif (x < world.mapWidth - 2 && x > 2) {\r\n\t\t\t\t\t\t\t\tif (y < world.mapLength - 2 && y > 2) {\r\n\r\n\t\t\t\t\t\t\t\t\tif (world.map[y][x].isDefined && \r\n\t\t\t\t\t\t\t\t\t\tworld.map[y-1][x].isDefined &&\r\n\t\t\t\t\t\t\t\t\t\tworld.map[y+1][x].isDefined &&\r\n\t\t\t\t\t\t\t\t\t\tworld.map[y][x-1].isDefined &&\r\n\t\t\t\t\t\t\t\t\t\tworld.map[y][x+1].isDefined) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (world.map[y][x].height > 4) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (world.map[y-1][x].blockGroup !== blockGroup) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tworld.map[y][x].tileStack[world.map[y][x].height-1].type = TileType.HalfBlock\r\n\t\t\t\t\t\t\t\t\t\t\t}\t\r\n\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t}\t\t\r\n\t\t\t\t\t\t\t\t}\t\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\t\t\r\n\t\t\t\tconsole.warn(\"Block edges array is empty.\")\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Cannot add more building components, maximum block iterations reached.\")\r\n\t\t}\r\n\r\n\t\treturn world.map\r\n\t}\t\r\n}","export class Primitives {\r\n\r\n\tgetPyramid(mapWidth: number, mapLength: number): number[][] {\r\n\r\n\t\tlet map = [],\r\n\t\t\twidth = Math.min(mapWidth, mapLength),\r\n\t\t\theight = Math.min(mapWidth, mapLength),\r\n\t\t\twidthHalf = Math.floor(width / 2),\r\n\t\t\theightHalf = Math.floor(height / 2),\r\n\t\t\tquarter = [];\r\n\r\n\t\tfor (let y = 0; y < width; y++) {\r\n\t\t\tmap[y] = []\r\n\t\t\tfor (let x = 0; x < height; x++) {\r\n\t\t\t\tif (y < Math.round(height / 2) && x < Math.round(width / 2)) {  \r\n\t\t\t\t\tmap[y][x] = Math.min(y, x)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmap[y][x] = Math.max(y, x)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let y = 0; y < widthHalf; y++) {\r\n\t\t\tquarter[y] = []\r\n\t\t\tfor (let x = 0; x < heightHalf; x++) {\r\n\t\t\t\tif (y < heightHalf && x < widthHalf) { \r\n\t\t\t\t\tquarter[y][x] = map[y][x]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet quarterRev = quarter.reverse()\r\n\r\n\t\tfor (let y = 0; y < width; y++) {\r\n\t\t\tfor (let x = 0; x < height; x++) {\r\n\t\t\t  \tif (y > heightHalf - 1 && x < widthHalf) {\r\n\t\t\t    \tmap[y][x] = quarterRev[y - heightHalf][x]\r\n\t\t\t    }\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let y = 0; y < width; y++) {\r\n\t\t\tfor (let x = 0; x < height; x++) {\r\n\t\t\t  \tif (x > widthHalf - 1) {\r\n\t\t\t    \tmap[y][x] = map[y][width - x - 1]\r\n\t\t\t    }\r\n\t\t  \t}\r\n\t\t}\r\n\r\n\t\treturn map\r\n\t}\r\n}","import { Config, Coords, TileTemplate, Position } from './config.component'\r\nimport { MapGenerationFunctions, Color } from './mapGenerationFunctions.component'\r\nimport { Tile, TileType } from './tile.component'\r\nimport { Column, ColumnEdge } from './mapper.component'\r\n\r\nexport class RenderElements {\r\n\r\n\tprivate config: Config = new Config()\r\n\tprivate calculations: MapGenerationFunctions = new MapGenerationFunctions()\r\n\r\n\tprivate tileW: number = this.config.tileWidth\r\n\tprivate tileL: number = this.config.tileLength\r\n\tprivate tileH: number = this.config.tileHeight\r\n\tprivate bleed: number = this.config.tileEdgeBleed\r\n\tprivate dimensions = this.calculations.calculateStraightLinesFromIsometricSquare(this.tileW, this.tileL)\r\n\r\n\tprivate tileColor: Color = this.config.groundColor\r\n\r\n\tcreateTile(xPos: number, yPos: number, shadow: string): TileTemplate {\r\n\r\n\t\tlet top: Position = { \"x\": (xPos + this.dimensions.horizontalWidthFromTop), \"y\": yPos}\r\n\t\tlet left: Position = { \"x\": xPos, \"y\": (yPos + this.dimensions.verticalHeightFromTop) }\r\n\t\tlet bottom: Position = { \"x\": (xPos + this.dimensions.horizontalWidthFromBottom), \"y\": (yPos + this.dimensions.totalHeight) }\r\n\t\tlet right: Position = { \"x\": (xPos + this.dimensions.totalWidth), \"y\": (yPos + this.dimensions.verticalHeightFromBottom) }\r\n\r\n\t\tlet pointTop = `${top.x} ${top.y-this.bleed}`\r\n\t\tlet pointLeft = `${left.x-this.bleed} ${left.y}`\r\n\t\tlet pointBottom = `${bottom.x} ${bottom.y+this.bleed}`\r\n\t\tlet pointRight = `${right.x+this.bleed} ${right.y}`\r\n\r\n\t\tlet tileColor = this.tileColor.hex()\r\n\t\tif (shadow === 'shade') {\r\n\t\t\ttileColor = this.tileColor.changeColorLightingString(-50)\r\n\t\t}\r\n\r\n\t\tvar html = `<path fill=\"${tileColor}\"\r\n\t\t\t\t\td=\"M${pointLeft} \r\n\t\t\t\t\tL${pointBottom} \r\n\t\t\t\t\tL${pointRight} \r\n\t\t\t\t\tL${pointTop} \r\n\t\t\t\t\tL${pointLeft} Z\" />`\r\n\r\n\t\tlet coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreatePlane(xPos: number, yPos: number, tile: Tile, color?: Color): TileTemplate {\r\n\r\n\t\tlet id = tile.id\r\n\t\tlet height = (tile.h * this.tileH) - this.tileH\r\n\r\n\t\tlet regularColor\r\n\r\n\t\tif (color) {\r\n\t\t\tregularColor = color.hex()\r\n\t\t} else {\r\n\t\t\tregularColor = this.config.groundColor.hex()\r\n\t\t}\r\n\r\n\t\tlet top: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromTop), \"y\": Math.ceil(yPos + this.config.topMargin ) }\r\n\t\tlet left: Position = { \"x\": Math.ceil(xPos), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromTop + this.config.topMargin ) }\r\n\t\tlet bottom: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromBottom), \"y\": Math.ceil(yPos + this.dimensions.totalHeight + this.config.topMargin ) }\r\n\t\tlet right: Position = { \"x\": Math.ceil(xPos + this.dimensions.totalWidth), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromBottom + this.config.topMargin ) }\r\n\r\n\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y}`\r\n\t\tlet blockTopBottom = `${bottom.x} ${bottom.y}`\r\n\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y}`\r\n\t\tlet blockTopTop = `${top.x} ${top.y}`\r\n\r\n\t\tlet html = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\tL${blockTopBottom} \r\n\t\t\t\t\tL${blockTopRight} \r\n\t\t\t\t\tL${blockTopTop} \r\n\t\t\t\t\tL${blockTopLeft} Z\" /></g>`\r\n\r\n\t\tlet coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreateBlock(xPos: number, yPos: number, tile: Tile): TileTemplate {\r\n\r\n\t\tlet id = tile.id\r\n\t\tlet height = (tile.h * this.tileH) - this.tileH\r\n\r\n\t\tlet regularColor\r\n\t\tlet highlight\r\n\t\tlet darkestColor\r\n\r\n\t\tif (tile.tileColor.hex() !== this.config.buildingBaseColor.hex()) {\r\n\t\t\tregularColor = tile.tileColor.hex()\r\n\t\t\thighlight = tile.tileColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = tile.tileColor.changeColorLightingString(-60)\r\n\t\t} else {\r\n\t\t\tregularColor = this.config.buildingBaseColor.hex()\r\n\t\t\thighlight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = this.config.buildingBaseColor.changeColorLightingString(-60)\r\n\t\t}\r\n\r\n\t\tlet top: Position = { x: Math.ceil(xPos + this.dimensions.horizontalWidthFromTop), y: Math.ceil(yPos + this.config.topMargin ) }\r\n\t\tlet left: Position = { x: Math.ceil(xPos), y: Math.ceil(yPos + this.dimensions.verticalHeightFromTop + this.config.topMargin ) }\r\n\t\tlet bottom: Position = { x: Math.ceil(xPos + this.dimensions.horizontalWidthFromBottom), y: Math.ceil(yPos + this.dimensions.totalHeight + this.config.topMargin ) }\r\n\t\tlet right: Position = { x: Math.ceil(xPos + this.dimensions.totalWidth), y: Math.ceil(yPos + this.dimensions.verticalHeightFromBottom + this.config.topMargin ) }\r\n\r\n\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\tlet leftWallRightTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\r\n\t\tlet rightWallLeftTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\tlet rightWallLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\tlet rightWallRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\tlet rightWallRightTop = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\r\n\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\t\tlet blockTopTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\tlet html = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\td=\"M${leftWallLeftTop} \r\n\t\t\t\t\tL${leftWallLeftBottom} \r\n\t\t\t\t\tL${leftWallRightBottom} \r\n\t\t\t\t\tL${leftWallRightTop} \r\n\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\td=\"M${rightWallLeftTop} \r\n\t\t\t\t\tL${rightWallLeftBottom} \r\n\t\t\t\t\tL${rightWallRightBottom} \r\n\t\t\t\t\tL${rightWallRightTop} \r\n\t\t\t\t\tL${rightWallLeftTop} Z\" />\r\n\t\t\t\t\t<path fill=\"${highlight}\"\r\n\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\tL${blockTopBottom} \r\n\t\t\t\t\tL${blockTopRight} \r\n\t\t\t\t\tL${blockTopTop} \r\n\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t</g>`\r\n\r\n\t\tlet coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreateHalfBlock(xPos: number, yPos: number, tile: Tile): TileTemplate {\r\n\r\n\t\tlet id = tile.id\r\n\t\tlet height = (tile.h * this.tileH) - this.tileH\r\n\r\n\t\tlet regularColor\r\n\t\tlet highlight\r\n\t\tlet darkestColor\r\n\r\n\t\tif (tile.tileColor.hex() !== this.config.buildingBaseColor.hex()) {\r\n\t\t\tregularColor = tile.tileColor.hex()\r\n\t\t\thighlight = tile.tileColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = tile.tileColor.changeColorLightingString(-60)\r\n\t\t} else {\r\n\t\t\tregularColor = this.config.buildingBaseColor.hex()\r\n\t\t\thighlight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = this.config.buildingBaseColor.changeColorLightingString(-60)\r\n\t\t}\t\r\n\r\n\t\tlet top: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromTop), \"y\": Math.ceil(yPos + this.config.topMargin ) }\r\n\t\tlet left: Position = { \"x\": Math.ceil(xPos), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromTop + this.config.topMargin ) }\r\n\t\tlet bottom: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromBottom), \"y\": Math.ceil(yPos + this.dimensions.totalHeight + this.config.topMargin ) }\r\n\t\tlet right: Position = { \"x\": Math.ceil(xPos + this.dimensions.totalWidth), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromBottom + this.config.topMargin ) }\r\n\r\n\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-(this.tileH / 2)}`\r\n\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\tlet leftWallRightTop = `${bottom.x} ${bottom.y-height-(this.tileH / 2)}`\r\n\r\n\t\tlet rightWallLeftTop = `${bottom.x} ${bottom.y-height-(this.tileH / 2)}`\r\n\t\tlet rightWallLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\tlet rightWallRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\tlet rightWallRightTop = `${right.x+this.bleed} ${right.y-height-(this.tileH / 2)}`\r\n\r\n\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height-(this.tileH / 2)}`\r\n\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height-(this.tileH / 2)}`\r\n\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height-(this.tileH / 2)}`\r\n\t\tlet blockTopTop = `${top.x} ${top.y-height-(this.tileH / 2)}`\r\n\r\n\t\tlet html = `<g style=\"z-index:${id};\"><path fill=\"${darkestColor}\"\r\n\t\t\t\t\td=\"M${leftWallLeftTop} \r\n\t\t\t\t\tL${leftWallLeftBottom} \r\n\t\t\t\t\tL${leftWallRightBottom} \r\n\t\t\t\t\tL${leftWallRightTop} \r\n\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\td=\"M${rightWallLeftTop} \r\n\t\t\t\t\tL${rightWallLeftBottom} \r\n\t\t\t\t\tL${rightWallRightBottom} \r\n\t\t\t\t\tL${rightWallRightTop} \r\n\t\t\t\t\tL${rightWallLeftTop} Z\" />\r\n\t\t\t\t\t<path fill=\"${highlight}\"\r\n\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\tL${blockTopBottom} \r\n\t\t\t\t\tL${blockTopRight} \r\n\t\t\t\t\tL${blockTopTop} \r\n\t\t\t\t\tL${blockTopLeft} Z\" /></g>`\r\n\r\n\t\tlet coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreateSlopeBlock(xPos: number, yPos: number, tile: Tile, slopeDirection: string): TileTemplate {\r\n\r\n\t\tlet id = tile.id\r\n\t\tlet height = (tile.h * this.tileH) - this.tileH\r\n\t\tlet regularColor: string\r\n\t\tlet regularDarkerColor: string\r\n\t\tlet regularLighterColor: string\r\n\t\tlet shadowLight: string\r\n\t\tlet shadowHighlight: string\r\n\t\tlet shadow: string\r\n\t\tlet highlight: string\r\n\t\tlet almostDarkestColor: string\r\n\t\tlet almostLightestColor: string\r\n\t\tlet darkestColor: string\r\n\t\tlet lightestColor: string\r\n\r\n\t\tif (tile.tileColor.hex() !== this.config.buildingBaseColor.hex()) {\r\n\t\t\tregularColor = tile.tileColor.hex()\r\n\t\t\tregularDarkerColor = tile.tileColor.changeColorLightingString(-10)\r\n\t\t\tregularLighterColor = tile.tileColor.changeColorLightingString(10)\r\n\t\t\tshadowLight = tile.tileColor.changeColorLightingString(-20)\r\n\t\t\tshadowHighlight = tile.tileColor.changeColorLightingString(20)\r\n\t\t\tshadow = tile.tileColor.changeColorLightingString(-30)\r\n\t\t\thighlight = tile.tileColor.changeColorLightingString(30)\r\n\t\t\talmostDarkestColor = tile.tileColor.changeColorLightingString(-40)\r\n\t\t\talmostLightestColor = tile.tileColor.changeColorLightingString(40)\r\n\t\t\tdarkestColor = tile.tileColor.changeColorLightingString(-60)\r\n\t\t\tlightestColor = tile.tileColor.changeColorLightingString(50)\r\n\t\t} else {\r\n\t\t\tregularColor = this.config.buildingBaseColor.hex()\r\n\t\t\tregularDarkerColor = this.config.buildingBaseColor.changeColorLightingString(-10)\r\n\t\t\tregularLighterColor = this.config.buildingBaseColor.changeColorLightingString(10)\r\n\t\t\tshadowLight = this.config.buildingBaseColor.changeColorLightingString(-20)\r\n\t\t\tshadowHighlight = this.config.buildingBaseColor.changeColorLightingString(20)\r\n\t\t\tshadow = this.config.buildingBaseColor.changeColorLightingString(-30)\r\n\t\t\thighlight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t\talmostDarkestColor = this.config.buildingBaseColor.changeColorLightingString(-40)\r\n\t\t\talmostLightestColor = this.config.buildingBaseColor.changeColorLightingString(40)\r\n\t\t\tdarkestColor = this.config.buildingBaseColor.changeColorLightingString(-60)\r\n\t\t\tlightestColor = this.config.buildingBaseColor.changeColorLightingString(50)\r\n\t\t}\r\n\r\n\t\tlet top: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromTop), \"y\": Math.ceil(yPos) }\r\n\t\tlet left: Position = { \"x\": Math.ceil(xPos), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromTop) }\r\n\t\tlet bottom: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromBottom), \"y\": Math.ceil(yPos + this.dimensions.totalHeight) }\r\n\t\tlet right: Position = { \"x\": Math.ceil(xPos + this.dimensions.totalWidth), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromBottom) }\r\n\r\n\t\tlet html = ''\r\n\t\tlet coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\tif (slopeDirection === 'n') {\r\n\r\n\t\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\r\n\t\t\tlet rightWallLeftTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\t\tlet rightWallLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet rightWallRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${shadow}\"\r\n\t\t\t\t\t\t\td=\"M${leftWallLeftTop} \r\n\t\t\t\t\t\t\tL${leftWallLeftBottom} \r\n\t\t\t\t\t\t\tL${leftWallRightBottom} \r\n\t\t\t\t\t\t\tL${leftWallRightTop} \r\n\t\t\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\t\t\td=\"M${rightWallLeftTop}\r\n\t\t\t\t\t\t\tL${rightWallLeftBottom}\r\n\t\t\t\t\t\t\tL${rightWallRightBottom}\r\n\t\t\t\t\t\t\tL${rightWallLeftTop} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${lightestColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'nw') {\r\n\r\n\t\t\tconsole.log('northwest')\r\n\r\n\t\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height}`\r\n\t\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height-this.tileH+this.bleed}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\tlet blockRightBottom = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\t\tlet blockRightRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet blockRightTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\t\td=\"M${leftWallLeftTop}\r\n\t\t\t\t\t\t\tL${leftWallLeftBottom}\r\n\t\t\t\t\t\t\tL${leftWallRightBottom}\r\n\t\t\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${lightestColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockRightBottom}\r\n\t\t\t\t\t\t\tL${blockRightRight}\r\n\t\t\t\t\t\t\tL${blockRightTop}\r\n\t\t\t\t\t\t\tL${blockRightBottom} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 's') {\r\n\r\n\t\t\tlet rightWallLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet rightWallRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet rightWallRightTop = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\t\t\td=\"M${rightWallLeftBottom}\r\n\t\t\t\t\t\t\tL${rightWallRightBottom}\r\n\t\t\t\t\t\t\tL${rightWallRightTop}\r\n\t\t\t\t\t\t\tL${rightWallLeftBottom} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${shadow}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'se') {\r\n\r\n\t\t\tlet blockLeftLeft = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet blockLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockLeftTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\t\tlet blockRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockRightRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet blockRightTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t<path fill=\"${shadow}\"\r\n\t\t\t\t\t\td=\"M${blockLeftLeft}\r\n\t\t\t\t\t\tL${blockLeftBottom}\r\n\t\t\t\t\t\tL${blockLeftTop}\r\n\t\t\t\t\t\tL${blockLeftLeft} Z\" />\r\n\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\td=\"M${blockRightRight}\r\n\t\t\t\t\t\tL${blockRightBottom}\r\n\t\t\t\t\t\tL${blockRightTop}\r\n\t\t\t\t\t\tL${blockRightRight} Z\" />\r\n\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'e') {\r\n\r\n\t\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\t\td=\"M${leftWallLeftTop}\r\n\t\t\t\t\t\t\tL${leftWallLeftBottom}\r\n\t\t\t\t\t\t\tL${leftWallRightBottom}\r\n\t\t\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'ne') {\r\n\r\n\t\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\r\n\t\t\tlet blockBottomLeft = `${left.x-this.bleed} ${left.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockBottomRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet blockBottomTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\td=\"M${leftWallLeftTop}\r\n\t\t\t\t\t\tL${leftWallLeftBottom}\r\n\t\t\t\t\t\tL${leftWallRightBottom}\r\n\t\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t<path fill=\"${lightestColor}\"\r\n\t\t\t\t\t\td=\"M${blockBottomLeft}\r\n\t\t\t\t\t\tL${blockBottomTop}\r\n\t\t\t\t\t\tL${blockBottomRight}\r\n\t\t\t\t\t\tL${blockBottomLeft} Z\" />\r\n\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'w') {\r\n\r\n\t\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height}`\r\n\t\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height-this.tileH+this.bleed}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\t\td=\"M${leftWallLeftTop}\r\n\t\t\t\t\t\t\tL${leftWallLeftBottom}\r\n\t\t\t\t\t\t\tL${leftWallRightBottom}\r\n\t\t\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'sw') {\r\n\r\n\t\t\tlet rightWallLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet rightWallRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet rightWallRightTop = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\t\t\td=\"M${rightWallLeftBottom}\r\n\t\t\t\t\t\t\tL${rightWallRightBottom}\r\n\t\t\t\t\t\t\tL${rightWallRightTop}\r\n\t\t\t\t\t\t\tL${rightWallLeftBottom} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${shadow}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreatePillarBlock(xPos: number, yPos: number, tile: Tile): TileTemplate {\r\n\r\n\t\tlet id = tile.id\r\n\t\tlet tileWidth = this.config.tileWidth\r\n\t\tlet height = (tile.h * this.tileH) - this.tileH\r\n\r\n\t\tlet regularColor\r\n\t\tlet highlight\r\n\t\tlet darkestColor\r\n\r\n\t\tif (tile.tileColor.hex() !== this.config.buildingBaseColor.hex()) {\r\n\t\t\tregularColor = tile.tileColor.hex()\r\n\t\t\thighlight = tile.tileColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = tile.tileColor.changeColorLightingString(-60)\r\n\t\t} else {\r\n\t\t\tregularColor = this.config.buildingBaseColor.hex()\r\n\t\t\thighlight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = this.config.buildingBaseColor.changeColorLightingString(-60)\r\n\t\t}\t\r\n\r\n\t\tlet top: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromTop), \"y\": Math.ceil(yPos + this.config.topMargin ) }\r\n\t\tlet left: Position = { \"x\": Math.ceil(xPos), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromTop + this.config.topMargin ) }\r\n\t\tlet bottom: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromBottom), \"y\": Math.ceil(yPos + this.dimensions.totalHeight + this.config.topMargin ) }\r\n\t\tlet right: Position = { \"x\": Math.ceil(xPos + this.dimensions.totalWidth), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromBottom + this.config.topMargin ) }\r\n\r\n\t\tlet leftWallLeftTop = `${left.x-this.bleed + (tileWidth / 3)} ${left.y-height-this.tileH}`\r\n\t\tlet leftWallLeftBottom = `${left.x-this.bleed + (tileWidth / 3)} ${left.y-height}`\r\n\r\n\t\tlet rightWallRightBottom = `${right.x+this.bleed - (tileWidth / 3)} ${right.y-height}`\r\n\t\tlet rightWallRightTop = `${right.x+this.bleed - (tileWidth / 3)} ${right.y-height-this.tileH}`\r\n\r\n\t\tlet leftWallBezier = `${left.x-this.bleed + (tileWidth / 3) + (tileWidth / 12)} ${bottom.y-height}`\r\n\t\tlet rightWallBezier = `${right.x-this.bleed - (tileWidth / 3) - (tileWidth / 12)} ${bottom.y-height}`\r\n\r\n\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\t\tlet blockTopTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\tlet html = `<g style=\"z-index:${id};\">`\r\n\t\t\thtml += `<defs>${this.calculations.addGradient(\"pillarGradient\", darkestColor, regularColor)}</defs>` \r\n\t\t\thtml += `<path fill=\"url(#pillarGradient)\"`\r\n\t\t\thtml += ` d=\"M ${leftWallLeftTop} `\r\n\t\t\thtml += `L ${leftWallLeftBottom} `\r\n\t\t\thtml += `C ${leftWallBezier}, ${rightWallBezier}, ${rightWallRightBottom} `\r\n\t\t\thtml += `L ${rightWallRightTop} `\r\n\t\t\thtml += `L ${leftWallLeftTop} Z\" /></g>`\r\n\r\n\t\tlet coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreateWindow(xPos: number, yPos: number, tile: Tile, columnInfo: Column, windowLights: boolean): TileTemplate {\r\n\r\n\t\tlet id = tile.id\r\n\t\tlet height = (tile.h * this.tileH) - this.tileH\r\n\t\tlet regularColor = '#222'\r\n\t\tlet darkestColor = '#111'\r\n\t\tlet light = '#f3ef76'\r\n\r\n\t\tlet top: Position = { x: Math.ceil(xPos + this.dimensions.horizontalWidthFromTop), y: Math.ceil(yPos + this.config.topMargin ) }\r\n\t\tlet left: Position = { x: Math.ceil(xPos), y: Math.ceil(yPos + this.dimensions.verticalHeightFromTop + this.config.topMargin ) }\r\n\t\tlet bottom: Position = { x: Math.ceil(xPos + this.dimensions.horizontalWidthFromBottom), y: Math.ceil(yPos + this.dimensions.totalHeight + this.config.topMargin ) }\r\n\t\tlet right: Position = { x: Math.ceil(xPos + this.dimensions.totalWidth), y: Math.ceil(yPos + this.dimensions.verticalHeightFromBottom + this.config.topMargin ) }\r\n\r\n\t\tlet coords: Coords = { top: top, left: left, bottom: bottom, right: right }\r\n\r\n\t\tlet windowBorderWidth = (top.x - left.x) / 10\r\n\r\n\t\tlet html = `<g style=\"z-index:${id+columnInfo.height};\">`\r\n\r\n\t\tif (columnInfo.edge.bottom) {\r\n\r\n\t\t\tlet xEdge = (bottom.x - left.x) / 3\r\n\t\t\tlet yEdge = (bottom.y - left.y) / 8\r\n\r\n\t\t\tlet leftWindowLeftTop = `${left.x + xEdge} ${left.y - height - this.tileH + (yEdge * 7)}`\r\n\t\t\tlet leftWindowLeftBottom = `${left.x + xEdge} ${left.y - height + (yEdge)}`\r\n\t\t\tlet leftWindowRightBottom = `${bottom.x - xEdge} ${bottom.y - height - (yEdge * 4)}`\r\n\t\t\tlet leftWindowRightTop = `${bottom.x - xEdge} ${bottom.y - height - this.tileH + (yEdge * 2)}`\r\n\t\t\tlet leftWindowRightBezier = `${bottom.x - xEdge} ${bottom.y - height - this.tileH - yEdge}`\r\n\t\t\tlet leftWindowLeftBezier = `${left.x + xEdge} ${left.y - height - this.tileH + (yEdge * 4)}`\r\n\r\n\t\t\tlet windowColor = darkestColor\r\n\t\t\tif (windowLights) {\r\n\t\t\t\tlet windowColor = (Math.round(Math.random() * 20) > 18) ? light : darkestColor\r\n\t\t\t}\t\t\r\n\r\n\t\t\thtml += `<path fill=\"${windowColor}\"\r\n\t\t\t\t\t\td=\"M${leftWindowLeftTop} \r\n\t\t\t\t\t\tL${leftWindowLeftBottom} \r\n\t\t\t\t\t\tL${leftWindowRightBottom} \r\n\t\t\t\t\t\tL${leftWindowRightTop} \r\n\t\t\t\t\t\tC${leftWindowRightBezier}, ${leftWindowLeftBezier}, ${leftWindowLeftTop} Z\" />`\r\n\t\t}\r\n\r\n\t\t\r\n\t\tif (columnInfo.edge.right) {\r\n\r\n\t\t\tlet xEdge = (right.x - bottom.x) / 3\r\n\t\t\tlet yEdge = (right.y - bottom.y) / 8\r\n\r\n\t\t\tlet rightWindowLeftTop = `${bottom.x + xEdge} ${bottom.y - height - this.tileH - (yEdge * 2)}`\r\n\t\t\tlet rightWindowLeftBottom = `${bottom.x + xEdge} ${bottom.y - height + (yEdge * 3.6)}`\r\n\t\t\tlet rightWindowRightBottom = `${right.x - xEdge} ${right.y - height - (yEdge * 1)}`\r\n\t\t\tlet rightWindowRightTop = `${right.x - xEdge} ${right.y - height - this.tileH - (yEdge * 6.5)}`\r\n\t\t\tlet rightWindowRightBezier = `${right.x - xEdge} ${right.y - height - this.tileH - (yEdge * 3.2)}`\r\n\t\t\tlet rightWindowLeftBezier = `${bottom.x + xEdge} ${bottom.y - height - this.tileH + (yEdge * 0.3)}`\r\n\t\t\t\r\n\t\t\tlet windowColor = regularColor\r\n\t\t\tif (windowLights) {\r\n\t\t\t\tlet windowColor = (Math.round(Math.random() * 20) > 18) ? light : regularColor\r\n\t\t\t}\t\r\n\r\n\t\t\thtml += `<path fill=\"${windowColor}\"\r\n\t\t\t\t\t\td=\"M${rightWindowLeftTop} \r\n\t\t\t\t\t\tL${rightWindowLeftBottom} \r\n\t\t\t\t\t\tL${rightWindowRightBottom} \r\n\t\t\t\t\t\tL${rightWindowRightTop} \r\n\t\t\t\t\t\tC${rightWindowRightBezier}, ${rightWindowLeftBezier}, ${rightWindowLeftTop} Z\" />`\r\n\t\t}\r\n\r\n\t\thtml += `</g>`\t\t\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreateDoor(xPos: number, yPos: number, tile: Tile, columnInfo: Column, direction?: string): TileTemplate {\r\n\r\n\t\tlet id = tile.id\r\n\t\tlet height = (tile.h * this.tileH) - this.tileH\r\n\t\tlet regularColor\r\n\t\tlet darkestColor\r\n\t\tlet doorHandleColor\r\n\r\n\t\tif (tile.tileColor.hex() !== this.config.buildingBaseColor.hex()) {\r\n\t\t\tdoorHandleColor = new Color(tile.tileColor.hex()).getColorByHue(110).changeColorLightingString(60)\r\n\t\t\tregularColor = new Color(tile.tileColor.hex()).getColorByHue(220).changeColorLightingString(-80)\r\n\t\t\tdarkestColor = new Color(tile.tileColor.hex()).getColorByHue(220).changeColorLightingString(-110)\r\n\t\t} else {\r\n\t\t\tdoorHandleColor = new Color(this.config.buildingBaseColor.hex()).getColorByHue(110).changeColorLightingString(60)\r\n\t\t\tregularColor = new Color(this.config.buildingBaseColor.hex()).getColorByHue(220).changeColorLightingString(-80)\r\n\t\t\tdarkestColor = new Color(this.config.buildingBaseColor.hex()).getColorByHue(220).changeColorLightingString(-110)\r\n\t\t}\r\n\r\n\t\tlet top: Position = { x: Math.ceil(xPos + this.dimensions.horizontalWidthFromTop), y: Math.ceil(yPos + this.config.topMargin ) }\r\n\t\tlet left: Position = { x: Math.ceil(xPos), y: Math.ceil(yPos + this.dimensions.verticalHeightFromTop + this.config.topMargin ) }\r\n\t\tlet bottom: Position = { x: Math.ceil(xPos + this.dimensions.horizontalWidthFromBottom), y: Math.ceil(yPos + this.dimensions.totalHeight + this.config.topMargin ) }\r\n\t\tlet right: Position = { x: Math.ceil(xPos + this.dimensions.totalWidth), y: Math.ceil(yPos + this.dimensions.verticalHeightFromBottom + this.config.topMargin ) }\r\n\r\n\t\tlet coords: Coords = { top: top, left: left, bottom: bottom, right: right }\r\n\r\n\t\tlet windowBorderWidth = (top.x - left.x) / 10\r\n\r\n\t\tlet html = `<g style=\"z-index:${id+columnInfo.height};\">`\r\n\r\n\t\tif (direction === 'bottom') {\r\n\r\n\t\t\tlet xEdge = (bottom.x - left.x) / 4\r\n\t\t\tlet yEdge = (bottom.y - left.y) / 8\r\n\r\n\t\t\tconsole.log(yEdge)\r\n\r\n\t\t\tlet leftWindowLeftTop = `${left.x + xEdge} ${left.y - height - this.tileH + (yEdge * 4.5)}`\r\n\t\t\tlet leftWindowLeftBottom = `${left.x + xEdge} ${left.y - height + (yEdge * 2)}`\r\n\t\t\tlet leftWindowRightBottom = `${bottom.x - xEdge} ${bottom.y - height - (yEdge * 2)}`\r\n\t\t\tlet leftWindowRightTop = `${bottom.x - xEdge} ${bottom.y - height - this.tileH + (yEdge * 0.5)}`\r\n\r\n\t\t\tlet leftWindowBorderLeftTop = `${left.x + xEdge} ${left.y - height - this.tileH + (yEdge * 4.5)}`\r\n\t\t\tlet leftWindowBorderRightBottom = `${bottom.x - xEdge} ${bottom.y - height - (yEdge * 2)}`\r\n\t\t\tlet leftWindowBorderRightTop = `${bottom.x - xEdge} ${bottom.y - height - this.tileH + (yEdge * 0.5)}`\r\n\r\n\t\t\thtml += `<path stroke=\"#111\" stroke-width=\"1.3\"\r\n\t\t\t\t\t\td=\"M${leftWindowBorderLeftTop}\r\n\t\t\t\t\t\tL${leftWindowBorderRightTop}\r\n\t\t\t\t\t\tL${leftWindowBorderRightBottom}\" />\r\n\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\td=\"M${leftWindowLeftTop} \r\n\t\t\t\t\t\tL${leftWindowLeftBottom} \r\n\t\t\t\t\t\tL${leftWindowRightBottom} \r\n\t\t\t\t\t\tL${leftWindowRightTop} \r\n\t\t\t\t\t\tL${leftWindowLeftTop} Z\" />\r\n\t\t\t\t\t<circle fill=\"${doorHandleColor}\" \r\n\t\t\t\t\t\tcx=\"${left.x + (xEdge * 1.4)}\" \r\n\t\t\t\t\t\tcy=\"${bottom.y - height - this.tileH + (yEdge * 2.8)}\" \r\n\t\t\t\t\t\tr=\"0.8\" />`\r\n\t\t}\r\n\r\n\t\t\r\n\t\tif (direction === 'right') {\r\n\r\n\t\t\tlet xEdge = (right.x - bottom.x) / 4\r\n\t\t\tlet yEdge = (right.y - bottom.y) / 8\r\n\r\n\t\t\tlet rightWindowLeftTop = `${bottom.x + xEdge} ${bottom.y - height - this.tileH - (yEdge)}`\r\n\t\t\tlet rightWindowLeftBottom = `${bottom.x + xEdge} ${bottom.y - height + (yEdge * 2)}`\r\n\t\t\tlet rightWindowRightBottom = `${right.x - xEdge} ${right.y - height - (yEdge * 1.5)}`\r\n\t\t\tlet rightWindowRightTop = `${right.x - xEdge} ${right.y - height - this.tileH - (yEdge * 4.5)}`\r\n\r\n\t\t\thtml += `<path stroke=\"#444\" stroke-width=\"1.3\"\r\n\t\t\t\t\t\td=\"M${rightWindowRightTop}\r\n\t\t\t\t\t\tL${rightWindowLeftTop}\r\n\t\t\t\t\t\tL${rightWindowLeftBottom}\" />\r\n\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\t\td=\"M${rightWindowLeftTop} \r\n\t\t\t\t\t\tL${rightWindowLeftBottom} \r\n\t\t\t\t\t\tL${rightWindowRightBottom} \r\n\t\t\t\t\t\tL${rightWindowRightTop} \r\n\t\t\t\t\t\tL${rightWindowLeftTop} Z\" />\r\n\t\t\t\t\t<circle fill=\"${doorHandleColor}\" \r\n\t\t\t\t\t\tcx=\"${bottom.x + (xEdge * 1.3)}\" \r\n\t\t\t\t\t\tcy=\"${bottom.y - height - this.tileH - (yEdge * 4.5)}\" \r\n\t\t\t\t\t\tr=\"0.8\" />`\r\n\t\t}\r\n\r\n\t\thtml += `</g>`\t\t\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreateHalfArch(xPos: number, yPos: number, tile: Tile, orientation: string): TileTemplate {\r\n\r\n\t\tlet id = tile.id\r\n\t\tlet height = (tile.h * this.tileH) - this.tileH\r\n\t\tlet regularColor\r\n\t\tlet darkestColor\r\n\t\tlet highlight\r\n\t\tlet highlightLeft\r\n\t\tlet highlightRight\r\n\t\tlet html\r\n\r\n\t\tif (tile.tileColor.hex() !== this.config.buildingBaseColor.hex()) {\r\n\t\t\tregularColor = tile.tileColor.hex()\r\n\t\t\thighlight = tile.tileColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = tile.tileColor.changeColorLightingString(-60)\r\n\t\t\thighlightLeft = tile.tileColor.changeColorLightingString(15)\r\n\t\t\thighlightRight = tile.tileColor.changeColorLightingString(30)\r\n\t\t} else {\r\n\t\t\tregularColor = this.config.buildingBaseColor.hex()\r\n\t\t\thighlight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = this.config.buildingBaseColor.changeColorLightingString(-60)\r\n\t\t\thighlightLeft = this.config.buildingBaseColor.changeColorLightingString(15)\r\n\t\t\thighlightRight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t}\r\n\r\n\t\tlet top: Position = { x: Math.ceil(xPos + this.dimensions.horizontalWidthFromTop), y: Math.ceil(yPos + this.config.topMargin ) }\r\n\t\tlet left: Position = { x: Math.ceil(xPos), y: Math.ceil(yPos + this.dimensions.verticalHeightFromTop + this.config.topMargin ) }\r\n\t\tlet bottom: Position = { x: Math.ceil(xPos + this.dimensions.horizontalWidthFromBottom), y: Math.ceil(yPos + this.dimensions.totalHeight + this.config.topMargin ) }\r\n\t\tlet right: Position = { x: Math.ceil(xPos + this.dimensions.totalWidth), y: Math.ceil(yPos + this.dimensions.verticalHeightFromBottom + this.config.topMargin ) }\r\n\r\n\t\tlet halfTileWidth = ((right.x - bottom.x) / 3)\r\n\r\n\t\tif (orientation === 'right-bottom') {\r\n\r\n\t\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\r\n\t\t\tlet rightWallLeftTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\t\tlet rightWallLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet rightWallLeftBottomBezier = `${bottom.x} ${bottom.y-height-(this.tileH * 0.5)}`\r\n\t\t\tlet rightWallRightTopBezier = `${bottom.x + (halfTileWidth*0.4)} ${bottom.y-height-this.tileH}`\r\n\t\t\tlet rightWallRightTop = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\td=\"M${leftWallLeftTop} \r\n\t\t\t\t\t\tL${leftWallLeftBottom} \r\n\t\t\t\t\t\tL${leftWallRightBottom} \r\n\t\t\t\t\t\tL${leftWallRightTop} \r\n\t\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\t\td=\"M${rightWallLeftTop} \r\n\t\t\t\t\t\tL${rightWallLeftBottom}\r\n\t\t\t\t\t\tC${rightWallLeftBottomBezier}, ${rightWallRightTopBezier}, ${rightWallRightTop}\r\n\t\t\t\t\t\tL${rightWallLeftTop} Z\" />\r\n\t\t\t\t\t\t<path fill=\"${highlight}\"\r\n\t\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\t\tL${blockTopBottom} \r\n\t\t\t\t\t\tL${blockTopRight} \r\n\t\t\t\t\t\tL${blockTopTop} \r\n\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t</g>`\r\n\r\n\t\t} \r\n\r\n\t\tif (orientation === 'right-top') {\r\n\r\n\t\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\r\n\t\t\tlet rightWallLeftTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\t\tlet rightWallLeftTopBezier = `${right.x+this.bleed-(halfTileWidth*0.3)} ${right.y-height-(this.tileH*0.7)}`\r\n\t\t\tlet rightWallRightBottomBezier = `${right.x} ${right.y-height-(this.tileH*0.4)}`\r\n\t\t\tlet rightWallRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet rightWallRightTop = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\t\tlet blockBackRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet blockBackLeftBottom = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\t\t\tlet blockBackLeftTop = `${top.x-this.bleed} ${top.y-height-this.tileH}`\r\n\t\t\tlet blockBackRightTop = `${top.x-this.bleed} ${top.y-height}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\td=\"M${blockBackRightBottom} \r\n\t\t\t\t\t\tL${blockBackLeftBottom} \r\n\t\t\t\t\t\tL${blockBackLeftTop} \r\n\t\t\t\t\t\tL${blockBackRightTop} \r\n\t\t\t\t\t\tL${blockBackRightBottom} Z\" />\r\n\t\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\t\td=\"M${rightWallLeftTop} \r\n\t\t\t\t\t\tC${rightWallLeftTopBezier}, ${rightWallRightBottomBezier}, ${rightWallRightBottom}\r\n\t\t\t\t\t\tL${rightWallRightTop} \r\n\t\t\t\t\t\tL${rightWallLeftTop} Z\" />\r\n\t\t\t\t\t\t<path fill=\"${highlight}\"\r\n\t\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\t\tL${blockTopBottom} \r\n\t\t\t\t\t\tL${blockTopRight} \r\n\t\t\t\t\t\tL${blockTopTop} \r\n\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tlet coords: Coords = { top: top, left: left, bottom: bottom, right: right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n}","import { Color } from './mapGenerationFunctions.component'\r\n\r\nexport class Tile {\r\n\t\r\n\t_id: number\r\n\t_x: number\r\n\t_y: number\r\n\t_h: number\r\n\t_tileType: TileType\r\n\t_tileColor: Color\r\n\t_options?: TileOptions\r\n\r\n\tconstructor(\t\t\t\r\n\t\t\tid: number,\r\n\t\t\tx: number,\r\n\t\t\ty: number,\r\n\t\t\th: number,\r\n\t\t\ttileType: TileType,\r\n\t\t\ttileColor: Color,\r\n\t\t\toptions?: TileOptions)\r\n\t{\r\n\t\tthis._id = id\r\n\t\tthis._x = x\r\n\t\tthis._y = y\r\n\t\tthis._h = h\r\n\t\tthis._tileType = tileType\r\n\t\tthis._tileColor = tileColor\r\n\r\n\t\tif (options) {\r\n\t\t\tthis._options = options\r\n\t\t}\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\treturn this._id\r\n\t}\r\n\r\n\tget x(): number {\r\n\t\treturn this._x\r\n\t}\r\n\r\n\tget y(): number {\r\n\t\treturn this._y\r\n\t}\r\n\r\n\tget h(): number {\r\n\t\treturn this._h\r\n\t}\r\n\r\n\tget type(): TileType {\r\n\t\treturn this._tileType\r\n\t}\r\n\r\n\tget options(): TileOptions | undefined {\r\n\t\tif (this._options) {\r\n\t\t\treturn this._options\r\n\t\t} else {\r\n\t\t\treturn undefined\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getColor(): Color {\r\n\t\treturn this._tileColor\r\n\t}\r\n\r\n\tget tileColor(): Color {\r\n\t\treturn this._tileColor\r\n\t}\r\n\r\n\tset tileColor(color: Color) {\r\n\t\tthis._tileColor = color\r\n\t}\r\n\r\n\tset type(type: TileType) {\r\n\t\tthis._tileType = type\r\n\t}\r\n}\r\n\r\nexport interface TileOptions {\r\n\troof: boolean,\r\n\tpillar: boolean,\r\n\tslope: string | boolean,\r\n\twindowed: number,\r\n\ttower: boolean,\r\n\tstairs:\tboolean,\r\n\thalfArch: boolean,\r\n\twholeArch: boolean\r\n}\r\n\r\nexport enum TileType {\r\n\tNone = 'none',\r\n\tBody = 'body',\r\n\tTower = 'tower',\r\n\tHalfBlock = 'halfBlock',\r\n\tRoof = 'roof',\r\n\tGrass = 'grass',\r\n\tShadow = 'shadow'\r\n}\r\n"]}