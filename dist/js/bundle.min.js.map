{"version":3,"sources":["node_modules/browser-pack/_prelude.js","bundle.min.js","src/ts/builder.component.ts","src/ts/config.component.ts","src/ts/main.ts","src/ts/mapGenerationFunctions.component.ts","src/ts/mapper.component.ts","src/ts/modifiers.component.ts","src/ts/primitives.component.ts","src/ts/renderelements.component.ts","src/ts/tile.component.ts"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Object","defineProperty","value","mapGenerationFunctions_component_1","tile_component_1","config_component_1","renderelements_component_1","Renderer","[object Object]","this","config","Config","calculations","MapGenerationFunctions","render","RenderElements","map","html","mapWidth","mapLength","tileWidth","tileLength","htmlMap","getMapWidth","y","halfWay","Math","round","x","getColumn","isDefined","getTopTile","tileTopColor","getColor","rgb","tileColor","edge","top","right","bottom","left","blockGroup","height","mapToBuild","mapTotalWidth","mapTotalLength","testTile","createTile","yDeviation","coords","tileHalfWidthLeft","tileHalfWidthRight","tileHalfLengthTop","mapLengthTop","mapLengthBottom","mapWidthPx","mapLengthPx","topMargin","shadowColor","groundColor","changeColorLighting","detailsHtml","lastTile","startTileX","thisPosY","thisPosX","newTile","newData","tileStack","type","TileType","Shadow","color","createPlane","Grass","h","currentTile","Body","tile","createBlock","tileHeight","options","windowed","allowDebug","debugInfo","id","HalfBlock","createHalfBlock","None","pillar","createPillarBlock","xPos","yPos","corner","createSlopeBlock","getTile","./config.component","./mapGenerationFunctions.component","./renderelements.component","./tile.component","2","_allowDebug","_tileWidth","_tileLength","_tileHeight","_tileSmallAngle","_tileLargeAngle","_groundColor","Color","_buildingBaseColor","floor","random","_tileEdgeBleed","_maxAllowedHeight","_topMargin","tileSmallAngle","tileLargeAngle","buildingBaseColor","tileEdgeBleed","maxAllowedHeight","mapArrayWidth","mapArrayLength","3","mapper_component_1","builder_component_1","RandomBuilding","_builder","_map","Map","document","querySelector","style","background","hex","build2DMap","addToBuilding","buildMap","col","getFirstDefinedColumn","console","log","building","setColors","getBaseColor","shade0","changeColorLightingString","shade1","colorDivs","getColorStringByHue","innerHTML","colorMap","drawTileMap","addEventListener","classList","remove","querySelectorAll","forEach","item","parentElement","toggle","addToBuildingAndRedraw","./builder.component","./mapper.component","4","smallAngle","largeAngle","maximumBlockIterations","blockWidth","blockHeight","smallOuterAngle","largeOuterAngle","horizontalWidthFromBottom","getHorizontalBottomShortestWidth","verticalHeightFromBottom","getVerticalBottomShortestHeight","horizontalWidthFromTop","getHorizontalTopLongestWidth","verticalHeightFromTop","getVerticalTopLongestHeight","totalWidth","totalHeight","diagonalWidth","sin","toRadians","diagonalHeight","cos","colorLeft","colorRight","gradient","angle","PI","TileColor","BuildingHeightVariations","params","error","validateHex","hexColor","charAt","setHex","hexToRgb","convertToHSL","validateRgb","setRgb","rgbToHex","toString","g","b","_colorRgb","s","l","_colorHsl","hexadecimal","hexVal1","hexVal2","hexVal3","_colorHex","match","hexValues","substr","split","hexPair1","parseInt","hexPair2","hexPair3","hexR","Number","hexG","hexB","amount","newR","newG","newB","hue","newHue","convertHSLtoRGB","convertRGBtoHex","cmin","min","cmax","max","delta","abs","toFixed","m","5","primitives_component_1","modifiers_component_1","mapMaxHeight","mapEdgeWidth","averageBuildingSize","pyramid","mapGen","primitives","Primitives","mods","Modifiers","_blockHeightVariationLabels","TallCenter","TallSurrounds","Random","_blockHeightVariation","_world","_mapWidth","_mapLength","_mapMaxHeight","_mapEdgeWidth","_averageBuildingSize","_blockHeight","_maximumBlockIterations","_additionalBlockIterations","calculateAdditionalBlockIterations","_blockGroups","_blockEdges","_blockHeightsArray","_mapHalfLength","_blockIdIterator","_blockAmountIterator","_blockHeightIterator","_decorationLineH","newLineHue","lineColor","_defaultColor","_lineColor","_HorizontalRemainingEmptyBlocksMin","_HorizontalRemainingEmptyBlocksMax","_surroundingsGrassColor","_surroundingsWaterColor","_surroundingsSandColor","_surroundingsDefaultColor","_showWindows","firstBlockHeight","mapLengthHalf","startblockLength","startblockWidth","startblockXfromCenter","startblockLengthHalf","startingPositionX","buildGardens","useWaterGarden","hollowBuildingBlock","openGroundLevel","thisBlockGroup","column","Column","xConditions","isSlope","thisPillar","tileType","thisWindowed","isRoof","push","Tile","roof","slope","tower","stairs","indexOf","setEdges","hasEdge","getEdges","addBuildingComponent","edgePointY","edgePointX","grass","getLeastOpenSpaceOnX","landsLength","landsEdge","defaultHeight","gardenBlock","clearMapEdges","mirrorMap","mapHalfLength","blockGroups","maxBlockIterations","blockAmountIterator","blockEdges","blockHeightsArray","heightsArray","blockIdIterator","blockHeightVariation","lineHeight","defaultColor","decorativeColors","showWindows","considerLowerEdges","pos","xMinValues","xMaxValues","xMin","xMax","defined","colX","colY","colHeight","_edge","_tileStack","_defined","_x","_y","_height","groupNum","_blockGroup","_corner","tiles","pop","./modifiers.component","./primitives.component","6","world","oldBlockGroups","activeCol","isTower","nextHeight","openFloor","ceil","randomNum","randomEdgePoint","creationPoint","nextBlockWidth","nextBlockLength","yStartOffset","yConditions","createCol","warn","7","width","widthHalf","heightHalf","quarter","quarterRev","reverse","8","tileW","tileL","tileH","bleed","dimensions","calculateStraightLinesFromIsometricSquare","shadow","pointTop","pointLeft","pointBottom","pointRight","regularColor","blockTopLeft","highlight","darkestColor","leftWallLeftTop","leftWallLeftBottom","leftWallRightBottom","leftWallRightTop","rightWallLeftTop","rightWallLeftBottom","rightWallRightBottom","rightWallRightTop","slopeDirection","regularDarkerColor","regularLighterColor","shadowLight","shadowHighlight","almostDarkestColor","almostLightestColor","lightestColor","blockTopBottom","blockTopTop","blockRightBottom","blockLeftLeft","blockLeftBottom","blockLeftTop","blockRightRight","blockBottomLeft","blockBottomRight","blockBottomTop","blockTopRight","leftWallBezier","rightWallBezier","addGradient","columnInfo","highlightLeft","highlightRight","size","sizeModifierY","isometricHeightDifferenceLeft","isometricHeightDifferenceRight","sizeModifierX","leftEdge","rightEdge","topEdge","bottomEdge","windowInsideLeftTop","9","_id","_h","_tileType","_tileColor","_options"],"mappings":"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","file":"bundle.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()",null,"import { MapGenerationFunctions, Color } from './mapGenerationFunctions.component'\r\nimport { Map } from './mapper.component'\r\nimport { Tile, TileType } from './tile.component'\r\nimport { Config, Coords, TileTemplate, Position } from './config.component'\r\nimport { RenderElements } from './renderelements.component'\r\n\r\nexport class Renderer {\t\r\n\r\n\tprivate config: Config = new Config()\r\n\tprivate calculations: MapGenerationFunctions = new MapGenerationFunctions()\r\n\tprivate render: RenderElements = new RenderElements()\r\n\r\n\tconstructor() {\t}\r\n\r\n\tshowData(map: Map): string {\r\n\r\n\t\tlet html = '<div class=\"showData\">'\r\n\t\thtml += `map width: ${map.mapWidth} tiles<br>map length: ${map.mapLength} tiles<br>`\r\n\t\thtml += `tile width: ${this.config.tileWidth}<br>tile length: ${this.config.tileLength}<br>`\r\n\t\thtml += '</div>'\r\n\r\n\t\treturn html\r\n\t}\r\n\r\n\tbuild2DMap(map: Map): string {\r\n\r\n\t\tlet htmlMap = `<div class=\"map\" style=\"width:${this.config.getMapWidth(map.mapWidth+1)}px;\">`\r\n\r\n\t\thtmlMap += `<div class=\"tile axis\" style=\"width:${this.config.tileWidth}px;height:${this.config.tileLength}px;\"></div>`\r\n\r\n\t\tfor (let i = 0; i < map.mapWidth; i++) {\r\n\t\t\thtmlMap += `<div class=\"tile axis\" style=\"width:${this.config.tileWidth}px;height:${this.config.tileLength}px;\">${i}</div>`\r\n\t\t}\r\n\r\n\t\tfor (let y = 0; y < map.mapLength; y++) {\r\n\r\n\t\t\tlet halfWay = ''\r\n\r\n\t\t\tif (y === Math.round(map.mapLength / 2)) {\r\n\t\t\t\thalfWay = ' half'\r\n\t\t\t}\r\n\r\n\t\t\thtmlMap += `<div class=\"tile axis${halfWay}\" style=\"width:${this.config.tileWidth}px;height:${this.config.tileLength}px;\">${y}</div>`\r\n\r\n\t\t\tfor (let x = 0; x < map.mapWidth; x++) {\r\n\r\n\t\t\t\thtmlMap += `<div class=\"tile${halfWay}\" style=\"width:${this.config.tileWidth}px;height:${this.config.tileLength}px;`\r\n\r\n\t\t\t\tif (map.getColumn(x, y).isDefined && map.getTopTile(x, y)) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet tile = map.getTopTile(x, y)\r\n\t\t\t\t\tlet tileTopColor = tile.getColor().rgb()\r\n\t\t\t\t\tlet tileColor = `rgb(${tileTopColor['r']}, ${tileTopColor['g']}, ${tileTopColor['b']})`\r\n\r\n\t\t\t\t\tlet edge = (map.map[y][x].edge.top || map.map[y][x].edge.right || map.map[y][x].edge.bottom || map.map[y][x].edge.left) ? true : false\r\n\t\t\t\t\tlet blockGroup = map.map[y][x].blockGroup\r\n\r\n\t\t\t\t\thtmlMap += `background-color:${tileColor}\"><div class=\"tileInfo\">x: ${x} y: ${y}<br>height: ${map.map[y][x].height}<br>edge: ${edge}<br>group: ${blockGroup}</div></div>`\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\thtmlMap += `\"></div>`\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\thtmlMap += `</div>`\r\n\r\n\t\treturn htmlMap\r\n\t}\r\n\r\n\tbuildMap(mapToBuild: Map): string {\r\n\r\n\t\tlet mapTotalWidth = mapToBuild.mapWidth\r\n\t\tlet mapTotalLength = mapToBuild.mapLength\r\n\r\n\t\tlet testTile = this.render.createTile(0, 0, '')\r\n\r\n\t\tlet xDeviation = testTile.coords.bottom.x - testTile.coords.top.x\r\n\t\tlet yDeviation = testTile.coords.right.y - testTile.coords.left.y\r\n\t\tlet tileHalfWidthLeft = testTile.coords.top.x - testTile.coords.left.x\r\n\t\tlet tileHalfWidthRight = testTile.coords.right.x - testTile.coords.top.x\r\n\t\tlet mapWidthLeft = tileHalfWidthLeft * mapTotalLength\r\n\t\tlet mapWidthRight = tileHalfWidthRight * mapTotalWidth\r\n\t\tlet tileHalfLengthTop = testTile.coords.right.y\r\n\t\tlet tileHalfLengthBottom = testTile.coords.bottom.y - testTile.coords.right.y\r\n\t\tlet mapLengthTop = tileHalfLengthTop * mapTotalWidth\r\n\t\tlet mapLengthBottom = tileHalfLengthBottom * mapTotalLength\r\n\t\tlet mapWidthPx = Math.round((tileHalfWidthLeft + tileHalfWidthRight) * (mapTotalWidth ))\r\n\t\tlet mapLengthPx = Math.round(mapLengthTop + mapLengthBottom) + this.config.topMargin\r\n\r\n\t\tconst shadowColor = this.config.groundColor.changeColorLighting(-20)\r\n\r\n\t\tconst map = mapToBuild.map\r\n\r\n\t\tlet detailsHtml = ''\r\n\t\tlet html = '<svg width=\"'+mapWidthPx+'\" height=\"'+mapLengthPx+'\">'\r\n\r\n\t\tlet lastTile = null\r\n\t\tlet startTileX = tileHalfWidthLeft * (mapTotalWidth - 1)\r\n\r\n\t\tfor (let y = 0; y < mapTotalLength; y++) {\r\n\r\n\t\t\tfor (let x = 0; x < mapTotalWidth; x++) {\r\n\r\n\t\t\t\tlet thisPosY = 0\r\n\t\t\t\tlet thisPosX = 0\r\n\r\n\t\t\t\tif (x === 0 && y === 0) {\r\n\t\t\t\t\tthisPosX = startTileX\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (lastTile != null) {\r\n\t\t\t\t\tthisPosY = lastTile.coords.right.y\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (y > 0 && x === 0) {\r\n\t\t\t\t\tthisPosX = startTileX - (tileHalfWidthLeft * y)\r\n\t\t\t\t\tthisPosY = (tileHalfLengthTop * y) - (yDeviation * y)\r\n\t\t\t\t}\t\r\n\t\t\t\t\r\n\t\t\t\tif (x > 0) {\r\n\t\t\t\t\tthisPosX = (lastTile.coords.right.x - (lastTile.coords.right.x - lastTile.coords.bottom.x))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet newTile = this.render.createTile(thisPosX, thisPosY, 'shade')\r\n\t\t\t\tlet newData = ''\r\n\t\t\t\t\r\n\t\t\t\tif (map[y][x].isDefined) {\r\n\r\n\t\t\t\t\tif (map[y][x].tileStack[0].type === TileType.Shadow) {\r\n\t\t\t\t\t\tlet color = shadowColor\r\n\t\t\t\t\t\tnewData += this.render.createPlane(thisPosX, thisPosY, map[y][x].tileStack[0], color).html\r\n\t\t\t\t\t} else if (map[y][x].tileStack[0].type === TileType.Grass) {\r\n\t\t\t\t\t\tlet color = map[y][x].tileStack[0].tileColor\r\n\t\t\t\t\t\tnewData += this.render.createPlane(thisPosX, thisPosY, map[y][x].tileStack[0], color).html\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (map[y][x].height > 0) {\r\n\r\n\t\t\t\t\t\tnewData += this.render.createPlane(thisPosX, thisPosY, map[y][x].tileStack[0], shadowColor).html\r\n\r\n\t\t\t\t\t\tfor (let h = 0; h < map[y][x].height; h++) {\r\n\r\n\t\t\t\t\t\t\tlet currentTile = map[y][x].tileStack[h]\r\n\r\n\t\t\t\t\t\t\tif (currentTile.type === TileType.Body) {\r\n\t\t\t\t\t\t\t\tlet tile = this.render.createBlock(thisPosX, thisPosY - this.config.tileHeight, currentTile)\r\n\t\t\t\t\t\t\t\tnewData += tile.html\r\n\r\n\t\t\t\t\t\t\t\tif (currentTile.options.windowed > 0) {\r\n\t\t\t\t\t\t\t\t\t//let window = this.render.createWindow(thisPosX, thisPosY - (this.config.tileHeight * h), currentTile, map[y][x])\r\n\t\t\t\t\t\t\t\t\t//newData += window.html\r\n\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t\tif (this.config.allowDebug) {\r\n\t\t\t\t\t\t\t\t\tif (h === map[y][x].height - 1) {\r\n\t\t\t\t\t\t\t\t\t\tlet debugInfo = `<span>x: ${x}, y: ${y} <span class=\"debugLink showGroups\" data-group=\"${map[y][x].blockGroup}\">groupId: ${map[y][x].blockGroup}</span><br>id: ${currentTile.id}  h: ${h}</span>`\r\n\t\t\t\t\t\t\t\t\t\tdetailsHtml += `<div class=\"blockLabel\" data-groupId=\"${map[y][x].blockGroup}\" style=\"left: ${tile.coords.top.x}px; top: ${tile.coords.top.y - (this.config.tileHeight * h-1)}px;\"><div class=\"point\"></div>${debugInfo}</div>`\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t} else if (currentTile.type === TileType.HalfBlock) {\r\n\r\n\t\t\t\t\t\t\t\tlet tile = this.render.createHalfBlock(thisPosX, thisPosY- this.config.tileHeight, currentTile)\r\n\t\t\t\t\t\t\t\tnewData += tile.html\r\n\r\n\t\t\t\t\t\t\t} else if (currentTile.type === TileType.None) {\r\n\r\n\t\t\t\t\t\t\t\tif (currentTile.options.pillar && h < map[y][x].height) {\r\n\t\t\t\t\t\t\t\t\tif (y < (mapTotalLength/2)-1 || y > (mapTotalLength/2)) {\r\n\t\t\t\t\t\t\t\t\t\tlet pillar = this.render.createPillarBlock(thisPosX, thisPosY- this.config.tileHeight, currentTile)\r\n\t\t\t\t\t\t\t\t\t\tnewData += pillar.html\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t} \r\n\r\n\t\t\t\thtml += newData\r\n\r\n\t\t\t\tlastTile = newTile\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\thtml += '</svg>'\r\n\r\n\t\t// document.querySelector('#debug').innerHTML = detailsHtml\r\n\r\n\t\treturn '<div id=\"debug\">' + detailsHtml + '</div>' + html\r\n\t}\r\n\r\n\taddSlopedEdges(map: any[], x: number, y: number, h: number, xPos: number, yPos: number) {\r\n\r\n\t\tlet tile = null\r\n\r\n\t\tif (map[y][x].edge.top && !map[y][x].corner && h === map[y][x].height-1) {\r\n\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'n')\r\n\t\t} else if (map[y][x].edge.bottom && !map[y][x].corner && h === map[y][x].height-1) {\r\n\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 's')\r\n\t\t} else if (map[y][x].edge.right && !map[y][x].corner && h === map[y][x].height-1) {\r\n\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'e')\r\n\t\t} else if (map[y][x].edge.left && !map[y][x].corner && h === map[y][x].height-1) {\r\n\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'w')\r\n\t\t} else {\r\n\t\t\ttile = this.render.createBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h))\t\r\n\t\t}\r\n\r\n\t\tif (map[y][x].corner && h === map[y][x].height-1) {\r\n\t\t\tif (map[y][x].edge.top && map[y][x].edge.left) {\r\n\t\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'nw')\r\n\t\t\t} else if (map[y][x].edge.top && map[y][x].edge.right) {\r\n\t\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'ne')\r\n\t\t\t} else if (map[y][x].edge.bottom && map[y][x].edge.left) {\r\n\t\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'sw')\r\n\t\t\t} else if (map[y][x].edge.bottom && map[y][x].edge.right) {\r\n\t\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'se')\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn tile\r\n\t}\r\n}\r\n","import { Color } from './mapGenerationFunctions.component'\r\n\r\nexport class Config {\r\n\r\n\tprivate _allowDebug: boolean = true\r\n\tprivate _tileWidth: number = 20\r\n\tprivate _tileLength: number = 20\r\n\tprivate _tileHeight: number = 15\r\n\tprivate _tileSmallAngle: number = 85\r\n\tprivate _tileLargeAngle: number = 100\r\n\tprivate _groundColor: Color = new Color('#f5f3e5')\r\n\tprivate _buildingBaseColor: Color = new Color(\r\n\t\t115 + Math.floor(Math.random() * 75),\r\n\t\t155 + Math.floor(Math.random() * 40),\r\n\t\t150 + Math.floor(Math.random() * 30)\r\n\t)\r\n\tprivate _tileEdgeBleed: number = 0.3\r\n\tprivate _maxAllowedHeight: number = 12\r\n\tprivate _topMargin: number = 80\r\n\r\n\tconstructor() {\t}\t\r\n\r\n\tpublic get allowDebug(): boolean {\r\n\t\treturn this._allowDebug\r\n\t}\r\n\r\n\tpublic get tileWidth(): number {\r\n\t\treturn this._tileWidth\r\n\t}\r\n\r\n\tpublic get tileLength(): number {\r\n\t\treturn this._tileLength\r\n\t}\r\n\r\n\tpublic get tileHeight(): number {\r\n\t\treturn this._tileHeight\r\n\t}\r\n\r\n\tpublic get tileSmallAngle(): number {\r\n\t\treturn this._tileSmallAngle\r\n\t}\r\n\r\n\tpublic get tileLargeAngle(): number {\r\n\t\treturn this._tileLargeAngle\r\n\t}\r\n\r\n\tpublic get groundColor(): Color {\r\n\t\treturn this._groundColor\r\n\t}\r\n\r\n\tpublic get buildingBaseColor(): Color {\r\n\t\treturn this._buildingBaseColor\r\n\t}\r\n\r\n\tpublic get tileEdgeBleed(): number {\r\n\t\treturn this._tileEdgeBleed\r\n\t}\r\n\r\n\tpublic get maxAllowedHeight(): number {\r\n\t\treturn this._maxAllowedHeight\r\n\t}\r\n\r\n\tpublic get topMargin(): number {\r\n\t\treturn this._topMargin\r\n\t}\r\n\r\n\tpublic getMapWidth(mapArrayWidth: number): number {\r\n\t\treturn mapArrayWidth * this._tileWidth\r\n\t}\r\n\r\n\tpublic getMapLength(mapArrayLength: number): number {\r\n\t\treturn mapArrayLength * this._tileLength\r\n\t}\r\n}\r\n\r\nexport interface Coords {\r\n\ttop?: Position,\r\n\tleft?: Position,\r\n\tbottom?: Position,\r\n\tright?: Position\r\n}\r\n\r\nexport interface TileTemplate {\r\n\thtml?: string,\r\n\tcoords?: Coords\r\n}\r\n\r\nexport interface Position {\r\n\tx?: number,\r\n\ty?: number\r\n}\r\n","import { Map } from './mapper.component'\r\nimport { Renderer } from './builder.component'\r\nimport { Color } from './mapGenerationFunctions.component'\r\nimport { Config } from './config.component'\r\n\r\nclass RandomBuilding {\r\n\r\n\tprivate _map: Map\r\n\tprivate _builder: Renderer = new Renderer\r\n\tprivate config: Config = new Config\r\n\r\n\tconstructor() {\r\n\t\tthis._map = new Map(30, 30, 10, 1, 5, 3, 4, false)\r\n\t\tdocument.querySelector('body').style.background = this.config.groundColor.hex()\r\n\t}\r\n\r\n\tpublic debug(): boolean {\r\n\t\treturn this.config.allowDebug\r\n\t}\r\n\r\n\tget map() {\r\n\t\treturn this._map\r\n\t}\r\n\r\n\tpublic colorMap(): string {\r\n\t\treturn this._builder.build2DMap(this._map)\r\n\t}\r\n\r\n\tpublic addToBuildingAndRedraw(): string {\r\n\t\tthis._map.addToBuilding()\r\n\t\treturn this._builder.build2DMap(this._map)\r\n\t}\r\n\r\n\tpublic drawTileMap(): string {\r\n\t\treturn this._builder.buildMap(this._map)\r\n\t}\r\n\r\n\tpublic getBaseColor(): Color {\r\n\r\n\t\tconst col = this.map.getFirstDefinedColumn()\r\n\t\tconst tile = col.tileStack[col.tileStack.length-1]\r\n\r\n\t\tconsole.log(tile)\r\n\r\n\t\treturn tile.getColor()\r\n\t}\r\n}\r\n\r\nlet building = new RandomBuilding()\r\ndocument.querySelector('#color').innerHTML = building.colorMap()\r\ndocument.querySelector(\"#worldtest\").innerHTML = building.drawTileMap()\r\n\r\nsetColors(building)\r\n\r\ndocument.querySelector('#generate').addEventListener('click', () => {\r\n\tbuilding = new RandomBuilding()\r\n\tdocument.querySelector('#color').innerHTML = building.colorMap()\r\n\tdocument.querySelector(\"#worldtest\").innerHTML = building.drawTileMap()\r\n\tdocument.querySelector('#debugActive').classList.remove('active')\r\n\r\n\tdocument.querySelectorAll('.point').forEach((item) => {\r\n\t\titem.addEventListener('click', () => {\r\n\t\t\tconsole.log('toggled', item)\r\n\t\t\titem.parentElement.classList.toggle('active')\r\n\t\t})\t\t\r\n\t})\r\n\r\n\tsetColors(building)\r\n})\r\n\r\ndocument.querySelector('#redraw').addEventListener('click', () => {\r\n\tbuilding.addToBuildingAndRedraw()\r\n\tdocument.querySelector('#color').innerHTML = building.colorMap()\r\n\tdocument.querySelector(\"#worldtest\").innerHTML = building.drawTileMap()\r\n\tdocument.querySelector('#debugActive').classList.remove('active')\r\n\r\n\tdocument.querySelectorAll('.blockLabel').forEach((item) => {\r\n\t\titem.addEventListener('click', () => {\r\n\t\t\titem.classList.toggle('active')\r\n\t\t})\r\n\t})\r\n})\r\n\r\ndocument.querySelector('#debugActive').addEventListener('click', () => {\r\n\tdocument.querySelector('#debug').classList.toggle('show')\r\n\tdocument.querySelector('#debugActive').classList.toggle('active')\r\n})\r\n\r\ndocument.querySelectorAll('.blockLabel').forEach((item) => {\r\n\titem.addEventListener('click', () => {\r\n\t\titem.classList.toggle('active')\r\n\t})\r\n})\r\n\r\nfunction setColors(building: RandomBuilding) {\r\n\r\n\tconst color = building.getBaseColor()\r\n\tconst shade0 = color.changeColorLightingString(0)\r\n\tconst shade1 = color.changeColorLightingString(20)\r\n\tconst shade2 = color.changeColorLightingString(-20)\r\n\tconst shade3 = color.getColorStringByHue(60)\r\n\tconst shade4 = color.getColorStringByHue(120)\r\n\tconst shade5 = color.getColorStringByHue(180)\r\n\tconst shade6 = color.getColorStringByHue(240)\r\n\tconst shade7 = color.getColorStringByHue(300)\r\n\r\n\tconst colorDivs = `\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade0};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade1};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade3};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade4};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade5};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade6};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade7};\"></div>`\r\n\r\n\tdocument.querySelector('#color-scheme').innerHTML = colorDivs\r\n}","import { Config } from './config.component'\r\n\r\nexport class MapGenerationFunctions {\r\n\r\n\tprivate config: Config = new Config();\r\n\tsmallAngle = this.config.tileSmallAngle;\r\n\tlargeAngle = this.config.tileLargeAngle;\r\n\r\n\tconstructor() { }\r\n\r\n\tpublic calculateAdditionalBlockIterations(maximumBlockIterations: number) {\r\n\t\treturn 2 + Math.floor(Math.random() * maximumBlockIterations);\r\n\t}\r\n\r\n\t// calculate the dimensions to draw the isometric perspective tile with the parameters as if it were a straight square tile\r\n\tpublic calculateStraightLinesFromIsometricSquare (blockWidth: number, blockHeight: number) {\r\n\t\t// lengths this function returns when it comes to positions of longest and shortest sides as array\r\n\t\t/*           [0]\r\n\t\t *   _________________ \r\n\t\t *   |    [3]  |      |\r\n\t\t *   | [5]            |\r\n\t\t *   |               -|\r\n\t\t *   |-               | [1]\r\n\t\t *   | [4]            |\r\n\t\t *   |    [2]         |\r\n\t\t *   |_______|________|\r\n\t\t */  \r\n\r\n\t\tlet smallOuterAngle = (180 - this.smallAngle) / 2;\r\n\t\tlet largeOuterAngle = (180 - this.largeAngle) / 2;\r\n\r\n\t\tlet horizontalWidthFromBottom = this.getHorizontalBottomShortestWidth(blockWidth, smallOuterAngle);\r\n\t\tlet verticalHeightFromBottom = this.getVerticalBottomShortestHeight(horizontalWidthFromBottom, smallOuterAngle);\r\n\r\n\t\tlet horizontalWidthFromTop = this.getHorizontalTopLongestWidth(blockHeight, largeOuterAngle);\r\n\t\tlet verticalHeightFromTop = this.getVerticalTopLongestHeight(horizontalWidthFromTop, largeOuterAngle);\r\n\r\n\t\tlet totalHeight = verticalHeightFromBottom + verticalHeightFromTop;\r\n\t\tlet totalWidth = horizontalWidthFromBottom + horizontalWidthFromTop;\r\n\r\n\t\treturn {\t'totalWidth': totalWidth, // 0\r\n\t\t\t\t\t'totalHeight': totalHeight,  // 1\r\n\t\t\t\t\t'horizontalWidthFromBottom': horizontalWidthFromBottom,  // 2\r\n\t\t\t\t\t'horizontalWidthFromTop': horizontalWidthFromTop,  // 3\r\n\t\t\t\t\t'verticalHeightFromBottom': verticalHeightFromBottom,  // 4\r\n\t\t\t\t\t'verticalHeightFromTop': verticalHeightFromTop } // 5\r\n\t}\r\n\r\n\t// calculate the amount of pixels from the bottom left side of a straight square to the point at the bottom \r\n\t// .. where the tip of the tile meets the border of the square\r\n\tpublic getHorizontalBottomShortestWidth (diagonalWidth: number, smallAngle: number): number {\r\n\t\treturn diagonalWidth * Math.sin(this.toRadians(smallAngle));\r\n\t}\r\n\r\n\tpublic getVerticalBottomShortestHeight (diagonalHeight: number, smallAngle: number): number {\r\n\t\treturn diagonalHeight * Math.cos(this.toRadians(smallAngle));\r\n\t}\r\n\r\n\tpublic getHorizontalTopLongestWidth (diagonalWidth: number, largeAngle: number): number {\r\n\t\treturn diagonalWidth * Math.sin(this.toRadians(largeAngle));\r\n\t}\r\n\r\n\tpublic getVerticalTopLongestHeight (diagonalHeight: number, largeAngle: number): number {\r\n\t\treturn diagonalHeight * Math.cos(this.toRadians(largeAngle));\r\n\t}\r\n\r\n\tpublic addGradient(id: string, colorLeft: string, colorRight: string) {\r\n\r\n\t\tlet gradient = '<linearGradient id=\"'+id+'\">'\r\n\t\t\tgradient += '<stop offset=\"5%\" stop-color=\"'+colorLeft+'\" />'\r\n\t\t\tgradient += '<stop offset=\"95%\" stop-color=\"'+colorRight+'\" />'\r\n\t\t\tgradient += '</linearGradient>'\r\n\r\n\t\treturn gradient\r\n\t}\r\n\r\n\ttoRadians (angle: number): number {\r\n\t\treturn angle * (Math.PI / 180);\r\n\t}\r\n}\r\n\r\nexport enum TileColor {\r\n\tRed = 125 + Math.floor(Math.random() * 75),\r\n\tGreen = 170 + Math.floor(Math.random() * 40),\r\n\tBlue = 180 + Math.floor(Math.random() * 30)\r\n}\r\n\r\nexport enum BuildingHeightVariations {\r\n\tTallCenter = 'tallCenter',\r\n\tTallSurrounds = 'tallSurrounds',\r\n\tRandom = 'random'\r\n}\r\n\r\nexport class Color {\r\n\tprivate _colorRgb: RGB\r\n\tprivate _colorHex: string\r\n\tprivate _colorHsl: HSL\r\n\r\n\tconstructor(...params: any[]) {\r\n\t\tlet error = null\r\n\t\tif (params.length === 1) {\r\n\t\t\tif (typeof params[0] === 'string') {\r\n\t\t\t\tif (this.validateHex(params[0])) {\r\n\t\t\t\t\tlet hexColor = params[0]\r\n\t\t\t\t\tif (hexColor.charAt(0) !== '#') {\r\n\t\t\t\t\t\thexColor = `#${hexColor}`\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.setHex(hexColor)\r\n\t\t\t\t\tthis.hexToRgb()\r\n\t\t\t\t\tthis.convertToHSL()\r\n\t\t\t\t} else {\r\n\t\t\t\t\terror = \"Hexadecimal color is incorrect\"\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\terror = \"Length of 1 in parameters is not equal to string\"\r\n\t\t\t}\r\n\t\t} else if (params.length === 3) {\r\n\t\t\tif (this.validateRgb(params)) {\r\n\t\t\t\tthis.setRgb(params[0], params[1], params[2])\r\n\t\t\t\tthis.rgbToHex()\r\n\t\t\t\tthis.convertToHSL()\r\n\t\t\t} else {\r\n\t\t\t\terror = \"Values of RGB exceed limits\"\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (error !== null) {\r\n\t\t\tthrow \"Color type is incorrect. \" + error + \": \" + params.toString()\r\n\t\t}\r\n\t}\r\n\r\n\tpublic setRgb(r: number, g: number, b: number) {\r\n\t\tthis._colorRgb = {r: r, g: g, b: b} as RGB\r\n\t}\r\n\r\n\tpublic setHsl(h: number, s: number, l: number) {\r\n\t\tthis._colorHsl = {h: h, s: s, l: l} as HSL\r\n\t}\r\n\r\n\tpublic setHex(hexadecimal: string) {\r\n\t\tif (hexadecimal.length < 7) {\r\n\t\t\tlet hexVal1 = hexadecimal.charAt(1)\r\n\t\t\tlet hexVal2 = hexadecimal.charAt(2)\r\n\t\t\tlet hexVal3 = hexadecimal.charAt(3)\r\n\t\t\thexadecimal = \"#\" + hexVal1 + hexVal1 + hexVal2 + hexVal2 + hexVal3 + hexVal3\r\n\t\t}\r\n\t\tthis._colorHex = hexadecimal\r\n\t}\r\n\r\n\tpublic rgb(): RGB {\r\n\t\treturn this._colorRgb\r\n\t}\r\n\r\n\tpublic hex(): string {\r\n\t\treturn this._colorHex\r\n\t}\r\n\r\n\tpublic hsl(): HSL {\r\n\t\treturn this._colorHsl\r\n\t}\r\n\r\n\tvalidateRgb(rgb: number[]): boolean {\r\n\t\tif (rgb[0] > -1 && rgb[0] < 256 &&\r\n\t\t\trgb[1] > -1 && rgb[1] < 256 &&\r\n\t\t\trgb[2] > -1 && rgb[2] < 256) {\r\n\t\t\treturn true\r\n\t\t} else {\r\n\t\t\treturn false\r\n\t\t}\r\n\t}\r\n\r\n\tvalidateHex(hex: string): boolean {\r\n\t\tlet regex = /^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/\r\n\t\tif (hex.match(regex)) {\r\n\t\t\treturn true\r\n\t\t} else {\r\n\t\t\treturn false\r\n\t\t}\r\n\t}\r\n\r\n\thexToRgb() {\r\n\t\tlet hexValues: string[] = this._colorHex.substr(1).split('')\r\n\t\tlet hexPair1 = parseInt(hexValues[0]+hexValues[1], 16)\r\n\t\tlet hexPair2 = parseInt(hexValues[2]+hexValues[3], 16)\r\n\t\tlet hexPair3 = parseInt(hexValues[4]+hexValues[5], 16)\r\n\t\tthis.setRgb(hexPair1, hexPair2, hexPair3)\r\n\t\tthis.rgbToHex()\r\n\t}\r\n\r\n\trgbToHex() {\r\n\t\tif (typeof this._colorRgb === 'object') {\r\n\t\t\tlet r = this._colorRgb.r\r\n\t\t\tlet b = this._colorRgb.b\r\n\t\t\tlet g = this._colorRgb.g\r\n\t\t\tlet hexR = Number(r).toString(16)\r\n\t\t\tlet hexG = Number(g).toString(16)\r\n\t\t\tlet hexB = Number(b).toString(16)\r\n\t\t\tthis._colorHex = \"#\" + hexR + hexG + hexB\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\tconvertRGBtoHex(color: RGB): string {\r\n\t\tlet r = color.r\r\n\t\tlet b = color.b\r\n\t\tlet g = color.g\r\n\t\tlet hexR = Number(r).toString(16)\r\n\t\tlet hexG = Number(g).toString(16)\r\n\t\tlet hexB = Number(b).toString(16)\r\n\t\treturn \"#\" + hexR + hexG + hexB\r\n\t}\r\n\r\n\tpublic changeColorLightingString(amount: number): string {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r + amount\r\n\t\tlet newG = g + amount\r\n\t\tlet newB = b + (amount - 8)\r\n\t\tif (newR > 255) newR = 255\r\n\t\tif (newG > 255) newG = 255\r\n\t\tif (newR > 255) newR = 255\r\n\r\n\t\tlet hexR = Number(newR).toString(16)\r\n\t\tlet hexG = Number(newG).toString(16)\r\n\t\tlet hexB = Number(newB).toString(16)\r\n\t\tlet result = \"#\" + hexR + hexG + hexB\r\n\r\n\t\treturn result\r\n\t}\r\n\r\n\tpublic changeColorLighting(amount: number): Color {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r + amount\r\n\t\tlet newG = g + amount\r\n\t\tlet newB = b + (amount - 8)\r\n\t\tif (newR > 255) newR = 255\r\n\t\tif (newG > 255) newG = 255\r\n\t\tif (newR > 255) newR = 255\r\n\t\t\r\n\t\tthis.setRgb(newR, newG, newR)\r\n\t\tthis.rgbToHex()\r\n\t\tthis.convertToHSL()\r\n\r\n\t\treturn this\r\n\t}\r\n\r\n\tpublic getLightestRGB(): RGB {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r + 55\r\n\t\tlet newG = g + 55\r\n\t\tlet newB = b + 40\r\n\t\tif (newR > 255) newR = 255\r\n\t\tif (newG > 255) newG = 255\r\n\t\tif (newR > 255) newR = 255\r\n\t\treturn {r: newR, g: newG, b: newB}\r\n\t}\r\n\r\n\tpublic getHighlightsRGB(): RGB {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r + 45\r\n\t\tlet newG = g + 45\r\n\t\tlet newB = b + 30\r\n\t\tif (newR > 255) newR = 255\r\n\t\tif (newG > 255) newG = 255\r\n\t\tif (newR > 255) newR = 255\r\n\t\treturn {r: newR, g: newG, b: newB}\r\n\t}\r\n\r\n\tpublic getDarkerRegularRGB(): RGB {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r + 15\r\n\t\tlet newG = g + 15\r\n\t\tlet newB = b + 5\r\n\t\tif (newR > 255) newR = 255\r\n\t\tif (newG > 255) newG = 255\r\n\t\tif (newR > 255) newR = 255\r\n\t\treturn {r: newR, g: newG, b: newB}\r\n\t}\r\n\r\n\tpublic getHalflightsRGB(): RGB {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r + 25\r\n\t\tlet newG = g + 25\r\n\t\tlet newB = b + 15\r\n\t\tif (newR > 255) newR = 255\r\n\t\tif (newG > 255) newG = 255\r\n\t\tif (newR > 255) newR = 255\r\n\t\treturn {r: newR, g: newG, b: newB}\r\n\t}\r\n\r\n\tpublic getShadowsRGB(): RGB {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r - 55\r\n\t\tlet newG = g - 55\r\n\t\tlet newB = b - 35\r\n\t\tif (newR < 0) newR = 0\r\n\t\tif (newG < 0) newG = 0\r\n\t\tif (newR < 0) newR = 0\r\n\t\treturn {r: newR, g: newG, b: newB}\r\n\t}\r\n\r\n\tpublic getDarkestRGB(): RGB {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r - 70\r\n\t\tlet newG = g - 70\r\n\t\tlet newB = b - 60\r\n\t\tif (newR < 0) newR = 0\r\n\t\tif (newG < 0) newG = 0\r\n\t\tif (newR < 0) newR = 0\r\n\t\treturn {r: newR, g: newG, b: newB}\r\n\t}\r\n\r\n\tpublic getColorStringByHue(hue: number): string {\r\n\r\n\t\tlet h = this._colorHsl.h,\r\n\t\t\ts = this._colorHsl.s,\r\n\t\t\tl = this._colorHsl.l\r\n\r\n\t\tlet newHue = h + hue\r\n\r\n\t\tif (newHue > 360) {\r\n\t\t\tnewHue = newHue % 360\r\n\t\t}\r\n\r\n\t\tlet rgb = this.convertHSLtoRGB({h: newHue, s: s, l: l})\r\n\r\n\t\treturn this.convertRGBtoHex(rgb)\r\n\t}\r\n\r\n\tpublic getColorByHue(hue: number): Color {\r\n\r\n\t\tlet h = this._colorHsl.h,\r\n\t\t\ts = this._colorHsl.s,\r\n\t\t\tl = this._colorHsl.l\r\n\r\n\t\tlet newHue = h + hue\r\n\r\n\t\tif (newHue > 360) {\r\n\t\t\tnewHue = newHue % 360\r\n\t\t}\r\n\r\n\t\tlet rgb = this.convertHSLtoRGB({h: newHue, s: s, l: l})\r\n\r\n\t\tthis.setRgb(rgb.r, rgb.g, rgb.b)\r\n\t\tthis.rgbToHex()\r\n\r\n\t\treturn this\r\n\t}\r\n\r\n\tconvertToHSL(): void {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\r\n\t\tr /= 255\r\n\t\tg /= 255\r\n\t\tb /= 255\r\n\r\n\t\tlet cmin = Math.min(r,g,b),\r\n\t\t\tcmax = Math.max(r,g,b),\r\n\t\t\tdelta = cmax - cmin,\r\n\t\t\th = 0,\r\n\t\t\ts = 0,\r\n\t\t\tl = 0\r\n\r\n\t\t// calculate hue\r\n\t\tif (delta === 0) {\r\n\t\t\th = 0\r\n\t\t} else if (cmax === r) {\r\n\t\t\th = ((g - b) / delta) % 6\r\n\t\t} else if (cmax === g) {\r\n\t\t\th = (b - r) / delta + 2\r\n\t\t} else {\r\n\t\t\th = (r - g) / delta + 4\r\n\t\t}\r\n\r\n\t\th = Math.round(h * 60)\r\n\r\n\t\tif (h < 0) {\r\n\t\t\th += 360\r\n\t\t}\r\n\r\n\t\t// calculate lightness\r\n\t\tl = (cmax + cmin) / 2 \r\n\r\n\t\t// calculate saturation\r\n\t\ts = delta === 0 ? 0 : delta / (1 - Math.abs(2 * l - 1))\r\n\r\n\t\ts = +(s * 100).toFixed(1)\r\n\t\tl = +(l * 100).toFixed(1)\r\n\r\n\t\tthis._colorHsl = { h: h, s: s, l: l }\r\n\t}\r\n\r\n\tconvertHSLtoRGB(color: HSL): RGB {\r\n\r\n\t\tlet h = color.h\r\n\t\tlet s = color.s\r\n\t\tlet l = color.l\r\n\r\n\t\ts /= 100\r\n\t\tl /= 100\r\n\r\n\t\tlet c = (1 - Math.abs(2 * l - 1)) * s,\r\n\t\t\tx = c * (1 - Math.abs((h / 60) % 2 - 1)),\r\n\t\t\tm = l - c / 2,\r\n\t\t\tr = 0,\r\n\t\t\tg = 0,\r\n\t\t\tb = 0\r\n\r\n\t\tif (0 <= h && h < 60) {\r\n\t\t\tr = c; g = x; b = 0;\r\n\t\t} else if (60 <= h && h < 120) {\r\n\t\t\tr = x; g = c; b = 0;\r\n\t\t} else if (120 <= h && h < 180) {\r\n\t\t\tr = 0; g = c; b = x;\r\n\t\t} else if (180 <= h && h < 240) {\r\n\t\t\tr = 0; g = x; b = c;\r\n\t\t} else if (240 <= h && h < 300) {\r\n\t\t\tr = x; g = 0; b = c;\r\n\t\t} else if (300 <= h && h < 360) {\r\n\t\t\tr = c; g = 0; b = x;\r\n\t\t}\r\n\t\t\r\n\t\tr = Math.round((r + m) * 255)\r\n\t\tg = Math.round((g + m) * 255)\r\n\t\tb = Math.round((b + m) * 255)\r\n\r\n\t\treturn {r: r, g: g, b: b}\r\n\t}\r\n}\r\n\r\nexport interface RGB {\r\n\tr: number,\r\n\tg: number,\r\n\tb: number\r\n}\r\n\r\nexport interface HSL {\r\n\th: number,\r\n\ts: number,\r\n\tl: number\r\n}","import { MapGenerationFunctions, BuildingHeightVariations, Color } from './mapGenerationFunctions.component'\r\nimport { Tile, TileType, TileOptions } from './tile.component'\r\nimport { Config, Position } from './config.component'\r\nimport { Primitives } from './primitives.component'\r\nimport { Modifiers } from './modifiers.component'\r\n\r\nexport class Map {\r\n\r\n\tprivate mapGen: MapGenerationFunctions = new MapGenerationFunctions()\r\n\tprivate config: Config = new Config()\r\n\tprivate primitives: Primitives = new Primitives()\r\n\tprivate mods: Modifiers = new Modifiers()\r\n\r\n\tprivate _mapWidth: number\r\n\tprivate _mapLength: number\r\n\tprivate _mapMaxHeight: number\r\n\tprivate _averageBuildingSize: number\r\n\tprivate _blockHeight: number\r\n\tprivate _maximumBlockIterations: number\r\n\tprivate _additionalBlockIterations: number\r\n\tprivate _mapEdgeWidth: number\r\n\tprivate _highestPoint: number\r\n\tprivate _startBlockXfromCenterDeviation: number\r\n\tprivate _mapHalfLength: number\r\n\tprivate _world: any[][]\r\n\tprivate _blockHeightsArray: number[]\r\n\tprivate _blockGroups: number[]\r\n\tprivate _blockEdges: Position[]\t\r\n\tprivate _blockHeightVariationLabels = [BuildingHeightVariations.TallCenter, BuildingHeightVariations.TallSurrounds, BuildingHeightVariations.Random]\r\n\tprivate _blockHeightVariation = this._blockHeightVariationLabels[Math.floor(Math.random() * 3)]\r\n\tprivate _blockIdIterator: number\r\n\tprivate _blockHeightIterator: number\r\n\tprivate _blockAmountIterator: number\r\n\tprivate _HorizontalRemainingEmptyBlocksMin: number\r\n\tprivate _HorizontalRemainingEmptyBlocksMax: number\r\n\tprivate _decorationLineH: number\r\n\tprivate _groundColor: Color\r\n\tprivate _defaultColor: Color\r\n\tprivate _lineColor: Color\r\n\tprivate _surroundingsGrassColor: Color\r\n\tprivate _surroundingsWaterColor: Color\r\n\tprivate _surroundingsSandColor: Color\r\n\tprivate _surroundingsDefaultColor: Color\r\n\tprivate _showWindows: number\r\n\r\n\tconstructor(\t\r\n\t\t\tmapWidth: number, \r\n\t\t\tmapLength: number, \r\n\t\t\tmapMaxHeight: number, \r\n\t\t\tmapEdgeWidth: number,\r\n\t\t\taverageBuildingSize: number,\r\n\t\t\tblockHeight: number,\r\n\t\t\tmaximumBlockIterations: number,\r\n\t\t\tpyramid: boolean)\r\n\t{\r\n\t\tthis._world = []\r\n\t\tthis._mapWidth = mapWidth\r\n\t\tthis._mapLength = mapLength\r\n\t\tthis._mapMaxHeight = mapMaxHeight\r\n\t\tthis._mapEdgeWidth = mapEdgeWidth\r\n\t\tthis._averageBuildingSize = averageBuildingSize \r\n\t\tthis._blockHeight = blockHeight\r\n\t\tthis._maximumBlockIterations = maximumBlockIterations\r\n\t\tthis._additionalBlockIterations = this.mapGen.calculateAdditionalBlockIterations(maximumBlockIterations)\r\n\t\tthis._blockGroups = []\r\n\t\tthis._blockEdges = []\r\n\t\tthis._blockHeightsArray = []\r\n\t\tthis._mapHalfLength = Math.floor(mapLength / 2)\r\n\t\tthis._blockIdIterator = 0\r\n\t\tthis._blockAmountIterator = 1\r\n\t\tthis._blockHeightIterator = 1\r\n\t\tthis._decorationLineH = -1\r\n\t\tlet newLineHue = this.config.buildingBaseColor.getColorStringByHue(-120)\r\n\t\tlet lineColor = new Color(newLineHue)\r\n\t\tthis._defaultColor = new Color(this.config.buildingBaseColor.hex())\r\n\t\tthis._lineColor = lineColor.changeColorLighting(-30)\r\n\t\tthis._groundColor = this.config.groundColor\r\n\t\tthis._HorizontalRemainingEmptyBlocksMin = 0\r\n\t\tthis._HorizontalRemainingEmptyBlocksMax = 0\r\n\t\tthis._surroundingsGrassColor = new Color('#7bb376')\r\n\t\tthis._surroundingsWaterColor = new Color('#6fb9ca')\r\n\t\tthis._surroundingsSandColor = new Color('#e9e3ba')\r\n\t\tthis._surroundingsDefaultColor = this._surroundingsGrassColor\r\n\t\tthis._showWindows = Math.round(Math.random() * 2)\r\n\r\n\t\tlet mapLengthHalf = Math.floor(mapLength / 2) \r\n\t\tlet mapWidthHalf = Math.floor(mapWidth / 2)\r\n\t\tlet startBlockXfromCenterDeviation = 7\r\n\t\tlet startblockLength = this._averageBuildingSize + Math.floor(Math.random() * 4)\r\n\t\tlet startblockWidth = this._averageBuildingSize + Math.floor(Math.random() * 3)\r\n\t\tlet startblockXfromCenter = 4 + Math.floor(Math.random() * startBlockXfromCenterDeviation)\r\n\t\tlet startblockLengthHalf = Math.floor(startblockLength / 2)\r\n\t\tlet startblockWidthHalf = Math.floor(startblockWidth / 2)\r\n\t\tlet startingPositionX = Math.floor(this._mapWidth / 2) - Math.floor(startblockXfromCenter / 2)\r\n\t\tlet buildGardens = !!(Math.round(Math.random() * 2))\r\n\t\tlet useWaterGarden = false\t\t\r\n\t\tlet tileHeight = 0\r\n\t\tlet firstBlockHeight\r\n\r\n\t\tif (this._defaultColor.rgb().g >= 180 && this._defaultColor.rgb().b >= 150 && Math.round(Math.random() * 4) >= 3) {\r\n\t\t\tuseWaterGarden = true\r\n\t\t\tthis._surroundingsDefaultColor = this._surroundingsWaterColor\r\n\t\t} else if (Math.round(Math.random() * 10) <= 1) {\r\n\t\t\tuseWaterGarden = true\r\n\t\t\tthis._surroundingsDefaultColor = this._surroundingsWaterColor\r\n\t\t}\r\n\r\n\t\tif (this._blockHeightVariation === BuildingHeightVariations.TallCenter) {\r\n\t\t\tfirstBlockHeight = this._blockHeight * 3\r\n\t\t} else if (this._blockHeightVariation === BuildingHeightVariations.TallSurrounds) {\r\n\t\t\tfirstBlockHeight = 3 + Math.round(Math.random())\r\n\t\t\tthis._blockHeight = firstBlockHeight\r\n\t\t} else {\r\n\t\t\tfirstBlockHeight = this._blockHeight + Math.round(Math.random() * 4)\r\n\t\t}\r\n\r\n\t\tif (firstBlockHeight > 6) {\r\n\t\t\tthis._decorationLineH = 4\r\n\t\t} else if (firstBlockHeight > 3) {\r\n\t\t\tthis._decorationLineH = 3\r\n\t\t}\r\n\r\n\t\tthis._blockHeight = firstBlockHeight\r\n\r\n\t\tlet hollowBuildingBlock = (Math.round(Math.random()) === 1 ? true : false) \r\n\t\tlet openGroundLevel = (Math.round(Math.random()) === 1 ? true : false) \r\n\r\n\t\tconsole.log('showWindows', this._showWindows)\r\n\r\n\t\tfor (let y = 0; y < this.mapLength; y++) {\r\n\r\n\t\t\tthis._world[y] = []\r\n\r\n\t\t\tfor (let x = 0; x < this.mapWidth; x++) {\r\n\r\n\t\t\t\tlet thisBlockGroup = 0\r\n\r\n\t\t\t\tlet column = new Column(false, x, y, 0)\r\n\r\n\t\t\t\tlet yConditions = (y >= mapLengthHalf && y <= (mapLengthHalf + startblockLengthHalf))\r\n\t\t\t\tlet xConditions = (x > startingPositionX && x <= (startingPositionX + startblockWidth))\r\n\r\n\t\t\t\tif (yConditions) {\r\n\r\n\t\t\t\t\tif (xConditions) {\r\n\r\n\t\t\t\t\t\tthisBlockGroup = 1\r\n\t\t\t\t\t\tlet tileStack = []\r\n\r\n\t\t\t\t\t\tfor (let h = 0; h < firstBlockHeight; h++) {\r\n\r\n\t\t\t\t\t\t\tlet isSlope = true\r\n\t\t\t\t\t\t\tlet thisPillar = false\r\n\t\t\t\t\t\t\tlet tileType = TileType.Body\r\n\t\t\t\t\t\t\tif (h < 2 && openGroundLevel) {\r\n\t\t\t\t\t\t\t\tif (y % 2 === 0) {\r\n\t\t\t\t\t\t\t\t\tthisPillar = true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (this._decorationLineH > 3 && h+1 === this._decorationLineH && h+1 < firstBlockHeight) {\r\n\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\tif (y % 2 === 0) {\r\n\t\t\t\t\t\t\t\t\tthisPillar = true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlet thisWindowed = 0\r\n\t\t\t\t\t\t\tif (!thisPillar && this._showWindows > 0 && h % 2 === 1) {\r\n\t\t\t\t\t\t\t\tthisWindowed = this._showWindows\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlet isRoof = (h === firstBlockHeight-1) ? true : false\r\n\t\t\t\t\t\t\tlet tileColor = this._defaultColor\r\n\r\n\t\t\t\t\t\t\tif (h === this._decorationLineH) {\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\ttileColor = this._lineColor\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttileColor = this._defaultColor\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\ttileStack.push(\r\n\t\t\t\t\t\t\t\tnew Tile(\r\n\t\t\t\t\t\t\t\t\tthis._blockIdIterator, \r\n\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\th, \r\n\t\t\t\t\t\t\t\t\ttileType,\r\n\t\t\t\t\t\t\t\t\ttileColor,\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\troof:\t\tisRoof,\r\n\t\t\t\t\t\t\t\t\t\tpillar: \tthisPillar,\r\n\t\t\t\t\t\t\t\t\t\tslope:\t\tisSlope,\r\n\t\t\t\t\t\t\t\t\t\twindowed: \tthisWindowed,\r\n\t\t\t\t\t\t\t\t\t\ttower: \t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\tstairs:\t\tfalse\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t)\r\n\r\n\t\t\t\t\t\t\tif (this._blockGroups.indexOf(thisBlockGroup) === -1) {\r\n\t\t\t\t\t\t\t\tthis._blockGroups.push(thisBlockGroup)\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tthis._blockHeightsArray.push(firstBlockHeight)\r\n\r\n\t\t\t\t\t\t\tthis._blockIdIterator++\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tcolumn = new Column(true, x, y, firstBlockHeight)\r\n\r\n\t\t\t\t\t\tcolumn.blockGroup = thisBlockGroup\r\n\t\t\t\t\t\tcolumn.height = firstBlockHeight\r\n\t\t\t\t\t\tcolumn.corner = false\r\n\t\t\t\t\t\tcolumn.tileStack = tileStack\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._world[y][x] = column\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.setEdges(false)\r\n\r\n\t\t/* Make hollow */\r\n\t\tif (hollowBuildingBlock) {\r\n\r\n\t\t\tfor (let y = 0; y < this.mapLength; y++) {\r\n\t\t\t\tfor (let x = 0; x < this.mapWidth; x++) {\r\n\r\n\t\t\t\t\tlet hasEdge = (this._world[y][x].edge.left || this._world[y][x].edge.bottom || this._world[y][x].edge.right) ? true : false\r\n\r\n\t\t\t\t\tif (this._world[y][x].isDefined && !hasEdge) {\r\n\t\t\t\t\t\tthis._world[y][x] = new Column(false, x, y, 0)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfor (let i = 0; i < this._additionalBlockIterations; i++) {\r\n\t\t\tthis.getEdges()\r\n\t\t\tthis._world = this.mods.addBuildingComponent(this)\r\n\t\t}\r\n\r\n\t\t/* \t\r\n\t\t *\tAdd shadows around the building\r\n\t\t */\r\n\r\n\t\tfor (let e = 0; e < this._blockEdges.length; e++) {\r\n\t\t\tlet edgePointY = this._blockEdges[e].y\r\n\t\t\tlet edgePointX = this._blockEdges[e].x\r\n\t\t\tlet grass = new Column(true, edgePointX, edgePointY, 0)\r\n\t\t\t\tgrass.tileStack = [new Tile(\r\n\t\t\t\t\t\t\t\t\tthis._blockIdIterator, \r\n\t\t\t\t\t\t\t\t\tedgePointX, \r\n\t\t\t\t\t\t\t\t\tedgePointY, \r\n\t\t\t\t\t\t\t\t\t0, \r\n\t\t\t\t\t\t\t\t\tTileType.Shadow,\r\n\t\t\t\t\t\t\t\t\tthis._defaultColor)]\r\n\r\n\t\t\tif (this._world[edgePointY][edgePointX].isDefined) {\r\n\t\t\t\t\r\n\t\t\t\tif (!this._world[edgePointY - 1][edgePointX].isDefined) {\r\n\t\t\t\t\tthis._world[edgePointY - 1][edgePointX] = grass\r\n\t\t\t\t}\r\n\t\t\t\tif (!this._world[edgePointY + 1][edgePointX].isDefined) {\r\n\t\t\t\t\tthis._world[edgePointY + 1][edgePointX] = grass\r\n\t\t\t\t}\r\n\t\t\t\tif (!this._world[edgePointY][edgePointX - 1].isDefined) {\r\n\t\t\t\t\tthis._world[edgePointY][edgePointX - 1] = grass\r\n\t\t\t\t}\r\n\t\t\t\tif (!this._world[edgePointY][edgePointX + 1].isDefined) {\r\n\t\t\t\t\tthis._world[edgePointY][edgePointX + 1] = grass\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._blockIdIterator++\r\n\t\t}\r\n\r\n\t\t/* \t\r\n\t\t *\tAdd gardens or other ornamental features around the building\r\n\t\t */\r\n\r\n\t\tif (buildGardens) {\r\n\r\n\t\t\tthis._HorizontalRemainingEmptyBlocksMin = this.getLeastOpenSpaceOnX()['min']\r\n\t\t\tthis._HorizontalRemainingEmptyBlocksMax = this.getLeastOpenSpaceOnX()['max']\r\n\r\n\t\t\tif (this._HorizontalRemainingEmptyBlocksMin > 7) {\r\n\r\n\t\t\t\tlet landsLength = this._HorizontalRemainingEmptyBlocksMin * 2\r\n\t\t\t\tif (landsLength > 16) landsLength = 16\r\n\t\t\t\tlet landsEdge = this._mapLength - landsLength\r\n\r\n\t\t\t\tfor (let y = Math.floor(landsEdge / 2); y < this.mapLength - Math.floor(landsEdge / 2); y++) {\t\t\t\t\r\n\t\t\t\t\tfor (let x = 0; x < this._HorizontalRemainingEmptyBlocksMin - 3; x++) {\r\n\t\t\t\t\t\tif (!this._world[y][x].isDefined) {\r\n\t\t\t\t\t\t\tlet edgeOfGarden = false\r\n\t\t\t\t\t\t\tlet tileType: TileType = TileType.Grass\r\n\t\t\t\t\t\t\tlet tileColor = this._surroundingsDefaultColor\r\n\t\t\t\t\t\t\tlet defaultHeight = 0\r\n\t\t\t\t\t\t\tif (x === 0 || \r\n\t\t\t\t\t\t\t\tx === this._HorizontalRemainingEmptyBlocksMin - 4) {\r\n\t\t\t\t\t\t\t\tif (useWaterGarden) {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._defaultColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.HalfBlock\r\n\t\t\t\t\t\t\t\t\tdefaultHeight = 1\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._surroundingsSandColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.Grass\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\t\t\t(y === Math.floor(landsEdge / 2) + 1) ||\r\n\t\t\t\t\t\t\t\t\t(y === this.mapLength - Math.floor(landsEdge / 2) - 1) ) {\r\n\t\t\t\t\t\t\t\tif (useWaterGarden) {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._defaultColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.HalfBlock\r\n\t\t\t\t\t\t\t\t\tdefaultHeight = 1\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._surroundingsSandColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.Grass\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlet gardenBlock = new Column(true, x, y, defaultHeight)\r\n\t\t\t\t\t\t\t\tgardenBlock.tileStack = [new Tile(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis._blockIdIterator, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t0, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttileType,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttileColor)]\r\n\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\tthis._world[y][x] = gardenBlock\r\n\t\t\t\t\t\t\tthis._blockIdIterator++\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this._HorizontalRemainingEmptyBlocksMax > 7) {\r\n\r\n\t\t\t\tlet landsLength = this._HorizontalRemainingEmptyBlocksMax * 2\r\n\t\t\t\tlet landsEdge = this._mapLength - landsLength\r\n\r\n\t\t\t\tfor (let y = Math.floor(landsEdge / 2); y < this.mapLength - Math.floor(landsEdge / 2); y++) {\r\n\t\t\t\t\tfor (let x = this._mapWidth - this._HorizontalRemainingEmptyBlocksMax + 2; x < this._mapWidth; x++) {\r\n\t\t\t\t\t\tif (!this._world[y][x].isDefined) {\r\n\t\t\t\t\t\t\tlet edgeOfGarden = false\r\n\t\t\t\t\t\t\tlet tileType: TileType = TileType.Grass\r\n\t\t\t\t\t\t\tlet tileColor = this._surroundingsDefaultColor\r\n\t\t\t\t\t\t\tlet defaultHeight = 0\r\n\t\t\t\t\t\t\tif (x === this._mapWidth - 1 || \r\n\t\t\t\t\t\t\t\tx === this._mapWidth - this._HorizontalRemainingEmptyBlocksMax + 2) {\r\n\t\t\t\t\t\t\t\tif (useWaterGarden) {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._defaultColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.HalfBlock\r\n\t\t\t\t\t\t\t\t\tdefaultHeight = 1\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._surroundingsSandColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.Grass\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\t\t\ty === Math.floor(landsEdge / 2) + 1 ||\r\n\t\t\t\t\t\t\t\t\ty === this.mapLength - Math.floor(landsEdge / 2) - 1) {\r\n\t\t\t\t\t\t\t\tif (useWaterGarden) {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._defaultColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.HalfBlock\r\n\t\t\t\t\t\t\t\t\tdefaultHeight = 1\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._surroundingsSandColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.Grass\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlet gardenBlock = new Column(true, x, y, defaultHeight)\r\n\t\t\t\t\t\t\t\tgardenBlock.tileStack = [new Tile(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis._blockIdIterator, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t0, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttileType,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttileColor)]\r\n\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\tthis._world[y][x] = gardenBlock\r\n\t\t\t\t\t\t\tthis._blockIdIterator++\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/* \t\r\n\t\t *\tClear the edges and mirror the building\r\n\t\t */\r\n\r\n\t\tthis._world = this.mods.clearMapEdges(this)\r\n\t\tthis._world = this.mods.mirrorMap(this)\r\n\t\tthis.setEdges(false)\r\n\r\n\t\tconsole.log(this._blockEdges)\r\n\t\tconsole.log(this._world)\r\n\t}\t\r\n\r\n\tget mapWidth(): number {\r\n\t\treturn this._mapWidth\r\n\t}\r\n\r\n\tget mapLength(): number {\r\n\t\treturn this._mapLength\r\n\t}\r\n\r\n\tget mapHalfLength(): number {\r\n\t\treturn this._mapHalfLength\r\n\t}\r\n\r\n\tget mapEdgeWidth(): number {\r\n\t\treturn this._mapEdgeWidth\r\n\t}\r\n\r\n\tget map(): any[] {\r\n\t\treturn this._world\r\n\t}\r\n\r\n\tget blockGroups(): number[] {\r\n\t\treturn this._blockGroups\r\n\t}\r\n\r\n\tset blockGroups(blockGroups: number[]) {\r\n\t\tthis._blockGroups = blockGroups\r\n\t}\r\n\r\n\tget blockHeight(): number {\r\n\t\treturn this._blockHeight\r\n\t}\r\n\r\n\tget mapMaxHeight(): number {\r\n\t\treturn this._mapMaxHeight\r\n\t}\r\n\r\n\tset blockHeight(height: number) {\r\n\t\tthis._blockHeight = height\r\n\t}\r\n\r\n\tget maxBlockIterations(): number {\r\n\t\treturn this._maximumBlockIterations\r\n\t}\r\n\r\n\tget blockAmountIterator(): number {\r\n\t\treturn this._blockAmountIterator\r\n\t}\r\n\r\n\tset blockAmountIterator(i: number) {\r\n\t\tthis._blockAmountIterator = i\r\n\t}\r\n\r\n\tget averageBuildingSize(): number {\r\n\t\treturn this._averageBuildingSize\r\n\t}\r\n\r\n\tget blockEdges(): object[] {\r\n\t\treturn this._blockEdges\r\n\t}\r\n\r\n\tset blockEdges(blockEdges: object[]) {\r\n\t\tthis._blockEdges = blockEdges\r\n\t}\r\n\r\n\tget blockHeightsArray(): number[] {\r\n\t\treturn this._blockHeightsArray\r\n\t}\r\n\r\n\tset blockHeightsArray(heightsArray: number[]) {\r\n\t\tthis._blockHeightsArray = heightsArray\r\n\t}\r\n\r\n\tget blockIdIterator(): number {\r\n\t\treturn this._blockIdIterator\r\n\t}\r\n\r\n\tset blockIdIterator(i: number) {\r\n\t\tthis._blockIdIterator = i\r\n\t}\r\n\r\n\tget blockHeightVariation(): BuildingHeightVariations {\r\n\t\treturn this._blockHeightVariation\r\n\t}\r\n\r\n\tget lineHeight(): number {\r\n\t\treturn this._decorationLineH\r\n\t}\r\n\r\n\tget groundColor(): Color {\r\n\t\treturn this._groundColor\r\n\t}\r\n\r\n\tget defaultColor(): Color {\r\n\t\treturn this._defaultColor\r\n\t}\r\n\r\n\tget decorativeColors(): object {\r\n\t\treturn { lineColor: this._lineColor }\r\n\t}\r\n\r\n\tget showWindows(): number {\r\n\t\treturn this._showWindows\r\n\t}\r\n\r\n\tpublic getColumn(x, y): Column {\r\n\t\treturn this._world[y][x]\r\n\t}\r\n\r\n\tpublic getTiles(x, y): Tile[] {\r\n\t\treturn this._world[y][x].tileStack\r\n\t}\r\n\r\n\tpublic getTile(x, y, h): Tile {\r\n\t\treturn this._world[y][x].getTile(h)\r\n\t}\r\n\r\n\tpublic getTopTile(x, y): Tile {\r\n\t\tlet height = this._world[y][x].height\r\n\t\treturn this._world[y][x].getTile(height-1)\r\n\t}\r\n\r\n\tpublic getFirstDefinedColumn(): Column {\r\n\t\tlet column\r\n\r\n\t\tfor (let y = 0; y < this.mapLength; y++) {\r\n\t\t\tfor (let x = 0; x < this.mapWidth; x++) {\r\n\t\t\t\tif (this._world[y][x].isDefined) {\r\n\t\t\t\t\tcolumn = this._world[y][x]\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn column\r\n\t}\r\n\r\n\tpublic addToBuilding(): void {\r\n\t\tthis._world = this.mods.addBuildingComponent(this)\r\n\t\tthis._world = this.mods.mirrorMap(this)\r\n\t\tthis._world = this.mods.clearMapEdges(this)\r\n\t\tthis.setEdges(false)\t\t\r\n\t}\r\n\r\n\tsetEdges(considerLowerEdges: boolean): void {\r\n\r\n\t\tfor (let y = 0; y < this.mapLength; y++) {\r\n\t\t\tfor (let x = 0; x < this.mapWidth; x++) {\r\n\t\t\t\t\r\n\t\t\t\tif (y > 0 && x > 0 && y < this.mapLength - 1 && x < this.mapWidth - 1 && this._world[y][x].isDefined) {\r\n\r\n\t\t\t\t\tif (considerLowerEdges) {\r\n\r\n\t\t\t\t\t\tif (this._world[y-1][x].height < this._world[y][x].height || y === 0) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.top = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (this._world[y+1][x].height < this._world[y][x].height || y === this.mapLength - 1) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.bottom = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (this._world[y][x-1].height < this._world[y][x].height) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.left = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (this._world[y][x+1].height < this._world[y][x].height) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.right = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tif (!this._world[y-1][x].isDefined || y === 0) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.top = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!this._world[y+1][x].isDefined || y === this.mapLength - 1) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.bottom = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!this._world[y][x-1].isDefined) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.left = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!this._world[y][x+1].isDefined) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.right = true\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( (this._world[y][x].edge.top && this._world[y][x].edge.right) ||\r\n\t\t\t\t\t\t (this._world[y][x].edge.top && this._world[y][x].edge.left) ||\r\n\t\t\t\t\t\t (this._world[y][x].edge.bottom && this._world[y][x].edge.right) ||\r\n\t\t\t\t\t\t (this._world[y][x].edge.bottom && this._world[y][x].edge.left) ) {\r\n\t\t\t\t\t\tthis._world[y][x].corner = true\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getEdges(): Position[] {\r\n\r\n\t\tthis._blockEdges = []\r\n\r\n\t\tfor (let y = 0; y < this._mapLength; y++) {\r\n\t\t\t// only check second half of map\r\n\r\n\t\t\tif (y > this._mapHalfLength + (this._blockAmountIterator - 1) && y < this._mapLength - 2) {\r\n\r\n\t\t\t\tfor (let x = 0; x < this._mapWidth; x++) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (x > this._mapEdgeWidth && x < this._mapWidth - 1) {\r\n\r\n\t\t\t\t\t\tif (this._world[y][x].isDefined) {\r\n\r\n\t\t\t\t\t\t\tif (!this._world[y][x+1].isDefined || \r\n\t\t\t\t\t\t\t\t!this._world[y][x-1].isDefined || \r\n\t\t\t\t\t\t\t\t!this._world[y+1][x].isDefined || \r\n\t\t\t\t\t\t\t\t!this._world[y-1][x+1].isDefined || \r\n\t\t\t\t\t\t\t\t!this._world[y-1][x-1].isDefined) {\r\n\r\n\t\t\t\t\t\t\t\tif (y > this._mapLength - 1) {\r\n\t\t\t\t\t\t\t\t\ty = this._mapLength - 1\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tlet pos: Position = {x: x, y: y}\r\n\r\n\t\t\t\t\t\t\t\tthis._blockEdges.push(pos)\r\n\r\n\t\t\t\t\t\t\t} else if ((!this._world[y-1][x].isDefined && !this._world[y+1][x].isDefined) ||\r\n\t\t\t\t\t\t\t\t(!this._world[y][x-1].isDefined && !this._world[y][x+1].isDefined)) {\r\n\r\n\t\t\t\t\t\t\t\tif (y > this._mapLength - 1) {\r\n\t\t\t\t\t\t\t\t\ty = this._mapLength - 1\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tlet pos: Position = {x: x, y: y}\r\n\r\n\t\t\t\t\t\t\t\tthis._blockEdges.push(pos)\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this._blockEdges\r\n\t}\r\n\r\n\tgetLeastOpenSpaceOnX(): object {\r\n\t\tlet xMinValues = []\r\n\t\tlet xMaxValues = []\r\n\r\n\t\tfor (let y = 0; y < this.mapLength; y++) {\r\n\t\t\t\r\n\t\t\tlet xMin = 0\r\n\t\t\tlet xMax = 0\r\n\t\t\t\r\n\t\t\tfor (let x = 0; x < this.mapWidth; x++) {\r\n\t\t\t\tif (x < Math.floor(this.mapWidth / 2)) {\r\n\t\t\t\t\tif (!this._world[y][x].isDefined && this._world[y][x].height === 0) {\r\n\t\t\t\t\t\txMin++\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!this._world[y][x].isDefined && this._world[y][x].height === 0) {\r\n\t\t\t\t\t\txMax++\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\txMinValues.push(xMin)\r\n\t\t\txMaxValues.push(xMax)\r\n\t\t}\r\n\r\n\t\treturn {'min': Math.min(...xMinValues), 'max': Math.min(...xMaxValues) }\t\t\r\n\t}\r\n}\r\n\r\nexport class Column {\r\n\r\n\tprivate _defined: boolean\r\n\tprivate _x: number\r\n\tprivate _y: number\r\n\tprivate _height: number\r\n\tprivate _blockGroup: number\r\n\tprivate _corner: boolean\r\n\tprivate _edge: ColumnEdge = { top: false, right: false, bottom: false, left: false }\r\n\tprivate _tileStack: Tile[] = []\r\n\r\n\tconstructor(private defined: boolean, private colX: number, private colY: number, private colHeight: number) {\r\n\t\tthis._defined = defined\r\n\t\tthis._x = colX\r\n\t\tthis._y = colY\r\n\t\tthis._height = colHeight\r\n\t}\r\n\r\n\tset x(x: number) {\r\n\t\tthis._x = x\r\n\t}\r\n\r\n\tset y(y: number) {\r\n\t\tthis._y = y\r\n\t}\r\n\r\n\tset height(height: number) {\r\n\t\tthis._height = height\r\n\t}\r\n\r\n\tset blockGroup(groupNum: number) {\r\n\t\tthis._blockGroup = groupNum\r\n\t}\r\n\r\n\tset corner(corner: boolean) {\r\n\t\tthis._corner = corner\r\n\t}\r\n\r\n\tset edge(edge: ColumnEdge) {\r\n\t\tthis._edge = edge\r\n\t}\r\n\r\n\tset tileStack(tiles: Tile[]) {\r\n\t\tthis._tileStack = tiles\r\n\t}\r\n\r\n\tget isDefined(): boolean {\r\n\t\treturn this._defined\r\n\t}\r\n\r\n\tget x(): number {\r\n\t\treturn this._x\r\n\t}\r\n\r\n\tget y(): number {\r\n\t\treturn this._y\r\n\t}\r\n\r\n\tget height(): number {\r\n\t\treturn this._height\r\n\t}\r\n\r\n\tget blockGroup(): number {\r\n\t\treturn this._blockGroup\r\n\t}\r\n\r\n\tget corner(): boolean {\r\n\t\treturn this._corner\r\n\t}\r\n\r\n\tget edge(): ColumnEdge {\r\n\t\treturn this._edge\r\n\t}\r\n\r\n\tget tileStack(): Tile[] {\r\n\t\treturn this._tileStack\r\n\t}\r\n\r\n\tpublic getTile(height: number): Tile {\r\n\t\treturn this._tileStack[height]\r\n\t}\r\n\r\n\tpublic removeTopTile(): void {\r\n\t\tthis._tileStack.pop()\r\n\t}\r\n}\r\n\r\nexport interface ColumnEdge {\r\n\ttop: boolean,\r\n\tright: boolean,\r\n\tbottom: boolean,\r\n\tleft: boolean\r\n}","import { Map, Column } from './mapper.component'\r\nimport { MapGenerationFunctions, BuildingHeightVariations, Color } from './mapGenerationFunctions.component'\r\nimport { Tile, TileType, TileOptions } from './tile.component'\r\nimport { Config, Position } from './config.component'\r\n\r\nexport class Modifiers {\r\n\r\n\tprivate config: Config = new Config()\r\n\r\n\tmirrorMap(world: Map): any[][] {\r\n\r\n\t\tlet oldBlockGroups = []\r\n\t\tworld.blockGroups.forEach(id => {\r\n\t\t\toldBlockGroups.push(id)\r\n\t\t})\r\n\r\n\t\tfor (let y = 0; y < world.mapHalfLength; y++) {\r\n\t\t\tif (y < world.mapHalfLength) {\r\n\t\t\t\t\t\t\t\r\n\t\t\t\tfor (let x = 0; x < world.mapWidth; x++) {\r\n\r\n\t\t\t\t\tif (world.map[world.mapLength - y - 1][x].isDefined) {\r\n\r\n\t\t\t\t\t\tlet activeCol = world.map[world.mapLength - y - 1][x]\r\n\t\t\t\t\t\tlet height = activeCol.height\r\n\r\n\t\t\t\t\t\tif (height > 0) {\r\n\t\t\t\t\t\t\tlet blockGroup = oldBlockGroups.length + activeCol.blockGroup\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlet tileStack = []\r\n\r\n\t\t\t\t\t\t\tfor (let h = 0; h < height; h++) {\r\n\r\n\t\t\t\t\t\t\t\tlet tileColor = activeCol.tileStack[h].tileColor\r\n\r\n\t\t\t\t\t\t\t\tlet thisPillar\r\n\t\t\t\t\t\t\t\tlet slope\r\n\t\t\t\t\t\t\t\tlet thisWindowed\r\n\t\t\t\t\t\t\t\tlet isTower\r\n\t\t\t\t\t\t\t\tlet stairs\r\n\t\t\t\t\t\t\t\tlet isRoof\r\n\r\n\t\t\t\t\t\t\t\tif (activeCol.tileStack[h].options) {\r\n\t\t\t\t\t\t\t\t\tthisPillar = activeCol.tileStack[h].options.pillar\r\n\t\t\t\t\t\t\t\t\tslope = activeCol.tileStack[h].options.slope\r\n\t\t\t\t\t\t\t\t\tthisWindowed = activeCol.tileStack[h].options.windowed\r\n\t\t\t\t\t\t\t\t\tisTower = activeCol.tileStack[h].options.tower\r\n\t\t\t\t\t\t\t\t\tstairs = activeCol.tileStack[h].options.stairs\r\n\t\t\t\t\t\t\t\t\tisRoof = (h === height-1) ? true : false\r\n\r\n\t\t\t\t\t\t\t\t\ttileStack.push(\r\n\t\t\t\t\t\t\t\t\t\tnew Tile(\r\n\t\t\t\t\t\t\t\t\t\t\tworld.blockIdIterator, \r\n\t\t\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\t\t\th, \r\n\t\t\t\t\t\t\t\t\t\t\tactiveCol.tileStack[h].type,\r\n\t\t\t\t\t\t\t\t\t\t\ttileColor,\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\troof: isRoof,\r\n\t\t\t\t\t\t\t\t\t\t\t\tpillar: thisPillar,\r\n\t\t\t\t\t\t\t\t\t\t\t\tslope: slope,\r\n\t\t\t\t\t\t\t\t\t\t\t\twindowed: thisWindowed,\r\n\t\t\t\t\t\t\t\t\t\t\t\ttower: isTower,\r\n\t\t\t\t\t\t\t\t\t\t\t\tstairs:\tstairs\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttileStack.push(\r\n\t\t\t\t\t\t\t\t\t\tnew Tile(\r\n\t\t\t\t\t\t\t\t\t\t\tworld.blockIdIterator, \r\n\t\t\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\t\t\th, \r\n\t\t\t\t\t\t\t\t\t\t\tactiveCol.tileStack[h].type,\r\n\t\t\t\t\t\t\t\t\t\t\ttileColor\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t\tworld.blockIdIterator++\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tworld.blockHeightsArray.push(height)\r\n\r\n\t\t\t\t\t\t\tif (world.blockGroups.indexOf(blockGroup) === -1) {\r\n\t\t\t\t\t\t\t\tworld.blockGroups.push(blockGroup)\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tworld.map[y][x] = null\r\n\r\n\t\t\t\t\t\t\tlet column = new Column(true, x, y, height)\r\n\r\n\t\t\t\t\t\t\tcolumn.blockGroup = blockGroup\r\n\t\t\t\t\t\t\tcolumn.height = height\r\n\t\t\t\t\t\t\tcolumn.corner = false\r\n\t\t\t\t\t\t\tcolumn.tileStack = tileStack\r\n\r\n\t\t\t\t\t\t\tworld.map[y][x] = column\r\n\t\t\t\t\t\t} else if(height === 0 && activeCol.isDefined) {\r\n\t\t\t\t\t\t\tworld.map[y][x] = activeCol\r\n\t\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn world.map\r\n\t}\r\n\t\r\n\tclearMapEdges(world: Map): any[][] {\r\n\r\n\t\tfor (let y = 0; y < world.mapLength; y++) {\r\n\t\t\tfor (let x = 1; x < world.mapWidth; x++) {\r\n\t\t\t\tif (x < world.mapEdgeWidth || x >= world.mapWidth ||\r\n\t\t\t\t\ty < world.mapEdgeWidth || y >= world.mapLength - world.mapEdgeWidth) {\r\n\t\t\t\t\tif (world.map[y][x].isDefined && world.map[y][x].height > 0) {\r\n\t\t\t\t\t\tworld.map[y][x] = null\r\n\t\t\t\t\t\tlet column = new Column(false, x, y, 0)\r\n\t\t\t\t\t\tcolumn.tileStack = []\r\n\t\t\t\t\t\tworld.map[y][x] = column\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn world.map\r\n\t}\r\n\r\n\taddBuildingComponent(world: Map): any[][] {\r\n\r\n\t\tif (world.blockAmountIterator < world.maxBlockIterations) {\r\n\r\n\t\t\tworld.blockEdges = world.getEdges()\r\n\r\n\t\t\tif (world.blockEdges.length > 0) {\t\t\t\r\n\r\n\t\t\t\tlet nextHeight\r\n\t\t\t\tlet openFloor = 0\r\n\t\t\t\tlet showWindows = world.showWindows\r\n\r\n\t\t\t\tif (world.blockHeightVariation === BuildingHeightVariations.TallCenter) {\r\n\t\t\t\t\tnextHeight = world.blockHeight - (world.blockAmountIterator)\r\n\t\t\t\t} else if (world.blockHeightVariation === BuildingHeightVariations.TallSurrounds) {\r\n\t\t\t\t\tnextHeight = world.blockHeight + (world.blockAmountIterator * Math.ceil(Math.random() * 2))\r\n\t\t\t\t} else if (world.blockHeightVariation === BuildingHeightVariations.Random) {\r\n\t\t\t\t\tlet randomNum = Math.ceil(Math.random() * 4)\r\n\t\t\t\t\tlet randomAdd = Math.round(Math.random())\r\n\t\t\t\t\tif (randomAdd === 0 && world.blockHeight > 3) {\r\n\t\t\t\t\t\tnextHeight = world.blockHeight - randomNum\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnextHeight = world.blockHeight + randomNum\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (nextHeight < 2) {\r\n\t\t\t\t\tnextHeight = 1\r\n\t\t\t\t} else if (nextHeight > world.mapMaxHeight) {\r\n\t\t\t\t\tnextHeight = world.mapMaxHeight\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (nextHeight > 5) {\r\n\t\t\t\t\topenFloor = 2 + Math.floor(Math.random() * 3)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet randomEdgePoint = Math.floor(Math.random() * world.blockEdges.length)\r\n\t\t\t\tlet creationPoint: Position = world.blockEdges[randomEdgePoint]\r\n\t\t\t\tlet blockGroup = world.blockGroups.length + 1\r\n\t\t\t\tlet manipulateExistingCols = (Math.round(Math.random()) < 1) ? false : true\r\n\t\t\t\tlet nextBlockWidth = (world.averageBuildingSize ) + Math.floor(Math.random() * 5)\r\n\t\t\t\tlet nextBlockLength = (world.averageBuildingSize ) + Math.floor(Math.random() * 5)\r\n\t\t\t\tlet yStartOffset = 1 + Math.floor(Math.random() * 2)\r\n\t\t\t\tlet hollowBuildingBlock = Math.round(Math.random()) === 1 ? true : false\r\n\t\t\t\t\r\n\t\t\t\tif (nextBlockWidth > 4 && nextBlockLength > 4) {\r\n\t\t\t\t\thollowBuildingBlock = false\r\n\t\t\t\t} else {\r\n\t\t\t\t\thollowBuildingBlock = false\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (let y = 0; y < world.mapLength; y++) {\r\n\t\t\t\t\tfor (let x = 0; x < world.mapWidth; x++) {\r\n\r\n\t\t\t\t\t\tlet yConditions = x > (creationPoint.x - (nextBlockWidth / 2)) && x < (creationPoint.x + (nextBlockWidth / 2))\r\n\t\t\t\t\t\tlet xConditions = (y > creationPoint.y - yStartOffset && y < creationPoint.y + nextBlockLength - yStartOffset)\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (yConditions) {\r\n\t\t\t\t\t\t\tif (xConditions) {\r\n\r\n\t\t\t\t\t\t\t\tlet createCol = true\r\n\r\n\t\t\t\t\t\t\t\tif (hollowBuildingBlock) {\r\n\t\t\t\t\t\t\t\t\tif (y > creationPoint.y + 1 && y < creationPoint.y + nextBlockLength - 1) {\r\n\t\t\t\t\t\t\t\t\t\tif ((x > (creationPoint.x - (nextBlockWidth / 2)) && x < creationPoint.x - (nextBlockWidth / 2) + 2)\r\n\t\t\t\t\t\t\t\t\t\t\t||\r\n\t\t\t\t\t\t\t\t\t\t\t(x < (creationPoint.x + (nextBlockWidth / 2)) && x > creationPoint.x - (nextBlockWidth / 2) - 2)) {\r\n\t\t\t\t\t\t\t\t\t\t\tcreateCol = false\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (createCol) {\r\n\r\n\t\t\t\t\t\t\t\t\tlet tileStack = []\r\n\r\n\t\t\t\t\t\t\t\t\tfor (let h = 0; h < nextHeight; h++) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tlet thisPillar = false\r\n\t\t\t\t\t\t\t\t\t\tlet thisWindowed = 0\r\n\t\t\t\t\t\t\t\t\t\tif (showWindows > 0 && h % 2 === 1) {\r\n\t\t\t\t\t\t\t\t\t\t\tthisWindowed = showWindows\r\n\t\t\t\t\t\t\t\t\t\t}\t\r\n\t\t\t\t\t\t\t\t\t\tlet isRoof = (h === nextHeight-1) ? true : false\r\n\t\t\t\t\t\t\t\t\t\tlet tileColor = world.getFirstDefinedColumn().tileStack[0].tileColor\r\n\t\t\t\t\t\t\t\t\t\tlet tileType = TileType.Body\r\n\t\t\t\t\t\t\t\t\t\tlet slope = false\r\n\t\t\t\t\t\t\t\t\t\tlet isTower = false\r\n\t\t\t\t\t\t\t\t\t\tlet stairs = false\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (openFloor > 0 && (h === openFloor)) {\r\n\t\t\t\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\t\t\t\tif (y % 2 === 0 && x % 2 !== 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tthisPillar = true\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else if (openFloor < 5 && nextHeight > 6 && h+1 === openFloor) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (y % 2 === 0 && x % 2 !== 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tthisPillar = true\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (h === world.lineHeight) {\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\ttileColor = world.decorativeColors['lineColor']\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\ttileColor = world.defaultColor\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\ttileStack.push(\r\n\t\t\t\t\t\t\t\t\t\t\tnew Tile(\r\n\t\t\t\t\t\t\t\t\t\t\t\tworld.blockIdIterator, \r\n\t\t\t\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\t\t\t\th, \r\n\t\t\t\t\t\t\t\t\t\t\t\ttileType,\r\n\t\t\t\t\t\t\t\t\t\t\t\ttileColor,\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\troof: isRoof,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpillar: thisPillar,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tslope: slope,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twindowed: thisWindowed,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttower: isTower,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstairs:\tstairs\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t)\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t\t\t\tworld.blockHeightsArray.push(nextHeight)\r\n\r\n\t\t\t\t\t\t\t\t\t\tworld.blockIdIterator++\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (world.blockGroups.indexOf(blockGroup) === -1) {\r\n\t\t\t\t\t\t\t\t\t\tworld.blockGroups.push(blockGroup)\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tworld.map[y][x] = null\r\n\r\n\t\t\t\t\t\t\t\t\tlet column = new Column(true, x, y, nextHeight)\r\n\r\n\t\t\t\t\t\t\t\t\tcolumn.blockGroup = blockGroup\r\n\t\t\t\t\t\t\t\t\tcolumn.height = nextHeight\r\n\t\t\t\t\t\t\t\t\tcolumn.corner = false\r\n\t\t\t\t\t\t\t\t\tcolumn.tileStack = tileStack\r\n\r\n\t\t\t\t\t\t\t\t\tworld.map[y][x] = column\t\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tworld.blockHeight = nextHeight\r\n\r\n\t\t\t\tworld.blockAmountIterator++\r\n\r\n\t\t\t\tif (1 === 1) {\r\n\r\n\t\t\t\t\tfor (let y = 0; y < world.mapLength; y++) {\r\n\t\t\t\t\t\tfor (let x = 0; x < world.mapWidth; x++) {\r\n\r\n\t\t\t\t\t\t\tif (x < world.mapWidth - 2 && x > 2) {\r\n\t\t\t\t\t\t\t\tif (y < world.mapLength - 2 && y > 2) {\r\n\r\n\t\t\t\t\t\t\t\t\tif (world.map[y][x].isDefined && \r\n\t\t\t\t\t\t\t\t\t\tworld.map[y-1][x].isDefined &&\r\n\t\t\t\t\t\t\t\t\t\tworld.map[y+1][x].isDefined &&\r\n\t\t\t\t\t\t\t\t\t\tworld.map[y][x-1].isDefined &&\r\n\t\t\t\t\t\t\t\t\t\tworld.map[y][x+1].isDefined) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (world.map[y][x].height > 4) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (world.map[y-1][x].blockGroup !== blockGroup) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tworld.map[y][x].tileStack[world.map[y][x].height-1].type = TileType.HalfBlock\r\n\t\t\t\t\t\t\t\t\t\t\t}\t\r\n\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t}\t\t\r\n\t\t\t\t\t\t\t\t}\t\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\t\t\r\n\t\t\t\tconsole.warn(\"Block edges array is empty.\")\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Cannot add more building components, maximum block iterations reached.\")\r\n\t\t}\r\n\r\n\t\treturn world.map\r\n\t}\t\r\n}","export class Primitives {\r\n\r\n\tgetPyramid(mapWidth: number, mapLength: number): number[][] {\r\n\r\n\t\tlet map = [],\r\n\t\t\twidth = Math.min(mapWidth, mapLength),\r\n\t\t\theight = Math.min(mapWidth, mapLength),\r\n\t\t\twidthHalf = Math.floor(width / 2),\r\n\t\t\theightHalf = Math.floor(height / 2),\r\n\t\t\tquarter = [];\r\n\r\n\t\tfor (let y = 0; y < width; y++) {\r\n\t\t\tmap[y] = []\r\n\t\t\tfor (let x = 0; x < height; x++) {\r\n\t\t\t\tif (y < Math.round(height / 2) && x < Math.round(width / 2)) {  \r\n\t\t\t\t\tmap[y][x] = Math.min(y, x)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmap[y][x] = Math.max(y, x)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let y = 0; y < widthHalf; y++) {\r\n\t\t\tquarter[y] = []\r\n\t\t\tfor (let x = 0; x < heightHalf; x++) {\r\n\t\t\t\tif (y < heightHalf && x < widthHalf) { \r\n\t\t\t\t\tquarter[y][x] = map[y][x]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet quarterRev = quarter.reverse()\r\n\r\n\t\tfor (let y = 0; y < width; y++) {\r\n\t\t\tfor (let x = 0; x < height; x++) {\r\n\t\t\t  \tif (y > heightHalf - 1 && x < widthHalf) {\r\n\t\t\t    \tmap[y][x] = quarterRev[y - heightHalf][x]\r\n\t\t\t    }\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let y = 0; y < width; y++) {\r\n\t\t\tfor (let x = 0; x < height; x++) {\r\n\t\t\t  \tif (x > widthHalf - 1) {\r\n\t\t\t    \tmap[y][x] = map[y][width - x - 1]\r\n\t\t\t    }\r\n\t\t  \t}\r\n\t\t}\r\n\r\n\t\treturn map\r\n\t}\r\n}","import { Config, Coords, TileTemplate, Position } from './config.component'\r\nimport { MapGenerationFunctions, Color } from './mapGenerationFunctions.component'\r\nimport { Tile, TileType } from './tile.component'\r\nimport { Column, ColumnEdge } from './mapper.component'\r\n\r\nexport class RenderElements {\r\n\r\n\tprivate config: Config = new Config()\r\n\tprivate calculations: MapGenerationFunctions = new MapGenerationFunctions()\r\n\r\n\tprivate tileW: number = this.config.tileWidth\r\n\tprivate tileL: number = this.config.tileLength\r\n\tprivate tileH: number = this.config.tileHeight\r\n\tprivate bleed: number = this.config.tileEdgeBleed\r\n\tprivate dimensions = this.calculations.calculateStraightLinesFromIsometricSquare(this.tileW, this.tileL)\r\n\r\n\tprivate tileColor: Color = this.config.groundColor\r\n\r\n\tcreateTile(xPos: number, yPos: number, shadow: string): TileTemplate {\r\n\r\n\t\tlet top: Position = { \"x\": (xPos + this.dimensions.horizontalWidthFromTop), \"y\": yPos}\r\n\t\tlet left: Position = { \"x\": xPos, \"y\": (yPos + this.dimensions.verticalHeightFromTop) }\r\n\t\tlet bottom: Position = { \"x\": (xPos + this.dimensions.horizontalWidthFromBottom), \"y\": (yPos + this.dimensions.totalHeight) }\r\n\t\tlet right: Position = { \"x\": (xPos + this.dimensions.totalWidth), \"y\": (yPos + this.dimensions.verticalHeightFromBottom) }\r\n\r\n\t\tlet pointTop = `${top.x} ${top.y-this.bleed}`\r\n\t\tlet pointLeft = `${left.x-this.bleed} ${left.y}`\r\n\t\tlet pointBottom = `${bottom.x} ${bottom.y+this.bleed}`\r\n\t\tlet pointRight = `${right.x+this.bleed} ${right.y}`\r\n\r\n\t\tlet tileColor = this.tileColor.hex()\r\n\t\tif (shadow === 'shade') {\r\n\t\t\ttileColor = this.tileColor.changeColorLightingString(-50)\r\n\t\t}\r\n\r\n\t\tvar html = `<path fill=\"${tileColor}\"\r\n\t\t\t\t\td=\"M${pointLeft} \r\n\t\t\t\t\tL${pointBottom} \r\n\t\t\t\t\tL${pointRight} \r\n\t\t\t\t\tL${pointTop} \r\n\t\t\t\t\tL${pointLeft} Z\" />`\r\n\r\n\t\tlet coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreatePlane(xPos: number, yPos: number, tile: Tile, color?: Color): TileTemplate {\r\n\r\n\t\tlet id = tile.id\r\n\t\tlet height = (tile.h * this.tileH) - this.tileH\r\n\r\n\t\tlet regularColor\r\n\r\n\t\tif (color) {\r\n\t\t\tregularColor = color.hex()\r\n\t\t} else {\r\n\t\t\tregularColor = this.config.groundColor.hex()\r\n\t\t}\r\n\r\n\t\tlet top: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromTop), \"y\": Math.ceil(yPos + this.config.topMargin ) }\r\n\t\tlet left: Position = { \"x\": Math.ceil(xPos), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromTop + this.config.topMargin ) }\r\n\t\tlet bottom: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromBottom), \"y\": Math.ceil(yPos + this.dimensions.totalHeight + this.config.topMargin ) }\r\n\t\tlet right: Position = { \"x\": Math.ceil(xPos + this.dimensions.totalWidth), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromBottom + this.config.topMargin ) }\r\n\r\n\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y}`\r\n\t\tlet blockTopBottom = `${bottom.x} ${bottom.y}`\r\n\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y}`\r\n\t\tlet blockTopTop = `${top.x} ${top.y}`\r\n\r\n\t\tlet html = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\tL${blockTopBottom} \r\n\t\t\t\t\tL${blockTopRight} \r\n\t\t\t\t\tL${blockTopTop} \r\n\t\t\t\t\tL${blockTopLeft} Z\" /></g>`\r\n\r\n\t\tlet coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreateBlock(xPos: number, yPos: number, tile: Tile): TileTemplate {\r\n\r\n\t\tlet id = tile.id\r\n\t\tlet height = (tile.h * this.tileH) - this.tileH\r\n\r\n\t\tlet regularColor\r\n\t\tlet highlight\r\n\t\tlet darkestColor\r\n\r\n\t\tif (tile.tileColor.hex() !== this.config.buildingBaseColor.hex()) {\r\n\t\t\tregularColor = tile.tileColor.hex()\r\n\t\t\thighlight = tile.tileColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = tile.tileColor.changeColorLightingString(-60)\r\n\t\t} else {\r\n\t\t\tregularColor = this.config.buildingBaseColor.hex()\r\n\t\t\thighlight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = this.config.buildingBaseColor.changeColorLightingString(-60)\r\n\t\t}\r\n\r\n\t\tlet top: Position = { x: Math.ceil(xPos + this.dimensions.horizontalWidthFromTop), y: Math.ceil(yPos + this.config.topMargin ) }\r\n\t\tlet left: Position = { x: Math.ceil(xPos), y: Math.ceil(yPos + this.dimensions.verticalHeightFromTop + this.config.topMargin ) }\r\n\t\tlet bottom: Position = { x: Math.ceil(xPos + this.dimensions.horizontalWidthFromBottom), y: Math.ceil(yPos + this.dimensions.totalHeight + this.config.topMargin ) }\r\n\t\tlet right: Position = { x: Math.ceil(xPos + this.dimensions.totalWidth), y: Math.ceil(yPos + this.dimensions.verticalHeightFromBottom + this.config.topMargin ) }\r\n\r\n\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\tlet leftWallRightTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\r\n\t\tlet rightWallLeftTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\tlet rightWallLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\tlet rightWallRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\tlet rightWallRightTop = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\r\n\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\t\tlet blockTopTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\tlet html = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\td=\"M${leftWallLeftTop} \r\n\t\t\t\t\tL${leftWallLeftBottom} \r\n\t\t\t\t\tL${leftWallRightBottom} \r\n\t\t\t\t\tL${leftWallRightTop} \r\n\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\td=\"M${rightWallLeftTop} \r\n\t\t\t\t\tL${rightWallLeftBottom} \r\n\t\t\t\t\tL${rightWallRightBottom} \r\n\t\t\t\t\tL${rightWallRightTop} \r\n\t\t\t\t\tL${rightWallLeftTop} Z\" />\r\n\t\t\t\t\t<path fill=\"${highlight}\"\r\n\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\tL${blockTopBottom} \r\n\t\t\t\t\tL${blockTopRight} \r\n\t\t\t\t\tL${blockTopTop} \r\n\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t</g>`\r\n\r\n\t\tlet coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreateHalfBlock(xPos: number, yPos: number, tile: Tile): TileTemplate {\r\n\r\n\t\tlet id = tile.id\r\n\t\tlet height = (tile.h * this.tileH) - this.tileH\r\n\r\n\t\tlet regularColor\r\n\t\tlet highlight\r\n\t\tlet darkestColor\r\n\r\n\t\tif (tile.tileColor.hex() !== this.config.buildingBaseColor.hex()) {\r\n\t\t\tregularColor = tile.tileColor.hex()\r\n\t\t\thighlight = tile.tileColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = tile.tileColor.changeColorLightingString(-60)\r\n\t\t} else {\r\n\t\t\tregularColor = this.config.buildingBaseColor.hex()\r\n\t\t\thighlight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = this.config.buildingBaseColor.changeColorLightingString(-60)\r\n\t\t}\t\r\n\r\n\t\tlet top: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromTop), \"y\": Math.ceil(yPos + this.config.topMargin ) }\r\n\t\tlet left: Position = { \"x\": Math.ceil(xPos), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromTop + this.config.topMargin ) }\r\n\t\tlet bottom: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromBottom), \"y\": Math.ceil(yPos + this.dimensions.totalHeight + this.config.topMargin ) }\r\n\t\tlet right: Position = { \"x\": Math.ceil(xPos + this.dimensions.totalWidth), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromBottom + this.config.topMargin ) }\r\n\r\n\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-(this.tileH / 2)}`\r\n\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\tlet leftWallRightTop = `${bottom.x} ${bottom.y-height-(this.tileH / 2)}`\r\n\r\n\t\tlet rightWallLeftTop = `${bottom.x} ${bottom.y-height-(this.tileH / 2)}`\r\n\t\tlet rightWallLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\tlet rightWallRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\tlet rightWallRightTop = `${right.x+this.bleed} ${right.y-height-(this.tileH / 2)}`\r\n\r\n\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height-(this.tileH / 2)}`\r\n\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height-(this.tileH / 2)}`\r\n\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height-(this.tileH / 2)}`\r\n\t\tlet blockTopTop = `${top.x} ${top.y-height-(this.tileH / 2)}`\r\n\r\n\t\tlet html = `<g style=\"z-index:${id};\"><path fill=\"${darkestColor}\"\r\n\t\t\t\t\td=\"M${leftWallLeftTop} \r\n\t\t\t\t\tL${leftWallLeftBottom} \r\n\t\t\t\t\tL${leftWallRightBottom} \r\n\t\t\t\t\tL${leftWallRightTop} \r\n\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\td=\"M${rightWallLeftTop} \r\n\t\t\t\t\tL${rightWallLeftBottom} \r\n\t\t\t\t\tL${rightWallRightBottom} \r\n\t\t\t\t\tL${rightWallRightTop} \r\n\t\t\t\t\tL${rightWallLeftTop} Z\" />\r\n\t\t\t\t\t<path fill=\"${highlight}\"\r\n\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\tL${blockTopBottom} \r\n\t\t\t\t\tL${blockTopRight} \r\n\t\t\t\t\tL${blockTopTop} \r\n\t\t\t\t\tL${blockTopLeft} Z\" /></g>`\r\n\r\n\t\tlet coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreateSlopeBlock(xPos: number, yPos: number, tile: Tile, slopeDirection: string): TileTemplate {\r\n\r\n\t\tlet id = tile.id\r\n\t\tlet height = (tile.h * this.tileH) - this.tileH\r\n\t\tlet regularColor: string\r\n\t\tlet regularDarkerColor: string\r\n\t\tlet regularLighterColor: string\r\n\t\tlet shadowLight: string\r\n\t\tlet shadowHighlight: string\r\n\t\tlet shadow: string\r\n\t\tlet highlight: string\r\n\t\tlet almostDarkestColor: string\r\n\t\tlet almostLightestColor: string\r\n\t\tlet darkestColor: string\r\n\t\tlet lightestColor: string\r\n\r\n\t\tif (tile.tileColor.hex() !== this.config.buildingBaseColor.hex()) {\r\n\t\t\tregularColor = tile.tileColor.hex()\r\n\t\t\tregularDarkerColor = tile.tileColor.changeColorLightingString(-10)\r\n\t\t\tregularLighterColor = tile.tileColor.changeColorLightingString(10)\r\n\t\t\tshadowLight = tile.tileColor.changeColorLightingString(-20)\r\n\t\t\tshadowHighlight = tile.tileColor.changeColorLightingString(20)\r\n\t\t\tshadow = tile.tileColor.changeColorLightingString(-30)\r\n\t\t\thighlight = tile.tileColor.changeColorLightingString(30)\r\n\t\t\talmostDarkestColor = tile.tileColor.changeColorLightingString(-40)\r\n\t\t\talmostLightestColor = tile.tileColor.changeColorLightingString(40)\r\n\t\t\tdarkestColor = tile.tileColor.changeColorLightingString(-60)\r\n\t\t\tlightestColor = tile.tileColor.changeColorLightingString(50)\r\n\t\t} else {\r\n\t\t\tregularColor = this.config.buildingBaseColor.hex()\r\n\t\t\tregularDarkerColor = this.config.buildingBaseColor.changeColorLightingString(-10)\r\n\t\t\tregularLighterColor = this.config.buildingBaseColor.changeColorLightingString(10)\r\n\t\t\tshadowLight = this.config.buildingBaseColor.changeColorLightingString(-20)\r\n\t\t\tshadowHighlight = this.config.buildingBaseColor.changeColorLightingString(20)\r\n\t\t\tshadow = this.config.buildingBaseColor.changeColorLightingString(-30)\r\n\t\t\thighlight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t\talmostDarkestColor = this.config.buildingBaseColor.changeColorLightingString(-40)\r\n\t\t\talmostLightestColor = this.config.buildingBaseColor.changeColorLightingString(40)\r\n\t\t\tdarkestColor = this.config.buildingBaseColor.changeColorLightingString(-60)\r\n\t\t\tlightestColor = this.config.buildingBaseColor.changeColorLightingString(50)\r\n\t\t}\r\n\r\n\t\tlet top: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromTop), \"y\": Math.ceil(yPos) }\r\n\t\tlet left: Position = { \"x\": Math.ceil(xPos), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromTop) }\r\n\t\tlet bottom: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromBottom), \"y\": Math.ceil(yPos + this.dimensions.totalHeight) }\r\n\t\tlet right: Position = { \"x\": Math.ceil(xPos + this.dimensions.totalWidth), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromBottom) }\r\n\r\n\t\tlet html = ''\r\n\t\tlet coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\tif (slopeDirection === 'n') {\r\n\r\n\t\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\r\n\t\t\tlet rightWallLeftTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\t\tlet rightWallLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet rightWallRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${shadow}\"\r\n\t\t\t\t\t\t\td=\"M${leftWallLeftTop} \r\n\t\t\t\t\t\t\tL${leftWallLeftBottom} \r\n\t\t\t\t\t\t\tL${leftWallRightBottom} \r\n\t\t\t\t\t\t\tL${leftWallRightTop} \r\n\t\t\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\t\t\td=\"M${rightWallLeftTop}\r\n\t\t\t\t\t\t\tL${rightWallLeftBottom}\r\n\t\t\t\t\t\t\tL${rightWallRightBottom}\r\n\t\t\t\t\t\t\tL${rightWallLeftTop} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${lightestColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'nw') {\r\n\r\n\t\t\tconsole.log('northwest')\r\n\r\n\t\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height}`\r\n\t\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height-this.tileH+this.bleed}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\tlet blockRightBottom = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\t\tlet blockRightRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet blockRightTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\t\td=\"M${leftWallLeftTop}\r\n\t\t\t\t\t\t\tL${leftWallLeftBottom}\r\n\t\t\t\t\t\t\tL${leftWallRightBottom}\r\n\t\t\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${lightestColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockRightBottom}\r\n\t\t\t\t\t\t\tL${blockRightRight}\r\n\t\t\t\t\t\t\tL${blockRightTop}\r\n\t\t\t\t\t\t\tL${blockRightBottom} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 's') {\r\n\r\n\t\t\tlet rightWallLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet rightWallRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet rightWallRightTop = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\t\t\td=\"M${rightWallLeftBottom}\r\n\t\t\t\t\t\t\tL${rightWallRightBottom}\r\n\t\t\t\t\t\t\tL${rightWallRightTop}\r\n\t\t\t\t\t\t\tL${rightWallLeftBottom} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${shadow}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'se') {\r\n\r\n\t\t\tlet blockLeftLeft = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet blockLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockLeftTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\t\tlet blockRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockRightRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet blockRightTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t<path fill=\"${shadow}\"\r\n\t\t\t\t\t\td=\"M${blockLeftLeft}\r\n\t\t\t\t\t\tL${blockLeftBottom}\r\n\t\t\t\t\t\tL${blockLeftTop}\r\n\t\t\t\t\t\tL${blockLeftLeft} Z\" />\r\n\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\td=\"M${blockRightRight}\r\n\t\t\t\t\t\tL${blockRightBottom}\r\n\t\t\t\t\t\tL${blockRightTop}\r\n\t\t\t\t\t\tL${blockRightRight} Z\" />\r\n\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'e') {\r\n\r\n\t\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\t\td=\"M${leftWallLeftTop}\r\n\t\t\t\t\t\t\tL${leftWallLeftBottom}\r\n\t\t\t\t\t\t\tL${leftWallRightBottom}\r\n\t\t\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'ne') {\r\n\r\n\t\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\r\n\t\t\tlet blockBottomLeft = `${left.x-this.bleed} ${left.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockBottomRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet blockBottomTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\td=\"M${leftWallLeftTop}\r\n\t\t\t\t\t\tL${leftWallLeftBottom}\r\n\t\t\t\t\t\tL${leftWallRightBottom}\r\n\t\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t<path fill=\"${lightestColor}\"\r\n\t\t\t\t\t\td=\"M${blockBottomLeft}\r\n\t\t\t\t\t\tL${blockBottomTop}\r\n\t\t\t\t\t\tL${blockBottomRight}\r\n\t\t\t\t\t\tL${blockBottomLeft} Z\" />\r\n\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'w') {\r\n\r\n\t\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height}`\r\n\t\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height-this.tileH+this.bleed}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\t\td=\"M${leftWallLeftTop}\r\n\t\t\t\t\t\t\tL${leftWallLeftBottom}\r\n\t\t\t\t\t\t\tL${leftWallRightBottom}\r\n\t\t\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'sw') {\r\n\r\n\t\t\tlet rightWallLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet rightWallRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet rightWallRightTop = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\t\t\td=\"M${rightWallLeftBottom}\r\n\t\t\t\t\t\t\tL${rightWallRightBottom}\r\n\t\t\t\t\t\t\tL${rightWallRightTop}\r\n\t\t\t\t\t\t\tL${rightWallLeftBottom} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${shadow}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreatePillarBlock(xPos: number, yPos: number, tile: Tile): TileTemplate {\r\n\r\n\t\tlet id = tile.id\r\n\t\tlet tileWidth = this.config.tileWidth\r\n\t\tlet height = (tile.h * this.tileH) - this.tileH\r\n\r\n\t\tlet regularColor\r\n\t\tlet highlight\r\n\t\tlet darkestColor\r\n\r\n\t\tif (tile.tileColor.hex() !== this.config.buildingBaseColor.hex()) {\r\n\t\t\tregularColor = tile.tileColor.hex()\r\n\t\t\thighlight = tile.tileColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = tile.tileColor.changeColorLightingString(-60)\r\n\t\t} else {\r\n\t\t\tregularColor = this.config.buildingBaseColor.hex()\r\n\t\t\thighlight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = this.config.buildingBaseColor.changeColorLightingString(-60)\r\n\t\t}\t\r\n\r\n\t\tlet top: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromTop), \"y\": Math.ceil(yPos + this.config.topMargin ) }\r\n\t\tlet left: Position = { \"x\": Math.ceil(xPos), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromTop + this.config.topMargin ) }\r\n\t\tlet bottom: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromBottom), \"y\": Math.ceil(yPos + this.dimensions.totalHeight + this.config.topMargin ) }\r\n\t\tlet right: Position = { \"x\": Math.ceil(xPos + this.dimensions.totalWidth), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromBottom + this.config.topMargin ) }\r\n\r\n\t\tlet leftWallLeftTop = `${left.x-this.bleed + (tileWidth / 3)} ${left.y-height-this.tileH}`\r\n\t\tlet leftWallLeftBottom = `${left.x-this.bleed + (tileWidth / 3)} ${left.y-height}`\r\n\r\n\t\tlet rightWallRightBottom = `${right.x+this.bleed - (tileWidth / 3)} ${right.y-height}`\r\n\t\tlet rightWallRightTop = `${right.x+this.bleed - (tileWidth / 3)} ${right.y-height-this.tileH}`\r\n\r\n\t\tlet leftWallBezier = `${left.x-this.bleed + (tileWidth / 3) + (tileWidth / 12)} ${bottom.y-height}`\r\n\t\tlet rightWallBezier = `${right.x-this.bleed - (tileWidth / 3) - (tileWidth / 12)} ${bottom.y-height}`\r\n\r\n\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\t\tlet blockTopTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\tlet html = `<g style=\"z-index:${id};\">`\r\n\t\t\thtml += `<defs>${this.calculations.addGradient(\"pillarGradient\", darkestColor, regularColor)}</defs>` \r\n\t\t\thtml += `<path fill=\"url(#pillarGradient)\"`\r\n\t\t\thtml += ` d=\"M ${leftWallLeftTop} `\r\n\t\t\thtml += `L ${leftWallLeftBottom} `\r\n\t\t\thtml += `C ${leftWallBezier}, ${rightWallBezier}, ${rightWallRightBottom} `\r\n\t\t\thtml += `L ${rightWallRightTop} `\r\n\t\t\thtml += `L ${leftWallLeftTop} Z\" /></g>`\r\n\r\n\t\tlet coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreateWindow(xPos: number, yPos: number, tile: Tile, columnInfo: Column): TileTemplate {\r\n\r\n\t\tlet id = tile.id\r\n\t\tlet height = (tile.h * this.tileH) - this.tileH\r\n\t\tlet regularColor\r\n\t\tlet darkestColor\r\n\t\tlet highlight\r\n\t\tlet highlightLeft\r\n\t\tlet highlightRight\r\n\t\tlet html\r\n\r\n\t\tif (tile.tileColor.hex() !== this.config.buildingBaseColor.hex()) {\r\n\t\t\tregularColor = tile.tileColor.hex()\r\n\t\t\thighlight = tile.tileColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = tile.tileColor.changeColorLightingString(-60)\r\n\t\t\thighlightLeft = tile.tileColor.changeColorLightingString(15)\r\n\t\t\thighlightRight = tile.tileColor.changeColorLightingString(30)\r\n\t\t} else {\r\n\t\t\tregularColor = this.config.buildingBaseColor.hex()\r\n\t\t\thighlight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = this.config.buildingBaseColor.changeColorLightingString(-60)\r\n\t\t\thighlightLeft = this.config.buildingBaseColor.changeColorLightingString(15)\r\n\t\t\thighlightRight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t}\r\n\r\n\t\tlet top: Position = { x: Math.ceil(xPos + this.dimensions.horizontalWidthFromTop), y: Math.ceil(yPos + this.config.topMargin ) }\r\n\t\tlet left: Position = { x: Math.ceil(xPos), y: Math.ceil(yPos + this.dimensions.verticalHeightFromTop + this.config.topMargin ) }\r\n\t\tlet bottom: Position = { x: Math.ceil(xPos + this.dimensions.horizontalWidthFromBottom), y: Math.ceil(yPos + this.dimensions.totalHeight + this.config.topMargin ) }\r\n\t\tlet right: Position = { x: Math.ceil(xPos + this.dimensions.totalWidth), y: Math.ceil(yPos + this.dimensions.verticalHeightFromBottom + this.config.topMargin ) }\r\n\r\n\t\tlet size = 4\r\n\r\n\t\tif (tile.options.windowed === 2) {\r\n\t\t\tsize = 6\r\n\t\t}\r\n\r\n\t\tlet windowBorderWidth = (top.x - left.x) / 10\t\t\r\n\t\tlet sizeModifierY = (bottom.y - top.y) / size\r\n\t\tlet isometricHeightDifferenceLeft = (bottom.y - left.y) / size\r\n\t\tlet isometricHeightDifferenceRight = (bottom.y - right.y) / size\r\n\r\n\t\thtml += `<g style=\"z-index:${id+columnInfo.height};\">`\r\n\r\n\t\tif (columnInfo.edge.bottom) {\r\n\r\n\t\t\tlet sizeModifierX = (top.x - left.x) / size\r\n\r\n\t\t\tlet leftEdge = left.x + sizeModifierX\r\n\t\t\tlet rightEdge = top.x - sizeModifierX\r\n\t\t\tlet topEdge = top.y + sizeModifierY + 2\r\n\t\t\tlet bottomEdge = top.y + this.tileH - sizeModifierY\r\n\r\n\t\t\tlet windowInsideLeftTop = `${leftEdge} ${topEdge - height - isometricHeightDifferenceLeft}`\r\n\t\t\tlet windowInsideLeftBottom = `${leftEdge} ${bottomEdge - height - isometricHeightDifferenceLeft}`\r\n\t\t\tlet windowInsideRightBottom = `${rightEdge} ${bottomEdge - height}`\r\n\t\t\tlet windowInsideRightTop = `${rightEdge} ${topEdge - height}`\r\n\r\n\t\t\thtml += `<path fill=\"#111\"\r\n\t\t\t\t\t\td=\"M${windowInsideLeftTop} \r\n\t\t\t\t\t\tL${windowInsideLeftBottom} \r\n\t\t\t\t\t\tL${windowInsideRightBottom} \r\n\t\t\t\t\t\tL${windowInsideRightTop} \r\n\t\t\t\t\t\tL${windowInsideLeftTop} Z\" />`\r\n\r\n\t\t} \r\n\r\n\t\tif (columnInfo.edge.right) {\r\n\r\n\t\t\tlet sizeModifierX = (right.x - top.x) / size\r\n\r\n\t\t\tlet leftEdge = top.x + sizeModifierX\r\n\t\t\tlet rightEdge = right.x - sizeModifierX\r\n\t\t\tlet topEdge = top.y + sizeModifierY\r\n\t\t\tlet bottomEdge = top.y + this.tileH - sizeModifierY\r\n\r\n\t\t\tlet windowInsideLeftTop = `${leftEdge} ${topEdge - height}`\r\n\t\t\tlet windowInsideLeftBottom = `${leftEdge} ${bottomEdge - height}`\r\n\t\t\tlet windowInsideRightBottom = `${rightEdge} ${bottomEdge - height - isometricHeightDifferenceRight}`\r\n\t\t\tlet windowInsideRightTop = `${rightEdge} ${topEdge - height - isometricHeightDifferenceRight}`\r\n\r\n\t\t\thtml += `<path fill=\"#111\"\r\n\t\t\t\t\t\td=\"M${windowInsideLeftTop} \r\n\t\t\t\t\t\tL${windowInsideLeftBottom} \r\n\t\t\t\t\t\tL${windowInsideRightBottom} \r\n\t\t\t\t\t\tL${windowInsideRightTop} \r\n\t\t\t\t\t\tL${windowInsideLeftTop} Z\" />`\r\n\t\t}\r\n\r\n\t\thtml += `</g>`\r\n\r\n\t\tlet coords: Coords = { top: top, left: left, bottom: bottom, right: right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n}","import { Color } from './mapGenerationFunctions.component'\r\n\r\nexport class Tile {\r\n\t\r\n\t_id: number\r\n\t_x: number\r\n\t_y: number\r\n\t_h: number\r\n\t_tileType: TileType\r\n\t_tileColor: Color\r\n\t_options?: TileOptions\r\n\r\n\tconstructor(\t\t\t\r\n\t\t\tid: number,\r\n\t\t\tx: number,\r\n\t\t\ty: number,\r\n\t\t\th: number,\r\n\t\t\ttileType: TileType,\r\n\t\t\ttileColor: Color,\r\n\t\t\toptions?: TileOptions)\r\n\t{\r\n\t\tthis._id = id\r\n\t\tthis._x = x\r\n\t\tthis._y = y\r\n\t\tthis._h = h\r\n\t\tthis._tileType = tileType\r\n\t\tthis._tileColor = tileColor\r\n\r\n\t\tif (options) {\r\n\t\t\tthis._options = options\r\n\t\t}\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\treturn this._id\r\n\t}\r\n\r\n\tget x(): number {\r\n\t\treturn this._x\r\n\t}\r\n\r\n\tget y(): number {\r\n\t\treturn this._y\r\n\t}\r\n\r\n\tget h(): number {\r\n\t\treturn this._h\r\n\t}\r\n\r\n\tget type(): TileType {\r\n\t\treturn this._tileType\r\n\t}\r\n\r\n\tget options(): TileOptions | undefined {\r\n\t\tif (this._options) {\r\n\t\t\treturn this._options\r\n\t\t} else {\r\n\t\t\treturn undefined\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getColor(): Color {\r\n\t\treturn this._tileColor\r\n\t}\r\n\r\n\tget tileColor(): Color {\r\n\t\treturn this._tileColor\r\n\t}\r\n\r\n\tset tileColor(color: Color) {\r\n\t\tthis._tileColor = color\r\n\t}\r\n\r\n\tset type(type: TileType) {\r\n\t\tthis._tileType = type\r\n\t}\r\n}\r\n\r\nexport interface TileOptions {\r\n\troof: boolean,\r\n\tpillar: boolean,\r\n\tslope: boolean,\r\n\twindowed: number,\r\n\ttower: boolean,\r\n\tstairs:\tboolean\r\n}\r\n\r\nexport enum TileType {\r\n\tNone = 'none',\r\n\tBody = 'body',\r\n\tTower = 'tower',\r\n\tHalfBlock = 'halfBlock',\r\n\tRoof = 'roof',\r\n\tGrass = 'grass',\r\n\tShadow = 'shadow'\r\n}\r\n"]}