{"version":3,"sources":["node_modules/browser-pack/_prelude.js","bundle.min.js","src/ts/builder.component.ts","src/ts/colors.component.ts","src/ts/column.component.ts","src/ts/config.component.ts","src/ts/decorations.component.ts","src/ts/enums/building-height-variations.enum.ts","src/ts/enums/tile-type.enum.ts","src/ts/main.ts","src/ts/mapGenerationFunctions.component.ts","src/ts/mapper.component.ts","src/ts/modifiers.component.ts","src/ts/primitives.component.ts","src/ts/renderelements.component.ts","src/ts/tile.component.ts"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Object","defineProperty","value","mapGenerationFunctions_component_1","config_component_1","tile_type_enum_1","renderelements_component_1","Renderer","[object Object]","this","config","Config","calculations","MapGenerationFunctions","render","RenderElements","map","html","mapWidth","mapLength","tileWidth","tileLength","htmlMap","getMapWidth","y","halfWay","Math","round","x","getColumn","isDefined","getTopTile","tileTopColor","getColor","rgb","tileColor","emptyBlocksPresent","h","height","tileStack","type","TileType","None","edge","top","right","bottom","left","blockGroup","mapToBuild","mapTotalWidth","mapTotalLength","tileHeight","windowLights","lightInWindows","console","log","testTile","createTile","yDeviation","coords","tileHalfWidthLeft","tileHalfWidthRight","tileHalfLengthTop","mapLengthTop","mapLengthBottom","mapWidthPx","mapLengthPx","topMargin","shadowColor","groundColor","changeColorLighting","lastTile","startTileX","topPavementType","floor","random","randomPaving","pavementType","thisPosY","thisPosX","newTile","newData","Shadow","color","createPlane","Grass","options","areaDecoration","createTree","slopeInCol","currentTile","roof","pillar","slope","windowed","tower","stairs","halfArch","wholeArch","Body","createSlopeBlock","getTile","isTop","createBlock","createWindow","createDoor","HalfBlock","createPillarBlock","createHalfArch","createHalfBlock","orientationTop","xPos","yPos","tile","corner","./config.component","./enums/tile-type.enum","./mapGenerationFunctions.component","./renderelements.component","2","Color","params","error","validateHex","hexColor","charAt","setHex","hexToRgb","convertToHSL","validateRgb","setRgb","rgbToHex","toString","g","b","_colorRgb","s","l","_colorHsl","hexadecimal","hexVal1","hexVal2","hexVal3","_colorHex","hex","match","hexValues","substr","split","hexPair1","parseInt","hexPair2","hexPair3","hexR","Number","hexG","hexB","amount","newR","newG","newB","hue","newHue","convertHSLtoRGB","convertRGBtoHex","cmin","min","cmax","max","delta","abs","toFixed","m","3","Column","defined","colX","colY","colHeight","_edge","_tileStack","_defined","_x","_y","_height","groupNum","_blockGroup","_corner","tiles","pop","4","colors_component_1","_allowDebug","_tileWidth","_tileLength","_tileHeight","_tileSmallAngle","_tileLargeAngle","_groundColor","_buildingBaseColor","_tileEdgeBleed","_maxAllowedHeight","_topMargin","_allowSurroundingDecorations","_allowWindows","_lightInWindows","_goldenRatio","_fibonacci","allowDebug","tileSmallAngle","tileLargeAngle","buildingBaseColor","tileEdgeBleed","maxAllowedHeight","allowWindows","allowSurroundingDecorations","goldenRatio","fibonacci","mapArrayWidth","mapArrayLength","./colors.component","5","column_component_1","tile_component_1","Decorations","world","randomAmount","yPlacement","xPlacement","push","loopCount","includes","forEach","indexOf","decoration","Tile","./column.component","./tile.component","6","BuildingHeightVariations","7","8","9","10","11","12","13","14","15","16","mapper_component_1","builder_component_1","RandomBuilding","_builder","_map","Map","document","querySelector","style","background","build2DMap","addToBuilding","buildMap","col","getFirstDefinedColumn","remove","svg","XMLSerializer","serializeToString","base64","window","btoa","newImg","createElement","setAttribute","beforeElement","insertBefore","classList","add","innerHTML","building","colorMap","querySelectorAll","addEventListener","event","evtTarget","target","getAttribute","debug","drawTileMap","getImageTag","setColors","addToBuildingAndRedraw","item","parentElement","toggle","getBaseColor","shade0","changeColorLightingString","shade1","colorDivs","getColorStringByHue","./builder.component","./mapper.component","17","smallAngle","largeAngle","maximumBlockIterations","blockWidth","blockHeight","smallOuterAngle","largeOuterAngle","horizontalWidthFromBottom","getHorizontalBottomShortestWidth","verticalHeightFromBottom","getVerticalBottomShortestHeight","horizontalWidthFromTop","getHorizontalTopLongestWidth","verticalHeightFromTop","getVerticalTopLongestHeight","totalWidth","totalHeight","diagonalWidth","sin","toRadians","diagonalHeight","cos","id","colorLeft","colorRight","gradient","angle","PI","array","highest","lowest","getHighestXfromArray","getHighestYfromArray","18","building_height_variations_enum_1","primitives_component_1","modifiers_component_1","decorations_component_1","mapMaxHeight","mapEdgeWidth","averageBuildingSize","mirrorAtCenter","mapGen","primitives","Primitives","mods","Modifiers","deco","_blockHeightVariationLabels","TallCenter","TallSurrounds","Random","_blockHeightVariation","_world","_mapWidth","_mapLength","_mapMaxHeight","_mapEdgeWidth","_averageBuildingSize","_blockHeight","_mirrorAtCenter","scaleFactor","_startBlockWidth","_startBlockLength","_maximumBlockIterations","_additionalBlockIterations","calculateAdditionalBlockIterations","_blockGroups","_blockEdges","_blockHeightsArray","_mapHalfLength","_blockIdIterator","_blockAmountIterator","_blockHeightIterator","_decorationLineH","newLineHue","lineColor","_defaultColor","_lineColor","_firstLevelColor","_HorizontalRemainingEmptyBlocksMin","_HorizontalRemainingEmptyBlocksMax","_surroundingsGrassColor","_surroundingsWaterColor","_surroundingsSandColor","_surroundingsDefaultColor","_showWindows","startblockYfromCenterDeviation","mapLengthHalf","startblockXfromCenter","startblockLengthHalf","startingPositionX","buildGardens","useWaterGarden","firstBlockHeightRandom","firstBlockHeight","slopeY","hollowArchWays","ceil","hollowBuildingBlock","openGroundLevel","yConditions","thisBlockGroup","column","xConditions","thisPillar","tileType","thisWindowed","isRoof","setEdges","hasEdge","getEdges","addBuildingComponent","removeExcessArches","getLeastOpenSpaceOnX","landsLength","landsEdge","defaultHeight","gardenBlock","edgePointY","edgePointX","grass","resetGrassTilesBelowPillars","clearMapEdges","mirrorMap","placeRandomTrees","mapHalfLength","blockGroups","startBlockSize","w","maxBlockIterations","blockAmountIterator","blockEdges","blockHeightsArray","heightsArray","blockIdIterator","blockHeightVariation","lineHeight","defaultColor","firstLevelColor","decorativeColors","showWindows","considerLowerEdges","pos","xMinValues","xMaxValues","xMin","xMax","./decorations.component","./enums/building-height-variations.enum","./modifiers.component","./primitives.component","19","_lastBlockHollow","oldBlockGroups","activeCol","isTower","halfArches","newBuildingBlockColor","nextHeight","shortestSide","openFloor","_lastBlockShortestSide","randomNum","creationPoint","yHigh","xLow","getLowestXfromArray","xHigh","yHighEdges","filter","edgePoint","xLowEdges","xHighEdges","sideSelectionForGeneration","yLowEdge","yHighEdge","xLowEdge","xHighEdge","nextBlockWidth","nextBlockLength","randomEdgePoint","yStartOffset","chanceForHigherSpace","changeForHighCorridor","yEdgeLowActive","yEdgeHighActive","createTower","towerLocation","xEdgeLowActive","xEdgeHighActive","createCol","buildTowerHere","thisHeight","thisHalfArch","thisWholeArch","maxWallPoint","undefined","warn","20","width","widthHalf","heightHalf","quarter","quarterRev","reverse","21","tileW","tileL","tileH","bleed","dimensions","calculateStraightLinesFromIsometricSquare","shadow","getPositions","pointTop","pointLeft","pointBottom","pointRight","regularColor","blockTopLeft","topTile","highlight","darkestColor","patternColor","leftWallLeftTop","leftWallLeftBottom","leftWallRightBottom","leftWallRightTop","rightWallLeftTop","rightWallLeftBottom","rightWallRightBottom","rightWallRightTop","blockTopBottom","blockTopRight","blockTopTop","margin","blockTopCenter","strokeColor","slopeDirection","regularDarkerColor","regularLighterColor","shadowLight","shadowHighlight","almostDarkestColor","almostLightestColor","lightestColor","blockRightBottom","blockLeftLeft","blockLeftBottom","blockLeftTop","blockRightRight","blockBottomLeft","blockBottomRight","blockBottomTop","leftWallBezier","rightWallBezier","addGradient","columnInfo","xEdge","yEdge","leftWindowLeftTop","leftWindowLeftBottom","leftWindowRightBottom","leftWindowRightTop","leftWindowRightBezier","leftWindowLeftBezier","windowColor","rightWindowLeftTop","rightWindowLeftBottom","rightWindowRightBottom","rightWindowRightTop","rightWindowRightBezier","rightWindowLeftBezier","direction","doorHandleColor","getColorByHue","leftWindowBorderLeftTop","leftWindowBorderRightBottom","orientation","highlightLeft","highlightRight","halfTileWidth","rightWallLeftBottomBezier","rightWallRightTopBezier","rightWallLeftTopBezier","rightWallRightBottomBezier","blockBackRightBottom","22","_id","_h","_tileType","_tileColor","_options"],"mappings":"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","file":"bundle.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()",null,"import { MapGenerationFunctions } from './mapGenerationFunctions.component'\r\nimport { Color } from './colors.component'\r\nimport { Map } from './mapper.component'\r\nimport { Tile } from './tile.component'\r\nimport { Config } from './config.component'\r\nimport { TileType } from './enums/tile-type.enum'\r\nimport { Coords } from './interfaces/coords.interface'\r\nimport { TileTemplate } from './interfaces/tiletemplate.interface'\r\nimport { Position } from './interfaces/position.interface'\r\nimport { RenderElements } from './renderelements.component'\r\n\r\nexport class Renderer {\t\r\n\r\n\tprivate config: Config = new Config()\r\n\tprivate calculations: MapGenerationFunctions = new MapGenerationFunctions()\r\n\tprivate render: RenderElements = new RenderElements()\r\n\r\n\tconstructor() {\t}\r\n\r\n\tshowData(map: Map): string {\r\n\r\n\t\tlet html = '<div class=\"showData\">'\r\n\t\thtml += `map width: ${map.mapWidth} tiles<br>map length: ${map.mapLength} tiles<br>`\r\n\t\thtml += `tile width: ${this.config.tileWidth}<br>tile length: ${this.config.tileLength}<br>`\r\n\t\thtml += '</div>'\r\n\r\n\t\treturn html\r\n\t}\r\n\r\n\tbuild2DMap(map: Map): string {\r\n\r\n\t\tlet htmlMap = `<div class=\"map\" style=\"width:${this.config.getMapWidth(map.mapWidth+1)}px;\">`\r\n\r\n\t\thtmlMap += `<div class=\"tile axis\" style=\"width:${this.config.tileWidth}px;height:${this.config.tileLength}px;\"></div>`\r\n\r\n\t\tfor (let i = 0; i < map.mapWidth; i++) {\r\n\t\t\thtmlMap += `<div class=\"tile axis\" style=\"width:${this.config.tileWidth}px;height:${this.config.tileLength}px;\">${i}</div>`\r\n\t\t}\r\n\r\n\t\tfor (let y = 0; y < map.mapLength; y++) {\r\n\r\n\t\t\tlet halfWay = ''\r\n\r\n\t\t\tif (y === Math.round(map.mapLength / 2)) {\r\n\t\t\t\thalfWay = ' half'\r\n\t\t\t}\r\n\r\n\t\t\thtmlMap += `<div class=\"tile axis${halfWay}\" style=\"width:${this.config.tileWidth}px;height:${this.config.tileLength}px;\">${y}</div>`\r\n\r\n\t\t\tfor (let x = 0; x < map.mapWidth; x++) {\r\n\r\n\t\t\t\thtmlMap += `<div data-y=\"${y}\" data-x=\"${x}\" class=\"tile${halfWay}\" style=\"width:${this.config.tileWidth}px;height:${this.config.tileLength}px;`\r\n\r\n\t\t\t\tif (map.getColumn(x, y).isDefined && map.getTopTile(x, y)) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet tile = map.getTopTile(x, y)\r\n\t\t\t\t\tlet tileTopColor = tile.getColor().rgb()\r\n\t\t\t\t\tlet tileColor = `rgb(${tileTopColor['r']}, ${tileTopColor['g']}, ${tileTopColor['b']})`\r\n\t\t\t\t\tlet emptyBlocksPresent = false\r\n\t\t\t\t\tfor (let h = 0; h < map.map[y][x].height; h++) {\r\n\t\t\t\t\t\tif (map.map[y][x].tileStack[h].type === TileType.None) {\r\n\t\t\t\t\t\t\temptyBlocksPresent = true\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet edge = (map.map[y][x].edge.top || map.map[y][x].edge.right || map.map[y][x].edge.bottom || map.map[y][x].edge.left) ? true : false\r\n\t\t\t\t\tlet blockGroup = map.map[y][x].blockGroup\r\n\r\n\t\t\t\t\tlet indicateEmptyBlocks = emptyBlocksPresent ? 'x' : ''\r\n\r\n\t\t\t\t\thtmlMap += `background-color:${tileColor}\">${indicateEmptyBlocks}<div class=\"tileInfo\">x: ${x} y: ${y}<br>height: ${map.map[y][x].height}<br>edge: ${edge}<br>group: ${blockGroup}</div></div>`\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\thtmlMap += `\"></div>`\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\thtmlMap += `</div>`\r\n\r\n\t\treturn htmlMap\r\n\t}\r\n\r\n\tbuildMap(mapToBuild: Map): string {\r\n\r\n\t\tlet mapTotalWidth = mapToBuild.mapWidth\r\n\t\tlet mapTotalLength = mapToBuild.mapLength\r\n\t\tconst tileHeight = this.config.tileHeight\r\n\t\tconst windowLights = this.config.lightInWindows\r\n\r\n\t\tconsole.log('windowLights', windowLights)\r\n\r\n\t\tlet testTile = this.render.createTile(0, 0, '')\r\n\r\n\t\tlet xDeviation = testTile.coords.bottom.x - testTile.coords.top.x\r\n\t\tlet yDeviation = testTile.coords.right.y - testTile.coords.left.y\r\n\t\tlet tileHalfWidthLeft = testTile.coords.top.x - testTile.coords.left.x\r\n\t\tlet tileHalfWidthRight = testTile.coords.right.x - testTile.coords.top.x\r\n\t\tlet mapWidthLeft = tileHalfWidthLeft * mapTotalLength\r\n\t\tlet mapWidthRight = tileHalfWidthRight * mapTotalWidth\r\n\t\tlet tileHalfLengthTop = testTile.coords.right.y\r\n\t\tlet tileHalfLengthBottom = testTile.coords.bottom.y - testTile.coords.right.y\r\n\t\tlet mapLengthTop = tileHalfLengthTop * mapTotalWidth\r\n\t\tlet mapLengthBottom = tileHalfLengthBottom * mapTotalLength\r\n\t\tlet mapWidthPx = Math.round((tileHalfWidthLeft + tileHalfWidthRight) * (mapTotalWidth ))\r\n\t\tlet mapLengthPx = Math.round(mapLengthTop + mapLengthBottom) + this.config.topMargin\r\n\r\n\t\tconst shadowColor = this.config.groundColor.changeColorLighting(-20)\r\n\r\n\t\tconst map = mapToBuild.map\r\n\r\n\t\tlet detailsHtml = ''\r\n\t\tlet html = '<svg width=\"'+mapWidthPx+'\" height=\"'+mapLengthPx+'\">'\r\n\r\n\t\tlet lastTile = null\r\n\t\tlet startTileX = tileHalfWidthLeft * (mapTotalWidth - 1)\r\n\r\n\t\tconst topPavementType = Math.floor(Math.random() * 5)\r\n\t\tconst randomPaving = Math.floor(Math.random() * 5)\r\n\t\tlet pavementType = ''\r\n\r\n\t\tif (topPavementType === 1) {\r\n\t\t\tpavementType = 'triangles'\r\n\t\t} else if (topPavementType === 3) {\r\n\t\t\tpavementType = 'squares'\t\r\n\t\t}\t\r\n\r\n\t\tfor (let y = 0; y < mapTotalLength; y++) {\r\n\r\n\t\t\tfor (let x = 0; x < mapTotalWidth; x++) {\r\n\r\n\t\t\t\tlet thisPosY = 0\r\n\t\t\t\tlet thisPosX = 0\r\n\r\n\t\t\t\tif (x === 0 && y === 0) {\r\n\t\t\t\t\tthisPosX = startTileX\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (lastTile != null) {\r\n\t\t\t\t\tthisPosY = lastTile.coords.right.y\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (y > 0 && x === 0) {\r\n\t\t\t\t\tthisPosX = startTileX - (tileHalfWidthLeft * y)\r\n\t\t\t\t\tthisPosY = (tileHalfLengthTop * y) - (yDeviation * y)\r\n\t\t\t\t}\t\r\n\t\t\t\t\r\n\t\t\t\tif (x > 0) {\r\n\t\t\t\t\tthisPosX = (lastTile.coords.right.x - (lastTile.coords.right.x - lastTile.coords.bottom.x))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet newTile = this.render.createTile(thisPosX, thisPosY, 'shade')\r\n\t\t\t\tlet newData = ''\r\n\t\t\t\t\r\n\t\t\t\tif (map[y][x].isDefined) {\r\n\r\n\t\t\t\t\tif (map[y][x].tileStack[0].type === TileType.Shadow) {\r\n\t\t\t\t\t\tlet color = shadowColor\r\n\t\t\t\t\t\tnewData += this.render.createPlane(thisPosX, thisPosY, map[y][x].tileStack[0], color).html\r\n\t\t\t\t\t} else if (map[y][x].tileStack[0].type === TileType.Grass) {\r\n\t\t\t\t\t\tlet color = map[y][x].tileStack[0].tileColor\r\n\t\t\t\t\t\tnewData += this.render.createPlane(thisPosX, thisPosY, map[y][x].tileStack[0], color).html\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (map[y][x].height === 0) {\r\n\r\n\t\t\t\t\t\tif (map[y][x].tileStack[0].type === TileType.None && map[y][x].tileStack[0].options.areaDecoration !== '') {\r\n\r\n\t\t\t\t\t\t\tif (map[y][x].tileStack[0].options.areaDecoration === 'tree') {\r\n\t\t\t\t\t\t\t\tconst treeData = this.render.createTree(thisPosX, thisPosY)\r\n\t\t\t\t\t\t\t\tnewData += treeData.html\r\n\t\t\t\t\t\t\t\tconsole.log('tree placed at y: ' + y + ', x: ' + x)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (map[y][x].height > 0) {\r\n\r\n\t\t\t\t\t\tnewData += this.render.createPlane(thisPosX, thisPosY, map[y][x].tileStack[0], shadowColor).html\r\n\r\n\t\t\t\t\t\tlet slopeInCol = false\r\n\r\n\t\t\t\t\t\tfor (let h = 0; h < map[y][x].height; h++) {\r\n\r\n\t\t\t\t\t\t\tlet currentTile = map[y][x].tileStack[h]\r\n\t\t\t\t\t\t\tlet options\r\n\r\n\t\t\t\t\t\t\tif (currentTile.options) {\r\n\t\t\t\t\t\t\t\toptions = currentTile.options\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\toptions = {\r\n\t\t\t\t\t\t\t\t\troof: false,\r\n\t\t\t\t\t\t\t\t\tpillar: false,\r\n\t\t\t\t\t\t\t\t\tslope: false,\r\n\t\t\t\t\t\t\t\t\twindowed: 0,\r\n\t\t\t\t\t\t\t\t\ttower: false,\r\n\t\t\t\t\t\t\t\t\tstairs:\tfalse,\r\n\t\t\t\t\t\t\t\t\thalfArch: false,\r\n\t\t\t\t\t\t\t\t\twholeArch: false\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (options.slope) {\r\n\t\t\t\t\t\t\t\tslopeInCol = true\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (currentTile.type === TileType.Body) {\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (currentTile.options.slope) {\r\n\t\t\t\t\t\t\t\t\tlet slope = this.render.createSlopeBlock(thisPosX, thisPosY + (tileHeight * 4.75), map[y][x].getTile(h), 'e')\r\n\t\t\t\t\t\t\t\t\tnewData += slope.html\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tif (!slopeInCol) {\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tlet isTop = ''\r\n\t\t\t\t\t\t\t\t\t\tif (map[y][x].blockGroup % 2 === 1 && h === map[y][x].height-1) {\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tisTop = pavementType\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif (randomPaving > 2) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (topPavementType === 1) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tisTop = 'triangles'\r\n\t\t\t\t\t\t\t\t\t\t\t\t} else if (topPavementType === 3) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tisTop = 'squares'\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tlet tile = this.render.createBlock(thisPosX, thisPosY - tileHeight, currentTile, isTop)\r\n\t\t\t\t\t\t\t\t\t\tnewData += tile.html\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (currentTile.options.windowed > 0) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (map[y][x].edge.right || map[y][x].edge.bottom) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (Math.round(Math.random() * 6) > 4) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet window = this.render.createWindow(thisPosX, thisPosY - tileHeight, currentTile, map[y][x], windowLights)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tnewData += window.html\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tif (map[y][x].edge.bottom && (h === map[y+1][x].height || h === 0) && Math.round(Math.random() * 10) > 8) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tlet door = this.render.createDoor(thisPosX, thisPosY - tileHeight, currentTile, map[y][x], 'bottom')\r\n\t\t\t\t\t\t\t\t\t\t\t\tnewData += door.html\r\n\t\t\t\t\t\t\t\t\t\t\t} else if (map[y][x].edge.right && (h === map[y][x+1].height || h === 0) && Math.round(Math.random() * 10) > 8) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tlet door = this.render.createDoor(thisPosX, thisPosY - tileHeight, currentTile, map[y][x], 'right')\r\n\t\t\t\t\t\t\t\t\t\t\t\tnewData += door.html\r\n\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t} else if (!options.tower && currentTile.type === TileType.HalfBlock) {\r\n\r\n\t\t\t\t\t\t\t\tlet tile = this.render.createHalfBlock(thisPosX, thisPosY - tileHeight, currentTile)\r\n\t\t\t\t\t\t\t\tnewData += tile.html\r\n\r\n\t\t\t\t\t\t\t} else if (!options.tower && currentTile.type === TileType.None) {\r\n\r\n\t\t\t\t\t\t\t\tif (currentTile.options.pillar && h < map[y][x].height) {\r\n\t\t\t\t\t\t\t\t\tif (y < (mapTotalLength/2)-1 || y > (mapTotalLength/2)) {\r\n\t\t\t\t\t\t\t\t\t\tlet pillar = this.render.createPillarBlock(thisPosX, thisPosY - tileHeight, currentTile)\r\n\t\t\t\t\t\t\t\t\t\tnewData += pillar.html\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (currentTile.options.halfArch) {\r\n\r\n\t\t\t\t\t\t\t\t\tif (y > 1 && y < mapTotalLength - 1) {\r\n\t\t\t\t\t\t\t\t\t\tif (map[y+1][x].isDefined && map[y+1][x].height > 0 && map[y+1][x].height > h && map[y+1][x].tileStack[h].type === TileType.None) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet arch = this.render.createHalfArch(thisPosX, thisPosY - tileHeight, currentTile, 'right-top')\r\n\t\t\t\t\t\t\t\t\t\t\tnewData += arch.html\r\n\t\t\t\t\t\t\t\t\t\t} else if (map[y-1][x].isDefined && map[y-1][x].height > 0 && map[y-1][x].height > h && map[y-1][x].tileStack[h].type === TileType.None) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet arch = this.render.createHalfArch(thisPosX, thisPosY - tileHeight, currentTile, 'right-bottom')\r\n\t\t\t\t\t\t\t\t\t\t\tnewData += arch.html\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (h === map[y][x].height - 1 && currentTile.options.tower) {\r\n\r\n\t\t\t\t\t\t\t\tlet orientationTop = ''\r\n\r\n\t\t\t\t\t\t\t\tif (y > 0 && y < mapTotalLength && x < mapTotalWidth) {\r\n\r\n\t\t\t\t\t\t\t\t\tif (map[y - 1][x].tileStack[h] && map[y - 1][x].tileStack[h].options.tower) {\r\n\t\t\t\t\t\t\t\t\t\torientationTop = 'se';\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (map[y + 1][x].tileStack[h] && map[y + 1][x].tileStack[h].options.tower) {\r\n\t\t\t\t\t\t\t\t\t\torientationTop = 'ne';\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (orientationTop !== '') {\r\n\t\t\t\t\t\t\t\t\t\tlet tile = this.render.createSlopeBlock(thisPosX, thisPosY = tileHeight, currentTile, orientationTop)\r\n\t\t\t\t\t\t\t\t\t\tnewData += tile.html\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t} \r\n\r\n\t\t\t\thtml += newData\r\n\r\n\t\t\t\tlastTile = newTile\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\thtml += '</svg>'\r\n\r\n\t\t// document.querySelector('#debug').innerHTML = detailsHtml\r\n\r\n\t\treturn '<div id=\"debug\">' + detailsHtml + '</div>' + html\r\n\t}\r\n\r\n\taddSlopedEdges(map: any[], x: number, y: number, h: number, xPos: number, yPos: number) {\r\n\r\n\t\tlet tile = null\r\n\r\n\t\tif (map[y][x].edge.top && !map[y][x].corner && h === map[y][x].height-1) {\r\n\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'n')\r\n\t\t} else if (map[y][x].edge.bottom && !map[y][x].corner && h === map[y][x].height-1) {\r\n\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 's')\r\n\t\t} else if (map[y][x].edge.right && !map[y][x].corner && h === map[y][x].height-1) {\r\n\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'e')\r\n\t\t} else if (map[y][x].edge.left && !map[y][x].corner && h === map[y][x].height-1) {\r\n\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'w')\r\n\t\t} else {\r\n\t\t\ttile = this.render.createBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h))\t\r\n\t\t}\r\n\r\n\t\tif (map[y][x].corner && h === map[y][x].height-1) {\r\n\t\t\tif (map[y][x].edge.top && map[y][x].edge.left) {\r\n\t\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'nw')\r\n\t\t\t} else if (map[y][x].edge.top && map[y][x].edge.right) {\r\n\t\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'ne')\r\n\t\t\t} else if (map[y][x].edge.bottom && map[y][x].edge.left) {\r\n\t\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'sw')\r\n\t\t\t} else if (map[y][x].edge.bottom && map[y][x].edge.right) {\r\n\t\t\t\ttile = this.render.createSlopeBlock(xPos, yPos - this.config.tileHeight, map[y][x].getTile(h), 'se')\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn tile\r\n\t}\r\n}\r\n","import { RGB } from './interfaces/color-rgb.interface'\r\nimport { HSL } from './interfaces/color-hsl.interface'\r\n\r\nexport class Color {\r\n\tprivate _colorRgb: RGB\r\n\tprivate _colorHex: string\r\n\tprivate _colorHsl: HSL\r\n\r\n\tconstructor(...params: any[]) {\r\n\t\tlet error = null\r\n\t\tif (params.length === 1) {\r\n\t\t\tif (typeof params[0] === 'string') {\r\n\t\t\t\tif (this.validateHex(params[0])) {\r\n\t\t\t\t\tlet hexColor = params[0]\r\n\t\t\t\t\tif (hexColor.charAt(0) !== '#') {\r\n\t\t\t\t\t\thexColor = `#${hexColor}`\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.setHex(hexColor)\r\n\t\t\t\t\tthis.hexToRgb()\r\n\t\t\t\t\tthis.convertToHSL()\r\n\t\t\t\t} else {\r\n\t\t\t\t\terror = \"Hexadecimal color is incorrect\"\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\terror = \"Length of 1 in parameters is not equal to string\"\r\n\t\t\t}\r\n\t\t} else if (params.length === 3) {\r\n\t\t\tif (this.validateRgb(params)) {\r\n\t\t\t\tthis.setRgb(params[0], params[1], params[2])\r\n\t\t\t\tthis.rgbToHex()\r\n\t\t\t\tthis.convertToHSL()\r\n\t\t\t} else {\r\n\t\t\t\terror = \"Values of RGB exceed limits\"\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (error !== null) {\r\n\t\t\tthrow \"Color type is incorrect. \" + error + \": \" + params.toString()\r\n\t\t}\r\n\t}\r\n\r\n\tpublic setRgb(r: number, g: number, b: number) {\r\n\t\tthis._colorRgb = {r: r, g: g, b: b} as RGB\r\n\t}\r\n\r\n\tpublic setHsl(h: number, s: number, l: number) {\r\n\t\tthis._colorHsl = {h: h, s: s, l: l} as HSL\r\n\t}\r\n\r\n\tpublic setHex(hexadecimal: string) {\r\n\t\tif (hexadecimal.length < 7) {\r\n\t\t\tlet hexVal1 = hexadecimal.charAt(1)\r\n\t\t\tlet hexVal2 = hexadecimal.charAt(2)\r\n\t\t\tlet hexVal3 = hexadecimal.charAt(3)\r\n\t\t\thexadecimal = \"#\" + hexVal1 + hexVal1 + hexVal2 + hexVal2 + hexVal3 + hexVal3\r\n\t\t}\r\n\t\tthis._colorHex = hexadecimal\r\n\t}\r\n\r\n\tpublic rgb(): RGB {\r\n\t\treturn this._colorRgb\r\n\t}\r\n\r\n\tpublic hex(): string {\r\n\t\treturn this._colorHex\r\n\t}\r\n\r\n\tpublic hsl(): HSL {\r\n\t\treturn this._colorHsl\r\n\t}\r\n\r\n\tvalidateRgb(rgb: number[]): boolean {\r\n\t\treturn (rgb[0] > -1 && rgb[0] < 256 &&\r\n\t\t\trgb[1] > -1 && rgb[1] < 256 &&\r\n\t\t\trgb[2] > -1 && rgb[2] < 256)\r\n\t}\r\n\r\n\tvalidateHex(hex: string): boolean {\r\n\t\tlet regex = /^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/\r\n\t\tif (hex.match(regex)) {\r\n\t\t\treturn true\r\n\t\t} else {\r\n\t\t\treturn false\r\n\t\t}\r\n\t}\r\n\r\n\thexToRgb() {\r\n\t\tlet hexValues: string[] = this._colorHex.substr(1).split('')\r\n\t\tlet hexPair1 = parseInt(hexValues[0]+hexValues[1], 16)\r\n\t\tlet hexPair2 = parseInt(hexValues[2]+hexValues[3], 16)\r\n\t\tlet hexPair3 = parseInt(hexValues[4]+hexValues[5], 16)\r\n\t\tthis.setRgb(hexPair1, hexPair2, hexPair3)\r\n\t\tthis.rgbToHex()\r\n\t}\r\n\r\n\trgbToHex() {\r\n\t\tif (typeof this._colorRgb === 'object') {\r\n\t\t\tlet r = this._colorRgb.r\r\n\t\t\tlet b = this._colorRgb.b\r\n\t\t\tlet g = this._colorRgb.g\r\n\t\t\tlet hexR = Number(r).toString(16)\r\n\t\t\tlet hexG = Number(g).toString(16)\r\n\t\t\tlet hexB = Number(b).toString(16)\r\n\t\t\tthis._colorHex = \"#\" + hexR + hexG + hexB\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\tconvertRGBtoHex(color: RGB): string {\r\n\t\tlet r = color.r\r\n\t\tlet b = color.b\r\n\t\tlet g = color.g\r\n\t\tlet hexR = Number(r).toString(16)\r\n\t\tlet hexG = Number(g).toString(16)\r\n\t\tlet hexB = Number(b).toString(16)\r\n\t\treturn \"#\" + hexR + hexG + hexB\r\n\t}\r\n\r\n\tpublic changeColorLightingString(amount: number): string {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r + amount\r\n\t\tlet newG = g + amount\r\n\t\tlet newB = b + (amount - 8)\r\n\t\tif (newR > 255) newR = 255\r\n\t\tif (newG > 255) newG = 255\r\n\t\tif (newR > 255) newR = 255\r\n\r\n\t\tlet hexR = Number(newR).toString(16)\r\n\t\tlet hexG = Number(newG).toString(16)\r\n\t\tlet hexB = Number(newB).toString(16)\r\n\t\tlet result = \"#\" + hexR + hexG + hexB\r\n\r\n\t\treturn result\r\n\t}\r\n\r\n\tpublic changeColorLighting(amount: number): Color {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\t\tlet newR = r + amount\r\n\t\tlet newG = g + amount\r\n\t\tlet newB = b + (amount - 8)\r\n\t\tif (newR > 255) newR = 255\r\n\t\tif (newG > 255) newG = 255\r\n\t\tif (newR > 255) newR = 255\r\n\t\t\r\n\t\tthis.setRgb(newR, newG, newR)\r\n\t\tthis.rgbToHex()\r\n\t\tthis.convertToHSL()\r\n\r\n\t\treturn this\r\n\t}\r\n\r\n\tpublic getColorStringByHue(hue: number): string {\r\n\r\n\t\tlet h = this._colorHsl.h,\r\n\t\t\ts = this._colorHsl.s,\r\n\t\t\tl = this._colorHsl.l\r\n\r\n\t\tlet newHue = h + hue\r\n\r\n\t\tif (newHue > 360) {\r\n\t\t\tnewHue = newHue % 360\r\n\t\t}\r\n\r\n\t\tlet rgb = this.convertHSLtoRGB({h: newHue, s: s, l: l})\r\n\r\n\t\treturn this.convertRGBtoHex(rgb)\r\n\t}\r\n\r\n\tpublic getColorByHue(hue: number): Color {\r\n\r\n\t\tlet h = this._colorHsl.h,\r\n\t\t\ts = this._colorHsl.s,\r\n\t\t\tl = this._colorHsl.l\r\n\r\n\t\tlet newHue = h + hue\r\n\r\n\t\tif (newHue > 360) {\r\n\t\t\tnewHue = newHue % 360\r\n\t\t}\r\n\r\n\t\tlet rgb = this.convertHSLtoRGB({h: newHue, s: s, l: l})\r\n\r\n\t\tthis.setRgb(rgb.r, rgb.g, rgb.b)\r\n\t\tthis.rgbToHex()\r\n\r\n\t\treturn this\r\n\t}\r\n\r\n\tconvertToHSL(): void {\r\n\t\tlet r = this._colorRgb.r\r\n\t\tlet b = this._colorRgb.b\r\n\t\tlet g = this._colorRgb.g\r\n\r\n\t\tr /= 255\r\n\t\tg /= 255\r\n\t\tb /= 255\r\n\r\n\t\tlet cmin = Math.min(r,g,b),\r\n\t\t\tcmax = Math.max(r,g,b),\r\n\t\t\tdelta = cmax - cmin,\r\n\t\t\th = 0,\r\n\t\t\ts = 0,\r\n\t\t\tl = 0\r\n\r\n\t\t// calculate hue\r\n\t\tif (delta === 0) {\r\n\t\t\th = 0\r\n\t\t} else if (cmax === r) {\r\n\t\t\th = ((g - b) / delta) % 6\r\n\t\t} else if (cmax === g) {\r\n\t\t\th = (b - r) / delta + 2\r\n\t\t} else {\r\n\t\t\th = (r - g) / delta + 4\r\n\t\t}\r\n\r\n\t\th = Math.round(h * 60)\r\n\r\n\t\tif (h < 0) {\r\n\t\t\th += 360\r\n\t\t}\r\n\r\n\t\t// calculate lightness\r\n\t\tl = (cmax + cmin) / 2 \r\n\r\n\t\t// calculate saturation\r\n\t\ts = delta === 0 ? 0 : delta / (1 - Math.abs(2 * l - 1))\r\n\r\n\t\ts = +(s * 100).toFixed(1)\r\n\t\tl = +(l * 100).toFixed(1)\r\n\r\n\t\tthis._colorHsl = { h: h, s: s, l: l }\r\n\t}\r\n\r\n\tconvertHSLtoRGB(color: HSL): RGB {\r\n\r\n\t\tlet h = color.h\r\n\t\tlet s = color.s\r\n\t\tlet l = color.l\r\n\r\n\t\ts /= 100\r\n\t\tl /= 100\r\n\r\n\t\tlet c = (1 - Math.abs(2 * l - 1)) * s,\r\n\t\t\tx = c * (1 - Math.abs((h / 60) % 2 - 1)),\r\n\t\t\tm = l - c / 2,\r\n\t\t\tr = 0,\r\n\t\t\tg = 0,\r\n\t\t\tb = 0\r\n\r\n\t\tif (0 <= h && h < 60) {\r\n\t\t\tr = c; g = x; b = 0;\r\n\t\t} else if (60 <= h && h < 120) {\r\n\t\t\tr = x; g = c; b = 0;\r\n\t\t} else if (120 <= h && h < 180) {\r\n\t\t\tr = 0; g = c; b = x;\r\n\t\t} else if (180 <= h && h < 240) {\r\n\t\t\tr = 0; g = x; b = c;\r\n\t\t} else if (240 <= h && h < 300) {\r\n\t\t\tr = x; g = 0; b = c;\r\n\t\t} else if (300 <= h && h < 360) {\r\n\t\t\tr = c; g = 0; b = x;\r\n\t\t}\r\n\t\t\r\n\t\tr = Math.round((r + m) * 255)\r\n\t\tg = Math.round((g + m) * 255)\r\n\t\tb = Math.round((b + m) * 255)\r\n\r\n\t\treturn {r: r, g: g, b: b}\r\n\t}\r\n}","import { Tile } from './tile.component'\r\nimport { ColumnEdge } from './interfaces/column-edge.interface'\r\n\r\nexport class Column {\r\n\r\n\tprivate _defined: boolean\r\n\tprivate _x: number\r\n\tprivate _y: number\r\n\tprivate _height: number\r\n\tprivate _blockGroup: number\r\n\tprivate _corner: boolean\r\n\tprivate _edge: ColumnEdge = { top: false, right: false, bottom: false, left: false }\r\n\tprivate _tileStack: Tile[] = []\r\n\r\n\tconstructor(private defined: boolean, private colX: number, private colY: number, private colHeight: number) {\r\n\t\tthis._defined = defined\r\n\t\tthis._x = colX\r\n\t\tthis._y = colY\r\n\t\tthis._height = colHeight\r\n\t}\r\n\r\n\tset x(x: number) {\r\n\t\tthis._x = x\r\n\t}\r\n\r\n\tset y(y: number) {\r\n\t\tthis._y = y\r\n\t}\r\n\r\n\tset height(h: number) {\r\n\t\tthis._height = h\r\n\t}\r\n\r\n\tset blockGroup(groupNum: number) {\r\n\t\tthis._blockGroup = groupNum\r\n\t}\r\n\r\n\tset corner(corner: boolean) {\r\n\t\tthis._corner = corner\r\n\t}\r\n\r\n\tset edge(edge: ColumnEdge) {\r\n\t\tthis._edge = edge\r\n\t}\r\n\r\n\tset tileStack(tiles: Tile[]) {\r\n\t\tthis._tileStack = tiles\r\n\t}\r\n\r\n\tget isDefined(): boolean {\r\n\t\treturn this._defined\r\n\t}\r\n\r\n\tget x(): number {\r\n\t\treturn this._x\r\n\t}\r\n\r\n\tget y(): number {\r\n\t\treturn this._y\r\n\t}\r\n\r\n\tget height(): number {\r\n\t\treturn this._height\r\n\t}\r\n\r\n\tget blockGroup(): number {\r\n\t\treturn this._blockGroup\r\n\t}\r\n\r\n\tget corner(): boolean {\r\n\t\treturn this._corner\r\n\t}\r\n\r\n\tget edge(): ColumnEdge {\r\n\t\treturn this._edge\r\n\t}\r\n\r\n\tget tileStack(): Tile[] {\r\n\t\treturn this._tileStack\r\n\t}\r\n\r\n\tpublic getTile(height: number): Tile {\r\n\t\treturn this._tileStack[height]\r\n\t}\r\n\r\n\tpublic removeTopTile(): void {\r\n\t\tthis._tileStack.pop()\r\n\t}\r\n}","import { Color } from './colors.component'\r\n\r\nexport class Config {\r\n\r\n\tprivate _allowDebug: boolean = true\r\n\tprivate _tileWidth: number = 16\r\n\tprivate _tileLength: number = 16\r\n\tprivate _tileHeight: number = 14\r\n\tprivate _tileSmallAngle: number = 85\r\n\tprivate _tileLargeAngle: number = 100\r\n\tprivate _groundColor: Color = new Color('#f5f3e5')\r\n\tprivate _buildingBaseColor: Color = new Color(\r\n\t\t125 + Math.floor(Math.random() * 75),\r\n\t\t125 + Math.floor(Math.random() * 40),\r\n\t\t160 + Math.floor(Math.random() * 30)\r\n\t)\r\n\tprivate _tileEdgeBleed: number = 0.3\r\n\tprivate _maxAllowedHeight: number = 12\r\n\tprivate _topMargin: number = 80\r\n\tprivate _allowSurroundingDecorations: boolean = true\r\n\tprivate _allowWindows: boolean = false\r\n\tprivate _lightInWindows: boolean = Math.round(Math.random() * 8) > 6 ? true : false\r\n\tprivate _goldenRatio: number = 1.61803399\r\n\tprivate _fibonacci: number[] = [1, 2, 3, 5, 8, 13]\r\n\r\n\tconstructor() {\t}\r\n\r\n\tpublic get allowDebug(): boolean {\r\n\t\treturn this._allowDebug\r\n\t}\r\n\r\n\tpublic get tileWidth(): number {\r\n\t\treturn this._tileWidth\r\n\t}\r\n\r\n\tpublic get tileLength(): number {\r\n\t\treturn this._tileLength\r\n\t}\r\n\r\n\tpublic get tileHeight(): number {\r\n\t\treturn this._tileHeight\r\n\t}\r\n\r\n\tpublic get tileSmallAngle(): number {\r\n\t\treturn this._tileSmallAngle\r\n\t}\r\n\r\n\tpublic get tileLargeAngle(): number {\r\n\t\treturn this._tileLargeAngle\r\n\t}\r\n\r\n\tpublic get groundColor(): Color {\r\n\t\treturn this._groundColor\r\n\t}\r\n\r\n\tpublic get buildingBaseColor(): Color {\r\n\t\treturn this._buildingBaseColor\r\n\t}\r\n\r\n\tpublic get tileEdgeBleed(): number {\r\n\t\treturn this._tileEdgeBleed\r\n\t}\r\n\r\n\tpublic get maxAllowedHeight(): number {\r\n\t\treturn this._maxAllowedHeight\r\n\t}\r\n\r\n\tpublic get topMargin(): number {\r\n\t\treturn this._topMargin\r\n\t}\r\n\r\n\tpublic get lightInWindows(): boolean {\r\n\t\treturn this._lightInWindows\r\n\t}\r\n\r\n\tpublic get allowWindows(): boolean {\r\n\t\treturn this._allowWindows\r\n\t}\r\n\r\n\tpublic get allowSurroundingDecorations(): boolean {\r\n\t\treturn this._allowSurroundingDecorations\r\n\t}\r\n\r\n\tpublic get goldenRatio(): number {\r\n\t\treturn this._goldenRatio\r\n\t}\r\n\r\n\tpublic get fibonacci(): number[] {\r\n\t\treturn this._fibonacci\r\n\t}\r\n\r\n\tpublic getMapWidth(mapArrayWidth: number): number {\r\n\t\treturn mapArrayWidth * this._tileWidth\r\n\t}\r\n\r\n\tpublic getMapLength(mapArrayLength: number): number {\r\n\t\treturn mapArrayLength * this._tileLength\r\n\t}\r\n}","import { Map } from './mapper.component'\r\nimport { Column } from './column.component'\r\nimport { Config } from './config.component'\r\nimport { Tile } from './tile.component'\r\nimport { TileType } from './enums/tile-type.enum'\r\nimport { TileOptions } from './interfaces/tile-options.interface'\r\n\r\nexport class Decorations {\r\n\r\n\tprivate config: Config = new Config()\r\n\r\n\tconstructor() {}\r\n\r\n\tpublic placeRandomTrees(world: Map) {\r\n\r\n\t\tconst randomAmount = Math.floor(Math.random() * 6)\t\t\r\n\t\tconst yPlacement = []\r\n\t\tconst xPlacement = []\r\n\r\n\t\tfor (let t = 0; t < randomAmount; t++) {\r\n\t\t\tyPlacement.push(Math.floor(5 + Math.random() * (world.mapLength - 5)))\r\n\t\t}\r\n\r\n\t\tfor (let y = 0; y < world.mapLength; y++) {\r\n\r\n\t\t\tif (y > 1 && y < world.mapLength - 2) {\r\n\r\n\t\t\t\tlet loopCount = 0\r\n\t\t\t\tlet i = 0\r\n\r\n\t\t\t\tif (yPlacement.includes(y)) {\r\n\t\t\t\t\tyPlacement.forEach(value => {\r\n\t\t\t\t\t\tif (value === y) {\r\n\t\t\t\t\t\t\tloopCount++\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (let x = 1; x < world.mapWidth; x++) {\r\n\r\n\t\t\t\t\tif (x > 2 && x < world.mapWidth - 3) {\r\n\r\n\t\t\t\t\t\tif (!world.map[y][x].isDefined &&\r\n\t\t\t\t\t\t\t!world.map[y-1][x].isDefined &&\r\n\t\t\t\t\t\t\t!world.map[y+1][x].isDefined &&\r\n\t\t\t\t\t\t\t!world.map[y][x-2].isDefined &&\r\n\t\t\t\t\t\t\t!world.map[y][x+2].isDefined) {\r\n\r\n\t\t\t\t\t\t\tconst chance = Math.floor(Math.random() * 200)\r\n\r\n\t\t\t\t\t\t\tif (chance > 160 && i < loopCount && xPlacement.indexOf(x) === -1) {\r\n\r\n\t\t\t\t\t\t\t\tlet decoration = new Column(true, x, y, 0)\r\n\t\t\t\t\t\t\t\t\tdecoration.tileStack = [new Tile(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t10000 + i, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t0, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tTileType.None,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.config.groundColor,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\troof:\t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpillar: \tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tslope:\t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twindowed: \t0,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttower: \t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstairs:\t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thalfArch: \tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twholeArch:\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tareaDecoration: 'tree'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t})]\r\n\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t\tworld.map[y][x] = decoration\r\n\r\n\t\t\t\t\t\t\t\txPlacement.push(x)\r\n\r\n\t\t\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\r\n\t\treturn world.map\r\n\t}\r\n}","export enum BuildingHeightVariations {\r\n\tTallCenter = 'tallCenter',\r\n\tTallSurrounds = 'tallSurrounds',\r\n\tRandom = 'random'\r\n}","export enum TileType {\r\n\tNone = 'none',\r\n\tBody = 'body',\r\n\tTower = 'tower',\r\n\tHalfBlock = 'halfBlock',\r\n\tRoof = 'roof',\r\n\tGrass = 'grass',\r\n\tShadow = 'shadow'\r\n}","import { Map } from './mapper.component'\r\nimport { Renderer } from './builder.component'\r\nimport { Color } from './colors.component'\r\nimport { Config } from './config.component'\r\n\r\nclass RandomBuilding {\r\n\r\n\tprivate _map: Map\r\n\tprivate _builder: Renderer = new Renderer\r\n\tprivate config: Config = new Config\r\n\r\n\tconstructor() {\r\n\t\t// !!Math.round(Math.random())\r\n\t\tthis._map = new Map(36, 36, 10, 1, 5, 3, 3, !!0)\r\n\t\tdocument.querySelector('body').style.background = this.config.groundColor.hex()\r\n\t}\r\n\r\n\tpublic debug(): boolean {\r\n\t\treturn this.config.allowDebug\r\n\t}\r\n\r\n\tget map() {\r\n\t\treturn this._map\r\n\t}\r\n\r\n\tpublic colorMap(): string {\r\n\t\treturn this._builder.build2DMap(this._map)\r\n\t}\r\n\r\n\tpublic addToBuildingAndRedraw(): string {\r\n\t\tthis._map.addToBuilding()\r\n\t\treturn this._builder.build2DMap(this._map)\r\n\t}\r\n\r\n\tpublic drawTileMap(): string {\r\n\t\treturn this._builder.buildMap(this._map)\r\n\t}\r\n\r\n\tpublic getBaseColor(): Color {\r\n\t\tconst col = this.map.getFirstDefinedColumn()\r\n\t\tconst tile = col.tileStack[col.tileStack.length-1]\r\n\t\treturn tile.getColor()\r\n\t}\r\n\r\n\tpublic getImageTag(): void {\r\n\t\tif (document.querySelector('#buildingimg')) {\r\n\t\t\tdocument.querySelector('#buildingimg').remove()\r\n\t\t}\r\n\r\n\t\tlet svg = new XMLSerializer().serializeToString(document.querySelector('svg'))\r\n\t\tlet base64 = window.btoa(svg)\r\n\r\n\t\tlet newImg = document.createElement('img')\r\n\t\tnewImg.setAttribute('id', 'buildingimg')\r\n\t\tif (window['debug']) {\r\n\t\t\tnewImg.setAttribute('class', 'debug-active')\r\n\t\t}\r\n\t\tnewImg.setAttribute('src', 'data:image/svg+xml;base64,'+base64)\r\n\t\t\r\n\t\tlet beforeElement = document.querySelector('#worldtest')\r\n\t\tlet parent = document.querySelector(\"body\")\r\n\t\tparent.insertBefore(newImg, beforeElement)\t\t\r\n\t}\r\n}\r\n\r\nwindow['debug'] = false\r\nlet world\r\n\r\nwindow['activateDebug'] = () => { \r\n\twindow['debug'] = true\r\n\tdocument.querySelector('#color').classList.remove('hide')\r\n\tdocument.querySelector('#add').classList.remove('hide')\r\n\tdocument.querySelector('#color-scheme').classList.remove('hide')\r\n\tif (document.querySelector('#buildingimg')) {\r\n\t\tdocument.querySelector('#buildingimg').classList.add('debug-active')\r\n\t}\t\r\n\tdocument.querySelector('#color').innerHTML = building.colorMap()\r\n\r\n\tconst tiles = document.querySelector('#color').querySelectorAll('.tile')\r\n\tworld = building.map\r\n\r\n\ttiles.forEach(tile => {\r\n\t\ttile.addEventListener('click', event => {\r\n\t\t\tconst evtTarget = event.target as HTMLElement\r\n\t\t\tconst y = evtTarget.getAttribute('data-y')\r\n\t\t\tconst x = evtTarget.getAttribute('data-x')\r\n\r\n\t\t\tconsole.log(world.map[y][x])\r\n\t\t})\r\n\t})\r\n}\r\n\r\nlet building = new RandomBuilding()\r\n\r\nif (building.debug()) {\r\n\twindow['activateDebug']();\r\n}\r\n\r\ndocument.querySelector(\"#worldtest\").innerHTML = building.drawTileMap()\r\nif (!building.debug()) {\r\n\tbuilding.getImageTag()\r\n\tdocument.querySelector(\"#worldtest\").classList.add('hide')\r\n}\r\n\r\nsetColors(building)\r\n\r\ndocument.querySelector('#add').addEventListener('click', () => {\r\n\tdocument.querySelector('#color').innerHTML = building.addToBuildingAndRedraw()\r\n\tdocument.querySelector(\"#worldtest\").innerHTML = building.drawTileMap()\r\n})\r\n\r\ndocument.querySelector('#generate').addEventListener('click', () => {\r\n\tbuilding = new RandomBuilding()\r\n\tif (window['debug']) {\r\n\t\tdocument.querySelector('#color').innerHTML = building.colorMap()\r\n\t}\t\r\n\tdocument.querySelector(\"#worldtest\").innerHTML = building.drawTileMap()\r\n\tif (!building.debug()) {\r\n\t\tbuilding.getImageTag()\r\n\t\tdocument.querySelector(\"#worldtest\").classList.add('hide')\r\n\t}\r\n\r\n\tdocument.querySelectorAll('.point').forEach((item) => {\r\n\t\titem.addEventListener('click', () => {\r\n\t\t\tconsole.log('toggled', item)\r\n\t\t\titem.parentElement.classList.toggle('active')\r\n\t\t})\t\t\r\n\t})\r\n\r\n\tsetColors(building)\r\n})\r\n\r\nconst getTileInfo = (y, x) => {\r\n\r\n}\r\n\r\n/*\r\ndocument.querySelector('#debugActive').addEventListener('click', () => {\r\n\tdocument.querySelector('#debug').classList.toggle('show')\r\n\tdocument.querySelector('#debugActive').classList.toggle('active')\r\n})\r\n\r\ndocument.querySelectorAll('.blockLabel').forEach((item) => {\r\n\titem.addEventListener('click', () => {\r\n\t\titem.classList.toggle('active')\r\n\t})\r\n}) */\r\n\r\nfunction setColors(building: RandomBuilding) {\r\n\r\n\tconst color = building.getBaseColor()\r\n\tconst shade0 = color.changeColorLightingString(0)\r\n\tconst shade1 = color.changeColorLightingString(20)\r\n\tconst shade2 = color.changeColorLightingString(-20)\r\n\tconst shade3 = color.getColorStringByHue(60)\r\n\tconst shade4 = color.getColorStringByHue(120)\r\n\tconst shade5 = color.getColorStringByHue(180)\r\n\tconst shade6 = color.getColorStringByHue(240)\r\n\tconst shade7 = color.getColorStringByHue(300)\r\n\r\n\tconst colorDivs = `\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade0};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade1};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade3};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade4};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade5};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade6};\"></div>\r\n\t\t<div class=\"color__tile\" style=\"background-color:${shade7};\"></div>`\r\n\r\n\tdocument.querySelector('#color-scheme').innerHTML = colorDivs\r\n}\r\n/*\r\ndocument.querySelector('#download').addEventListener('click', () => {\r\n\tlet svg = new XMLSerializer().serializeToString(document.querySelector('svg'))\r\n\tlet base64 = window.btoa(svg)\r\n\r\n\tlet newImg = document.createElement('img')\r\n\tnewImg.setAttribute('src', 'data:image/svg+xml;base64,'+base64)\r\n\tdocument.querySelector('body').appendChild(newImg)\r\n}); */","import { Config } from './config.component'\r\nimport { Position } from './interfaces/position.interface'\r\n\r\nexport class MapGenerationFunctions {\r\n\r\n\tprivate config: Config = new Config();\r\n\tsmallAngle = this.config.tileSmallAngle;\r\n\tlargeAngle = this.config.tileLargeAngle;\r\n\r\n\tconstructor() { }\r\n\r\n\tpublic calculateAdditionalBlockIterations(maximumBlockIterations: number) {\r\n\t\treturn 2 + Math.floor(Math.random() * maximumBlockIterations);\r\n\t}\r\n\r\n\t// calculate the dimensions to draw the isometric perspective tile with the parameters as if it were a straight square tile\r\n\tpublic calculateStraightLinesFromIsometricSquare (blockWidth: number, blockHeight: number) {\r\n\t\t// lengths this function returns when it comes to positions of longest and shortest sides as array\r\n\t\t/*           [0]\r\n\t\t *   _________________ \r\n\t\t *   |    [3]  |      |\r\n\t\t *   | [5]            |\r\n\t\t *   |               -|\r\n\t\t *   |-               | [1]\r\n\t\t *   | [4]            |\r\n\t\t *   |    [2]         |\r\n\t\t *   |_______|________|\r\n\t\t */  \r\n\r\n\t\tlet smallOuterAngle = (180 - this.smallAngle) / 2;\r\n\t\tlet largeOuterAngle = (180 - this.largeAngle) / 2;\r\n\r\n\t\tlet horizontalWidthFromBottom = this.getHorizontalBottomShortestWidth(blockWidth, smallOuterAngle);\r\n\t\tlet verticalHeightFromBottom = this.getVerticalBottomShortestHeight(horizontalWidthFromBottom, smallOuterAngle);\r\n\r\n\t\tlet horizontalWidthFromTop = this.getHorizontalTopLongestWidth(blockHeight, largeOuterAngle);\r\n\t\tlet verticalHeightFromTop = this.getVerticalTopLongestHeight(horizontalWidthFromTop, largeOuterAngle);\r\n\r\n\t\tlet totalHeight = verticalHeightFromBottom + verticalHeightFromTop;\r\n\t\tlet totalWidth = horizontalWidthFromBottom + horizontalWidthFromTop;\r\n\r\n\t\treturn {\t'totalWidth': totalWidth, // 0\r\n\t\t\t\t\t'totalHeight': totalHeight,  // 1\r\n\t\t\t\t\t'horizontalWidthFromBottom': horizontalWidthFromBottom,  // 2\r\n\t\t\t\t\t'horizontalWidthFromTop': horizontalWidthFromTop,  // 3\r\n\t\t\t\t\t'verticalHeightFromBottom': verticalHeightFromBottom,  // 4\r\n\t\t\t\t\t'verticalHeightFromTop': verticalHeightFromTop } // 5\r\n\t}\r\n\r\n\t// calculate the amount of pixels from the bottom left side of a straight square to the point at the bottom \r\n\t// .. where the tip of the tile meets the border of the square\r\n\tpublic getHorizontalBottomShortestWidth (diagonalWidth: number, smallAngle: number): number {\r\n\t\treturn diagonalWidth * Math.sin(this.toRadians(smallAngle));\r\n\t}\r\n\r\n\tpublic getVerticalBottomShortestHeight (diagonalHeight: number, smallAngle: number): number {\r\n\t\treturn diagonalHeight * Math.cos(this.toRadians(smallAngle));\r\n\t}\r\n\r\n\tpublic getHorizontalTopLongestWidth (diagonalWidth: number, largeAngle: number): number {\r\n\t\treturn diagonalWidth * Math.sin(this.toRadians(largeAngle));\r\n\t}\r\n\r\n\tpublic getVerticalTopLongestHeight (diagonalHeight: number, largeAngle: number): number {\r\n\t\treturn diagonalHeight * Math.cos(this.toRadians(largeAngle));\r\n\t}\r\n\r\n\tpublic addGradient(id: string, colorLeft: string, colorRight: string) {\r\n\r\n\t\tlet gradient = '<linearGradient id=\"'+id+'\">'\r\n\t\t\tgradient += '<stop offset=\"5%\" stop-color=\"'+colorLeft+'\" />'\r\n\t\t\tgradient += '<stop offset=\"95%\" stop-color=\"'+colorRight+'\" />'\r\n\t\t\tgradient += '</linearGradient>'\r\n\r\n\t\treturn gradient\r\n\t}\r\n\r\n\ttoRadians (angle: number): number {\r\n\t\treturn angle * (Math.PI / 180);\r\n\t}\r\n\r\n\tpublic getHighestXfromArray(array: Position[]): Position {\r\n\t\tlet highest: Position = {x: 0, y: 0}\r\n\r\n\t\tarray.forEach(item => {\r\n\t\t\tif (item.x > highest.x) {\r\n\t\t\t\thighest = item\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\treturn highest\r\n\t}\r\n\r\n\tpublic getHighestYfromArray(array: Position[]): Position {\r\n\t\tlet highest: Position = {x: 0, y: 0}\r\n\r\n\t\tarray.forEach(item => {\r\n\t\t\tif (item.y > highest.y) {\r\n\t\t\t\thighest = item\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\treturn highest\r\n\t}\r\n\r\n\tpublic getLowestXfromArray(array: Position[]): Position {\r\n\t\tlet highest = this.getHighestXfromArray(array)\r\n\t\tlet lowest: Position = highest\r\n\r\n\t\tarray.forEach(item => {\r\n\t\t\tif (item.x < lowest.x) {\r\n\t\t\t\tlowest = item\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\treturn lowest\r\n\t}\r\n\r\n\tpublic getLowestYfromArray(array: Position[]): Position {\r\n\t\tlet highest = this.getHighestYfromArray(array)\r\n\t\tlet lowest: Position = highest\r\n\r\n\t\tarray.forEach(item => {\r\n\t\t\tif (item.y < lowest.y) {\r\n\t\t\t\tlowest = item\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\treturn lowest\r\n\t}\r\n}\r\n","import { MapGenerationFunctions } from './mapGenerationFunctions.component'\r\nimport { BuildingHeightVariations } from './enums/building-height-variations.enum'\r\nimport { Color } from './colors.component'\r\nimport { Column } from './column.component'\r\nimport { Tile } from './tile.component'\r\nimport { TileOptions } from './interfaces/tile-options.interface'\r\nimport { TileType } from './enums/tile-type.enum'\r\nimport { Config } from './config.component'\r\nimport { Position } from './interfaces/position.interface'\r\nimport { Dimensions } from './interfaces/dimensions.interface'\r\nimport { Primitives } from './primitives.component'\r\nimport { Modifiers } from './modifiers.component'\r\nimport { Decorations } from './decorations.component'\r\n\r\nexport class Map {\r\n\r\n\tprivate mapGen: MapGenerationFunctions = new MapGenerationFunctions()\r\n\tprivate config: Config = new Config()\r\n\tprivate primitives: Primitives = new Primitives()\r\n\tprivate mods: Modifiers = new Modifiers()\r\n\tprivate deco: Decorations = new Decorations()\r\n\r\n\tprivate _mapWidth: number\r\n\tprivate _mapLength: number\r\n\tprivate _mapMaxHeight: number\r\n\tprivate _averageBuildingSize: number\r\n\tprivate _blockHeight: number\r\n\tprivate _maximumBlockIterations: number\r\n\tprivate _additionalBlockIterations: number\r\n\tprivate _mapEdgeWidth: number\r\n\tprivate _highestPoint: number\r\n\tprivate _startBlockXfromCenterDeviation: number\r\n\tprivate _startBlockWidth: number\r\n\tprivate _startBlockLength: number\r\n\tprivate _mapHalfLength: number\r\n\tprivate _world: any[][]\r\n\tprivate _mirrorAtCenter: boolean\r\n\tprivate _blockHeightsArray: number[]\r\n\tprivate _blockGroups: number[]\r\n\tprivate _blockEdges: Position[]\t\r\n\tprivate _blockHeightVariationLabels = [BuildingHeightVariations.TallCenter, BuildingHeightVariations.TallSurrounds, BuildingHeightVariations.Random]\r\n\tprivate _blockHeightVariation = this._blockHeightVariationLabels[Math.floor(Math.random() * 3)]\r\n\tprivate _blockIdIterator: number\r\n\tprivate _blockHeightIterator: number\r\n\tprivate _blockAmountIterator: number\r\n\tprivate _HorizontalRemainingEmptyBlocksMin: number\r\n\tprivate _HorizontalRemainingEmptyBlocksMax: number\r\n\tprivate _decorationLineH: number\r\n\tprivate _groundColor: Color\r\n\tprivate _defaultColor: Color\r\n\tprivate _lineColor: Color\r\n\tprivate _firstLevelColor: Color\r\n\tprivate _surroundingsGrassColor: Color\r\n\tprivate _surroundingsWaterColor: Color\r\n\tprivate _surroundingsSandColor: Color\r\n\tprivate _surroundingsDefaultColor: Color\r\n\tprivate _showWindows: number\r\n\r\n\tconstructor(\t\r\n\t\t\tmapWidth: number, \r\n\t\t\tmapLength: number, \r\n\t\t\tmapMaxHeight: number, \r\n\t\t\tmapEdgeWidth: number,\r\n\t\t\taverageBuildingSize: number,\r\n\t\t\tblockHeight: number,\r\n\t\t\tmaximumBlockIterations: number,\r\n\t\t\tmirrorAtCenter: boolean = false)\r\n\t{\r\n\t\tthis._world = []\r\n\t\tthis._mapWidth = mapWidth\r\n\t\tthis._mapLength = mapLength\r\n\t\tthis._mapMaxHeight = mapMaxHeight\r\n\t\tthis._mapEdgeWidth = mapEdgeWidth\r\n\t\tthis._averageBuildingSize = averageBuildingSize \r\n\t\tthis._blockHeight = blockHeight\r\n\t\tthis._mirrorAtCenter = mirrorAtCenter\r\n\t\tlet baseHeight = 2\r\n\t\tlet scaleFactor\r\n\t\tif (this._blockHeightVariation === BuildingHeightVariations.TallCenter) {\r\n\t\t\tscaleFactor = 2\r\n\t\t} else if (this._blockHeightVariation === BuildingHeightVariations.TallSurrounds) {\r\n\t\t\tscaleFactor = 8\r\n\t\t} else {\r\n\t\t\tscaleFactor = 4\r\n\t\t}\r\n\t\tif (Math.round(Math.random()) === 0) {\r\n\t\t\tthis._startBlockWidth = this._averageBuildingSize + Math.floor(Math.random() * scaleFactor)\r\n\t\t\tthis._startBlockLength = Math.floor(this._startBlockWidth * this.config.goldenRatio)\r\n\t\t} else {\r\n\t\t\tthis._startBlockLength = this._averageBuildingSize + Math.floor(Math.random() * scaleFactor)\r\n\t\t\tthis._startBlockWidth = Math.floor(this._startBlockLength * this.config.goldenRatio)\r\n\t\t}\t\t\r\n\t\tthis._maximumBlockIterations = maximumBlockIterations\r\n\t\tthis._additionalBlockIterations = this.mapGen.calculateAdditionalBlockIterations(maximumBlockIterations)\r\n\t\tthis._blockGroups = []\r\n\t\tthis._blockEdges = []\r\n\t\tthis._blockHeightsArray = []\r\n\t\tthis._mapHalfLength = Math.floor(mapLength / 2)\r\n\t\tthis._blockIdIterator = 0\r\n\t\tthis._blockAmountIterator = 1\r\n\t\tthis._blockHeightIterator = 1\r\n\t\tthis._decorationLineH = -1\r\n\t\tlet newLineHue = this.config.buildingBaseColor.getColorStringByHue(-120)\r\n\t\tlet lineColor = new Color(newLineHue)\r\n\t\tthis._defaultColor = new Color(this.config.buildingBaseColor.hex())\r\n\t\tthis._lineColor = lineColor.changeColorLighting(-30)\r\n\t\tthis._firstLevelColor = new Color(this.config.buildingBaseColor.getColorStringByHue(10)).changeColorLighting(-20)\r\n\t\tthis._groundColor = this.config.groundColor\r\n\t\tthis._HorizontalRemainingEmptyBlocksMin = 0\r\n\t\tthis._HorizontalRemainingEmptyBlocksMax = 0\r\n\t\tthis._surroundingsGrassColor = new Color('#7bb376')\r\n\t\tthis._surroundingsWaterColor = new Color('#6fb9ca')\r\n\t\tthis._surroundingsSandColor = new Color('#e9e3ba')\r\n\t\tthis._surroundingsDefaultColor = this._surroundingsGrassColor\r\n\t\tthis._showWindows = this.config.allowWindows ? Math.round(Math.random() * 2) : 0\r\n\r\n\t\tlet startblockYfromCenterDeviation = 0\r\n\t\tif (!this._mirrorAtCenter) {\t\t\t\r\n\t\t\tstartblockYfromCenterDeviation = -8\r\n\t\t\tif (Math.round(Math.random()) === 0) {\r\n\t\t\t\tstartblockYfromCenterDeviation = 8\r\n\t\t\t}\r\n\t\t\tconsole.log('not mirrorred: dev:', startblockYfromCenterDeviation)\r\n\t\t}\r\n\r\n\t\tlet mapLengthHalf = Math.floor(mapLength / 2) \r\n\t\tlet mapWidthHalf = Math.floor(mapWidth / 2)\r\n\t\tlet startBlockXfromCenterDeviation = 7\t\t\r\n\t\tlet startblockXfromCenter = 4 + Math.floor(Math.random() * startBlockXfromCenterDeviation)\r\n\t\tlet startblockLengthHalf = Math.floor(this._startBlockLength / 2)\r\n\t\tlet startblockWidthHalf = Math.floor(this._startBlockWidth / 2)\r\n\t\tlet startingPositionX = Math.floor(this._mapWidth / 2) - Math.floor(startblockXfromCenter / 2)\r\n\t\tlet buildGardens = !!(Math.round(Math.random() * 2))\r\n\t\tlet useWaterGarden = false\r\n\t\tlet tileHeight = 0\r\n\t\tlet firstBlockHeightRandom = Math.floor(Math.random() * this.config.fibonacci.length)\r\n\t\tlet firstBlockHeight = this.config.fibonacci[firstBlockHeightRandom]\r\n\t\tlet slopeY = 0\r\n\r\n\t\tif (this._defaultColor.rgb().g >= 180 && this._defaultColor.rgb().b >= 150 && Math.round(Math.random() * 4) >= 3) {\r\n\t\t\tuseWaterGarden = (Math.round(Math.random() * 10) > 6) ? true : false\r\n\t\t\tthis._surroundingsDefaultColor = this._surroundingsWaterColor\r\n\t\t} else if (Math.round(Math.random() * 10) <= 1) {\r\n\t\t\tuseWaterGarden = (Math.round(Math.random() * 10) > 3) ? true : false\r\n\t\t\tthis._surroundingsDefaultColor = this._surroundingsWaterColor\r\n\t\t}\r\n\r\n\t\tif (this._blockHeightVariation === BuildingHeightVariations.TallCenter) {\r\n\t\t\tfirstBlockHeight = this.config.fibonacci[maximumBlockIterations]\r\n\t\t} else if (this._blockHeightVariation === BuildingHeightVariations.TallSurrounds) {\r\n\t\t\tfirstBlockHeight = baseHeight + this.config.fibonacci[0]\r\n\t\t\tthis._blockHeight = firstBlockHeight\r\n\t\t}\r\n\r\n\t\tlet hollowArchWays = false\r\n\r\n\t\tif (firstBlockHeight === 3) {\r\n\t\t\thollowArchWays = true\r\n\t\t}\r\n\r\n\t\tif (firstBlockHeight > 6) {\r\n\t\t\tthis._decorationLineH = 4\r\n\t\t} else if (firstBlockHeight > 3) {\r\n\t\t\tthis._decorationLineH = 3\r\n\t\t}\r\n\r\n\t\tif (firstBlockHeight < 4) {\r\n\t\t\tif (Math.round(Math.random() * 5) > 2) {\r\n\t\t\t\tslopeY = startingPositionX + Math.ceil(Math.random() * this._startBlockWidth - 2)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._blockHeight = firstBlockHeight\r\n\r\n\t\tlet hollowBuildingBlock = (Math.round(Math.random()) === 1 ? true : false) \r\n\t\tlet openGroundLevel = (this._blockHeight > 2) ? (Math.round(Math.random()) === 1 ? true : false) : false\r\n\r\n\t\tfor (let y = 0; y < this.mapLength; y++) {\r\n\r\n\t\t\tthis._world[y] = []\r\n\r\n\t\t\tfor (let x = 0; x < this.mapWidth; x++) {\r\n\r\n\t\t\t\tlet thisBlockGroup = 0\r\n\r\n\t\t\t\tlet column = new Column(false, x, y, 0)\r\n\t\t\t\tlet yConditions\r\n\t\t\t\tlet xConditions = (x > startingPositionX && x <= (startingPositionX + this._startBlockWidth))\r\n\r\n\t\t\t\tif (!this._mirrorAtCenter) {\r\n\t\t\t\t\tyConditions = (y >= mapLengthHalf + startblockYfromCenterDeviation && y <= mapLengthHalf + (startblockYfromCenterDeviation + this._startBlockLength))\r\n\t\t\t\t} else {\r\n\t\t\t\t\tyConditions = (y >= mapLengthHalf && y <= (mapLengthHalf + startblockLengthHalf))\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\r\n\t\t\t\tif (yConditions) {\r\n\r\n\t\t\t\t\tif (xConditions) {\r\n\r\n\t\t\t\t\t\tthisBlockGroup = 1\r\n\t\t\t\t\t\tlet tileStack = []\r\n\r\n\t\t\t\t\t\tfor (let h = 0; h < this._blockHeight; h++) {\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlet thisPillar = false\r\n\t\t\t\t\t\t\tlet tileType = TileType.Body\r\n\t\t\t\t\t\t\tif (h < 2 && openGroundLevel) {\r\n\t\t\t\t\t\t\t\tif (y % 2 === 0) {\r\n\t\t\t\t\t\t\t\t\tthisPillar = true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (this._decorationLineH > 3 && h+1 === this._decorationLineH && h+1 < this._blockHeight) {\r\n\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\tif (y % 2 === 0) {\r\n\t\t\t\t\t\t\t\t\tthisPillar = true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlet thisWindowed = 0\r\n\t\t\t\t\t\t\tif (!thisPillar && this._showWindows > 0 && h % 2 === 1) {\r\n\t\t\t\t\t\t\t\tthisWindowed = this._showWindows\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlet isRoof = (h === this._blockHeight-1) ? true : false\r\n\t\t\t\t\t\t\tlet tileColor = this._defaultColor\r\n\r\n\t\t\t\t\t\t\tif (h === this._decorationLineH) {\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\ttileColor = this._lineColor\r\n\t\t\t\t\t\t\t} else if (h === 0) { \r\n\t\t\t\t\t\t\t\ttileColor = this._firstLevelColor\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttileColor = this._defaultColor\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlet slope = false\r\n\t\t\t\t\t\t\tif (h < this._blockHeight && y === slopeY) {\r\n\t\t\t\t\t\t\t\tif (h === 0) {\r\n\t\t\t\t\t\t\t\t\tif (x === startingPositionX + this._startBlockWidth) {\r\n\t\t\t\t\t\t\t\t\t\tslope = true\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else if (h === 1) {\r\n\t\t\t\t\t\t\t\t\tif (x === startingPositionX + this._startBlockWidth - 1) {\r\n\t\t\t\t\t\t\t\t\t\tslope = true\r\n\t\t\t\t\t\t\t\t\t} else if (x === startingPositionX + this._startBlockWidth) {\r\n\t\t\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else if (h === 2) {\r\n\t\t\t\t\t\t\t\t\tif (x === startingPositionX + this._startBlockWidth - 2) {\r\n\t\t\t\t\t\t\t\t\t\tslope = true\r\n\t\t\t\t\t\t\t\t\t} else if (x > startingPositionX + this._startBlockWidth - 2) {\r\n\t\t\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (hollowArchWays && h < 2) {\r\n\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\tif ((y % 2 === 0 && x % 2 === 1) || (y % 2 === 1 && x % 2 === 0)) {\r\n\t\t\t\t\t\t\t\t\tthisPillar = true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\t\t\t\t\r\n\r\n\t\t\t\t\t\t\ttileStack.push(\r\n\t\t\t\t\t\t\t\tnew Tile(\r\n\t\t\t\t\t\t\t\t\tthis._blockIdIterator, \r\n\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\th, \r\n\t\t\t\t\t\t\t\t\ttileType,\r\n\t\t\t\t\t\t\t\t\ttileColor,\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\troof:\t\tisRoof,\r\n\t\t\t\t\t\t\t\t\t\tpillar: \tthisPillar,\r\n\t\t\t\t\t\t\t\t\t\tslope:\t\tslope,\r\n\t\t\t\t\t\t\t\t\t\twindowed: \tthisWindowed,\r\n\t\t\t\t\t\t\t\t\t\ttower: \t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\tstairs:\t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\thalfArch: \tfalse,\r\n\t\t\t\t\t\t\t\t\t\twholeArch:\tfalse,\r\n\t\t\t\t\t\t\t\t\t\tareaDecoration: ''\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t)\r\n\r\n\t\t\t\t\t\t\tif (this._blockGroups.indexOf(thisBlockGroup) === -1) {\r\n\t\t\t\t\t\t\t\tthis._blockGroups.push(thisBlockGroup)\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tthis._blockHeightsArray.push(this._blockHeight)\r\n\r\n\t\t\t\t\t\t\tthis._blockIdIterator++\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tcolumn = new Column(true, x, y, this._blockHeight)\r\n\r\n\t\t\t\t\t\tcolumn.blockGroup = thisBlockGroup\r\n\t\t\t\t\t\tcolumn.height = this._blockHeight\r\n\t\t\t\t\t\tcolumn.corner = false\r\n\t\t\t\t\t\tcolumn.tileStack = tileStack\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._world[y][x] = column\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.setEdges(false)\r\n\r\n\t\t/* Make hollow */\r\n\t\tif (hollowBuildingBlock && this._blockHeight > 2) {\r\n\r\n\t\t\tfor (let y = 0; y < this.mapLength; y++) {\r\n\t\t\t\tfor (let x = 0; x < this.mapWidth; x++) {\r\n\r\n\t\t\t\t\tif (!!this._world[y][x].edge.left) {\r\n\t\t\t\t\t\t// console.log('left? ', this._world[y][x].edge.left)\r\n\t\t\t\t\t\tfor (let h = 0; h < this._blockHeight; h++) {\r\n\t\t\t\t\t\t\tif (this._world[y][x].tileStack[h].type === TileType.None) {\r\n\t\t\t\t\t\t\t\tif (y % 2 === 0) {\r\n\t\t\t\t\t\t\t\t\tthis._world[y][x].tileStack[h].options.pillar = true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} \r\n\t\t\t\t\tif (!!this._world[y][x].edge.bottom) {\r\n\t\t\t\t\t\t// console.log('bottom? ', this._world[y][x].edge.bottom)\r\n\t\t\t\t\t\tfor (let h = 0; h < this._blockHeight; h++) {\r\n\t\t\t\t\t\t\tif (this._world[y][x].tileStack[h].type === TileType.None) {\r\n\t\t\t\t\t\t\t\tif (x % 2 === 0) {\r\n\t\t\t\t\t\t\t\t\tthis._world[y][x].tileStack[h].options.pillar = true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!!this._world[y][x].edge.right) {\r\n\t\t\t\t\t\t// console.log('right? ', this._world[y][x].edge.right)\r\n\t\t\t\t\t\tfor (let h = 0; h < this._blockHeight; h++) {\r\n\t\t\t\t\t\t\tif (this._world[y][x].tileStack[h].type === TileType.None) {\r\n\t\t\t\t\t\t\t\tif (y % 2 === 0) {\r\n\t\t\t\t\t\t\t\t\tthis._world[y][x].tileStack[h].options.pillar = true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!!this._world[y][x].edge.top) {\r\n\t\t\t\t\t\t// console.log('top? ', this._world[y][x].edge.top)\r\n\t\t\t\t\t\tfor (let h = 0; h < this._blockHeight; h++) {\r\n\t\t\t\t\t\t\tif (this._world[y][x].tileStack[h].type === TileType.None) {\r\n\t\t\t\t\t\t\t\tif (x % 2 === 0) {\r\n\t\t\t\t\t\t\t\t\tthis._world[y][x].tileStack[h].options.pillar = true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet hasEdge = (this._world[y][x].edge.left || this._world[y][x].edge.bottom || this._world[y][x].edge.right) ? true : false\r\n\r\n\t\t\t\t\tif (this._world[y][x].isDefined && !hasEdge) {\r\n\t\t\t\t\t\tthis._world[y][x] = new Column(false, x, y, 0)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t\r\n\t\tfor (let i = 0; i < this._additionalBlockIterations; i++) {\r\n\t\t\tthis.getEdges()\r\n\t\t\tthis._world = this.mods.addBuildingComponent(this)\r\n\t\t}\r\n\r\n\t\tconsole.log('remove excess arches');\r\n\t\tthis._world = this.mods.removeExcessArches(this);\r\n\r\n\t\t/*\t\r\n\t\t *\tAdd gardens or other ornamental features around the building */\t\t\r\n\r\n\t\tif (this.config.allowSurroundingDecorations && buildGardens) {\r\n\r\n\t\t\tthis._HorizontalRemainingEmptyBlocksMin = this.getLeastOpenSpaceOnX()['min']\r\n\t\t\tthis._HorizontalRemainingEmptyBlocksMax = this.getLeastOpenSpaceOnX()['max']\r\n\r\n\t\t\tif (this._HorizontalRemainingEmptyBlocksMin > 7) {\r\n\r\n\t\t\t\tlet landsLength = this._HorizontalRemainingEmptyBlocksMin * 2\r\n\t\t\t\tif (landsLength > 16) landsLength = 16\r\n\t\t\t\tlet landsEdge = this._mapLength - landsLength\r\n\r\n\t\t\t\tfor (let y = Math.floor(landsEdge / 2); y < this.mapLength - Math.floor(landsEdge / 2); y++) {\t\t\t\t\r\n\t\t\t\t\tfor (let x = 0; x < this._HorizontalRemainingEmptyBlocksMin - 3; x++) {\r\n\t\t\t\t\t\tif (!this._world[y][x].isDefined) {\r\n\t\t\t\t\t\t\tlet edgeOfGarden = false\r\n\t\t\t\t\t\t\tlet tileType: TileType = TileType.Grass\r\n\t\t\t\t\t\t\tlet tileColor = this._surroundingsDefaultColor\r\n\t\t\t\t\t\t\tlet defaultHeight = 0\r\n\t\t\t\t\t\t\tif (x === 0 || \r\n\t\t\t\t\t\t\t\tx === this._HorizontalRemainingEmptyBlocksMin - 4) {\r\n\t\t\t\t\t\t\t\tif (useWaterGarden) {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._defaultColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.HalfBlock\r\n\t\t\t\t\t\t\t\t\tdefaultHeight = 1\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._surroundingsSandColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.Grass\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\t\t\t(y === Math.floor(landsEdge / 2)) ||\r\n\t\t\t\t\t\t\t\t\t(y === this.mapLength - Math.floor(landsEdge / 2) - 1) ) {\r\n\t\t\t\t\t\t\t\tif (useWaterGarden) {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._defaultColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.HalfBlock\r\n\t\t\t\t\t\t\t\t\tdefaultHeight = 1\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._surroundingsSandColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.Grass\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlet gardenBlock = new Column(true, x, y, defaultHeight)\r\n\t\t\t\t\t\t\t\tgardenBlock.tileStack = [new Tile(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis._blockIdIterator, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t0, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttileType,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttileColor,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\troof:\t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tpillar: \tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tslope:\t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twindowed: \t0,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttower: \t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstairs:\t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thalfArch: \tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twholeArch:\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tareaDecoration: ''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})]\r\n\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\tthis._world[y][x] = gardenBlock\r\n\t\t\t\t\t\t\tthis._blockIdIterator++\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this._HorizontalRemainingEmptyBlocksMax > 7) {\r\n\r\n\t\t\t\tlet landsLength = this._HorizontalRemainingEmptyBlocksMax * 2\r\n\t\t\t\tlet landsEdge = this._mapLength - landsLength\r\n\r\n\t\t\t\tfor (let y = Math.floor(landsEdge / 2); y < this.mapLength - Math.floor(landsEdge / 2); y++) {\r\n\t\t\t\t\tfor (let x = this._mapWidth - this._HorizontalRemainingEmptyBlocksMax + 2; x < this._mapWidth; x++) {\r\n\t\t\t\t\t\tif (!this._world[y][x].isDefined) {\r\n\t\t\t\t\t\t\tlet edgeOfGarden = false\r\n\t\t\t\t\t\t\tlet tileType: TileType = TileType.Grass\r\n\t\t\t\t\t\t\tlet tileColor = this._surroundingsDefaultColor\r\n\t\t\t\t\t\t\tlet defaultHeight = 0\r\n\t\t\t\t\t\t\tif (x === this._mapWidth - 1 || \r\n\t\t\t\t\t\t\t\tx === this._mapWidth - this._HorizontalRemainingEmptyBlocksMax + 2) {\r\n\t\t\t\t\t\t\t\tif (useWaterGarden) {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._defaultColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.HalfBlock\r\n\t\t\t\t\t\t\t\t\tdefaultHeight = 1\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._surroundingsSandColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.Grass\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\t\t\ty === Math.floor(landsEdge / 2) ||\r\n\t\t\t\t\t\t\t\t\ty === this.mapLength - Math.floor(landsEdge / 2) - 1) {\r\n\t\t\t\t\t\t\t\tif (useWaterGarden) {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._defaultColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.HalfBlock\r\n\t\t\t\t\t\t\t\t\tdefaultHeight = 1\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttileColor = this._surroundingsSandColor\r\n\t\t\t\t\t\t\t\t\ttileType = TileType.Grass\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlet gardenBlock = new Column(true, x, y, defaultHeight)\r\n\t\t\t\t\t\t\t\tgardenBlock.tileStack = [new Tile(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis._blockIdIterator, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t0, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttileType,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttileColor,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\troof:\t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tpillar: \tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tslope:\t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twindowed: \t0,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttower: \t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstairs:\t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thalfArch: \tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twholeArch:\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tareaDecoration: ''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})]\r\n\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\tthis._world[y][x] = gardenBlock\r\n\t\t\t\t\t\t\tthis._blockIdIterator++\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let e = 0; e < this._blockEdges.length; e++) {\r\n\t\t\tlet edgePointY = this._blockEdges[e].y\r\n\t\t\tlet edgePointX = this._blockEdges[e].x\r\n\t\t\tlet grass = new Column(true, edgePointX, edgePointY, 0)\r\n\t\t\t\tgrass.tileStack = [new Tile(\r\n\t\t\t\t\t\t\t\t\tthis._blockIdIterator, \r\n\t\t\t\t\t\t\t\t\tedgePointX, \r\n\t\t\t\t\t\t\t\t\tedgePointY, \r\n\t\t\t\t\t\t\t\t\t0, \r\n\t\t\t\t\t\t\t\t\tTileType.Shadow,\r\n\t\t\t\t\t\t\t\t\tthis._defaultColor,\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\troof:\t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\tpillar: \tfalse,\r\n\t\t\t\t\t\t\t\t\t\tslope:\t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\twindowed: \t0,\r\n\t\t\t\t\t\t\t\t\t\ttower: \t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\tstairs:\t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\thalfArch: \tfalse,\r\n\t\t\t\t\t\t\t\t\t\twholeArch:\tfalse,\r\n\t\t\t\t\t\t\t\t\t\tareaDecoration: ''\r\n\t\t\t\t\t\t\t\t\t})]\r\n\r\n\t\t\tif (this._world[edgePointY][edgePointX].isDefined) {\r\n\t\t\t\t\r\n\t\t\t\tif (!this._world[edgePointY - 1][edgePointX].isDefined) {\r\n\t\t\t\t\tthis._world[edgePointY - 1][edgePointX] = grass\r\n\t\t\t\t}\r\n\t\t\t\tif (!this._world[edgePointY + 1][edgePointX].isDefined) {\r\n\t\t\t\t\tthis._world[edgePointY + 1][edgePointX] = grass\r\n\t\t\t\t}\r\n\t\t\t\tif (!this._world[edgePointY][edgePointX - 1].isDefined) {\r\n\t\t\t\t\tthis._world[edgePointY][edgePointX - 1] = grass\r\n\t\t\t\t}\r\n\t\t\t\tif (!this._world[edgePointY][edgePointX + 1].isDefined) {\r\n\t\t\t\t\tthis._world[edgePointY][edgePointX + 1] = grass\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._blockIdIterator++\r\n\t\t}\r\n\r\n\t\t/*\r\n\t\t *\tReset grass tiles beneath pillars and empty tiles below building blocks that\r\n\t\t *\tshould be grass tiles\r\n\t\t */\r\n\r\n\t\tthis._world = this.mods.resetGrassTilesBelowPillars(this);\r\n\r\n\r\n\t\t/* \t\r\n\t\t *\tClear the edges and mirror the building\r\n\t\t */\r\n\r\n\t\tthis._world = this.mods.clearMapEdges(this)\r\n\t\tif (this._mirrorAtCenter) {\r\n\t\t\tthis._world = this.mods.mirrorMap(this)\r\n\t\t}\t\t\r\n\t\t// this.setEdges(true)\r\n\r\n\t\tthis._world = this.deco.placeRandomTrees(this)\r\n\r\n\t\tconsole.log(this._world)\r\n\t}\t\r\n\r\n\tget mapWidth(): number {\r\n\t\treturn this._mapWidth\r\n\t}\r\n\r\n\tget mapLength(): number {\r\n\t\treturn this._mapLength\r\n\t}\r\n\r\n\tget mapHalfLength(): number {\r\n\t\treturn this._mapHalfLength\r\n\t}\r\n\r\n\tget mapEdgeWidth(): number {\r\n\t\treturn this._mapEdgeWidth\r\n\t}\r\n\r\n\tget map(): any[] {\r\n\t\treturn this._world\r\n\t}\r\n\r\n\tget blockGroups(): number[] {\r\n\t\treturn this._blockGroups\r\n\t}\r\n\r\n\tset blockGroups(blockGroups: number[]) {\r\n\t\tthis._blockGroups = blockGroups\r\n\t}\r\n\r\n\tget blockHeight(): number {\r\n\t\treturn this._blockHeight\r\n\t}\r\n\r\n\tget mapMaxHeight(): number {\r\n\t\treturn this._mapMaxHeight\r\n\t}\r\n\r\n\tget startBlockSize(): Dimensions {\r\n\t\treturn { w: this._startBlockWidth, l: this._startBlockLength }\r\n\t}\r\n\r\n\tset blockHeight(height: number) {\r\n\t\tthis._blockHeight = height\r\n\t}\r\n\r\n\tget maxBlockIterations(): number {\r\n\t\treturn this._maximumBlockIterations\r\n\t}\r\n\r\n\tget blockAmountIterator(): number {\r\n\t\treturn this._blockAmountIterator\r\n\t}\r\n\r\n\tset blockAmountIterator(i: number) {\r\n\t\tthis._blockAmountIterator = i\r\n\t}\r\n\r\n\tget averageBuildingSize(): number {\r\n\t\treturn this._averageBuildingSize\r\n\t}\r\n\r\n\tget blockEdges(): object[] {\r\n\t\treturn this._blockEdges\r\n\t}\r\n\r\n\tset blockEdges(blockEdges: object[]) {\r\n\t\tthis._blockEdges = blockEdges\r\n\t}\r\n\r\n\tget blockHeightsArray(): number[] {\r\n\t\treturn this._blockHeightsArray\r\n\t}\r\n\r\n\tset blockHeightsArray(heightsArray: number[]) {\r\n\t\tthis._blockHeightsArray = heightsArray\r\n\t}\r\n\r\n\tget blockIdIterator(): number {\r\n\t\treturn this._blockIdIterator\r\n\t}\r\n\r\n\tset blockIdIterator(i: number) {\r\n\t\tthis._blockIdIterator = i\r\n\t}\r\n\r\n\tget blockHeightVariation(): BuildingHeightVariations {\r\n\t\treturn this._blockHeightVariation\r\n\t}\r\n\r\n\tget lineHeight(): number {\r\n\t\treturn this._decorationLineH\r\n\t}\r\n\r\n\tget groundColor(): Color {\r\n\t\treturn this._groundColor\r\n\t}\r\n\r\n\tget defaultColor(): Color {\r\n\t\treturn this._defaultColor\r\n\t}\r\n\r\n\tget firstLevelColor(): Color {\r\n\t\treturn this._firstLevelColor\r\n\t}\r\n\r\n\tget decorativeColors(): object {\r\n\t\treturn { lineColor: this._lineColor }\r\n\t}\r\n\r\n\tget showWindows(): number {\r\n\t\treturn this._showWindows\r\n\t}\r\n\r\n\tpublic getColumn(x, y): Column {\r\n\t\treturn this._world[y][x]\r\n\t}\r\n\r\n\tpublic getTiles(x, y): Tile[] {\r\n\t\treturn this._world[y][x].tileStack\r\n\t}\r\n\r\n\tpublic getTile(x, y, h): Tile {\r\n\t\treturn this._world[y][x].getTile(h)\r\n\t}\r\n\r\n\tpublic getTopTile(x, y): Tile {\r\n\t\tlet height = this._world[y][x].height\r\n\t\treturn this._world[y][x].getTile(height-1)\r\n\t}\r\n\r\n\tpublic getFirstDefinedColumn(): Column {\r\n\t\tlet column\r\n\r\n\t\tfor (let y = 0; y < this.mapLength; y++) {\r\n\t\t\tfor (let x = 0; x < this.mapWidth; x++) {\r\n\t\t\t\tif (this._world[y][x].isDefined && this._world[y][x].height > 0) {\r\n\t\t\t\t\tcolumn = this._world[y][x]\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn column\r\n\t}\t\r\n\r\n\tsetEdges(considerLowerEdges: boolean): void {\r\n\r\n\t\tfor (let y = 0; y < this.mapLength; y++) {\r\n\t\t\tfor (let x = 0; x < this.mapWidth; x++) {\r\n\t\t\t\t\r\n\t\t\t\tif (y > 0 && x > 0 && y < this.mapLength - 1 && x < this.mapWidth - 1 && this._world[y][x].isDefined) {\r\n\r\n\t\t\t\t\tif (considerLowerEdges) {\r\n\r\n\t\t\t\t\t\tif (this._world[y-1][x].height < this._world[y][x].height || y === 0) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.top = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (this._world[y+1][x].height < this._world[y][x].height || y === this.mapLength - 1) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.bottom = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (this._world[y][x-1].height < this._world[y][x].height) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.left = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (this._world[y][x+1].height < this._world[y][x].height) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.right = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tif (!this._world[y-1][x].isDefined || y === 0) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.top = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!this._world[y+1][x].isDefined || y === this.mapLength - 1) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.bottom = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!this._world[y][x-1].isDefined) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.left = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!this._world[y][x+1].isDefined) {\r\n\t\t\t\t\t\t\tthis._world[y][x].edge.right = true\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( (this._world[y][x].edge.top && this._world[y][x].edge.right) ||\r\n\t\t\t\t\t\t (this._world[y][x].edge.top && this._world[y][x].edge.left) ||\r\n\t\t\t\t\t\t (this._world[y][x].edge.bottom && this._world[y][x].edge.right) ||\r\n\t\t\t\t\t\t (this._world[y][x].edge.bottom && this._world[y][x].edge.left) ) {\r\n\t\t\t\t\t\tthis._world[y][x].corner = true\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getEdges(): Position[] {\r\n\r\n\t\tthis._blockEdges = []\r\n\t\tlet yConditions\t\t\r\n\r\n\t\tfor (let y = 0; y < this._mapLength; y++) {\r\n\t\t\t// only check second half of map\r\n\r\n\t\t\tif (!this._mirrorAtCenter) {\t\r\n\t\t\t\tyConditions = y > 2 && y < this._mapLength - 2\r\n\t\t\t} else {\r\n\t\t\t\tyConditions = y > this._mapHalfLength + (this._blockAmountIterator - 1) && y < this._mapLength - 2\r\n\t\t\t}\r\n\r\n\t\t\tif (yConditions) {\r\n\r\n\t\t\t\tfor (let x = 0; x < this._mapWidth; x++) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (x > this._mapEdgeWidth && x < this._mapWidth - 1) {\r\n\r\n\t\t\t\t\t\tif (this._world[y][x].isDefined) {\r\n\r\n\t\t\t\t\t\t\tif (!this._world[y][x+1].isDefined || \r\n\t\t\t\t\t\t\t\t!this._world[y][x-1].isDefined || \r\n\t\t\t\t\t\t\t\t!this._world[y+1][x].isDefined || \r\n\t\t\t\t\t\t\t\t!this._world[y-1][x+1].isDefined || \r\n\t\t\t\t\t\t\t\t!this._world[y-1][x-1].isDefined) {\r\n\r\n\t\t\t\t\t\t\t\tif (y > this._mapLength - 1) {\r\n\t\t\t\t\t\t\t\t\ty = this._mapLength - 1\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tlet pos: Position = {x: x, y: y}\r\n\r\n\t\t\t\t\t\t\t\tthis._blockEdges.push(pos)\r\n\r\n\t\t\t\t\t\t\t} else if ((!this._world[y-1][x].isDefined && !this._world[y+1][x].isDefined) ||\r\n\t\t\t\t\t\t\t\t(!this._world[y][x-1].isDefined && !this._world[y][x+1].isDefined)) {\r\n\r\n\t\t\t\t\t\t\t\tif (y > this._mapLength - 1) {\r\n\t\t\t\t\t\t\t\t\ty = this._mapLength - 1\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tlet pos: Position = {x: x, y: y}\r\n\r\n\t\t\t\t\t\t\t\tthis._blockEdges.push(pos)\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this._blockEdges\r\n\t}\r\n\r\n\tgetLeastOpenSpaceOnX(): object {\r\n\t\tlet xMinValues = []\r\n\t\tlet xMaxValues = []\r\n\r\n\t\tfor (let y = 0; y < this.mapLength; y++) {\r\n\t\t\t\r\n\t\t\tlet xMin = 0\r\n\t\t\tlet xMax = 0\r\n\t\t\t\r\n\t\t\tfor (let x = 0; x < this.mapWidth; x++) {\r\n\t\t\t\tif (x < Math.floor(this.mapWidth / 2)) {\r\n\t\t\t\t\tif (!this._world[y][x].isDefined && this._world[y][x].height === 0) {\r\n\t\t\t\t\t\txMin++\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!this._world[y][x].isDefined && this._world[y][x].height === 0) {\r\n\t\t\t\t\t\txMax++\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\txMinValues.push(xMin)\r\n\t\t\txMaxValues.push(xMax)\r\n\t\t}\r\n\r\n\t\treturn {'min': Math.min(...xMinValues), 'max': Math.min(...xMaxValues) }\t\t\r\n\t}\r\n\r\n\tpublic addToBuilding(): void {\r\n\t\tthis._world = this.mods.addBuildingComponent(this)\r\n\t\t// this._world = this.mods.mirrorMap(this)\r\n\t\tthis._world = this.mods.clearMapEdges(this)\r\n\t\tthis.setEdges(false)\r\n\t\tconsole.log(this._world)\t\r\n\t}\r\n}","import { Map } from './mapper.component'\r\nimport { Column } from './column.component'\r\nimport { MapGenerationFunctions } from './mapGenerationFunctions.component'\r\nimport { BuildingHeightVariations } from './enums/building-height-variations.enum'\r\nimport { Color } from './colors.component'\r\nimport { Tile } from './tile.component'\r\nimport { TileOptions } from './interfaces/tile-options.interface'\r\nimport { TileType } from './enums/tile-type.enum'\r\nimport { Config } from './config.component'\r\nimport { Position } from './interfaces/position.interface'\r\n\r\nexport class Modifiers {\r\n\r\n\tprivate config: Config = new Config()\r\n\tprivate mapGen: MapGenerationFunctions = new MapGenerationFunctions()\r\n\tprivate _lastBlockHollow: boolean = false\r\n\tprivate _lastBlockShortestSide: number\r\n\r\n\tpublic mirrorMap(world: Map): any[][] {\r\n\r\n\t\tlet oldBlockGroups = []\r\n\t\tworld.blockGroups.forEach(id => {\r\n\t\t\toldBlockGroups.push(id)\r\n\t\t})\r\n\r\n\t\tfor (let y = 0; y < world.mapHalfLength; y++) {\r\n\t\t\tif (y < world.mapHalfLength) {\r\n\t\t\t\t\t\t\t\r\n\t\t\t\tfor (let x = 0; x < world.mapWidth; x++) {\r\n\r\n\t\t\t\t\tif (world.map[world.mapLength - y - 1][x].isDefined) {\r\n\r\n\t\t\t\t\t\tlet activeCol = world.map[world.mapLength - y - 1][x]\r\n\t\t\t\t\t\tlet height = activeCol.height\r\n\r\n\t\t\t\t\t\tif (height > 0) {\r\n\t\t\t\t\t\t\tlet blockGroup = oldBlockGroups.length + activeCol.blockGroup\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlet tileStack = []\r\n\r\n\t\t\t\t\t\t\tfor (let h = 0; h < height; h++) {\r\n\r\n\t\t\t\t\t\t\t\tlet tileColor = activeCol.tileStack[h].tileColor\r\n\r\n\t\t\t\t\t\t\t\tlet thisPillar\r\n\t\t\t\t\t\t\t\tlet slope\r\n\t\t\t\t\t\t\t\tlet thisWindowed\r\n\t\t\t\t\t\t\t\tlet isTower\r\n\t\t\t\t\t\t\t\tlet stairs\r\n\t\t\t\t\t\t\t\tlet isRoof\r\n\t\t\t\t\t\t\t\tlet halfArches\r\n\t\t\t\t\t\t\t\tlet wholeArch\r\n\r\n\t\t\t\t\t\t\t\tif (activeCol.tileStack[h].options) {\r\n\t\t\t\t\t\t\t\t\tthisPillar = activeCol.tileStack[h].options.pillar\r\n\t\t\t\t\t\t\t\t\tslope = activeCol.tileStack[h].options.slope\r\n\t\t\t\t\t\t\t\t\tthisWindowed = activeCol.tileStack[h].options.windowed\r\n\t\t\t\t\t\t\t\t\tisTower = activeCol.tileStack[h].options.tower\r\n\t\t\t\t\t\t\t\t\tstairs = activeCol.tileStack[h].options.stairs\r\n\t\t\t\t\t\t\t\t\tisRoof = (h === height-1) ? true : false\r\n\t\t\t\t\t\t\t\t\thalfArches = activeCol.tileStack[h].options.halfArch\r\n\t\t\t\t\t\t\t\t\twholeArch = activeCol.tileStack[h].options.wholeArch\r\n\r\n\t\t\t\t\t\t\t\t\ttileStack.push(\r\n\t\t\t\t\t\t\t\t\t\tnew Tile(\r\n\t\t\t\t\t\t\t\t\t\t\tworld.blockIdIterator, \r\n\t\t\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\t\t\th, \r\n\t\t\t\t\t\t\t\t\t\t\tactiveCol.tileStack[h].type,\r\n\t\t\t\t\t\t\t\t\t\t\ttileColor,\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\troof: isRoof,\r\n\t\t\t\t\t\t\t\t\t\t\t\tpillar: thisPillar,\r\n\t\t\t\t\t\t\t\t\t\t\t\tslope: slope,\r\n\t\t\t\t\t\t\t\t\t\t\t\twindowed: thisWindowed,\r\n\t\t\t\t\t\t\t\t\t\t\t\ttower: isTower,\r\n\t\t\t\t\t\t\t\t\t\t\t\tstairs:\tstairs,\r\n\t\t\t\t\t\t\t\t\t\t\t\thalfArch: halfArches,\r\n\t\t\t\t\t\t\t\t\t\t\t\twholeArch: wholeArch,\r\n\t\t\t\t\t\t\t\t\t\t\t\tareaDecoration: ''\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttileStack.push(\r\n\t\t\t\t\t\t\t\t\t\tnew Tile(\r\n\t\t\t\t\t\t\t\t\t\t\tworld.blockIdIterator, \r\n\t\t\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\t\t\th, \r\n\t\t\t\t\t\t\t\t\t\t\tactiveCol.tileStack[h].type,\r\n\t\t\t\t\t\t\t\t\t\t\ttileColor,\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\troof:\t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\tpillar: \tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\tslope:\t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\twindowed: \t0,\r\n\t\t\t\t\t\t\t\t\t\t\t\ttower: \t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\tstairs:\t\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\thalfArch: \tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\twholeArch:\tfalse,\r\n\t\t\t\t\t\t\t\t\t\t\t\tareaDecoration: ''\r\n\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t\tworld.blockIdIterator++\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tworld.blockHeightsArray.push(height)\r\n\r\n\t\t\t\t\t\t\tif (world.blockGroups.indexOf(blockGroup) === -1) {\r\n\t\t\t\t\t\t\t\tworld.blockGroups.push(blockGroup)\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tworld.map[y][x] = null\r\n\r\n\t\t\t\t\t\t\tlet column = new Column(true, x, y, height)\r\n\r\n\t\t\t\t\t\t\tcolumn.blockGroup = blockGroup\r\n\t\t\t\t\t\t\tcolumn.height = height\r\n\t\t\t\t\t\t\tcolumn.corner = false\r\n\t\t\t\t\t\t\tcolumn.tileStack = tileStack\r\n\r\n\t\t\t\t\t\t\tworld.map[y][x] = column\r\n\t\t\t\t\t\t} else if(height === 0 && activeCol.isDefined) {\r\n\t\t\t\t\t\t\tworld.map[y][x] = activeCol\r\n\t\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn world.map\r\n\t}\r\n\t\r\n\tpublic clearMapEdges(world: Map): any[][] {\r\n\r\n\t\tfor (let y = 0; y < world.mapLength; y++) {\r\n\t\t\tfor (let x = 1; x < world.mapWidth; x++) {\r\n\t\t\t\tif (x < world.mapEdgeWidth || x >= world.mapWidth ||\r\n\t\t\t\t\ty < world.mapEdgeWidth || y >= world.mapLength - world.mapEdgeWidth) {\r\n\t\t\t\t\tif (world.map[y][x].isDefined && world.map[y][x].height > 0) {\r\n\t\t\t\t\t\tworld.map[y][x] = null\r\n\t\t\t\t\t\tlet column = new Column(false, x, y, 0)\r\n\t\t\t\t\t\tcolumn.tileStack = []\r\n\t\t\t\t\t\tworld.map[y][x] = column\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn world.map\r\n\t}\r\n\r\n\tpublic addBuildingComponent(world: Map): any[][] {\r\n\r\n\t\tconst defaultColor = world.defaultColor\r\n\r\n\t\tif (world.blockAmountIterator < world.maxBlockIterations + 1) {\r\n\r\n\t\t\tconst newBuildingBlockColor = defaultColor.changeColorLighting(-Math.floor(Math.random() * 15))\r\n\r\n\t\t\tworld.blockEdges = world.getEdges()\r\n\r\n\t\t\tif (world.blockEdges.length > 0) {\t\t\t\r\n\r\n\t\t\t\tlet nextHeight\r\n\t\t\t\tlet openFloor = 0\r\n\t\t\t\tlet showWindows = world.showWindows\r\n\t\t\t\tlet shortestSide\r\n\r\n\t\t\t\tif (world.blockAmountIterator === 1) {\r\n\t\t\t\t\tshortestSide = Math.min(world.startBlockSize.w, world.startBlockSize.l)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tshortestSide = this._lastBlockShortestSide\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (world.blockHeightVariation === BuildingHeightVariations.TallCenter) {\r\n\t\t\t\t\tnextHeight = this.config.fibonacci[ world.maxBlockIterations - world.blockAmountIterator + 1 ]\r\n\t\t\t\t} else if (world.blockHeightVariation === BuildingHeightVariations.TallSurrounds) {\r\n\t\t\t\t\tnextHeight = this.config.fibonacci[world.blockAmountIterator + 1]\r\n\t\t\t\t} else if (world.blockHeightVariation === BuildingHeightVariations.Random) {\r\n\t\t\t\t\tlet randomNum = Math.ceil(Math.random() * 4)\r\n\t\t\t\t\tlet randomAdd = Math.round(Math.random())\r\n\t\t\t\t\tif (randomAdd === 0 && world.blockHeight > 3) {\r\n\t\t\t\t\t\tnextHeight = world.blockHeight - randomNum\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnextHeight = world.blockHeight + randomNum\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (nextHeight < 2) {\r\n\t\t\t\t\tnextHeight = 1\r\n\t\t\t\t} else if (nextHeight > world.mapMaxHeight) {\r\n\t\t\t\t\tnextHeight = world.mapMaxHeight\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (nextHeight > 5) {\r\n\t\t\t\t\topenFloor = 2 + Math.floor(Math.random() * 3)\r\n\t\t\t\t}\r\n\r\n\t\t\t\t/* determine which side for placement */\r\n\t\t\t\tlet yHigh = this.mapGen.getHighestYfromArray(world.blockEdges)\r\n\t\t\t\tlet xLow = this.mapGen.getLowestXfromArray(world.blockEdges)\r\n\t\t\t\tlet xHigh = this.mapGen.getHighestXfromArray(world.blockEdges)\r\n\t\t\t\t\r\n\t\t\t\tlet yHighEdges = world.blockEdges.filter((edgePoint: Position) => edgePoint.y === yHigh.y)\r\n\t\t\t\tlet xLowEdges = world.blockEdges.filter((edgePoint: Position) => edgePoint.x === xLow.x)\r\n\t\t\t\tlet xHighEdges = world.blockEdges.filter((edgePoint: Position) => edgePoint.x === xHigh.x)\r\n\r\n\t\t\t\tlet sideSelectionForGeneration = Math.floor(Math.random() * 3)\t\r\n\t\t\t\tif (yHigh.y > world.mapLength - 5) {\r\n\t\t\t\t\tsideSelectionForGeneration = Math.floor(Math.random() * 2)\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlet creationPoint: Position\r\n\t\t\t\tlet nextBlockWidth = shortestSide - world.blockAmountIterator\r\n\t\t\t\tlet nextBlockLength = Math.floor(nextBlockWidth * this.config.goldenRatio)\r\n\t\t\t\tlet yLowEdge, yHighEdge, xLowEdge, xHighEdge\r\n\r\n\t\t\t\t// maybe function to build next block inside last block if too little space?\r\n\r\n\t\t\t\tif (sideSelectionForGeneration === 0) {\r\n\t\t\t\t\t// lowest x point\r\n\t\t\t\t\tlet randomEdgePoint = Math.floor(Math.random() * (xLowEdges.length))\r\n\t\t\t\t\tif (xLowEdges.length > 4) {\r\n\t\t\t\t\t\trandomEdgePoint = 2 + Math.floor(Math.random() * (xLowEdges.length - 2))\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tcreationPoint = xLowEdges[randomEdgePoint]\r\n\r\n\t\t\t\t\tyLowEdge = creationPoint.y - Math.round(nextBlockLength / 2) - 1\r\n\t\t\t\t\tyHighEdge = creationPoint.y + Math.round(nextBlockLength / 2) + 1\r\n\t\t\t\t\txLowEdge = creationPoint.x - nextBlockWidth\r\n\t\t\t\t\txHighEdge = creationPoint.x\r\n\r\n\t\t\t\t} else if (sideSelectionForGeneration === 1) {\r\n\t\t\t\t\t// highest x point\r\n\t\t\t\t\tlet randomEdgePoint = Math.floor(Math.random() * (xHighEdges.length))\r\n\t\t\t\t\tif (xHighEdges.length > 4) {\r\n\t\t\t\t\t\trandomEdgePoint = 2 + Math.floor(Math.random() * (xHighEdges.length - 2))\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t\tcreationPoint = xHighEdges[randomEdgePoint]\r\n\r\n\t\t\t\t\tyLowEdge = creationPoint.y - Math.round(nextBlockLength / 2) - 1\r\n\t\t\t\t\tyHighEdge = creationPoint.y + Math.round(nextBlockLength / 2) + 1\r\n\t\t\t\t\txLowEdge = creationPoint.x\r\n\t\t\t\t\txHighEdge = creationPoint.x + nextBlockWidth\r\n\r\n\t\t\t\t} else if (sideSelectionForGeneration === 2) {\r\n\t\t\t\t\t// highest y point\r\n\t\t\t\t\tlet randomEdgePoint = Math.floor(Math.random() * yHighEdges.length)\r\n\t\t\t\t\tcreationPoint = yHighEdges[randomEdgePoint]\r\n\r\n\t\t\t\t\tyLowEdge = creationPoint.y\r\n\t\t\t\t\tyHighEdge = creationPoint.y + nextBlockLength\r\n\t\t\t\t\txLowEdge = creationPoint.x - Math.round(nextBlockWidth / 2) + 1\r\n\t\t\t\t\txHighEdge = creationPoint.x + Math.round(nextBlockWidth / 2) - 1\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._lastBlockShortestSide = Math.min(nextBlockWidth, nextBlockLength)\r\n\t\t\t\tlet blockGroup = world.blockGroups.length + 1\r\n\t\t\t\tlet manipulateExistingCols = (Math.round(Math.random()) < 1) ? false : true\t\t\t\t\r\n\t\t\t\tlet yStartOffset = 0\r\n\t\t\t\tlet hollowBuildingBlock = Math.round(Math.random()) === 1 ? true : false\r\n\r\n\t\t\t\tif (creationPoint.y + nextBlockLength > world.mapLength - 1) {\r\n\t\t\t\t\tnextBlockLength = world.mapLength - (creationPoint.y + yStartOffset) - 1\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (nextBlockWidth > 4 && nextBlockLength > 4) {\r\n\t\t\t\t\tif (!this._lastBlockHollow) {\r\n\t\t\t\t\t\thollowBuildingBlock = Math.round(Math.random() * 8) > 5 ? true : false\r\n\t\t\t\t\t\tthis._lastBlockHollow = true\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\thollowBuildingBlock = false\r\n\t\t\t\t\t\tthis._lastBlockHollow = false\r\n\t\t\t\t\t}\r\n\t\t\t\t\thollowBuildingBlock = true\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\thollowBuildingBlock = false\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet chanceForHigherSpace = Math.round(Math.random() * 8)\r\n\t\t\t\tlet changeForHighCorridor = true // Math.round(Math.random() * 8) > 5 ? true : false\r\n\t\t\t\t\r\n\t\t\t\tlet yEdgeLowActive = false\r\n\t\t\t\tlet yEdgeHighActive = false\r\n\r\n\t\t\t\tlet createTower = (nextHeight < 7 && Math.round(Math.random() * 8) > 5) ? true : false\r\n\t\t\t\tlet towerLocation = 0\r\n\t\t\t\tif (createTower) {\r\n\t\t\t\t\ttowerLocation = Math.round(Math.random() * 2)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet defaultTileColor = world.getFirstDefinedColumn().tileStack[0].tileColor\t\t\t\t\t\t\t\r\n\r\n\t\t\t\tlet slopeY\r\n\t\t\t\tif (nextHeight < 4) {\r\n\t\t\t\t\tif (Math.round(Math.random() * 5) > 0) {\r\n\t\t\t\t\t\tslopeY = creationPoint.x + Math.ceil(Math.random() * Math.round(nextBlockWidth / 2) - 2)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (let y = 0; y < world.mapLength; y++) {\t\r\n\r\n\t\t\t\t\tif (yLowEdge === y) {\r\n\t\t\t\t\t\tyEdgeLowActive = true\r\n\t\t\t\t\t} else if (yHighEdge === y) {\r\n\t\t\t\t\t\tyEdgeHighActive = true\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tyEdgeLowActive = false\r\n\t\t\t\t\t\tyEdgeHighActive = false\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet xEdgeLowActive = false\r\n\t\t\t\t\tlet xEdgeHighActive = false\r\n\r\n\t\t\t\t\tfor (let x = 0; x < world.mapWidth; x++) {\r\n\r\n\t\t\t\t\t\tif (x === xLowEdge) {\r\n\t\t\t\t\t\t\txEdgeLowActive = true\r\n\t\t\t\t\t\t} else if (x === xHighEdge) {\r\n\t\t\t\t\t\t\txEdgeHighActive = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (y >= yLowEdge && y <= yHighEdge) {\r\n\r\n\t\t\t\t\t\t\tif (x >= xLowEdge && x <= xHighEdge) {\r\n\r\n\t\t\t\t\t\t\t\tlet createCol = true\r\n\r\n\t\t\t\t\t\t\t\tif (hollowBuildingBlock) {\r\n\t\t\t\t\t\t\t\t\tif (y > yLowEdge && y < yHighEdge && x > xLowEdge+1 && x < xHighEdge-1) {\r\n\t\t\t\t\t\t\t\t\t\tcreateCol = false\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (createCol) {\r\n\r\n\t\t\t\t\t\t\t\t\tlet buildTowerHere = false\r\n\r\n\t\t\t\t\t\t\t\t\tif (createTower) {\r\n\t\t\t\t\t\t\t\t\t\tif (towerLocation === 0) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (y <= yLowEdge + 1 && x <= xLowEdge + 1) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tbuildTowerHere = true\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else if (towerLocation === 1) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (y <= yLowEdge + 1 && x >= xHighEdge - 2) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tbuildTowerHere = true\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else if (towerLocation === 2) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (y >= yHighEdge - 1 && x >= xHighEdge - 2) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif ((world.blockHeightVariation !== BuildingHeightVariations.TallCenter)) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tbuildTowerHere = true\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tlet thisHeight = nextHeight\r\n\t\t\t\t\t\t\t\t\tif (buildTowerHere) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('tower built');\r\n\t\t\t\t\t\t\t\t\t\tthisHeight = nextHeight + 5\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tlet tileStack = []\r\n\r\n\t\t\t\t\t\t\t\t\tfor (let h = 0; h < thisHeight; h++) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tlet thisPillar = false\r\n\t\t\t\t\t\t\t\t\t\tlet thisWindowed = 0\r\n\t\t\t\t\t\t\t\t\t\tif (showWindows > 0 && h % 2 === 1) {\r\n\t\t\t\t\t\t\t\t\t\t\tthisWindowed = showWindows\r\n\t\t\t\t\t\t\t\t\t\t}\t\r\n\t\t\t\t\t\t\t\t\t\tlet isRoof = (h === thisHeight-1) ? true : false\r\n\t\t\t\t\t\t\t\t\t\tlet slope = false\r\n\t\t\t\t\t\t\t\t\t\tif (h < nextHeight) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (y === slopeY && x === creationPoint.x + Math.round(nextBlockWidth / 2) - h) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tslope = true\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\t\r\n\t\t\t\t\t\t\t\t\t\tlet tileColor = newBuildingBlockColor\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tlet tileType = TileType.Body\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tlet isTower = false\r\n\t\t\t\t\t\t\t\t\t\tif (buildTowerHere) {\r\n\t\t\t\t\t\t\t\t\t\t\tisTower = true\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tlet stairs = false\r\n\t\t\t\t\t\t\t\t\t\tlet thisHalfArch = false\r\n\t\t\t\t\t\t\t\t\t\tlet thisWholeArch = false\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (thisHeight > 4) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (changeForHighCorridor) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (nextBlockLength > 4 && nextBlockLength < 6) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet maxWallPoint = creationPoint.y + 5\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (creationPoint.y + 5 > creationPoint.y + (nextBlockLength / 2)) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaxWallPoint = creationPoint.y + 4\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (y > creationPoint.y + 1 && y < maxWallPoint) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (h < thisHeight - 2) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (creationPoint.y + 5 > 27) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (y % 2 === 0 && x % 2 !== 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthisPillar = true\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (h === thisHeight - 3) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthisHalfArch = true\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} \r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (nextBlockLength === 6) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (y === yLowEdge + 1 || \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ty === yLowEdge + 2 ||\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ty === yHighEdge - 2 ||\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ty === yHighEdge - 3) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (h < thisHeight - 2) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (h === thisHeight - 3) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthisHalfArch = true\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (nextBlockLength === 8) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (y === yLowEdge + 1 || \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ty === yLowEdge + 2 ||\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ty === yLowEdge + 4 ||\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ty === yLowEdge + 5) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (h < thisHeight - 2) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (h === thisHeight - 3) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthisHalfArch = true\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (y === yLowEdge + 3 || y === yLowEdge + 6) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttileType = TileType.Body\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthisHalfArch = false\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (nextBlockWidth === 6) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (x === xLowEdge + 1 || \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tx === xLowEdge + 2 ||\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tx === xHighEdge - 2 ||\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tx === xHighEdge - 3) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (h < thisHeight - 2) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (h === thisHeight - 3) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthisHalfArch = true\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (nextBlockWidth === 8) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (x === xLowEdge + 1 || \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tx === xLowEdge + 2 ||\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tx === xLowEdge + 4 ||\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tx === xLowEdge + 5) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (h < thisHeight - 2) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (h === thisHeight - 3) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthisHalfArch = true\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (x === xLowEdge + 3 || x === xLowEdge + 6) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttileType = TileType.Body\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthisHalfArch = false\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (chanceForHigherSpace > 4) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (openFloor > 0 && (h === openFloor || h+1 === openFloor)) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (y % 2 === 0 && x % 2 !== 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthisPillar = true\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (thisHeight > 7 && openFloor > 0 && h > openFloor && h < openFloor + 4) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttileType = TileType.None\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (y % 2 === 0 && x % 2 !== 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthisPillar = true\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (h === world.lineHeight) {\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\ttileColor = world.decorativeColors['lineColor']\r\n\t\t\t\t\t\t\t\t\t\t} else if (h === 0) {\r\n\t\t\t\t\t\t\t\t\t\t\ttileColor = world.firstLevelColor\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\ttileColor = newBuildingBlockColor\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (world.map[y][x].isDefined) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (world.map[y][x].tileStack[0].type === TileType.Grass) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (h === 0 && tileType === TileType.None) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttileType = TileType.Grass\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttileColor = world.map[y][x].tileStack[0].tileColor\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t\t\t\ttileStack.push(\r\n\t\t\t\t\t\t\t\t\t\t\tnew Tile(\r\n\t\t\t\t\t\t\t\t\t\t\t\tworld.blockIdIterator, \r\n\t\t\t\t\t\t\t\t\t\t\t\tx, \r\n\t\t\t\t\t\t\t\t\t\t\t\ty, \r\n\t\t\t\t\t\t\t\t\t\t\t\th, \r\n\t\t\t\t\t\t\t\t\t\t\t\ttileType,\r\n\t\t\t\t\t\t\t\t\t\t\t\ttileColor,\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\troof: isRoof,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpillar: thisPillar,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tslope: slope,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twindowed: thisWindowed,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttower: isTower,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstairs:\tstairs,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\thalfArch: thisHalfArch,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twholeArch: thisWholeArch,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tareaDecoration: ''\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t)\t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t\t\t\tworld.blockHeightsArray.push(thisHeight)\r\n\r\n\t\t\t\t\t\t\t\t\t\tworld.blockIdIterator++\r\n\r\n\t\t\t\t\t\t\t\t\t\ttileColor = undefined\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (world.blockGroups.indexOf(blockGroup) === -1) {\r\n\t\t\t\t\t\t\t\t\t\tworld.blockGroups.push(blockGroup)\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tworld.map[y][x] = null\r\n\r\n\t\t\t\t\t\t\t\t\tlet column = new Column(true, x, y, thisHeight)\r\n\r\n\t\t\t\t\t\t\t\t\tcolumn.blockGroup = blockGroup\r\n\t\t\t\t\t\t\t\t\tcolumn.height = thisHeight\r\n\t\t\t\t\t\t\t\t\tcolumn.corner = false\r\n\t\t\t\t\t\t\t\t\tcolumn.tileStack = tileStack\r\n\r\n\t\t\t\t\t\t\t\t\tworld.map[y][x] = column\t\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tworld.blockHeight = nextHeight\r\n\r\n\t\t\t\tworld.blockAmountIterator++\r\n\r\n\t\t\t} else {\t\t\r\n\t\t\t\tconsole.warn(\"Block edges array is empty.\")\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Cannot add more building components, maximum block iterations reached.\")\r\n\t\t}\r\n\r\n\t\treturn world.map\r\n\t}\r\n\r\n\tpublic removeExcessArches(world: Map) {\r\n\r\n\t\tfor (let y = 0; y < world.mapLength; y++) {\r\n\r\n\t\t\tfor (let x = 0; x < world.mapWidth; x++) {\r\n\r\n\t\t\t\tif (y > 0 && x > 0 && y < world.mapLength - 2 && x < world.mapWidth - 2) {\r\n\r\n\t\t\t\t\tif (world.map[y][x].isDefined) {\r\n\r\n\t\t\t\t\t\tfor (let h = 0; h < world.map[y][x].height; h++) {\r\n\r\n\t\t\t\t\t\t\tif (world.map[y][x].tileStack[h].type === TileType.None && world.map[y][x].tileStack[h].options.halfArch) {\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (world.map[y - 1][x].isDefined && world.map[y - 1][x].height > 0 && world.map[y - 1][x].height === world.map[y][x].height) {\r\n\r\n\t\t\t\t\t\t\t\t\tif (world.map[y - 1][x].tileStack[h].options.halfArch) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('y + 1', world.map[y + 1][x])\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (world.map[y + 1][x].isDefined && world.map[y + 1][x].height > 0 && world.map[y + 1][x].height === world.map[y][x].height) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif (world.map[y + 1][x].tileStack[h].options.halfArch) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tworld.map[y][x].tileStack[h].options.halfArch = false;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('y + 2', world.map[y + 2][x])\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (world.map[y + 2][x].isDefined && world.map[y + 2][x].height > 0 && world.map[y + 2][x].height === world.map[y][x].height) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif (world.map[y + 2][x].tileStack[h].options.halfArch) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tworld.map[y + 1][x].tileStack[h].options.halfArch = false;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (x > 1 && x < world.mapWidth - 3) {\r\n\r\n\t\t\t\t\t\t\t\t\tif (world.map[y][x - 1].isDefined && world.map[y][x - 1].height === world.map[y][x].height) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (world.map[y][x - 1].tileStack[h].options.halfArch) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif (world.map[y][x + 1].isDefined && world.map[y][x + 1].height === world.map[y][x].height) {\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (world.map[y][x + 1].tileStack[h].options.halfArch) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tworld.map[y][x].tileStack[h].options.halfArch = false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('x + 2', world.map[y + 2][x])\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif (world.map[y][x + 2].isDefined && \r\n\t\t\t\t\t\t\t\t\t\t\t\tworld.map[y][x + 1].height === world.map[y][x].height && \r\n\t\t\t\t\t\t\t\t\t\t\t\tworld.map[y][x + 2].height === world.map[y][x].height) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (world.map[y][x + 2].tileStack[h].options.halfArch) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tworld.map[y][x + 1].tileStack[h].options.halfArch = false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn world.map;\r\n\r\n\t}\r\n\r\n\tpublic resetGrassTilesBelowPillars (world: Map) {\r\n\r\n\t\tfor (let y = 0; y < world.mapLength; y++) {\r\n\r\n\t\t\tfor (let x = 0; x < world.mapWidth; x++) {\r\n\r\n\t\t\t\tif (y > 0 && x > 0 && y < world.mapLength - 1 && x < world.mapWidth - 1) {\r\n\r\n\t\t\t\t\tif (world.map[y][x].isDefined && world.map[y][x].height > 0 && world.map[y][x].tileStack[0].type === TileType.None) {\r\n\r\n\t\t\t\t\t\tif ((world.map[y - 1][x].isDefined && world.map[y - 1][x].tileStack[0].type === TileType.Grass) ||\r\n\t\t\t\t\t\t\t(world.map[y + 1][x].isDefined && world.map[y + 1][x].tileStack[0].type === TileType.Grass) ||\r\n\t\t\t\t\t\t\t(world.map[y][x - 1].isDefined && world.map[y][x - 1].tileStack[0].type === TileType.Grass) ||\r\n\t\t\t\t\t\t\t(world.map[y][x + 1].isDefined && world.map[y][x + 1].tileStack[0].type === TileType.Grass)) {\r\n\r\n\t\t\t\t\t\t\tconsole.log('should be grass tile!')\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn world.map;\r\n\r\n\t}\r\n}","export class Primitives {\r\n\r\n\tgetPyramid(mapWidth: number, mapLength: number): number[][] {\r\n\r\n\t\tlet map = [],\r\n\t\t\twidth = Math.min(mapWidth, mapLength),\r\n\t\t\theight = Math.min(mapWidth, mapLength),\r\n\t\t\twidthHalf = Math.floor(width / 2),\r\n\t\t\theightHalf = Math.floor(height / 2),\r\n\t\t\tquarter = [];\r\n\r\n\t\tfor (let y = 0; y < width; y++) {\r\n\t\t\tmap[y] = []\r\n\t\t\tfor (let x = 0; x < height; x++) {\r\n\t\t\t\tif (y < Math.round(height / 2) && x < Math.round(width / 2)) {  \r\n\t\t\t\t\tmap[y][x] = Math.min(y, x)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmap[y][x] = Math.max(y, x)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let y = 0; y < widthHalf; y++) {\r\n\t\t\tquarter[y] = []\r\n\t\t\tfor (let x = 0; x < heightHalf; x++) {\r\n\t\t\t\tif (y < heightHalf && x < widthHalf) { \r\n\t\t\t\t\tquarter[y][x] = map[y][x]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet quarterRev = quarter.reverse()\r\n\r\n\t\tfor (let y = 0; y < width; y++) {\r\n\t\t\tfor (let x = 0; x < height; x++) {\r\n\t\t\t  \tif (y > heightHalf - 1 && x < widthHalf) {\r\n\t\t\t    \tmap[y][x] = quarterRev[y - heightHalf][x]\r\n\t\t\t    }\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let y = 0; y < width; y++) {\r\n\t\t\tfor (let x = 0; x < height; x++) {\r\n\t\t\t  \tif (x > widthHalf - 1) {\r\n\t\t\t    \tmap[y][x] = map[y][width - x - 1]\r\n\t\t\t    }\r\n\t\t  \t}\r\n\t\t}\r\n\r\n\t\treturn map\r\n\t}\r\n}","import { Config } from './config.component'\r\nimport { MapGenerationFunctions } from './mapGenerationFunctions.component'\r\nimport { Color } from './colors.component'\r\nimport { Tile } from './tile.component'\r\nimport { TileType } from './enums/tile-type.enum'\r\nimport { Coords } from './interfaces/coords.interface'\r\nimport { TileTemplate } from './interfaces/tiletemplate.interface'\r\nimport { Position } from './interfaces/position.interface'\r\nimport { Column } from './column.component'\r\nimport { ColumnEdge } from './interfaces/column-edge.interface'\r\n\r\nexport class RenderElements {\r\n\r\n\tprivate config: Config = new Config()\r\n\tprivate calculations: MapGenerationFunctions = new MapGenerationFunctions()\r\n\r\n\tprivate tileW: number = this.config.tileWidth\r\n\tprivate tileL: number = this.config.tileLength\r\n\tprivate tileH: number = this.config.tileHeight\r\n\tprivate bleed: number = this.config.tileEdgeBleed\r\n\tprivate dimensions = this.calculations.calculateStraightLinesFromIsometricSquare(this.tileW, this.tileL)\r\n\r\n\tprivate tileColor: Color = this.config.groundColor\r\n\r\n\tgetPositions(xPos: number, yPos: number, topMargin: number = 0) {\t\t\r\n\t\tconst top: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromTop), \"y\": Math.ceil(yPos + topMargin ) }\r\n\t\tconst left: Position = { \"x\": Math.ceil(xPos), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromTop + topMargin ) }\r\n\t\tconst bottom: Position = { \"x\": Math.ceil(xPos + this.dimensions.horizontalWidthFromBottom), \"y\": Math.ceil(yPos + this.dimensions.totalHeight + topMargin ) }\r\n\t\tconst right: Position = { \"x\": Math.ceil(xPos + this.dimensions.totalWidth), \"y\": Math.ceil(yPos + this.dimensions.verticalHeightFromBottom + topMargin ) }\r\n\r\n\t\treturn { top, left, bottom, right }\r\n\t}\r\n\r\n\tcreateTile(xPos: number, yPos: number, shadow: string): TileTemplate {\r\n\r\n\t\t// let top: Position = { \"x\": (xPos + this.dimensions.horizontalWidthFromTop), \"y\": yPos}\r\n\t\t// let left: Position = { \"x\": xPos, \"y\": (yPos + this.dimensions.verticalHeightFromTop) }\r\n\t\t// let bottom: Position = { \"x\": (xPos + this.dimensions.horizontalWidthFromBottom), \"y\": (yPos + this.dimensions.totalHeight) }\r\n\t\t// let right: Position = { \"x\": (xPos + this.dimensions.totalWidth), \"y\": (yPos + this.dimensions.verticalHeightFromBottom) }\r\n\r\n\t\tconst { top, left, bottom, right } = this.getPositions(xPos, yPos, 0)\r\n\r\n\t\tlet pointTop = `${top.x} ${top.y-this.bleed}`\r\n\t\tlet pointLeft = `${left.x-this.bleed} ${left.y}`\r\n\t\tlet pointBottom = `${bottom.x} ${bottom.y+this.bleed}`\r\n\t\tlet pointRight = `${right.x+this.bleed} ${right.y}`\r\n\r\n\t\tlet tileColor = this.tileColor.hex()\r\n\t\tif (shadow === 'shade') {\r\n\t\t\ttileColor = this.tileColor.changeColorLightingString(-50)\r\n\t\t}\r\n\r\n\t\tvar html = `<path fill=\"${tileColor}\"\r\n\t\t\t\t\td=\"M${pointLeft} \r\n\t\t\t\t\tL${pointBottom} \r\n\t\t\t\t\tL${pointRight} \r\n\t\t\t\t\tL${pointTop} \r\n\t\t\t\t\tL${pointLeft} Z\" />`\r\n\r\n\t\tlet coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreatePlane(xPos: number, yPos: number, tile: Tile, color: Color = this.config.groundColor): TileTemplate {\r\n\r\n\t\tconst id = tile.id\r\n\t\tconst height = (tile.h * this.tileH) - this.tileH\r\n\r\n\t\tlet regularColor = color.hex()\r\n\r\n\t\tconst { top, left, bottom, right } = this.getPositions(xPos, yPos, this.config.topMargin)\r\n\r\n\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y}`\r\n\t\tlet blockTopBottom = `${bottom.x} ${bottom.y}`\r\n\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y}`\r\n\t\tlet blockTopTop = `${top.x} ${top.y}`\r\n\r\n\t\tlet html = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\tL${blockTopBottom} \r\n\t\t\t\t\tL${blockTopRight} \r\n\t\t\t\t\tL${blockTopTop} \r\n\t\t\t\t\tL${blockTopLeft} Z\" /></g>`\r\n\r\n\t\tlet coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreateBlock(xPos: number, yPos: number, tile: Tile, topTile: boolean | string = false): TileTemplate {\r\n\r\n\t\tconst id = tile.id\r\n\t\tconst height = (tile.h * this.tileH) - this.tileH\r\n\r\n\t\tlet regularColor\r\n\t\tlet highlight\r\n\t\tlet darkestColor\r\n\t\tlet patternColor\r\n\r\n\t\tif (tile.tileColor.hex() !== this.config.buildingBaseColor.hex()) {\r\n\t\t\tregularColor = tile.tileColor.hex()\r\n\t\t\thighlight = tile.tileColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = tile.tileColor.changeColorLightingString(-60)\r\n\t\t\tpatternColor = tile.tileColor.changeColorLightingString(15)\r\n\t\t} else {\r\n\t\t\tregularColor = this.config.buildingBaseColor.hex()\r\n\t\t\thighlight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = this.config.buildingBaseColor.changeColorLightingString(-60)\r\n\t\t\tpatternColor = this.config.buildingBaseColor.changeColorLightingString(15)\r\n\t\t}\r\n\r\n\t\tconst { top, left, bottom, right } = this.getPositions(xPos, yPos, this.config.topMargin)\r\n\r\n\t\tconst leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\tconst leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\tconst leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\tconst leftWallRightTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\r\n\t\tconst rightWallLeftTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\tconst rightWallLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\tconst rightWallRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\tconst rightWallRightTop = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\r\n\t\tconst blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\tconst blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\tconst blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\t\tconst blockTopTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\tlet html = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\td=\"M${leftWallLeftTop} \r\n\t\t\t\t\tL${leftWallLeftBottom} \r\n\t\t\t\t\tL${leftWallRightBottom} \r\n\t\t\t\t\tL${leftWallRightTop} \r\n\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\td=\"M${rightWallLeftTop} \r\n\t\t\t\t\tL${rightWallLeftBottom} \r\n\t\t\t\t\tL${rightWallRightBottom} \r\n\t\t\t\t\tL${rightWallRightTop} \r\n\t\t\t\t\tL${rightWallLeftTop} Z\" />`\r\n\r\n\t\tif (topTile === 'triangles') {\r\n\r\n\t\t\tconst margin = 2;\r\n\r\n\t\t\tconst blockTopTileLeft = `${left.x-this.bleed+margin} ${left.y-height-this.tileH}`\r\n\t\t\tconst blockTopTileBottom = `${bottom.x} ${bottom.y-height-this.tileH-(margin/2)}`\r\n\t\t\tconst blockTopTileRight = `${right.x+this.bleed-margin} ${right.y-height-this.tileH}`\r\n\t\t\tconst blockTopTileTop = `${top.x} ${top.y-height-this.tileH+(margin/1.5)}`\r\n\r\n\t\t\tconst blockTopCenter = { x: left.x + ((right.x - left.x) / 2), y: (top.y + ((bottom.y - top.y) / 2)) }\r\n\r\n\t\t\tconst blockTopCenterLeftMargin = `${blockTopCenter.x - (margin /2)} ${blockTopCenter.y}`\r\n\t\t\tconst blockTopCenterBottomMargin = `${blockTopCenter.x} ${blockTopCenter.y + (margin /2)}`\r\n\t\t\tconst blockTopCenterRightMargin = `${blockTopCenter.x + (margin /2)} ${blockTopCenter.y}`\r\n\t\t\tconst blockTopCenterTopMargin = `${blockTopCenter.x} ${blockTopCenter.y - (margin /2)}`\r\n\r\n\t\t\tconst blockTopLeftTopCenter = `${left.x + ((top.x - left.x) / 2)} ${top.y + ((left.y - top.y) / 2) - height - this.tileH}`\r\n\t\t\tconst blockTopLeftBottomCenter = `${left.x + ((bottom.x - left.x) / 2)} ${bottom.y - ((bottom.y - left.y) / 2) - height - this.tileH}`\r\n\t\t\tconst blockTopRightBottomCenter = `${right.x - ((right.x - bottom.x) / 2)} ${bottom.y - ((right.y - top.y) / 2) - height - this.tileH}`\r\n\t\t\tconst blockTopRightTopCenter = `${right.x - ((right.x - top.x) / 2)} ${right.y + ((bottom.y - right.y) / 2) - height - this.tileH}`\r\n\r\n\t\t\thtml += `<path fill=\"${highlight}\"\r\n\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\tL${blockTopBottom} \r\n\t\t\t\t\tL${blockTopRight} \r\n\t\t\t\t\tL${blockTopTop} \r\n\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t<path fill=\"transparent\" stroke=\"${patternColor}\"\r\n\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\tL${blockTopBottom} \r\n\t\t\t\t\tL${blockTopRight} \r\n\t\t\t\t\tL${blockTopTop} \r\n\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t<path fill=\"transparent\" stroke=\"${patternColor}\"\r\n\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\tL${blockTopRight}\" />\r\n\t\t\t\t\t<path fill=\"transparent\" stroke=\"${patternColor}\"\r\n\t\t\t\t\td=\"M${blockTopTop} \r\n\t\t\t\t\tL${blockTopBottom}\" />`\r\n\r\n\t\t} else if (topTile === 'squares') {\r\n\r\n\t\t\tconst margin = 2;\r\n\r\n\t\t\tconst blockTopTileLeft = `${left.x-this.bleed+margin} ${left.y-height-this.tileH}`\r\n\t\t\tconst blockTopTileBottom = `${bottom.x} ${bottom.y-height-this.tileH-(margin/2)}`\r\n\t\t\tconst blockTopTileRight = `${right.x+this.bleed-margin} ${right.y-height-this.tileH}`\r\n\t\t\tconst blockTopTileTop = `${top.x} ${top.y-height-this.tileH+(margin/1.5)}`\r\n\r\n\t\t\tconst blockTopCenter = { x: left.x + ((right.x - left.x) / 2), y: (top.y + ((bottom.y - top.y) / 2)) }\r\n\r\n\t\t\tconst blockTopCenterLeftMargin = `${blockTopCenter.x - (margin /2)} ${blockTopCenter.y}`\r\n\t\t\tconst blockTopCenterBottomMargin = `${blockTopCenter.x} ${blockTopCenter.y + (margin /2)}`\r\n\t\t\tconst blockTopCenterRightMargin = `${blockTopCenter.x + (margin /2)} ${blockTopCenter.y}`\r\n\t\t\tconst blockTopCenterTopMargin = `${blockTopCenter.x} ${blockTopCenter.y - (margin /2)}`\r\n\r\n\t\t\tconst blockTopLeftTopCenter = `${left.x + ((top.x - left.x) / 2)} ${top.y + ((left.y - top.y) / 2) - height - this.tileH}`\r\n\t\t\tconst blockTopLeftBottomCenter = `${left.x + ((bottom.x - left.x) / 2)} ${bottom.y - ((bottom.y - left.y) / 2) - height - this.tileH}`\r\n\t\t\tconst blockTopRightBottomCenter = `${right.x - ((right.x - bottom.x) / 2)} ${bottom.y - ((right.y - top.y) / 2) - height - this.tileH}`\r\n\t\t\tconst blockTopRightTopCenter = `${right.x - ((right.x - top.x) / 2)} ${right.y + ((bottom.y - right.y) / 2) - height - this.tileH}`\r\n\r\n\t\t\thtml += `<path fill=\"${highlight}\"\r\n\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\tL${blockTopBottom} \r\n\t\t\t\t\tL${blockTopRight} \r\n\t\t\t\t\tL${blockTopTop} \r\n\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t<path fill=\"transparent\" stroke=\"${patternColor}\"\r\n\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\tL${blockTopBottom} \r\n\t\t\t\t\tL${blockTopRight} \r\n\t\t\t\t\tL${blockTopTop} \r\n\t\t\t\t\tL${blockTopLeft} Z\" />`\r\n\t\t} else {\r\n\r\n\t\t\thtml += `<path fill=\"${highlight}\"\r\n\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\tL${blockTopBottom} \r\n\t\t\t\t\tL${blockTopRight} \r\n\t\t\t\t\tL${blockTopTop} \r\n\t\t\t\t\tL${blockTopLeft} Z\" />`\r\n\t\t}\r\n\t\t\t\t\t\r\n\t\thtml +=\t`</g>`\r\n\r\n\t\tconst coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreateHalfBlock(xPos: number, yPos: number, tile: Tile): TileTemplate {\r\n\r\n\t\tconst id = tile.id\r\n\t\tconst height = (tile.h * this.tileH) - this.tileH\r\n\r\n\t\tlet regularColor\r\n\t\tlet highlight\r\n\t\tlet darkestColor\r\n\t\tlet strokeColor\r\n\r\n\t\tif (tile.tileColor.hex() !== this.config.buildingBaseColor.hex()) {\r\n\t\t\tregularColor = tile.tileColor.hex()\r\n\t\t\thighlight = tile.tileColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = tile.tileColor.changeColorLightingString(-60)\r\n\t\t\tstrokeColor = tile.tileColor.changeColorLightingString(10)\r\n\t\t} else {\r\n\t\t\tregularColor = this.config.buildingBaseColor.hex()\r\n\t\t\thighlight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = this.config.buildingBaseColor.changeColorLightingString(-60)\r\n\t\t\tstrokeColor = this.config.buildingBaseColor.changeColorLightingString(10)\r\n\t\t}\t\r\n\r\n\t\tconst { top, left, bottom, right } = this.getPositions(xPos, yPos, this.config.topMargin)\r\n\r\n\t\tconst leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-(this.tileH / 2)}`\r\n\t\tconst leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\tconst leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\tconst leftWallRightTop = `${bottom.x} ${bottom.y-height-(this.tileH / 2)}`\r\n\r\n\t\tconst rightWallLeftTop = `${bottom.x} ${bottom.y-height-(this.tileH / 2)}`\r\n\t\tconst rightWallLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\tconst rightWallRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\tconst rightWallRightTop = `${right.x+this.bleed} ${right.y-height-(this.tileH / 2)}`\r\n\r\n\t\tconst blockTopLeft = `${left.x-this.bleed} ${left.y-height-(this.tileH / 2)}`\r\n\t\tconst blockTopBottom = `${bottom.x} ${bottom.y-height-(this.tileH / 2)}`\r\n\t\tconst blockTopRight = `${right.x+this.bleed} ${right.y-height-(this.tileH / 2)}`\r\n\t\tconst blockTopTop = `${top.x} ${top.y-height-(this.tileH / 2)}`\r\n\r\n\t\tconst blockTopCenter = `${(left.x + ((right.x - left.x) / 2))} ${(top.y + ((bottom.y - top.y) / 2))}`\r\n\r\n\t\tconst html = `<g style=\"z-index:${id};\"><path fill=\"${darkestColor}\"\r\n\t\t\t\t\td=\"M${leftWallLeftTop} \r\n\t\t\t\t\tL${leftWallLeftBottom} \r\n\t\t\t\t\tL${leftWallRightBottom} \r\n\t\t\t\t\tL${leftWallRightTop} \r\n\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\td=\"M${rightWallLeftTop} \r\n\t\t\t\t\tL${rightWallLeftBottom} \r\n\t\t\t\t\tL${rightWallRightBottom} \r\n\t\t\t\t\tL${rightWallRightTop} \r\n\t\t\t\t\tL${rightWallLeftTop} Z\" />\r\n\t\t\t\t\t<path fill=\"${highlight}\"\r\n\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\tL${blockTopBottom} \r\n\t\t\t\t\tL${blockTopRight} \r\n\t\t\t\t\tL${blockTopTop} \r\n\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t<path fill=\"transparent\" stroke=\"${strokeColor}\"\r\n\t\t\t\t\td=\"M${blockTopRight}\r\n\t\t\t\t\tL${blockTopLeft}\r\n\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\tL${blockTopTop}\" />\r\n\t\t\t\t\t</g>`\r\n\r\n\t\tconst coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreateSlopeBlock(xPos: number, yPos: number, tile: Tile, slopeDirection: string): TileTemplate {\r\n\r\n\t\tconst id = tile.id\r\n\t\tconst height = (tile.h * this.tileH) - this.tileH\r\n\t\tlet regularColor: string\r\n\t\tlet regularDarkerColor: string\r\n\t\tlet regularLighterColor: string\r\n\t\tlet shadowLight: string\r\n\t\tlet shadowHighlight: string\r\n\t\tlet shadow: string\r\n\t\tlet highlight: string\r\n\t\tlet almostDarkestColor: string\r\n\t\tlet almostLightestColor: string\r\n\t\tlet darkestColor: string\r\n\t\tlet lightestColor: string\r\n\r\n\t\tif (tile.tileColor.hex() !== this.config.buildingBaseColor.hex()) {\r\n\t\t\tregularColor = tile.tileColor.hex()\r\n\t\t\tregularDarkerColor = tile.tileColor.changeColorLightingString(-10)\r\n\t\t\tregularLighterColor = tile.tileColor.changeColorLightingString(10)\r\n\t\t\tshadowLight = tile.tileColor.changeColorLightingString(-20)\r\n\t\t\tshadowHighlight = tile.tileColor.changeColorLightingString(20)\r\n\t\t\tshadow = tile.tileColor.changeColorLightingString(-30)\r\n\t\t\thighlight = tile.tileColor.changeColorLightingString(30)\r\n\t\t\talmostDarkestColor = tile.tileColor.changeColorLightingString(-40)\r\n\t\t\talmostLightestColor = tile.tileColor.changeColorLightingString(40)\r\n\t\t\tdarkestColor = tile.tileColor.changeColorLightingString(-60)\r\n\t\t\tlightestColor = tile.tileColor.changeColorLightingString(50)\r\n\t\t} else {\r\n\t\t\tregularColor = this.config.buildingBaseColor.hex()\r\n\t\t\tregularDarkerColor = this.config.buildingBaseColor.changeColorLightingString(-10)\r\n\t\t\tregularLighterColor = this.config.buildingBaseColor.changeColorLightingString(10)\r\n\t\t\tshadowLight = this.config.buildingBaseColor.changeColorLightingString(-20)\r\n\t\t\tshadowHighlight = this.config.buildingBaseColor.changeColorLightingString(20)\r\n\t\t\tshadow = this.config.buildingBaseColor.changeColorLightingString(-30)\r\n\t\t\thighlight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t\talmostDarkestColor = this.config.buildingBaseColor.changeColorLightingString(-40)\r\n\t\t\talmostLightestColor = this.config.buildingBaseColor.changeColorLightingString(40)\r\n\t\t\tdarkestColor = this.config.buildingBaseColor.changeColorLightingString(-60)\r\n\t\t\tlightestColor = this.config.buildingBaseColor.changeColorLightingString(50)\r\n\t\t}\r\n\r\n\t\tconst { top, left, bottom, right } = this.getPositions(xPos, yPos)\r\n\r\n\t\tlet html = ''\r\n\t\tlet coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\tif (slopeDirection === 'n') {\r\n\r\n\t\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\r\n\t\t\tlet rightWallLeftTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\t\tlet rightWallLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet rightWallRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${shadow}\"\r\n\t\t\t\t\t\t\td=\"M${leftWallLeftTop} \r\n\t\t\t\t\t\t\tL${leftWallLeftBottom} \r\n\t\t\t\t\t\t\tL${leftWallRightBottom} \r\n\t\t\t\t\t\t\tL${leftWallRightTop} \r\n\t\t\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\t\t\td=\"M${rightWallLeftTop}\r\n\t\t\t\t\t\t\tL${rightWallLeftBottom}\r\n\t\t\t\t\t\t\tL${rightWallRightBottom}\r\n\t\t\t\t\t\t\tL${rightWallLeftTop} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${lightestColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'nw') {\r\n\r\n\t\t\tconsole.log('northwest')\r\n\r\n\t\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height}`\r\n\t\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height-this.tileH+this.bleed}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\tlet blockRightBottom = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\t\tlet blockRightRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet blockRightTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\t\td=\"M${leftWallLeftTop}\r\n\t\t\t\t\t\t\tL${leftWallLeftBottom}\r\n\t\t\t\t\t\t\tL${leftWallRightBottom}\r\n\t\t\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${lightestColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockRightBottom}\r\n\t\t\t\t\t\t\tL${blockRightRight}\r\n\t\t\t\t\t\t\tL${blockRightTop}\r\n\t\t\t\t\t\t\tL${blockRightBottom} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 's') {\r\n\r\n\t\t\tlet rightWallLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet rightWallRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet rightWallRightTop = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\t\t\td=\"M${rightWallLeftBottom}\r\n\t\t\t\t\t\t\tL${rightWallRightBottom}\r\n\t\t\t\t\t\t\tL${rightWallRightTop}\r\n\t\t\t\t\t\t\tL${rightWallLeftBottom} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${shadow}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'se') {\r\n\r\n\t\t\tlet blockLeftLeft = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet blockLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockLeftTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\t\tlet blockRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockRightRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet blockRightTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t<path fill=\"${shadow}\"\r\n\t\t\t\t\t\td=\"M${blockLeftLeft}\r\n\t\t\t\t\t\tL${blockLeftBottom}\r\n\t\t\t\t\t\tL${blockLeftTop}\r\n\t\t\t\t\t\tL${blockLeftLeft} Z\" />\r\n\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\td=\"M${blockRightRight}\r\n\t\t\t\t\t\tL${blockRightBottom}\r\n\t\t\t\t\t\tL${blockRightTop}\r\n\t\t\t\t\t\tL${blockRightRight} Z\" />\r\n\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'e') {\r\n\r\n\t\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\t\td=\"M${leftWallLeftTop}\r\n\t\t\t\t\t\t\tL${leftWallLeftBottom}\r\n\t\t\t\t\t\t\tL${leftWallRightBottom}\r\n\t\t\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'ne') {\r\n\r\n\t\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\r\n\t\t\tlet blockBottomLeft = `${left.x-this.bleed} ${left.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockBottomRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet blockBottomTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\td=\"M${leftWallLeftTop}\r\n\t\t\t\t\t\tL${leftWallLeftBottom}\r\n\t\t\t\t\t\tL${leftWallRightBottom}\r\n\t\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t<path fill=\"${lightestColor}\"\r\n\t\t\t\t\t\td=\"M${blockBottomLeft}\r\n\t\t\t\t\t\tL${blockBottomTop}\r\n\t\t\t\t\t\tL${blockBottomRight}\r\n\t\t\t\t\t\tL${blockBottomLeft} Z\" />\r\n\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'w') {\r\n\r\n\t\t\tlet leftWallLeftTop = `${left.x-this.bleed} ${left.y-height}`\r\n\t\t\tlet leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet leftWallRightBottom = `${bottom.x} ${bottom.y-height-this.tileH+this.bleed}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\t\td=\"M${leftWallLeftTop}\r\n\t\t\t\t\t\t\tL${leftWallLeftBottom}\r\n\t\t\t\t\t\t\tL${leftWallRightBottom}\r\n\t\t\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tif (slopeDirection === 'sw') {\r\n\r\n\t\t\tlet rightWallLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet rightWallRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tlet rightWallRightTop = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\r\n\t\t\tlet blockTopLeft = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tlet blockTopBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tlet blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH+this.bleed}`\r\n\t\t\tlet blockTopTop = `${top.x} ${top.y-height}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\t\t\td=\"M${rightWallLeftBottom}\r\n\t\t\t\t\t\t\tL${rightWallRightBottom}\r\n\t\t\t\t\t\t\tL${rightWallRightTop}\r\n\t\t\t\t\t\t\tL${rightWallLeftBottom} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${regularDarkerColor}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopTop}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t\t<path fill=\"${shadow}\"\r\n\t\t\t\t\t\t\td=\"M${blockTopLeft}\r\n\t\t\t\t\t\t\tL${blockTopBottom}\r\n\t\t\t\t\t\t\tL${blockTopRight}\r\n\t\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreatePillarBlock(xPos: number, yPos: number, tile: Tile): TileTemplate {\r\n\r\n\t\tlet id = tile.id\r\n\t\tlet tileWidth = this.config.tileWidth\r\n\t\tlet height = (tile.h * this.tileH) - this.tileH\r\n\r\n\t\tlet regularColor\r\n\t\tlet highlight\r\n\t\tlet darkestColor\r\n\r\n\t\tif (tile.tileColor.hex() !== this.config.buildingBaseColor.hex()) {\r\n\t\t\tregularColor = tile.tileColor.hex()\r\n\t\t\thighlight = tile.tileColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = tile.tileColor.changeColorLightingString(-60)\r\n\t\t} else {\r\n\t\t\tregularColor = this.config.buildingBaseColor.hex()\r\n\t\t\thighlight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = this.config.buildingBaseColor.changeColorLightingString(-60)\r\n\t\t}\t\r\n\r\n\t\tconst { top, left, bottom, right } = this.getPositions(xPos, yPos, this.config.topMargin)\r\n\r\n\t\tconst leftWallLeftTop = `${left.x-this.bleed + (tileWidth / 2.7)} ${left.y-height-this.tileH}`\r\n\t\tconst leftWallLeftBottom = `${left.x-this.bleed + (tileWidth / 2.7)} ${left.y-height}`\r\n\r\n\t\tconst rightWallRightBottom = `${right.x+this.bleed - (tileWidth / 2.7)} ${right.y-height}`\r\n\t\tconst rightWallRightTop = `${right.x+this.bleed - (tileWidth / 2.7)} ${right.y-height-this.tileH}`\r\n\r\n\t\tconst leftWallBezier = `${left.x-this.bleed + (tileWidth / 2.7) + (tileWidth / 12)} ${bottom.y-height}`\r\n\t\tconst rightWallBezier = `${right.x-this.bleed - (tileWidth / 2.7) - (tileWidth / 12)} ${bottom.y-height}`\r\n\r\n\t\tconst blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\tconst blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\tconst blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\t\tconst blockTopTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\tlet html = `<g style=\"z-index:${id};\">\r\n\t\t\t<defs>${this.calculations.addGradient(\"pillarGradient\", darkestColor, regularColor)}</defs> \r\n\t\t\t<path fill=\"url(#pillarGradient)\"\r\n\t\t\t d=\"M ${leftWallLeftTop} \r\n\t\t\tL ${leftWallLeftBottom} \r\n\t\t\tC ${leftWallBezier}, ${rightWallBezier}, ${rightWallRightBottom} \r\n\t\t\tL ${rightWallRightTop} \r\n\t\t\tL ${leftWallLeftTop} Z\" /></g>`\r\n\r\n\t\tlet coords: Coords = { \"top\": top, \"left\": left, \"bottom\": bottom, \"right\": right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreateWindow(xPos: number, yPos: number, tile: Tile, columnInfo: Column, windowLights: boolean): TileTemplate {\r\n\r\n\t\tlet id = tile.id\r\n\t\tlet height = (tile.h * this.tileH) - this.tileH\r\n\t\tlet regularColor = '#222'\r\n\t\tlet darkestColor = '#111'\r\n\t\tlet light = '#f3ef76'\r\n\r\n\t\tconst { top, left, bottom, right } = this.getPositions(xPos, yPos, this.config.topMargin)\r\n\r\n\t\tlet coords: Coords = { top: top, left: left, bottom: bottom, right: right }\r\n\r\n\t\tlet windowBorderWidth = (top.x - left.x) / 10\r\n\r\n\t\tlet html = `<g style=\"z-index:${id+columnInfo.height};\">`\r\n\r\n\t\tif (columnInfo.edge.bottom) {\r\n\r\n\t\t\tconst xEdge = (bottom.x - left.x) / 3\r\n\t\t\tconst yEdge = (bottom.y - left.y) / 8\r\n\r\n\t\t\tconst leftWindowLeftTop = `${left.x + xEdge} ${left.y - height - this.tileH + (yEdge * 7)}`\r\n\t\t\tconst leftWindowLeftBottom = `${left.x + xEdge} ${left.y - height + (yEdge)}`\r\n\t\t\tconst leftWindowRightBottom = `${bottom.x - xEdge} ${bottom.y - height - (yEdge * 4)}`\r\n\t\t\tconst leftWindowRightTop = `${bottom.x - xEdge} ${bottom.y - height - this.tileH + (yEdge * 2)}`\r\n\t\t\tconst leftWindowRightBezier = `${bottom.x - xEdge} ${bottom.y - height - this.tileH - yEdge}`\r\n\t\t\tconst leftWindowLeftBezier = `${left.x + xEdge} ${left.y - height - this.tileH + (yEdge * 4)}`\r\n\r\n\t\t\tlet windowColor = darkestColor\r\n\t\t\tif (windowLights) {\r\n\t\t\t\tlet windowColor = (Math.round(Math.random() * 20) > 18) ? light : darkestColor\r\n\t\t\t}\t\t\r\n\r\n\t\t\thtml += `<path fill=\"${windowColor}\"\r\n\t\t\t\t\t\td=\"M${leftWindowLeftTop} \r\n\t\t\t\t\t\tL${leftWindowLeftBottom} \r\n\t\t\t\t\t\tL${leftWindowRightBottom} \r\n\t\t\t\t\t\tL${leftWindowRightTop} \r\n\t\t\t\t\t\tC${leftWindowRightBezier}, ${leftWindowLeftBezier}, ${leftWindowLeftTop} Z\" />`\r\n\t\t}\r\n\r\n\t\t\r\n\t\tif (columnInfo.edge.right) {\r\n\r\n\t\t\tconst xEdge = (right.x - bottom.x) / 3\r\n\t\t\tconst yEdge = (right.y - bottom.y) / 8\r\n\r\n\t\t\tconst rightWindowLeftTop = `${bottom.x + xEdge} ${bottom.y - height - this.tileH - (yEdge * 2)}`\r\n\t\t\tconst rightWindowLeftBottom = `${bottom.x + xEdge} ${bottom.y - height + (yEdge * 3.6)}`\r\n\t\t\tconst rightWindowRightBottom = `${right.x - xEdge} ${right.y - height - (yEdge * 1)}`\r\n\t\t\tconst rightWindowRightTop = `${right.x - xEdge} ${right.y - height - this.tileH - (yEdge * 6.5)}`\r\n\t\t\tconst rightWindowRightBezier = `${right.x - xEdge} ${right.y - height - this.tileH - (yEdge * 3.2)}`\r\n\t\t\tconst rightWindowLeftBezier = `${bottom.x + xEdge} ${bottom.y - height - this.tileH + (yEdge * 0.3)}`\r\n\t\t\t\r\n\t\t\tlet windowColor = regularColor\r\n\t\t\tif (windowLights) {\r\n\t\t\t\tlet windowColor = (Math.round(Math.random() * 20) > 18) ? light : regularColor\r\n\t\t\t}\t\r\n\r\n\t\t\thtml += `<path fill=\"${windowColor}\"\r\n\t\t\t\t\t\td=\"M${rightWindowLeftTop} \r\n\t\t\t\t\t\tL${rightWindowLeftBottom} \r\n\t\t\t\t\t\tL${rightWindowRightBottom} \r\n\t\t\t\t\t\tL${rightWindowRightTop} \r\n\t\t\t\t\t\tC${rightWindowRightBezier}, ${rightWindowLeftBezier}, ${rightWindowLeftTop} Z\" />`\r\n\t\t}\r\n\r\n\t\thtml += `</g>`\t\t\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreateDoor(xPos: number, yPos: number, tile: Tile, columnInfo: Column, direction?: string): TileTemplate {\r\n\r\n\t\tconst id = tile.id\r\n\t\tconst height = (tile.h * this.tileH) - this.tileH\r\n\t\tlet regularColor\r\n\t\tlet darkestColor\r\n\t\tlet doorHandleColor\r\n\r\n\t\tif (tile.tileColor.hex() !== this.config.buildingBaseColor.hex()) {\r\n\t\t\tdoorHandleColor = new Color(tile.tileColor.hex()).getColorByHue(110).changeColorLightingString(60)\r\n\t\t\tregularColor = new Color(tile.tileColor.hex()).getColorByHue(220).changeColorLightingString(-80)\r\n\t\t\tdarkestColor = new Color(tile.tileColor.hex()).getColorByHue(220).changeColorLightingString(-110)\r\n\t\t} else {\r\n\t\t\tdoorHandleColor = new Color(this.config.buildingBaseColor.hex()).getColorByHue(110).changeColorLightingString(60)\r\n\t\t\tregularColor = new Color(this.config.buildingBaseColor.hex()).getColorByHue(220).changeColorLightingString(-80)\r\n\t\t\tdarkestColor = new Color(this.config.buildingBaseColor.hex()).getColorByHue(220).changeColorLightingString(-110)\r\n\t\t}\r\n\r\n\t\tconst { top, left, bottom, right } = this.getPositions(xPos, yPos, this.config.topMargin)\r\n\r\n\t\tconst coords: Coords = { top: top, left: left, bottom: bottom, right: right }\r\n\r\n\t\tconst windowBorderWidth = (top.x - left.x) / 10\r\n\r\n\t\tlet html = `<g style=\"z-index:${id+columnInfo.height};\">`\r\n\r\n\t\tif (direction === 'bottom') {\r\n\r\n\t\t\tlet xEdge = (bottom.x - left.x) / 4\r\n\t\t\tlet yEdge = (bottom.y - left.y) / 8\r\n\r\n\t\t\tconsole.log(yEdge)\r\n\r\n\t\t\tconst leftWindowLeftTop = `${left.x + xEdge} ${left.y - height - this.tileH + (yEdge * 4.5)}`\r\n\t\t\tconst leftWindowLeftBottom = `${left.x + xEdge} ${left.y - height + (yEdge * 2)}`\r\n\t\t\tconst leftWindowRightBottom = `${bottom.x - xEdge} ${bottom.y - height - (yEdge * 2)}`\r\n\t\t\tconst leftWindowRightTop = `${bottom.x - xEdge} ${bottom.y - height - this.tileH + (yEdge * 0.5)}`\r\n\r\n\t\t\tconst leftWindowBorderLeftTop = `${left.x + xEdge} ${left.y - height - this.tileH + (yEdge * 4.5)}`\r\n\t\t\tconst leftWindowBorderRightBottom = `${bottom.x - xEdge} ${bottom.y - height - (yEdge * 2)}`\r\n\t\t\tconst leftWindowBorderRightTop = `${bottom.x - xEdge} ${bottom.y - height - this.tileH + (yEdge * 0.5)}`\r\n\r\n\t\t\thtml += `<path stroke=\"#111\" stroke-width=\"1.3\"\r\n\t\t\t\t\t\td=\"M${leftWindowBorderLeftTop}\r\n\t\t\t\t\t\tL${leftWindowBorderRightTop}\r\n\t\t\t\t\t\tL${leftWindowBorderRightBottom}\" />\r\n\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\td=\"M${leftWindowLeftTop} \r\n\t\t\t\t\t\tL${leftWindowLeftBottom} \r\n\t\t\t\t\t\tL${leftWindowRightBottom} \r\n\t\t\t\t\t\tL${leftWindowRightTop} \r\n\t\t\t\t\t\tL${leftWindowLeftTop} Z\" />\r\n\t\t\t\t\t<circle fill=\"${doorHandleColor}\" \r\n\t\t\t\t\t\tcx=\"${left.x + (xEdge * 1.4)}\" \r\n\t\t\t\t\t\tcy=\"${bottom.y - height - this.tileH + (yEdge * 2.8)}\" \r\n\t\t\t\t\t\tr=\"0.8\" />`\r\n\t\t}\r\n\r\n\t\t\r\n\t\tif (direction === 'right') {\r\n\r\n\t\t\tconst xEdge = (right.x - bottom.x) / 4\r\n\t\t\tconst yEdge = (right.y - bottom.y) / 8\r\n\r\n\t\t\tconst rightWindowLeftTop = `${bottom.x + xEdge} ${bottom.y - height - this.tileH - (yEdge)}`\r\n\t\t\tconst rightWindowLeftBottom = `${bottom.x + xEdge} ${bottom.y - height + (yEdge * 2)}`\r\n\t\t\tconst rightWindowRightBottom = `${right.x - xEdge} ${right.y - height - (yEdge * 1.5)}`\r\n\t\t\tconst rightWindowRightTop = `${right.x - xEdge} ${right.y - height - this.tileH - (yEdge * 4.5)}`\r\n\r\n\t\t\thtml += `<path stroke=\"#444\" stroke-width=\"1.3\"\r\n\t\t\t\t\t\td=\"M${rightWindowRightTop}\r\n\t\t\t\t\t\tL${rightWindowLeftTop}\r\n\t\t\t\t\t\tL${rightWindowLeftBottom}\" />\r\n\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\t\td=\"M${rightWindowLeftTop} \r\n\t\t\t\t\t\tL${rightWindowLeftBottom} \r\n\t\t\t\t\t\tL${rightWindowRightBottom} \r\n\t\t\t\t\t\tL${rightWindowRightTop} \r\n\t\t\t\t\t\tL${rightWindowLeftTop} Z\" />\r\n\t\t\t\t\t<circle fill=\"${doorHandleColor}\" \r\n\t\t\t\t\t\tcx=\"${bottom.x + (xEdge * 1.3)}\" \r\n\t\t\t\t\t\tcy=\"${bottom.y - height - this.tileH - (yEdge * 4.5)}\" \r\n\t\t\t\t\t\tr=\"0.8\" />`\r\n\t\t}\r\n\r\n\t\thtml += `</g>`\t\t\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreateHalfArch(xPos: number, yPos: number, tile: Tile, orientation: string): TileTemplate {\r\n\r\n\t\tconst id = tile.id\r\n\t\tconst height = (tile.h * this.tileH) - this.tileH\r\n\t\tlet regularColor\r\n\t\tlet darkestColor\r\n\t\tlet highlight\r\n\t\tlet highlightLeft\r\n\t\tlet highlightRight\r\n\t\tlet html\r\n\r\n\t\tif (tile.tileColor.hex() !== this.config.buildingBaseColor.hex()) {\r\n\t\t\tregularColor = tile.tileColor.hex()\r\n\t\t\thighlight = tile.tileColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = tile.tileColor.changeColorLightingString(-60)\r\n\t\t\thighlightLeft = tile.tileColor.changeColorLightingString(15)\r\n\t\t\thighlightRight = tile.tileColor.changeColorLightingString(30)\r\n\t\t} else {\r\n\t\t\tregularColor = this.config.buildingBaseColor.hex()\r\n\t\t\thighlight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t\tdarkestColor = this.config.buildingBaseColor.changeColorLightingString(-60)\r\n\t\t\thighlightLeft = this.config.buildingBaseColor.changeColorLightingString(15)\r\n\t\t\thighlightRight = this.config.buildingBaseColor.changeColorLightingString(30)\r\n\t\t}\r\n\r\n\t\tconst { top, left, bottom, right } = this.getPositions(xPos, yPos, this.config.topMargin)\r\n\r\n\t\tconst halfTileWidth = ((right.x - bottom.x) / 3)\r\n\r\n\t\tif (orientation === 'right-bottom') {\r\n\r\n\t\t\tconst leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tconst leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tconst leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tconst leftWallRightTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\r\n\t\t\tconst rightWallLeftTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\t\tconst rightWallLeftBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tconst rightWallLeftBottomBezier = `${bottom.x} ${bottom.y-height-(this.tileH * 0.5)}`\r\n\t\t\tconst rightWallRightTopBezier = `${bottom.x + (halfTileWidth*0.4)} ${bottom.y-height-this.tileH}`\r\n\t\t\tconst rightWallRightTop = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\r\n\t\t\tconst blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tconst blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\t\tconst blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\t\t\tconst blockTopTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\td=\"M${leftWallLeftTop} \r\n\t\t\t\t\t\tL${leftWallLeftBottom} \r\n\t\t\t\t\t\tL${leftWallRightBottom} \r\n\t\t\t\t\t\tL${leftWallRightTop} \r\n\t\t\t\t\t\tL${leftWallLeftTop} Z\" />\r\n\t\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\t\td=\"M${rightWallLeftTop} \r\n\t\t\t\t\t\tL${rightWallLeftBottom}\r\n\t\t\t\t\t\tC${rightWallLeftBottomBezier}, ${rightWallRightTopBezier}, ${rightWallRightTop}\r\n\t\t\t\t\t\tL${rightWallLeftTop} Z\" />\r\n\t\t\t\t\t\t<path fill=\"${highlight}\"\r\n\t\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\t\tL${blockTopBottom} \r\n\t\t\t\t\t\tL${blockTopRight} \r\n\t\t\t\t\t\tL${blockTopTop} \r\n\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t</g>`\r\n\r\n\t\t} \r\n\r\n\t\tif (orientation === 'right-top') {\r\n\r\n\t\t\tconst leftWallLeftTop = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tconst leftWallLeftBottom = `${left.x-this.bleed} ${left.y-height+this.bleed}`\r\n\t\t\tconst leftWallRightBottom = `${bottom.x} ${bottom.y-height+this.bleed}`\r\n\t\t\tconst leftWallRightTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\r\n\t\t\tconst rightWallLeftTop = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\t\tconst rightWallLeftTopBezier = `${right.x+this.bleed-(halfTileWidth*0.3)} ${right.y-height-(this.tileH*0.7)}`\r\n\t\t\tconst rightWallRightBottomBezier = `${right.x} ${right.y-height-(this.tileH*0.4)}`\r\n\t\t\tconst rightWallRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tconst rightWallRightTop = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\r\n\t\t\tconst blockTopLeft = `${left.x-this.bleed} ${left.y-height-this.tileH}`\r\n\t\t\tconst blockTopBottom = `${bottom.x} ${bottom.y-height-this.tileH}`\r\n\t\t\tconst blockTopRight = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\t\t\tconst blockTopTop = `${top.x} ${top.y-height-this.tileH}`\r\n\r\n\t\t\tconst blockBackRightBottom = `${right.x+this.bleed} ${right.y-height+this.bleed}`\r\n\t\t\tconst blockBackLeftBottom = `${right.x+this.bleed} ${right.y-height-this.tileH}`\r\n\t\t\tconst blockBackLeftTop = `${top.x-this.bleed} ${top.y-height-this.tileH}`\r\n\t\t\tconst blockBackRightTop = `${top.x-this.bleed} ${top.y-height}`\r\n\r\n\t\t\thtml = `<g style=\"z-index:${id};\">\r\n\t\t\t\t\t\t<path fill=\"${darkestColor}\"\r\n\t\t\t\t\t\td=\"M${blockBackRightBottom} \r\n\t\t\t\t\t\tL${blockBackLeftBottom} \r\n\t\t\t\t\t\tL${blockBackLeftTop} \r\n\t\t\t\t\t\tL${blockBackRightTop} \r\n\t\t\t\t\t\tL${blockBackRightBottom} Z\" />\r\n\t\t\t\t\t\t<path fill=\"${regularColor}\"\r\n\t\t\t\t\t\td=\"M${rightWallLeftTop} \r\n\t\t\t\t\t\tC${rightWallLeftTopBezier}, ${rightWallRightBottomBezier}, ${rightWallRightBottom}\r\n\t\t\t\t\t\tL${rightWallRightTop} \r\n\t\t\t\t\t\tL${rightWallLeftTop} Z\" />\r\n\t\t\t\t\t\t<path fill=\"${highlight}\"\r\n\t\t\t\t\t\td=\"M${blockTopLeft} \r\n\t\t\t\t\t\tL${blockTopBottom} \r\n\t\t\t\t\t\tL${blockTopRight} \r\n\t\t\t\t\t\tL${blockTopTop} \r\n\t\t\t\t\t\tL${blockTopLeft} Z\" />\r\n\t\t\t\t\t</g>`\r\n\t\t}\r\n\r\n\t\tconst coords: Coords = { top: top, left: left, bottom: bottom, right: right }\r\n\r\n\t\treturn { html: html, coords: coords }\r\n\t}\r\n\r\n\tcreateTowerTop(xPos: number, yPos: number, tile: Tile) {\r\n\r\n\t\tconsole.log('tile', tile);\r\n\t}\r\n\r\n\r\n\tcreateTree(xPos: number, yPos: number) {\r\n\r\n\t\tconst x = xPos\r\n\t\tconst y = yPos\r\n\r\n\t\tconst darkGreen = '#007c36'\r\n\t\tconst lightGreen = '#5fb875'\r\n\t\tconst darkBrown = '#443422'\r\n\t\tconst lightBrown = '#664c2c'\r\n\t\tconst shadowFull = '#00000744'\r\n\t\tconst shadowEmpty = '#02001e00'\r\n\r\n\t\tconst treeHtml = `\r\n\t\t<defs>${this.calculations.addGradient(\"woodGradient\", darkBrown, lightBrown)}</defs> \r\n\t\t<defs>${this.calculations.addGradient(\"leafGradient\", darkGreen, lightGreen)}</defs>\r\n\t\t<defs>${this.calculations.addGradient(\"shadow\", shadowEmpty, shadowFull)}</defs>\r\n\t\t\t<path fill=\"url(#woodGradient)\" \r\n\t\t\td=\"M${x+34.3} ${y+89.4}\r\n\t\t\tl-0.4 21.3\r\n\t\t\tc0,0,0.2 3.9,4.2 3.9\r\n\t\t\tc3.4 0 3.5-4.4 3.5-4.4\r\n\t\t\tl-0.5-20.8\r\n\t\t\tL${x+34.3} ${y+89.4} z\"/>\t\t\t\r\n\t\t\t<path fill=\"url(#leafGradient)\"\r\n\t\t\td=\"M${x+38.6} ${y+32.8}\r\n\t\t\tc-9.9 0-18.5 20-18.5 39.7\r\n\t\t\ts12.4 23.1 18.1 23.1\r\n\t\t\ts17.8-4.3 17.8-23.2\r\n\t\t\tS${x+45.5} ${y+32.8} ${x+38.6} ${y+32.8} z\"/>\r\n\t\t\t<polygon fill=\"url(#shadow)\" \r\n\t\t\tpoints=\"${x+34.8} ${y+111} ${x+25.7} ${y+115.7} ${x+32.8} ${y+118.8} ${x+41} ${y+113}\"/>`\r\n\r\n\t\treturn { html: treeHtml }\r\n\t}\r\n}","import { Color } from './colors.component'\r\nimport { TileType } from './enums/tile-type.enum'\r\nimport { TileOptions } from './interfaces/tile-options.interface'\r\n\r\nexport class Tile {\r\n\t\r\n\t_id: number\r\n\t_x: number\r\n\t_y: number\r\n\t_h: number\r\n\t_tileType: TileType\r\n\t_tileColor: Color\r\n\t_options?: TileOptions\r\n\r\n\tconstructor(\t\t\t\r\n\t\t\tid: number,\r\n\t\t\tx: number,\r\n\t\t\ty: number,\r\n\t\t\th: number,\r\n\t\t\ttileType: TileType,\r\n\t\t\ttileColor: Color,\r\n\t\t\toptions?: TileOptions)\r\n\t{\r\n\t\tthis._id = id\r\n\t\tthis._x = x\r\n\t\tthis._y = y\r\n\t\tthis._h = h\r\n\t\tthis._tileType = tileType\r\n\t\tthis._tileColor = tileColor\r\n\r\n\t\tif (options) {\r\n\t\t\tthis._options = options\r\n\t\t}\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\treturn this._id\r\n\t}\r\n\r\n\tget x(): number {\r\n\t\treturn this._x\r\n\t}\r\n\r\n\tget y(): number {\r\n\t\treturn this._y\r\n\t}\r\n\r\n\tget h(): number {\r\n\t\treturn this._h\r\n\t}\r\n\r\n\tget type(): TileType {\r\n\t\treturn this._tileType\r\n\t}\r\n\r\n\tget options(): TileOptions | undefined {\r\n\t\tif (this._options) {\r\n\t\t\treturn this._options\r\n\t\t} else {\r\n\t\t\treturn undefined\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getColor(): Color {\r\n\t\treturn this._tileColor\r\n\t}\r\n\r\n\tget tileColor(): Color {\r\n\t\treturn this._tileColor\r\n\t}\r\n\r\n\tset tileColor(color: Color) {\r\n\t\tthis._tileColor = color\r\n\t}\r\n\r\n\tset type(type: TileType) {\r\n\t\tthis._tileType = type\r\n\t}\r\n}"]}